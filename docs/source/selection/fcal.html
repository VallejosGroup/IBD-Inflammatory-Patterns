<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Nathan Constantine-Cooke">
<meta name="author" content="Karla Monterrubio-Gómez">
<meta name="author" content="Catalina A. Vallejos">
<meta name="dcterms.date" content="2024-12-13">
<title>Analysis by Constantine-Cooke et al.&nbsp;- Model selection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Analysis by Constantine-Cooke et al.&nbsp;- Model selection">
<meta property="og:description" content="Faecal calprotectin">
<meta property="og:site_name" content="Analysis by Constantine-Cooke et al.">
<meta name="twitter:title" content="Analysis by Constantine-Cooke et al.&nbsp;- Model selection">
<meta name="twitter:description" content="Faecal calprotectin">
<meta name="twitter:creator" content="@IBDNathan">
<meta name="twitter:site" content="@EdinUni_IGC">
<meta name="twitter:card" content="summary">
<meta name="citation_title" content="Model selection">
<meta name="citation_author" content="Nathan Constantine-Cooke">
<meta name="citation_author" content="Karla Monterrubio-Gómez">
<meta name="citation_author" content="Catalina A. Vallejos">
<meta name="citation_publication_date" content="2024-12-13">
<meta name="citation_cover_date" content="2024-12-13">
<meta name="citation_year" content="2024">
<meta name="citation_online_date" content="2024-12-13">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Longitudinal Fecal Calprotectin Profiles Characterize Disease Course Heterogeneity in Crohn’s Disease;,citation_author=Nathan Constantine-Cooke;,citation_author=Karla Monterrubio-Gómez;,citation_author=Nikolas Plevris;,citation_author=Lauranne A. A. P. Derikx;,citation_author=Beatriz Gros;,citation_author=Gareth-Rhys Jones;,citation_author=Riccardo E. Marioni;,citation_author=Charlie W. Lees;,citation_author=Catalina A. Vallejos;,citation_publication_date=2023-03;,citation_cover_date=2023-03;,citation_year=2023;,citation_fulltext_html_url=https://linkinghub.elsevier.com/retrieve/pii/S1542356523002343;,citation_doi=10.1016/j.cgh.2023.03.026;,citation_issn=15423565;,citation_journal_title=Clinical Gastroenterology and Hepatology;">
<meta name="citation_reference" content="citation_title=Increasing incidences of inflammatory bowel disease and decreasing surgery rates in copenhagen city and county, 20032005: A population-based study from the danish crohn colitis database;,citation_author=Ida Vind;,citation_author=Lene Riis;,citation_author=Tine Jess;,citation_author=Elisabeth Knudsen;,citation_author=Natalia Pedersen;,citation_author=Margarita Elkjær;,citation_author=Inger Bak Andersen;,citation_author=Vibeke Wewer;,citation_author=Peter Nørregaard;,citation_author=Flemming Moesgaard;,citation_author=Flemming Bendtsen;,citation_author=Pia Munkholm;,citation_publication_date=2006-06;,citation_cover_date=2006-06;,citation_year=2006;,citation_fulltext_html_url=https://doi.org/10.1111%2Fj.1572-0241.2006.00552.x;,citation_issue=6;,citation_doi=10.1111/j.1572-0241.2006.00552.x;,citation_volume=101;,citation_journal_title=The American Journal of Gastroenterology;,citation_publisher=Ovid Technologies (Wolters Kluwer Health);">
<meta name="citation_reference" content="citation_title=Using linear and natural cubic splines, SITAR, and latent trajectory models to characterise nonlinear longitudinal growth trajectories in cohort studies;,citation_abstract=Longitudinal data analysis can improve our understanding of the influences on health trajectories across the life-course. There are a variety of statistical models which can be used, and their fitting and interpretation can be complex, particularly where there is a nonlinear trajectory. Our aim was to provide an accessible guide along with applied examples to using four sophisticated modelling procedures for describing nonlinear growth trajectories.;,citation_author=Ahmed Elhakeem;,citation_author=Rachael A. Hughes;,citation_author=Kate Tilling;,citation_author=Diana L. Cousminer;,citation_author=Stefan A. Jackowski;,citation_author=Tim J. Cole;,citation_author=Alex S. F. Kwong;,citation_author=Zheyuan Li;,citation_author=Struan F. A. Grant;,citation_author=Adam D. G. Baxter-Jones;,citation_author=Babette S. Zemel;,citation_author=Deborah A. Lawlor;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://doi.org/10.1186/s12874-022-01542-8;,citation_issue=1;,citation_doi=10.1186/s12874-022-01542-8;,citation_isbn=1471-2288;,citation_volume=22;,citation_journal_title=BMC Medical Research Methodology;">
<meta name="citation_reference" content="citation_title=Estimation of extended mixed models using latent classes and latent processes: The R package lcmm;,citation_author=Cécile Proust-Lima;,citation_author=Viviane Philipps;,citation_author=Benoit Liquet;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=2;,citation_doi=10.18637/jss.v078.i02;,citation_volume=78;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=Temporal trends in surgical resection rates and biologic prescribing in crohn’s disease: A population-based cohort study;,citation_author=P W Jenkinson;,citation_author=N Plevris;,citation_author=S Siakavellas;,citation_author=M Lyons;,citation_author=I D Arnott;,citation_author=D Wilson;,citation_author=A J M Watson;,citation_author=G-R Jones;,citation_author=C W Lees;,citation_publication_date=2020-08;,citation_cover_date=2020-08;,citation_year=2020;,citation_fulltext_html_url=https://doi.org/10.1093%2Fecco-jcc%2Fjjaa044;,citation_issue=9;,citation_doi=10.1093/ecco-jcc/jjaa044;,citation_volume=14;,citation_journal_title=Journal of Crohns and Colitis;,citation_publisher=Oxford University Press (OUP);">
<meta name="citation_reference" content="citation_title=IBD prevalence in lothian, scotland, derived by capture-recapture methodology;,citation_author=Gareth-Rhys Jones;,citation_author=Mathew Lyons;,citation_author=Nikolas Plevris;,citation_author=Philip W Jenkinson;,citation_author=Cathy Bisset;,citation_author=Christopher Burgess;,citation_author=Shahida Din;,citation_author=James Fulforth;,citation_author=Paul Henderson;,citation_author=Gwo-Tzer Ho;,citation_author=Kathryn Kirkwood;,citation_author=Colin Noble;,citation_author=Alan G Shand;,citation_author=David C Wilson;,citation_author=Ian DR Arnott;,citation_author=Charlie W Lees;,citation_publication_date=2019-07;,citation_cover_date=2019-07;,citation_year=2019;,citation_fulltext_html_url=https://doi.org/10.1136%2Fgutjnl-2019-318936;,citation_issue=11;,citation_doi=10.1136/gutjnl-2019-318936;,citation_volume=68;,citation_journal_title=Gut;,citation_publisher=BMJ;">
<meta name="citation_reference" content="citation_title=General Aspects of Fitting Regression Models;,citation_abstract=The ordinary multiple linear regression model is frequently used and has parameters that are easily interpreted. In this chapter we study a general class of regression models, those stated in terms of a weighted sum of a set of independent or predictor variables. It is shown that after linearizing the model with respect to the predictor variables, the parameters in such regression models are also readily interpreted. Also, all the designs used in ordinary linear regression can be used in this general setting. These designs include analysis of variance (ANOVAANOVA) setups, interaction effects, and nonlinear effects. Besides describing and interpreting general regression models, this chapter also describes, in general terms, how the three types of assumptions of regression models can be examined.;,citation_author=Frank E. Harrell;,citation_editor=Jr. Harrell;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_doi=10.1007/978-3-319-19425-7_2;,citation_isbn=978-3-319-19425-7;,citation_language=en-US;,citation_inbook_title=Regression Modeling Strategies: With Applications to Linear Models, Logistic and Ordinal Regression, and Survival Analysis;,citation_series_title=Springer Series in Statistics;">
<meta name="citation_reference" content="citation_title=A biomarker-stratified comparison of top-down versus accelerated step-up treatment strategies for patients with newly diagnosed crohn’s disease (PROFILE): A multicentre, open-label randomised controlled trial;,citation_abstract=Summary Background Management strategies and clinical outcomes vary substantially in patients newly diagnosed with Crohn’s disease. We evaluated the use of a putative prognostic biomarker to guide therapy by assessing outcomes in patients randomised to either top-down (ie, early combined immunosuppression with infliximab and immunomodulator) or accelerated step-up (conventional) treatment strategies. Methods PROFILE (PRedicting Outcomes For Crohn’s disease using a moLecular biomarker) was a multicentre, open-label, biomarker-stratified, randomised controlled trial that enrolled adults with newly diagnosed active Crohn’s disease (Harvey-Bradshaw Index ≥7, either elevated C-reactive protein or faecal calprotectin or both, and endoscopic evidence of active inflammation). Potential participants had blood drawn to be tested for a prognostic biomarker derived from T-cell transcriptional signatures (PredictSURE-IBD assay). Following testing, patients were randomly assigned, via a secure online platform, to top-down or accelerated step-up treatment stratified by biomarker subgroup (IBDhi or IBDlo), endoscopic inflammation (mild, moderate, or severe), and extent (colonic or other). Blinding to biomarker status was maintained throughout the trial. The primary endpoint was sustained steroid-free and surgery-free remission to week 48. Remission was defined by a composite of symptoms and inflammatory markers at all visits. Flare required active symptoms (HBI ≥5) plus raised inflammatory markers (CRP &amp;amp;amp;gt;upper limit of normal or faecal calprotectin ≥200 μg/g, or both), while remission was the converse—ie, quiescent symptoms (HBI &amp;lt;5) or resolved inflammatory markers (both CRP ≤ the upper limit of normal and calprotectin &amp;lt;200 μg/g) or both. Analyses were done in the full analysis (intention-to-treat) population. The trial has completed and is registered (ISRCTN11808228). Findings Between Dec 29, 2017, and Jan 5, 2022, 386 patients (mean age 33·6 years [SD 13·2]; 179 [46 Interpretation Top-down treatment with combination infliximab plus immunomodulator achieved substantially better outcomes at 1 year than accelerated step-up treatment. The biomarker did not show clinical utility. Top-down treatment should be considered standard of care for patients with newly diagnosed active Crohn’s disease. Funding Wellcome and PredictImmune Ltd.;,citation_author=Nurulamin M Noor;,citation_author=James C Lee;,citation_author=Simon Bond;,citation_author=Francis Dowling;,citation_author=Biljana Brezina;,citation_author=Kamal V Patel;,citation_author=Tariq Ahmad;,citation_author=Paul J Banim;,citation_author=James W Berrill;,citation_author=Rachel Cooney;,citation_author=Juan De La Revilla Negro;,citation_author=Shanika Silva;,citation_author=Shahida Din;,citation_author=Dharmaraj Durai;,citation_author=John N Gordon;,citation_author=Peter M Irving;,citation_author=Matthew Johnson;,citation_author=Alexandra J Kent;,citation_author=Klaartje B Kok;,citation_author=Gordon W Moran;,citation_author=Craig Mowat;,citation_author=Pritash Patel;,citation_author=Chris S Probert;,citation_author=Tim Raine;,citation_author=Rebecca Saich;,citation_author=Abigail Seward;,citation_author=Dan Sharpstone;,citation_author=Melissa A Smith;,citation_author=Sreedhar Subramanian;,citation_author=Sara S Upponi;,citation_author=Alan Wiles;,citation_author=Horace R T Williams;,citation_author=Gijs R Brink;,citation_author=Séverine Vermeire;,citation_author=Vipul Jairath;,citation_author=Geert R D’Haens;,citation_author=Eoin F McKinney;,citation_author=Paul A Lyons;,citation_author=James O Lindsay;,citation_author=Nicholas A Kennedy;,citation_author=Kenneth G C Smith;,citation_author=Miles Parkes;,citation_author=Nurulamin Noor;,citation_author=James Lee;,citation_author=Simon Bond;,citation_author=Francis Dowling;,citation_author=Biljana Brezina;,citation_author=Kamal Patel;,citation_author=Tariq Ahmad;,citation_author=Paul Banim;,citation_author=James Berrill;,citation_author=Rachel Cooney;,citation_author=Juan De La Revilla Negro;,citation_author=Shanika Silva;,citation_author=Shahida Din;,citation_author=Dharmaraj Durai;,citation_author=John Gordon;,citation_author=Peter Irving;,citation_author=Matthew Johnson;,citation_author=Alexandra Kent;,citation_author=Klaartje Bel Kok;,citation_author=Gordon Moran;,citation_author=Craig Mowat;,citation_author=Pritash Patel;,citation_author=Chris Probert;,citation_author=Tim Raine;,citation_author=Rebecca Saich;,citation_author=Abigail Seward;,citation_author=Dan Sharpstone;,citation_author=Melissa Smith;,citation_author=Sreedhar Subramanian;,citation_author=Sara Upponi;,citation_author=Alan Wiles;,citation_author=Horace Williams;,citation_author=Gijs Den Brink;,citation_author=Severine Vermeire;,citation_author=Vipul Jairath;,citation_author=Geert D’Haens;,citation_author=Eoin McKinney;,citation_author=Paul Lyons;,citation_author=James Lindsay;,citation_author=Nicholas Kennedy;,citation_author=Kenneth Smith;,citation_author=Miles Parkes;,citation_author=Clare Allcock;,citation_author=Suhaylah Bhatti;,citation_author=Jonathan Blackwell;,citation_author=Robert Boulton-Jones;,citation_author=Matthew Brookes;,citation_author=Rhys Butcher;,citation_author=Jeffrey Butterworth;,citation_author=Karlena Champion;,citation_author=Rakesh Chaudhary;,citation_author=Andy Cole;,citation_author=Lauranne Derikx;,citation_author=Anjan Dhar;,citation_author=Mary Flowerdew;,citation_author=Rishi Goel;,citation_author=Ailsa Hart;,citation_author=Rory Hughes;,citation_author=Babur Javaid;,citation_author=Paul Knight;,citation_author=Jacinta Lee;,citation_author=Charlie Lees;,citation_author=Emma Levell;,citation_author=Andy Li;,citation_author=Charles Murray;,citation_author=Leisha O’Brien;,citation_author=Gareth Parkes;,citation_author=Richard Pollok;,citation_author=Sam Powles;,citation_author=Arvind Ramdas;,citation_author=Philip Smith;,citation_author=Richard Ally Speight;,citation_author=Simon Travis;,citation_author=Sean Weaver;,citation_author=Emma Wesley;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S2468125324000347;,citation_issue=5;,citation_doi=https://doi.org/10.1016/S2468-1253(24)00034-7;,citation_issn=2468-1253;,citation_volume=9;,citation_journal_title=The Lancet Gastroenterology &amp;amp; Hepatology;">
<meta name="citation_reference" content="citation_title=Early combined immunosuppression or conventional management in patients with newly diagnosed crohn’s disease: An open randomised trial;,citation_abstract=Summary Background Most patients who have active Crohn’s disease are treated initially with corticosteroids. Although this approach usually controls symptoms, many patients become resistant to or dependent on corticosteroids, and long exposure is associated with an increased risk of mortality. We aimed to compare the effectiveness of early use of combined immunosuppression with conventional management in patients with active Crohn’s disease who had not previously received glucocorticoids, antimetabolites, or infliximab. Methods We did a 2-year open-label randomised trial at 18 centres in Belgium, Holland, and Germany between May, 2001, and January, 2004. We randomly assigned 133 patients to either early combined immunosuppression or conventional treatment. The 67 patients assigned to combined immunosuppression received three infusions of infliximab (5 mg/kg of bodyweight) at weeks 0, 2, and 6, with azathioprine. We gave additional treatment with infliximab and, if necessary, corticosteroids, to control disease activity. 66 patients assigned to conventional management received corticosteroids, followed, in sequence, by azathioprine and infliximab. The primary outcome measures were remission without corticosteroids and without bowel resection at weeks 26 and 52. Analysis was by modified intention to treat. This trial was registered with ClinicalTrials.gov, number NCT00554710. Findings Four patients (two in each group) did not receive treatment as per protocol. At week 26, 39 (60·0 Interpretation Combined immunosuppression was more effective than conventional management for induction of remission and reduction of corticosteroid use in patients who had been recently diagnosed with Crohn’s disease. Initiation of more intensive treatment early in the course of the disease could result in better outcomes.;,citation_author=Geert D’Haens;,citation_author=Filip Baert;,citation_author=Gert Assche;,citation_author=Philip Caenepeel;,citation_author=Philippe Vergauwe;,citation_author=Hans Tuynman;,citation_author=Martine De Vos;,citation_author=Sander Deventer;,citation_author=Larry Stitt;,citation_author=Allan Donner;,citation_author=Severine Vermeire;,citation_author=Frank J Van De Mierop;,citation_author=Jean-Charles R Coche;,citation_author=Janneke Woude;,citation_author=Thomas Ochsenkühn;,citation_author=Ad A Bodegraven;,citation_author=Philippe P Van Hootegem;,citation_author=Guy L Lambrecht;,citation_author=Fazia Mana;,citation_author=Paul Rutgeerts;,citation_author=Brian G Feagan;,citation_author=Daniel Hommes;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S0140673608603049;,citation_issue=9613;,citation_doi=https://doi.org/10.1016/S0140-6736(08)60304-9;,citation_issn=0140-6736;,citation_volume=371;,citation_journal_title=The Lancet;">
<meta name="citation_reference" content="citation_title=Incidence, prevalence, and racial and ethnic distribution of inflammatory bowel disease in the united states;,citation_author=James D. Lewis;,citation_author=Lauren E. Parlett;,citation_author=Michele L. Jonsson Funk;,citation_author=Colleen Brensinger;,citation_author=Virginia Pate;,citation_author=Qufei Wu;,citation_author=Ghadeer K. Dawwas;,citation_author=Alexandra Weiss;,citation_author=Brad D. Constant;,citation_author=Maureen McCauley;,citation_author=Kevin Haynes;,citation_author=Jeff Yufeng Yang;,citation_author=Douglas E. Schaubel;,citation_author=Andres Hurtado-Lorenzo;,citation_author=Michael David Kappelman;,citation_publication_date=2023-11;,citation_cover_date=2023-11;,citation_year=2023;,citation_fulltext_html_url=http://dx.doi.org/10.1053/j.gastro.2023.07.003;,citation_issue=5;,citation_doi=10.1053/j.gastro.2023.07.003;,citation_issn=0016-5085;,citation_volume=165;,citation_journal_title=Gastroenterology;,citation_publisher=Elsevier BV;">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Analysis by Constantine-Cooke et al.</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-before-model-fitting" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Before model fitting</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-before-model-fitting">
<li>
    <a class="dropdown-item" href="../../source/pre/preprocessing.html">
 <span class="dropdown-text">Preprocessing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/pre/baseline.html">
 <span class="dropdown-text">Baseline data</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-model-fitting" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Model fitting</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-model-fitting">
<li>
    <a class="dropdown-item" href="../../source/selection/fcal.html">
 <span class="dropdown-text">Faecal calprotectin</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/selection/crp.html">
 <span class="dropdown-text">C-reactive protein</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-after-model-fitting" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">After model fitting</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-after-model-fitting">
<li>
    <a class="dropdown-item" href="../../source/post/associations.html">
 <span class="dropdown-text">Associations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/post/FCALvsCRP.html">
 <span class="dropdown-text">Comparison between FC and CRP</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/VallejosGroup/Lothian-IBDR"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li>
<a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model specification</a>
  <ul class="collapse">
<li><a href="#model-statistics" id="toc-model-statistics" class="nav-link" data-scroll-target="#model-statistics">Model statistics</a></li>
  </ul>
</li>
  <li><a href="#model-loading" id="toc-model-loading" class="nav-link" data-scroll-target="#model-loading">Model loading</a></li>
  <li>
<a href="#fixed-effects-specified-via-natural-cubic-splines" id="toc-fixed-effects-specified-via-natural-cubic-splines" class="nav-link" data-scroll-target="#fixed-effects-specified-via-natural-cubic-splines">Fixed effects specified via Natural Cubic Splines</a>
  <ul class="collapse">
<li><a href="#knot-choice" id="toc-knot-choice" class="nav-link" data-scroll-target="#knot-choice">Knot choice</a></li>
  <li><a href="#number-of-clusters" id="toc-number-of-clusters" class="nav-link" data-scroll-target="#number-of-clusters">Number of clusters</a></li>
  <li><a href="#chosen-model-1" id="toc-chosen-model-1" class="nav-link" data-scroll-target="#chosen-model-1">Chosen model</a></li>
  </ul>
</li>
  <li>
<a href="#fixed-effects-specified-via-gaussian-radial-basis-functions" id="toc-fixed-effects-specified-via-gaussian-radial-basis-functions" class="nav-link" data-scroll-target="#fixed-effects-specified-via-gaussian-radial-basis-functions">Fixed effects specified via Gaussian radial basis functions</a>
  <ul class="collapse">
<li><a href="#number-of-gaussian-radial-basis-functions" id="toc-number-of-gaussian-radial-basis-functions" class="nav-link" data-scroll-target="#number-of-gaussian-radial-basis-functions">Number of Gaussian radial basis functions</a></li>
  <li><a href="#number-of-clusters-1" id="toc-number-of-clusters-1" class="nav-link" data-scroll-target="#number-of-clusters-1">Number of clusters</a></li>
  </ul>
</li>
  <li><a href="#ncs-vs-grbf-comparison" id="toc-ncs-vs-grbf-comparison" class="nav-link" data-scroll-target="#ncs-vs-grbf-comparison">NCS vs GRBF comparison</a></li>
  
  
  
  
  
  
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/VallejosGroup/Lothian-IBDR/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Model selection</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Faecal calprotectin</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://scholar.google.com/citations?user=2emHWR0AAAAJ&amp;hl=en&amp;oi=ao">Nathan Constantine-Cooke</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/centre-genomic-medicine">
            Centre for Genomic and Experimental Medicine
            </a>
          </p>
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/mrc-human-genetics-unit">
            MRC Human Genetics Unit
            </a>
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://scholar.google.com/citations?user=YmyxSXAAAAAJ&amp;hl=en">Karla Monterrubio-Gómez</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/mrc-human-genetics-unit">
            MRC Human Genetics Unit
            </a>
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://scholar.google.com/citations?user=lkdrwm0AAAAJ&amp;hl=en&amp;oi=ao">Catalina A. Vallejos</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/mrc-human-genetics-unit">
            MRC Human Genetics Unit
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 13, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"/.dockerenv"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># Check if running in Docker</span></span>
<span>  <span class="co"># Assume igmm/cvallejo-predicct/libdr/ is passed to the data volume</span></span>
<span>  <span class="va">prefix</span> <span class="op">&lt;-</span> <span class="st">"data/"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Assume running outside of a Docker container and the IGC(/IGMM) datastore is</span></span>
<span>  <span class="co"># mounted at /Volumes</span></span>
<span>  <span class="va">prefix</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/igmm/cvallejo-predicct/libdr/"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">##########################</span></span>
<span><span class="co">#--     Packages       --#</span></span>
<span><span class="co">##########################</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co"># Support package (source found in libdr/)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">libdr</span><span class="op">)</span></span>
<span><span class="co">## Modelling ##</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cecileproust-lima.github.io/lcmm/">lcmm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kml</span><span class="op">)</span> <span class="co"># K-means</span></span>
<span><span class="co">## Presentation ##</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/">pander</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aloy/qqplotr">qqplotr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">##########################</span></span>
<span><span class="co">#--     Data read      --#</span></span>
<span><span class="co">##########################</span></span>
<span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/dict.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/fcal.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dk.fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"Denmark/2024-11-29/Fcal_8_models.csv"</span><span class="op">)</span>,</span>
<span>                    sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This page describes how the latent class mixed models (LCMMs) were fitted to faecal calprotectin (FC). <a href="../../source/selection/crp.html">A separate page</a> is dedicated to C-reactive protein.</p>
<p>In order to not present subject-level data, subjects within each cluster have been collated into groups of six.</p>
</section><section id="model-specification" class="level2"><h2 class="anchored" data-anchor-id="model-specification">Model specification</h2>
<p>LCMMs are an extension of linear mixed effects models with an added cluster-specific fixed effect component. We use LCMMs with a natural cubic spline formulation for the fixed effects component. Random effects are specified as intercepts and the multinomial logistic regression model which assigns cluster membership uses IBD type (CD, UC, or IBDU) as a covariate.</p>
<p>For full formal definitions of the models and statistics we have used in the work, please refer to the supplementary material for our paper.</p>
<section id="model-statistics" class="level3"><h3 class="anchored" data-anchor-id="model-statistics">Model statistics</h3>
</section></section><section id="model-loading" class="level2"><h2 class="anchored" data-anchor-id="model-loading">Model loading</h2>
<p>Fitting the LCMMs discussed in this report takes multiple days in some cases and uses 25 CPU cores per model. We have fitted these models using <a href="https://www.ed.ac.uk/information-services/research-support/research-computing/ecdf/high-performance-computing">Eddie</a>, the University of Edinburgh’s high performance computing solution. The code in the dropdown box below was used to fit the models.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code used to fit models
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Initial LME</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">LCMM</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Modelling ##</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cecileproust-lima.github.io/lcmm/">lcmm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"fcal.RDS"</span><span class="op">)</span></span>
<span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="st">"cache"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"cache"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"m1.RDS"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m1</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://cecileproust-lima.github.io/lcmm/reference/hlme.html">hlme</a></span><span class="op">(</span>fixed <span class="op">=</span>  <span class="va">calpro_result</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span><span class="op">(</span><span class="va">calpro_time</span>,</span>
<span>                                          df <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                          Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              random <span class="op">=</span> <span class="op">~</span>  <span class="fl">1</span>,</span>
<span>              subject <span class="op">=</span> <span class="st">"ids"</span>,</span>
<span>              data <span class="op">=</span> <span class="va">fcal</span>,</span>
<span>              verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>              maxiter <span class="op">=</span> <span class="fl">8000</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">m1</span><span class="op">$</span><span class="va">conv</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"LME did not converge \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">m1</span>, <span class="st">"m1.RDS"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Finished fitting m1"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Modelling ##</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cecileproust-lima.github.io/lcmm/">lcmm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html">commandArgs</a></span><span class="op">(</span>trailingOnly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"fcal.RDS"</span><span class="op">)</span></span>
<span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="st">"cache"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"cache"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rep</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="co"># set the maximum number of iterations</span></span>
<span><span class="va">maxiter</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"m1.RDS"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"m1.RDS"</span><span class="op">)</span></span>
<span>  <span class="va">ng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># create a cluster</span></span>
<span>  <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeForkCluster</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># export the number of groups to the cluster</span></span>
<span>  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html">clusterExport</a></span><span class="op">(</span><span class="va">cl</span>, <span class="st">"ng"</span><span class="op">)</span></span>
<span>  <span class="co"># run gridsearch</span></span>
<span>  <span class="va">hlme.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cecileproust-lima.github.io/lcmm/reference/gridsearch.html">gridsearch</a></span><span class="op">(</span></span>
<span>    rep <span class="op">=</span> <span class="va">rep</span>,</span>
<span>    maxiter <span class="op">=</span> <span class="va">maxiter</span>,</span>
<span>    minit <span class="op">=</span> <span class="va">m1</span>,</span>
<span>    cl <span class="op">=</span> <span class="va">cl</span>,</span>
<span>    <span class="fu"><a href="https://cecileproust-lima.github.io/lcmm/reference/hlme.html">hlme</a></span><span class="op">(</span><span class="va">calpro_result</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span><span class="op">(</span><span class="va">calpro_time</span>,</span>
<span>                            df <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                            Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         mixture <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span><span class="op">(</span><span class="va">calpro_time</span>,</span>
<span>                        df <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                        Boundary.knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         random <span class="op">=</span> <span class="op">~</span>  <span class="fl">1</span>,</span>
<span>         subject <span class="op">=</span> <span class="st">"ids"</span>,</span>
<span>     classmb <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">diagnosis</span>,</span>
<span>         ng <span class="op">=</span> <span class="va">ng</span>,</span>
<span>         data <span class="op">=</span> <span class="va">fcal</span>,</span>
<span>         maxiter <span class="op">=</span> <span class="fl">24000</span>,</span>
<span>         verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         partialH <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># stop the cluster</span></span>
<span>  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">hlme.fit</span><span class="op">$</span><span class="va">conv</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Convergence achieved for "</span>, <span class="va">ng</span>, <span class="st">" subgroups ✅ \n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Convergence NOT achieved for "</span>, <span class="va">ng</span>, <span class="st">" subgroups ⚠️ \n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">hlme.fit</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cache/fcal-"</span>, <span class="va">ng</span>, <span class="st">".RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"m1 not found!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>As recommended by <span class="citation" data-cites="Proust-Lima2017">Proust-Lima, Philipps, and Liquet (<a href="#ref-Proust-Lima2017" role="doc-biblioref">2017</a>)</span>, a linear mixed effects model is first fitted to generate initial starting values, (the “Initial LME” tab). A grid search approach is then used to converge the LCMMs towards a global maximum for each assumed number of clusters based on maximum likelihood (the “LCMM” tab).</p>
<p>After the above code is run, the resultant models are saved in <code>cvallejo-predicct/libdr/cache/</code> for use in this report.</p>
<p>When an LCMM is fitted, the assumed number of clusters (<em>or “classes”</em>) must be specified a priori. Here we consider 4-8 clusters as 4 clusters were already found in our previous work <span class="citation" data-cites="constantine-cooke2023">(<a href="#ref-constantine-cooke2023" role="doc-biblioref">Constantine-Cooke et al. 2023</a>)</span>, and we expect to find at least as many clusters given our inclusion criteria is more relaxed.</p>
<p>A posteriori model statistics and visual investigations must be used to decide upon the optimum number of classes.</p>
</section><section id="fixed-effects-specified-via-natural-cubic-splines" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="fixed-effects-specified-via-natural-cubic-splines">Fixed effects specified via Natural Cubic Splines</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set the number of groups</span></span>
<span><span class="va">G.fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">models.fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">G.cands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">11</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">G.cand</span> <span class="kw">in</span> <span class="va">G.cands</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">file.name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"/cache/fcal/ncs/fcal-"</span>, <span class="va">G.cand</span>, <span class="st">".RDS"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file.name</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">G.fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">G.fcal</span>, <span class="va">G.cand</span><span class="op">)</span></span>
<span>    <span class="va">models.fcal</span><span class="op">[[</span><span class="va">G.cand</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">file.name</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">G.cand</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We firstly consider specifying fixed effects using NCS which have a few notable advantages <span class="citation" data-cites="Elhakeem2022">(<a href="#ref-Elhakeem2022" role="doc-biblioref">Elhakeem et al. 2022</a>)</span>:</p>
<ol type="1">
<li>Less parameters need to be estimated than either a GRBF function regression model or a polynomial regression model with the same flexibility. This reduces the time complexity when fitting the model and in the future may also make extensions more practically feasible.</li>
<li>NCS enforce linearity between <span class="math inline">t_0</span> and the first knot and between the last knot and <span class="math inline">t_\text{max}</span> which ensures the model does not behave erratically in these sometimes problematic areas.</li>
<li>NCS are not highly sensitive to a continuous parameter and instead requires only <span class="math inline">K</span>, the number of knots to be tuned. NCS are typically robust to where the knots themselves are placed.</li>
</ol>
<section id="knot-choice" class="level3"><h3 class="anchored" data-anchor-id="knot-choice">Knot choice</h3>
<p>To determine the most appropriate number of knots for the natural cubic splines, we considered two, three, and four knots. We only use six-cluster models for this analysis as this reasonably captures heterogeneity without being too expensive computationally.</p>
<p>Our previous work used three knots across a five-year period. As we are now modelling across a seven-year period, we may need to increase the number of knots to four to ensure the model remains flexible. We also considered two knots] in case a more smoooth model is required.</p>
<p>We place the knots at their default location which is at quantiles. We note that the number of knots is reported by <span class="citation" data-cites="harrell2015">Harrell (<a href="#ref-harrell2015" role="doc-biblioref">2015</a>)</span> to be much more important than knot location.</p>
<section id="model-trajectories" class="level4"><h4 class="anchored" data-anchor-id="model-trajectories">Model trajectories</h4>
<section id="one-knot" class="level5"><h5 class="anchored" data-anchor-id="one-knot">One knot</h5>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"/cache/fcal/ncs/1-knots.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">knots.1.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">knots.1.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">knots.1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="st">"paper/1-knots.pdf"</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.1.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.1.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-1-knots" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-1-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-1-knots-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Cluster profiles for the six-cluster model assuming one knot. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves
</figcaption></figure>
</div>
</div>
</div>
</section><section id="two-knots" class="level5"><h5 class="anchored" data-anchor-id="two-knots">Two knots</h5>
<p>From <a href="#fig-2-knots" class="quarto-xref">Figure&nbsp;2</a>, we can see specifying only two knots results in very smooth curves for the mean trajectory of each cluster. However, this model appears to be too smooth which results in a relatively poor fit.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"/cache/fcal/ncs/2-knots.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">knots.2.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">knots.2.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">knots.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="st">"paper/2-knots.pdf"</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.2.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.2.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-2-knots" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-2-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-2-knots-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Cluster profiles for the six-cluster model assuming two knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves
</figcaption></figure>
</div>
</div>
</div>
</section><section id="three-knots" class="level5"><h5 class="anchored" data-anchor-id="three-knots">Three knots</h5>
<p>Three knots appears to be the most appropriate specification (<a href="#fig-3-knots" class="quarto-xref">Figure&nbsp;3</a>). Whilst there is perhaps some evidence of overfitting, this appears to be minimal.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"cache/fcal/ncs/fcal-6.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">knots.3.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">knots.3.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">knots.3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="st">"paper/3-knots.pdf"</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.3.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.3.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-3-knots" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-3-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-3-knots-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Cluster profiles for the six-cluster model assuming three knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves
</figcaption></figure>
</div>
</div>
</div>
</section><section id="four-knots" class="level5"><h5 class="anchored" data-anchor-id="four-knots">Four knots</h5>
<p>Four knots appears to be too many. <a href="#fig-4-knots" class="quarto-xref">Figure&nbsp;4</a> presents a minor improvement to model fit over the three knot specification, and there are signs of overfitting which is likely driven by the small distances between knots.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"/cache/fcal/ncs/4-knots.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">knots.4.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">knots.4.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">knots.4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="st">"paper/4-knots.pdf"</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.4.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 24 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.4.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 24 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-4-knots" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-4-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-4-knots-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4-knots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Cluster profiles for the six-cluster model assuming four knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="model-statistics-1" class="level4"><h4 class="anchored" data-anchor-id="model-statistics-1">Model statistics</h4>
<p>AIC and BIC both suggest a four-knot specification to be optimal (<a href="#tbl-knot-stats-ncs" class="quarto-xref">Table&nbsp;1</a>). However, visual inspection of the mean cluster trajectories (<a href="#model-trajectories">see above</a>) suggests the four-knot approach results in overfitting, especially around knot locations. This will also become more of an issue as the number of clusters increase and additional sparsity is exhibited for some clusters.</p>
<p>As such, we have elected to use natural cubic splines with three knots placed at quantiles.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  Knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"One knot"</span>, <span class="st">"Two knots"</span>, <span class="st">"Three knots"</span>, <span class="st">"Four knots"</span><span class="op">)</span>,</span>
<span>  loglik <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">knots.1</span><span class="op">$</span><span class="va">loglik</span>,</span>
<span>    <span class="va">knots.2</span><span class="op">$</span><span class="va">loglik</span>,</span>
<span>    <span class="va">knots.3</span><span class="op">$</span><span class="va">loglik</span>,</span>
<span>    <span class="va">knots.4</span><span class="op">$</span><span class="va">loglik</span></span>
<span>  <span class="op">)</span>,</span>
<span>  AIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">knots.1</span><span class="op">$</span><span class="va">AIC</span>,</span>
<span>    <span class="va">knots.2</span><span class="op">$</span><span class="va">AIC</span>,</span>
<span>    <span class="va">knots.3</span><span class="op">$</span><span class="va">AIC</span>,</span>
<span>    <span class="va">knots.4</span><span class="op">$</span><span class="va">AIC</span></span>
<span>  <span class="op">)</span>,</span>
<span>  BIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">knots.1</span><span class="op">$</span><span class="va">BIC</span>,</span>
<span>    <span class="va">knots.2</span><span class="op">$</span><span class="va">BIC</span>,</span>
<span>    <span class="va">knots.3</span><span class="op">$</span><span class="va">BIC</span>,</span>
<span>    <span class="va">knots.4</span><span class="op">$</span><span class="va">BIC</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">knots.df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Knots"</span>,</span>
<span>    <span class="st">"Maxmum log likelihood"</span>,</span>
<span>    <span class="st">"AIC"</span>,</span>
<span>    <span class="st">"BIC"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span></span>
<span>  <span class="va">knots.1</span>,</span>
<span>  <span class="va">knots.1.list</span>,</span>
<span>  <span class="va">knots.3</span>,</span>
<span>  <span class="va">knots.3.list</span>,</span>
<span>  <span class="va">knots.4</span>,</span>
<span>  <span class="va">knots.4.list</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-knot-stats-ncs" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-knot-stats-ncs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Model statistics for differing numbers of knots for natural cubic splines
</figcaption><div aria-describedby="tbl-knot-stats-ncs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Knots</th>
<th style="text-align: right;">Maxmum log likelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">One knot</td>
<td style="text-align: right;">-16448.75</td>
<td style="text-align: right;">32967.49</td>
<td style="text-align: right;">33140.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">Two knots</td>
<td style="text-align: right;">-16230.02</td>
<td style="text-align: right;">32542.04</td>
<td style="text-align: right;">32744.71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Three knots</td>
<td style="text-align: right;">-16141.82</td>
<td style="text-align: right;">32377.63</td>
<td style="text-align: right;">32609.96</td>
</tr>
<tr class="even">
<td style="text-align: left;">Four knots</td>
<td style="text-align: right;">-16125.38</td>
<td style="text-align: right;">32356.75</td>
<td style="text-align: right;">32618.74</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section></section><section id="number-of-clusters" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="number-of-clusters">Number of clusters</h3>
<p>After determining the most appriopate number of knots, we must now decide upon the most appropiate number of clusters.</p>
<p>From the alluvial plot comparing FC models (<a href="#fig-fcal-alluvial" class="quarto-xref">Figure&nbsp;5</a>), we can see newly formed clusters are quite robust- remaining consistent as the number of clusters increases. However, new clusters are formed from multiple clusters which implies these clusters do not have a high degree of separation from one another. From this figure, six clusters appear to be a reasonable choice.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"class"</span>, <span class="st">"G"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">G</span> <span class="kw">in</span> <span class="va">G.fcal</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">alluvial.df</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="va">G</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, G <span class="op">=</span> <span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># eliminate label switching</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">4</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">4</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">5</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">5</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">6</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">6</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">7</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">7</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">8</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">8</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">9</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">9</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">10</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">10</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">10</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">11</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">11</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">7</span>, <span class="fl">2</span>, <span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">alluvial.df</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">G</span>,</span>
<span>    stratum <span class="op">=</span> <span class="va">class</span>,</span>
<span>    alluvium <span class="op">=</span> <span class="va">ids</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">class</span>,</span>
<span>    label <span class="op">=</span> <span class="va">class</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_flow.html">geom_flow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Assumed number of clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/alluvial-FCAL-all.png"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6.75</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/alluvial-FCAL-all.pdf"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6.75</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-fcal-alluvial" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcal-alluvial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-fcal-alluvial-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-alluvial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Alluvial plot of cluster membership across G for FC
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"class"</span>, <span class="st">"G"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">G</span> <span class="kw">in</span> <span class="va">G.fcal</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">alluvial.df</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="va">G</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, G <span class="op">=</span> <span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">alluvial.df</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">G</span>,</span>
<span>    stratum <span class="op">=</span> <span class="va">class</span>,</span>
<span>    alluvium <span class="op">=</span> <span class="va">ids</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">class</span>,</span>
<span>    label <span class="op">=</span> <span class="va">class</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_flow.html">geom_flow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Assumed number of clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-fcal-alluvial-unadjusted" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcal-alluvial-unadjusted-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-fcal-alluvial-unadjusted-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-alluvial-unadjusted-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Alluvial plot of cluster membership across G for FC
</figcaption></figure>
</div>
</div>
</div>
<section id="posterior-classifications" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="posterior-classifications">Posterior classifications</h4>
<p>From the below data, we can see how posterior probabilities change as the number of assumed clusters increase.</p>
<div class="column-page">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">G = 2</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">G = 3</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">G = 4</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">G = 5</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">G = 6</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">G = 7</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">G = 8</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-8" role="tab" aria-controls="tabset-2-8" aria-selected="false">G = 9</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-9" role="tab" aria-controls="tabset-2-9" aria-selected="false">G = 10</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-10" role="tab" aria-controls="tabset-2-10" aria-selected="false">G = 11</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">505</td>
<td style="text-align: center;">531</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">48.75</td>
<td style="text-align: center;">51.25</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.805</td>
<td style="text-align: center;">0.195</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.1986</td>
<td style="text-align: center;">0.8014</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">68.71</td>
<td style="text-align: center;">69.49</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">54.26</td>
<td style="text-align: center;">50.47</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">37.23</td>
<td style="text-align: center;">37.1</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">501</td>
<td style="text-align: center;">298</td>
<td style="text-align: center;">237</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">48.36</td>
<td style="text-align: center;">28.76</td>
<td style="text-align: center;">22.88</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.8072</td>
<td style="text-align: center;">0.0856</td>
<td style="text-align: center;">0.1072</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.1203</td>
<td style="text-align: center;">0.787</td>
<td style="text-align: center;">0.0927</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.1259</td>
<td style="text-align: center;">0.1043</td>
<td style="text-align: center;">0.7698</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">70.66</td>
<td style="text-align: center;">66.78</td>
<td style="text-align: center;">63.71</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">57.68</td>
<td style="text-align: center;">54.7</td>
<td style="text-align: center;">50.63</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">43.51</td>
<td style="text-align: center;">39.6</td>
<td style="text-align: center;">35.86</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">324</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">274</td>
<td style="text-align: center;">238</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">31.27</td>
<td style="text-align: center;">19.31</td>
<td style="text-align: center;">26.45</td>
<td style="text-align: center;">22.97</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7547</td>
<td style="text-align: center;">0.1307</td>
<td style="text-align: center;">0.0465</td>
<td style="text-align: center;">0.0681</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.1486</td>
<td style="text-align: center;">0.6844</td>
<td style="text-align: center;">0.0645</td>
<td style="text-align: center;">0.1025</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0651</td>
<td style="text-align: center;">0.0609</td>
<td style="text-align: center;">0.7858</td>
<td style="text-align: center;">0.0881</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0701</td>
<td style="text-align: center;">0.1005</td>
<td style="text-align: center;">0.0904</td>
<td style="text-align: center;">0.7389</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">60.19</td>
<td style="text-align: center;">43</td>
<td style="text-align: center;">68.61</td>
<td style="text-align: center;">58.4</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">45.99</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">56.2</td>
<td style="text-align: center;">47.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">36.42</td>
<td style="text-align: center;">21.5</td>
<td style="text-align: center;">41.24</td>
<td style="text-align: center;">34.87</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">255</td>
<td style="text-align: center;">258</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">337</td>
<td style="text-align: center;">144</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">24.61</td>
<td style="text-align: center;">24.9</td>
<td style="text-align: center;">4.05</td>
<td style="text-align: center;">32.53</td>
<td style="text-align: center;">13.9</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7292</td>
<td style="text-align: center;">0.0724</td>
<td style="text-align: center;">0.0374</td>
<td style="text-align: center;">0.0776</td>
<td style="text-align: center;">0.0834</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0901</td>
<td style="text-align: center;">0.7656</td>
<td style="text-align: center;">0.0432</td>
<td style="text-align: center;">0.0502</td>
<td style="text-align: center;">0.0509</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0344</td>
<td style="text-align: center;">0.0776</td>
<td style="text-align: center;">0.8022</td>
<td style="text-align: center;">0.0782</td>
<td style="text-align: center;">0.0075</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0811</td>
<td style="text-align: center;">0.0315</td>
<td style="text-align: center;">0.037</td>
<td style="text-align: center;">0.747</td>
<td style="text-align: center;">0.1035</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0967</td>
<td style="text-align: center;">0.0679</td>
<td style="text-align: center;">0.0059</td>
<td style="text-align: center;">0.1416</td>
<td style="text-align: center;">0.6878</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">54.9</td>
<td style="text-align: center;">63.95</td>
<td style="text-align: center;">71.43</td>
<td style="text-align: center;">59.05</td>
<td style="text-align: center;">43.75</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">45.1</td>
<td style="text-align: center;">51.55</td>
<td style="text-align: center;">59.52</td>
<td style="text-align: center;">46.88</td>
<td style="text-align: center;">32.64</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">31.76</td>
<td style="text-align: center;">37.98</td>
<td style="text-align: center;">42.86</td>
<td style="text-align: center;">34.42</td>
<td style="text-align: center;">22.92</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">141</td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">48</td>
<td style="text-align: center;">234</td>
<td style="text-align: center;">312</td>
<td style="text-align: center;">157</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">13.61</td>
<td style="text-align: center;">13.9</td>
<td style="text-align: center;">4.63</td>
<td style="text-align: center;">22.59</td>
<td style="text-align: center;">30.12</td>
<td style="text-align: center;">15.15</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7231</td>
<td style="text-align: center;">0.0302</td>
<td style="text-align: center;">0.028</td>
<td style="text-align: center;">0.097</td>
<td style="text-align: center;">0.0124</td>
<td style="text-align: center;">0.1093</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0374</td>
<td style="text-align: center;">0.6684</td>
<td style="text-align: center;">0.009</td>
<td style="text-align: center;">0.0911</td>
<td style="text-align: center;">0.126</td>
<td style="text-align: center;">0.0681</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.061</td>
<td style="text-align: center;">0.0094</td>
<td style="text-align: center;">0.7606</td>
<td style="text-align: center;">0.0477</td>
<td style="text-align: center;">0.0726</td>
<td style="text-align: center;">0.0487</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0727</td>
<td style="text-align: center;">0.1064</td>
<td style="text-align: center;">0.034</td>
<td style="text-align: center;">0.6842</td>
<td style="text-align: center;">0.0851</td>
<td style="text-align: center;">0.0175</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0068</td>
<td style="text-align: center;">0.094</td>
<td style="text-align: center;">0.0393</td>
<td style="text-align: center;">0.083</td>
<td style="text-align: center;">0.7422</td>
<td style="text-align: center;">0.0346</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.1158</td>
<td style="text-align: center;">0.0547</td>
<td style="text-align: center;">0.0412</td>
<td style="text-align: center;">0.04</td>
<td style="text-align: center;">0.0646</td>
<td style="text-align: center;">0.6836</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">55.32</td>
<td style="text-align: center;">42.36</td>
<td style="text-align: center;">66.67</td>
<td style="text-align: center;">48.29</td>
<td style="text-align: center;">58.65</td>
<td style="text-align: center;">48.41</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">44.68</td>
<td style="text-align: center;">31.94</td>
<td style="text-align: center;">54.17</td>
<td style="text-align: center;">37.61</td>
<td style="text-align: center;">47.76</td>
<td style="text-align: center;">33.76</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">30.5</td>
<td style="text-align: center;">22.22</td>
<td style="text-align: center;">39.58</td>
<td style="text-align: center;">21.79</td>
<td style="text-align: center;">33.33</td>
<td style="text-align: center;">21.66</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">49</td>
<td style="text-align: center;">177</td>
<td style="text-align: center;">59</td>
<td style="text-align: center;">205</td>
<td style="text-align: center;">191</td>
<td style="text-align: center;">229</td>
<td style="text-align: center;">126</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">4.73</td>
<td style="text-align: center;">17.08</td>
<td style="text-align: center;">5.69</td>
<td style="text-align: center;">19.79</td>
<td style="text-align: center;">18.44</td>
<td style="text-align: center;">22.1</td>
<td style="text-align: center;">12.16</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
<th style="text-align: center;">prob7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.6775</td>
<td style="text-align: center;">0.0669</td>
<td style="text-align: center;">0.0022</td>
<td style="text-align: center;">0.0379</td>
<td style="text-align: center;">0.0546</td>
<td style="text-align: center;">0.1242</td>
<td style="text-align: center;">0.0367</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0346</td>
<td style="text-align: center;">0.6893</td>
<td style="text-align: center;">0.0388</td>
<td style="text-align: center;">0.034</td>
<td style="text-align: center;">0.0378</td>
<td style="text-align: center;">0.0546</td>
<td style="text-align: center;">0.1108</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0027</td>
<td style="text-align: center;">0.0598</td>
<td style="text-align: center;">0.7169</td>
<td style="text-align: center;">0.0618</td>
<td style="text-align: center;">0.0617</td>
<td style="text-align: center;">0.0363</td>
<td style="text-align: center;">0.0607</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0076</td>
<td style="text-align: center;">0.0305</td>
<td style="text-align: center;">0.0458</td>
<td style="text-align: center;">0.7318</td>
<td style="text-align: center;">0.0358</td>
<td style="text-align: center;">0.1458</td>
<td style="text-align: center;">0.0029</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0256</td>
<td style="text-align: center;">0.0222</td>
<td style="text-align: center;">0.0383</td>
<td style="text-align: center;">0.0342</td>
<td style="text-align: center;">0.6878</td>
<td style="text-align: center;">0.1125</td>
<td style="text-align: center;">0.0794</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0428</td>
<td style="text-align: center;">0.0383</td>
<td style="text-align: center;">0.0226</td>
<td style="text-align: center;">0.144</td>
<td style="text-align: center;">0.1246</td>
<td style="text-align: center;">0.6117</td>
<td style="text-align: center;">0.016</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.016</td>
<td style="text-align: center;">0.1025</td>
<td style="text-align: center;">0.0297</td>
<td style="text-align: center;">0.0068</td>
<td style="text-align: center;">0.0838</td>
<td style="text-align: center;">0.0202</td>
<td style="text-align: center;">0.741</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">46.94</td>
<td style="text-align: center;">48.59</td>
<td style="text-align: center;">54.24</td>
<td style="text-align: center;">58.54</td>
<td style="text-align: center;">50.26</td>
<td style="text-align: center;">31.44</td>
<td style="text-align: center;">58.73</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">40.82</td>
<td style="text-align: center;">36.16</td>
<td style="text-align: center;">49.15</td>
<td style="text-align: center;">44.39</td>
<td style="text-align: center;">38.22</td>
<td style="text-align: center;">21.83</td>
<td style="text-align: center;">50</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">30.61</td>
<td style="text-align: center;">20.9</td>
<td style="text-align: center;">35.59</td>
<td style="text-align: center;">27.32</td>
<td style="text-align: center;">26.18</td>
<td style="text-align: center;">10.92</td>
<td style="text-align: center;">34.13</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
<th style="text-align: center;">class8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">244</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">103</td>
<td style="text-align: center;">194</td>
<td style="text-align: center;">140</td>
<td style="text-align: center;">67</td>
<td style="text-align: center;">67</td>
<td style="text-align: center;">157</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">23.55</td>
<td style="text-align: center;">6.18</td>
<td style="text-align: center;">9.94</td>
<td style="text-align: center;">18.73</td>
<td style="text-align: center;">13.51</td>
<td style="text-align: center;">6.47</td>
<td style="text-align: center;">6.47</td>
<td style="text-align: center;">15.15</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
<th style="text-align: center;">prob7</th>
<th style="text-align: center;">prob8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.6255</td>
<td style="text-align: center;">0.0238</td>
<td style="text-align: center;">0.0339</td>
<td style="text-align: center;">0.127</td>
<td style="text-align: center;">0.0156</td>
<td style="text-align: center;">0.0661</td>
<td style="text-align: center;">0.0167</td>
<td style="text-align: center;">0.0914</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0312</td>
<td style="text-align: center;">0.7158</td>
<td style="text-align: center;">0.0553</td>
<td style="text-align: center;">0.0692</td>
<td style="text-align: center;">0.0406</td>
<td style="text-align: center;">0.006</td>
<td style="text-align: center;">0.0169</td>
<td style="text-align: center;">0.0649</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0548</td>
<td style="text-align: center;">0.0357</td>
<td style="text-align: center;">0.7109</td>
<td style="text-align: center;">0.0362</td>
<td style="text-align: center;">0.0734</td>
<td style="text-align: center;">0.0232</td>
<td style="text-align: center;">0.0573</td>
<td style="text-align: center;">0.0085</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.1397</td>
<td style="text-align: center;">0.037</td>
<td style="text-align: center;">0.021</td>
<td style="text-align: center;">0.7495</td>
<td style="text-align: center;">0.0021</td>
<td style="text-align: center;">0.0189</td>
<td style="text-align: center;">0.0097</td>
<td style="text-align: center;">0.0222</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0175</td>
<td style="text-align: center;">0.0232</td>
<td style="text-align: center;">0.1004</td>
<td style="text-align: center;">0.0055</td>
<td style="text-align: center;">0.7182</td>
<td style="text-align: center;">0.0176</td>
<td style="text-align: center;">0.0432</td>
<td style="text-align: center;">0.0744</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.1193</td>
<td style="text-align: center;">0.0137</td>
<td style="text-align: center;">0.0437</td>
<td style="text-align: center;">0.0543</td>
<td style="text-align: center;">0.0271</td>
<td style="text-align: center;">0.6537</td>
<td style="text-align: center;">0.0239</td>
<td style="text-align: center;">0.0643</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0373</td>
<td style="text-align: center;">0.0164</td>
<td style="text-align: center;">0.1082</td>
<td style="text-align: center;">0.0123</td>
<td style="text-align: center;">0.0775</td>
<td style="text-align: center;">0.0298</td>
<td style="text-align: center;">0.6788</td>
<td style="text-align: center;">0.0397</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.0929</td>
<td style="text-align: center;">0.043</td>
<td style="text-align: center;">0.0102</td>
<td style="text-align: center;">0.0232</td>
<td style="text-align: center;">0.0752</td>
<td style="text-align: center;">0.0436</td>
<td style="text-align: center;">0.0275</td>
<td style="text-align: center;">0.6844</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
<th style="text-align: center;">class8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">34.84</td>
<td style="text-align: center;">54.69</td>
<td style="text-align: center;">55.34</td>
<td style="text-align: center;">59.28</td>
<td style="text-align: center;">53.57</td>
<td style="text-align: center;">47.76</td>
<td style="text-align: center;">44.78</td>
<td style="text-align: center;">49.68</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">24.18</td>
<td style="text-align: center;">48.44</td>
<td style="text-align: center;">38.83</td>
<td style="text-align: center;">46.39</td>
<td style="text-align: center;">47.86</td>
<td style="text-align: center;">37.31</td>
<td style="text-align: center;">37.31</td>
<td style="text-align: center;">39.49</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">15.16</td>
<td style="text-align: center;">28.12</td>
<td style="text-align: center;">25.24</td>
<td style="text-align: center;">32.47</td>
<td style="text-align: center;">31.43</td>
<td style="text-align: center;">28.36</td>
<td style="text-align: center;">25.37</td>
<td style="text-align: center;">29.94</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-8-tab">
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
<th style="text-align: center;">class8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">102</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">33</td>
<td style="text-align: center;">129</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">235</td>
<td style="text-align: center;">164</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">9.85</td>
<td style="text-align: center;">5.79</td>
<td style="text-align: center;">7.24</td>
<td style="text-align: center;">3.19</td>
<td style="text-align: center;">12.45</td>
<td style="text-align: center;">4.34</td>
<td style="text-align: center;">22.68</td>
<td style="text-align: center;">15.83</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class9</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">193</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">18.63</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
<th style="text-align: center;">prob7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7052</td>
<td style="text-align: center;">0.0337</td>
<td style="text-align: center;">0.0567</td>
<td style="text-align: center;">0.002</td>
<td style="text-align: center;">0.0747</td>
<td style="text-align: center;">0.0322</td>
<td style="text-align: center;">0.0527</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.055</td>
<td style="text-align: center;">0.7411</td>
<td style="text-align: center;">0.0163</td>
<td style="text-align: center;">0.0077</td>
<td style="text-align: center;">0.0229</td>
<td style="text-align: center;">0.0015</td>
<td style="text-align: center;">0.0377</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.1003</td>
<td style="text-align: center;">0.0155</td>
<td style="text-align: center;">0.6609</td>
<td style="text-align: center;">0.0053</td>
<td style="text-align: center;">0.0687</td>
<td style="text-align: center;">0.0225</td>
<td style="text-align: center;">0.055</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0023</td>
<td style="text-align: center;">0.0124</td>
<td style="text-align: center;">0.0023</td>
<td style="text-align: center;">0.7246</td>
<td style="text-align: center;">3e-04</td>
<td style="text-align: center;">0.0191</td>
<td style="text-align: center;">0.1115</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0985</td>
<td style="text-align: center;">0.0183</td>
<td style="text-align: center;">0.0463</td>
<td style="text-align: center;">0.0011</td>
<td style="text-align: center;">0.7203</td>
<td style="text-align: center;">0.0174</td>
<td style="text-align: center;">0.0145</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0562</td>
<td style="text-align: center;">0.0022</td>
<td style="text-align: center;">0.0205</td>
<td style="text-align: center;">0.0276</td>
<td style="text-align: center;">0.029</td>
<td style="text-align: center;">0.6901</td>
<td style="text-align: center;">0.1125</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0333</td>
<td style="text-align: center;">0.0248</td>
<td style="text-align: center;">0.0177</td>
<td style="text-align: center;">0.0688</td>
<td style="text-align: center;">0.0122</td>
<td style="text-align: center;">0.0332</td>
<td style="text-align: center;">0.6131</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.0131</td>
<td style="text-align: center;">0.051</td>
<td style="text-align: center;">0.031</td>
<td style="text-align: center;">0.0309</td>
<td style="text-align: center;">0.0821</td>
<td style="text-align: center;">0.0252</td>
<td style="text-align: center;">0.0812</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class9</strong></td>
<td style="text-align: center;">0.0185</td>
<td style="text-align: center;">0.0375</td>
<td style="text-align: center;">0.0046</td>
<td style="text-align: center;">0.0174</td>
<td style="text-align: center;">0.0018</td>
<td style="text-align: center;">0.009</td>
<td style="text-align: center;">0.1455</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob8</th>
<th style="text-align: center;">prob9</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.0116</td>
<td style="text-align: center;">0.0312</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0536</td>
<td style="text-align: center;">0.0642</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0524</td>
<td style="text-align: center;">0.0194</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0864</td>
<td style="text-align: center;">0.0412</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0783</td>
<td style="text-align: center;">0.0052</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0363</td>
<td style="text-align: center;">0.0256</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0824</td>
<td style="text-align: center;">0.1145</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.6679</td>
<td style="text-align: center;">0.0177</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class9</strong></td>
<td style="text-align: center;">0.0192</td>
<td style="text-align: center;">0.7466</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 19%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">51.96</td>
<td style="text-align: center;">56.67</td>
<td style="text-align: center;">44</td>
<td style="text-align: center;">57.58</td>
<td style="text-align: center;">56.59</td>
<td style="text-align: center;">46.67</td>
<td style="text-align: center;">37.02</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">40.2</td>
<td style="text-align: center;">53.33</td>
<td style="text-align: center;">33.33</td>
<td style="text-align: center;">45.45</td>
<td style="text-align: center;">47.29</td>
<td style="text-align: center;">42.22</td>
<td style="text-align: center;">23.83</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">22.55</td>
<td style="text-align: center;">31.67</td>
<td style="text-align: center;">26.67</td>
<td style="text-align: center;">30.3</td>
<td style="text-align: center;">32.56</td>
<td style="text-align: center;">33.33</td>
<td style="text-align: center;">14.89</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class8</th>
<th style="text-align: center;">class9</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">45.12</td>
<td style="text-align: center;">59.07</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">37.2</td>
<td style="text-align: center;">47.15</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">28.66</td>
<td style="text-align: center;">31.09</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-9-tab">
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
<th style="text-align: center;">class8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">102</td>
<td style="text-align: center;">43</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">94</td>
<td style="text-align: center;">118</td>
<td style="text-align: center;">188</td>
<td style="text-align: center;">133</td>
<td style="text-align: center;">59</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">9.85</td>
<td style="text-align: center;">4.15</td>
<td style="text-align: center;">3.47</td>
<td style="text-align: center;">9.07</td>
<td style="text-align: center;">11.39</td>
<td style="text-align: center;">18.15</td>
<td style="text-align: center;">12.84</td>
<td style="text-align: center;">5.69</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class9</th>
<th style="text-align: center;">class10</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">209</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">5.21</td>
<td style="text-align: center;">20.17</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
<th style="text-align: center;">prob7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.73</td>
<td style="text-align: center;">0.0125</td>
<td style="text-align: center;">0.0207</td>
<td style="text-align: center;">0.0026</td>
<td style="text-align: center;">0.0149</td>
<td style="text-align: center;">0.099</td>
<td style="text-align: center;">0.0706</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0206</td>
<td style="text-align: center;">0.6965</td>
<td style="text-align: center;">0.0302</td>
<td style="text-align: center;">0.0467</td>
<td style="text-align: center;">0.046</td>
<td style="text-align: center;">0.0962</td>
<td style="text-align: center;">0.0253</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0818</td>
<td style="text-align: center;">0.0227</td>
<td style="text-align: center;">0.7056</td>
<td style="text-align: center;">0.0027</td>
<td style="text-align: center;">0.0599</td>
<td style="text-align: center;">0.0816</td>
<td style="text-align: center;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.005</td>
<td style="text-align: center;">0.0265</td>
<td style="text-align: center;">8e-04</td>
<td style="text-align: center;">0.7029</td>
<td style="text-align: center;">0.0226</td>
<td style="text-align: center;">0.0629</td>
<td style="text-align: center;">0.0653</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0291</td>
<td style="text-align: center;">0.0232</td>
<td style="text-align: center;">0.0871</td>
<td style="text-align: center;">0.0133</td>
<td style="text-align: center;">0.5886</td>
<td style="text-align: center;">0.0965</td>
<td style="text-align: center;">0.0037</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0975</td>
<td style="text-align: center;">0.0353</td>
<td style="text-align: center;">0.0398</td>
<td style="text-align: center;">0.0463</td>
<td style="text-align: center;">0.09</td>
<td style="text-align: center;">0.5336</td>
<td style="text-align: center;">0.0356</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0636</td>
<td style="text-align: center;">0.0162</td>
<td style="text-align: center;">0.0015</td>
<td style="text-align: center;">0.0791</td>
<td style="text-align: center;">0.004</td>
<td style="text-align: center;">0.0549</td>
<td style="text-align: center;">0.7225</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.0314</td>
<td style="text-align: center;">0.0205</td>
<td style="text-align: center;">0.0023</td>
<td style="text-align: center;">0.084</td>
<td style="text-align: center;">0.0063</td>
<td style="text-align: center;">0.0772</td>
<td style="text-align: center;">0.0692</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class9</strong></td>
<td style="text-align: center;">0.0505</td>
<td style="text-align: center;">0.0023</td>
<td style="text-align: center;">0.0088</td>
<td style="text-align: center;">0.046</td>
<td style="text-align: center;">0.0046</td>
<td style="text-align: center;">0.0922</td>
<td style="text-align: center;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class10</strong></td>
<td style="text-align: center;">0.0191</td>
<td style="text-align: center;">0.0108</td>
<td style="text-align: center;">0.0163</td>
<td style="text-align: center;">0.0158</td>
<td style="text-align: center;">0.1163</td>
<td style="text-align: center;">0.0539</td>
<td style="text-align: center;">0.0018</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob8</th>
<th style="text-align: center;">prob9</th>
<th style="text-align: center;">prob10</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.016</td>
<td style="text-align: center;">0.0267</td>
<td style="text-align: center;">0.0069</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0102</td>
<td style="text-align: center;">3e-04</td>
<td style="text-align: center;">0.028</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">8e-04</td>
<td style="text-align: center;">0.0074</td>
<td style="text-align: center;">0.0316</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0501</td>
<td style="text-align: center;">0.0306</td>
<td style="text-align: center;">0.0333</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0032</td>
<td style="text-align: center;">0.0107</td>
<td style="text-align: center;">0.1445</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0309</td>
<td style="text-align: center;">0.037</td>
<td style="text-align: center;">0.0541</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0385</td>
<td style="text-align: center;">0.0149</td>
<td style="text-align: center;">0.0048</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.6971</td>
<td style="text-align: center;">0.007</td>
<td style="text-align: center;">0.0049</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class9</strong></td>
<td style="text-align: center;">0.004</td>
<td style="text-align: center;">0.7179</td>
<td style="text-align: center;">0.0437</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class10</strong></td>
<td style="text-align: center;">0.0041</td>
<td style="text-align: center;">0.0389</td>
<td style="text-align: center;">0.7229</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 19%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">53.92</td>
<td style="text-align: center;">48.84</td>
<td style="text-align: center;">52.78</td>
<td style="text-align: center;">52.13</td>
<td style="text-align: center;">30.51</td>
<td style="text-align: center;">21.28</td>
<td style="text-align: center;">54.89</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">46.08</td>
<td style="text-align: center;">41.86</td>
<td style="text-align: center;">47.22</td>
<td style="text-align: center;">38.3</td>
<td style="text-align: center;">25.42</td>
<td style="text-align: center;">13.83</td>
<td style="text-align: center;">47.37</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">36.27</td>
<td style="text-align: center;">32.56</td>
<td style="text-align: center;">33.33</td>
<td style="text-align: center;">25.53</td>
<td style="text-align: center;">16.95</td>
<td style="text-align: center;">4.79</td>
<td style="text-align: center;">33.83</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class8</th>
<th style="text-align: center;">class9</th>
<th style="text-align: center;">class10</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">49.15</td>
<td style="text-align: center;">59.26</td>
<td style="text-align: center;">54.55</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">42.37</td>
<td style="text-align: center;">53.7</td>
<td style="text-align: center;">43.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">28.81</td>
<td style="text-align: center;">31.48</td>
<td style="text-align: center;">32.54</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-2-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-10-tab">
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
<th style="text-align: center;">class8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">133</td>
<td style="text-align: center;">189</td>
<td style="text-align: center;">118</td>
<td style="text-align: center;">103</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">199</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">42</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">12.84</td>
<td style="text-align: center;">18.24</td>
<td style="text-align: center;">11.39</td>
<td style="text-align: center;">9.94</td>
<td style="text-align: center;">0.97</td>
<td style="text-align: center;">19.21</td>
<td style="text-align: center;">3.47</td>
<td style="text-align: center;">4.05</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class9</th>
<th style="text-align: center;">class10</th>
<th style="text-align: center;">class11</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">51</td>
<td style="text-align: center;">97</td>
<td style="text-align: center;">58</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">4.92</td>
<td style="text-align: center;">9.36</td>
<td style="text-align: center;">5.6</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
<th style="text-align: center;">prob7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7214</td>
<td style="text-align: center;">0.0564</td>
<td style="text-align: center;">0.004</td>
<td style="text-align: center;">0.0625</td>
<td style="text-align: center;">5e-04</td>
<td style="text-align: center;">0.0047</td>
<td style="text-align: center;">0.0015</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.036</td>
<td style="text-align: center;">0.5301</td>
<td style="text-align: center;">0.0906</td>
<td style="text-align: center;">0.0972</td>
<td style="text-align: center;">0.012</td>
<td style="text-align: center;">0.0519</td>
<td style="text-align: center;">0.0387</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0037</td>
<td style="text-align: center;">0.0953</td>
<td style="text-align: center;">0.5825</td>
<td style="text-align: center;">0.0285</td>
<td style="text-align: center;">0.019</td>
<td style="text-align: center;">0.1379</td>
<td style="text-align: center;">0.0849</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0695</td>
<td style="text-align: center;">0.102</td>
<td style="text-align: center;">0.016</td>
<td style="text-align: center;">0.7222</td>
<td style="text-align: center;">0.005</td>
<td style="text-align: center;">0.0084</td>
<td style="text-align: center;">0.0204</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.0287</td>
<td style="text-align: center;">0.087</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.7155</td>
<td style="text-align: center;">0.0924</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0019</td>
<td style="text-align: center;">0.051</td>
<td style="text-align: center;">0.1141</td>
<td style="text-align: center;">0.0173</td>
<td style="text-align: center;">0.0313</td>
<td style="text-align: center;">0.6994</td>
<td style="text-align: center;">0.0161</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.006</td>
<td style="text-align: center;">0.0824</td>
<td style="text-align: center;">0.0613</td>
<td style="text-align: center;">0.0805</td>
<td style="text-align: center;">0.003</td>
<td style="text-align: center;">0.0308</td>
<td style="text-align: center;">0.7028</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.0255</td>
<td style="text-align: center;">0.0972</td>
<td style="text-align: center;">0.0482</td>
<td style="text-align: center;">0.0204</td>
<td style="text-align: center;">4e-04</td>
<td style="text-align: center;">0.0194</td>
<td style="text-align: center;">0.0297</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class9</strong></td>
<td style="text-align: center;">0.0264</td>
<td style="text-align: center;">0.0875</td>
<td style="text-align: center;">0.0044</td>
<td style="text-align: center;">0.048</td>
<td style="text-align: center;">0.0246</td>
<td style="text-align: center;">0.043</td>
<td style="text-align: center;">0.0086</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class10</strong></td>
<td style="text-align: center;">0.0647</td>
<td style="text-align: center;">0.0672</td>
<td style="text-align: center;">0.0219</td>
<td style="text-align: center;">0.0048</td>
<td style="text-align: center;">0.0057</td>
<td style="text-align: center;">0.0322</td>
<td style="text-align: center;">8e-04</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class11</strong></td>
<td style="text-align: center;">0.0655</td>
<td style="text-align: center;">0.0793</td>
<td style="text-align: center;">0.0065</td>
<td style="text-align: center;">0.0309</td>
<td style="text-align: center;">7e-04</td>
<td style="text-align: center;">0.0049</td>
<td style="text-align: center;">0.0023</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob8</th>
<th style="text-align: center;">prob9</th>
<th style="text-align: center;">prob10</th>
<th style="text-align: center;">prob11</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.0161</td>
<td style="text-align: center;">0.015</td>
<td style="text-align: center;">0.0809</td>
<td style="text-align: center;">0.037</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0345</td>
<td style="text-align: center;">0.0346</td>
<td style="text-align: center;">0.0442</td>
<td style="text-align: center;">0.0303</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0227</td>
<td style="text-align: center;">0.009</td>
<td style="text-align: center;">0.0133</td>
<td style="text-align: center;">0.0032</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0122</td>
<td style="text-align: center;">0.0258</td>
<td style="text-align: center;">0.0025</td>
<td style="text-align: center;">0.0158</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.0395</td>
<td style="text-align: center;">0.0368</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0132</td>
<td style="text-align: center;">0.0362</td>
<td style="text-align: center;">0.0151</td>
<td style="text-align: center;">0.0045</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0225</td>
<td style="text-align: center;">0.0072</td>
<td style="text-align: center;">0.0028</td>
<td style="text-align: center;">7e-04</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.6994</td>
<td style="text-align: center;">3e-04</td>
<td style="text-align: center;">0.0493</td>
<td style="text-align: center;">0.0101</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class9</strong></td>
<td style="text-align: center;">0.0024</td>
<td style="text-align: center;">0.7202</td>
<td style="text-align: center;">0.0308</td>
<td style="text-align: center;">0.0041</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class10</strong></td>
<td style="text-align: center;">0.0259</td>
<td style="text-align: center;">0.0263</td>
<td style="text-align: center;">0.7003</td>
<td style="text-align: center;">0.0504</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class11</strong></td>
<td style="text-align: center;">0.0203</td>
<td style="text-align: center;">0.0065</td>
<td style="text-align: center;">0.0835</td>
<td style="text-align: center;">0.6997</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 19%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">54.89</td>
<td style="text-align: center;">21.69</td>
<td style="text-align: center;">29.66</td>
<td style="text-align: center;">52.43</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">50.75</td>
<td style="text-align: center;">52.78</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">47.37</td>
<td style="text-align: center;">13.76</td>
<td style="text-align: center;">23.73</td>
<td style="text-align: center;">45.63</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">41.21</td>
<td style="text-align: center;">44.44</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">33.83</td>
<td style="text-align: center;">4.23</td>
<td style="text-align: center;">16.95</td>
<td style="text-align: center;">34.95</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">29.15</td>
<td style="text-align: center;">33.33</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class8</th>
<th style="text-align: center;">class9</th>
<th style="text-align: center;">class10</th>
<th style="text-align: center;">class11</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">47.62</td>
<td style="text-align: center;">56.86</td>
<td style="text-align: center;">52.58</td>
<td style="text-align: center;">48.28</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">42.86</td>
<td style="text-align: center;">50.98</td>
<td style="text-align: center;">40.21</td>
<td style="text-align: center;">43.1</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">33.33</td>
<td style="text-align: center;">33.33</td>
<td style="text-align: center;">25.77</td>
<td style="text-align: center;">29.31</td>
</tr>
</tbody>
</table>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pprobs.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.2</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.3</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.4</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.5</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.6</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.7</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.8</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.9</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">9</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.10</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.11</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">11</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">class.2</span> <span class="op">&lt;-</span> <span class="va">groups.2</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.2</span>, <span class="va">groups.2</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.2</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.3</span> <span class="op">&lt;-</span> <span class="va">groups.3</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.3</span>, <span class="va">groups.3</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.3</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.4</span> <span class="op">&lt;-</span> <span class="va">groups.4</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.4</span>, <span class="va">groups.4</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.4</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.5</span> <span class="op">&lt;-</span> <span class="va">groups.5</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.5</span>, <span class="va">groups.5</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.5</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.6</span> <span class="op">&lt;-</span> <span class="va">groups.6</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.6</span>, <span class="va">groups.6</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.6</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.7</span> <span class="op">&lt;-</span> <span class="va">groups.7</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.7</span>, <span class="va">groups.7</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.7</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.8</span> <span class="op">&lt;-</span> <span class="va">groups.8</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.8</span>, <span class="va">groups.8</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.8</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.9</span> <span class="op">&lt;-</span> <span class="va">groups.9</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.9</span>, <span class="va">groups.9</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.9</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.10</span> <span class="op">&lt;-</span> <span class="va">groups.10</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.10</span>, <span class="va">groups.10</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.10</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.11</span> <span class="op">&lt;-</span> <span class="va">groups.11</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.11</span>, <span class="va">groups.11</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.11</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pprobs.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.2</span><span class="op">)</span></span>
<span><span class="va">pprobs.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.3</span><span class="op">)</span></span>
<span><span class="va">pprobs.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.4</span><span class="op">)</span></span>
<span><span class="va">pprobs.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.5</span><span class="op">)</span></span>
<span><span class="va">pprobs.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.6</span><span class="op">)</span></span>
<span><span class="va">pprobs.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.7</span><span class="op">)</span></span>
<span><span class="va">pprobs.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.8</span><span class="op">)</span></span>
<span><span class="va">pprobs.9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.9</span><span class="op">)</span></span>
<span><span class="va">pprobs.10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.10</span><span class="op">)</span></span>
<span><span class="va">pprobs.11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.11</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pprobs.2</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Two clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.3</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Three clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.4</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Four clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.5</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Five clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.6</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Six clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.7</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Seven clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.8</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Eight clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.9</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Nine clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.10</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Ten clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.11</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Eleven clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">pprobs.2</span>,</span>
<span>  <span class="va">pprobs.3</span>,</span>
<span>  <span class="va">pprobs.4</span>,</span>
<span>  <span class="va">pprobs.5</span>,</span>
<span>  <span class="va">pprobs.6</span>,</span>
<span>  <span class="va">pprobs.7</span>,</span>
<span>  <span class="va">pprobs.8</span>,</span>
<span>  <span class="va">pprobs.9</span>,</span>
<span>  <span class="va">pprobs.10</span>,</span>
<span>  <span class="va">pprobs.11</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">pprobs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prob</span>, y <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slab.html">stat_slab</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="st">"#5D5179"</span>, color <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/geom_dots.html">geom_dots</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#4F759B"</span>, dotsize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Posterior probability for cluster membership"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span></span>
<span>    <span class="st">"Distribution of Posterior Probabilities Across Models"</span>,</span>
<span>    <span class="st">"Subject-specific posterior probabilities for assigned cluster"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">rev</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/pprob-distribution.png"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8.5</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">7.5</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/pprob-distribution.pdf"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8.5</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">7.5</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/PProb distributions NCS-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section><section id="residual-plots" class="level4"><h4 class="anchored" data-anchor-id="residual-plots">Residual plots</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">G = 2</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p><img src="fcal_files/figure-html/FCAL residuals-1.png" class="img-fluid" width="672">##### G = 3 <img src="fcal_files/figure-html/FCAL residuals-2.png" class="img-fluid" width="672">##### G = 4 <img src="fcal_files/figure-html/FCAL residuals-3.png" class="img-fluid" width="672">##### G = 5 <img src="fcal_files/figure-html/FCAL residuals-4.png" class="img-fluid" width="672">##### G = 6 <img src="fcal_files/figure-html/FCAL residuals-5.png" class="img-fluid" width="672">##### G = 7 <img src="fcal_files/figure-html/FCAL residuals-6.png" class="img-fluid" width="672">##### G = 8 <img src="fcal_files/figure-html/FCAL residuals-7.png" class="img-fluid" width="672">##### G = 9 <img src="fcal_files/figure-html/FCAL residuals-8.png" class="img-fluid" width="672">##### G = 10 <img src="fcal_files/figure-html/FCAL residuals-9.png" class="img-fluid" width="672">##### G = 11 <img src="fcal_files/figure-html/FCAL residuals-10.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<section id="chosen-model" class="level5"><h5 class="anchored" data-anchor-id="chosen-model">Chosen model</h5>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#D8829D"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#AF6A80"</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">30</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#023777"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Residuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_band.html">stat_qq_band</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_qq_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#D8829D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_point.html">stat_qq_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#023777"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Theoretical Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sample Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/Residual-plot-fcal-ncs.pdf"</span>,</span>
<span>  plot <span class="op">=</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-NCS-norm" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NCS-norm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-NCS-norm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NCS-norm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Plots assessing normality for the distribution of residuals for the chosen NCS model for FCAL. (A) Histrogram; (B) Q-Q plot.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">predClass</span> <span class="op">&lt;-</span> <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pred</span>, <span class="va">predClass</span>, by <span class="op">=</span> <span class="st">"ids"</span><span class="op">)</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">class</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">resid_ss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_band.html">stat_qq_band</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_qq_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#D8829D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_point.html">stat_qq_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#023777"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Theoretical Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sample Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">labels</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ArrangedPlot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">p</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">p</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">p</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/cluster-resids-ncs.pdf"</span>,</span>
<span>  <span class="va">ArrangedPlot</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ArrangedPlot</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-NCS-norm-cluster" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-NCS-norm-cluster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-NCS-norm-cluster-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NCS-norm-cluster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Q-Q plots assessing normality for the distribution of residuals stratifed by cluster assignment.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="model-metrics" class="level4"><h4 class="anchored" data-anchor-id="model-metrics">Model metrics</h4>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://cecileproust-lima.github.io/lcmm/reference/summaryplot.html">summaryplot</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">9</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.fcal</span><span class="op">[[</span><span class="fl">11</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"loglik"</span>, <span class="st">"AIC"</span>, <span class="st">"BIC"</span>, <span class="st">"entropy"</span>, <span class="st">"ICL"</span><span class="op">)</span>,</span>
<span>  mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  axis <span class="op">=</span> <span class="st">"Class"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-fcal-metrics" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcal-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-fcal-metrics-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Model metrics for FCAL for G = 4-9
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal.metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/makeMetrics.html">makeMetrics</a></span><span class="op">(</span><span class="va">G.fcal</span>, <span class="va">models.fcal</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/buildDT.html">buildDT</a></span><span class="op">(</span><span class="va">fcal.metrics</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Clusters</th>
<th style="text-align: right;">Maximum log-likelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-16532.10</td>
<td style="text-align: right;">33094.20</td>
<td style="text-align: right;">33168.35</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">-16354.39</td>
<td style="text-align: right;">32754.78</td>
<td style="text-align: right;">32868.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">-16260.21</td>
<td style="text-align: right;">32582.42</td>
<td style="text-align: right;">32735.66</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-16201.86</td>
<td style="text-align: right;">32481.71</td>
<td style="text-align: right;">32674.49</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">-16141.82</td>
<td style="text-align: right;">32377.63</td>
<td style="text-align: right;">32609.96</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">-16109.77</td>
<td style="text-align: right;">32329.54</td>
<td style="text-align: right;">32601.42</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">-16076.89</td>
<td style="text-align: right;">32279.77</td>
<td style="text-align: right;">32591.19</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">-16039.66</td>
<td style="text-align: right;">32221.33</td>
<td style="text-align: right;">32572.29</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">-16015.29</td>
<td style="text-align: right;">32188.59</td>
<td style="text-align: right;">32579.09</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: right;">-16005.55</td>
<td style="text-align: right;">32185.10</td>
<td style="text-align: right;">32615.16</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The optimum AIC is <b> 32185.1 </b> with cluster 13. The optimum BIC is <b>32572.29 </b> with cluster 11</p>
</section><section id="spaghetti-plots-per-cluster" class="level4"><h4 class="anchored" data-anchor-id="spaghetti-plots-per-cluster">Spaghetti plots per cluster</h4>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">G</span> <span class="kw">in</span> <span class="va">G.fcal</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Data frame to hold processed data</span></span>
<span>  <span class="va">new.fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    calpro_result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    calpro_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">clust</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">G</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ids.clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="va">G</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span>, <span class="va">class</span> <span class="op">==</span> <span class="va">clust</span><span class="op">)</span><span class="op">$</span><span class="va">ids</span></span>
<span>    <span class="va">n.clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ids.clust</span><span class="op">)</span></span>
<span>    <span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">n.clust</span>, <span class="va">n.clust</span><span class="op">)</span> <span class="co"># Randomise the order of the ids</span></span>
<span>    <span class="va">iters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">n.clust</span> <span class="op">/</span> <span class="fl">6</span><span class="op">)</span> <span class="co"># How many groups of six are there?</span></span>
<span></span>
<span>    <span class="co"># Matrix to hold the smoothed data</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">iters</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span>    <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">iters</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">iters</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Find ids for group of five</span></span>
<span>      <span class="va">ids.select</span> <span class="op">&lt;-</span> <span class="va">ids.clust</span><span class="op">[</span><span class="va">rand</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">fcal.subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ids.select</span><span class="op">)</span></span>
<span>      <span class="co"># Median process as per CRP preprocessing</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>            <span class="va">fcal.subset</span>,</span>
<span>            <span class="va">calpro_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">calpro_time</span> <span class="op">&lt;=</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>            <span class="va">fcal.subset</span>,</span>
<span>            <span class="va">calpro_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">calpro_time</span> <span class="op">&lt;</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">fcal.ma</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span></span>
<span>          <span class="va">fcal.time</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">$</span><span class="va">calpro_time</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">iters</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span>,</span>
<span>      id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span>,</span>
<span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"calpro_result"</span><span class="op">)</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="va">fcal.ma</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co"># Make ids first column</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">iters</span></span>
<span>    <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span>,</span>
<span>      id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span>,</span>
<span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"pred_time"</span><span class="op">)</span></span>
<span>    <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="va">fcal.time</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co"># Make ids first column</span></span>
<span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">fcal.ma</span>, <span class="va">fcal.time</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"calpro_time"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="va">fcal.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>calpro_time <span class="op">=</span> <span class="va">pred_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">pred_time</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">fcal.ma</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="va">clust</span> <span class="co"># Identify cluster assignment</span></span>
<span>    <span class="va">new.fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">new.fc</span>, <span class="va">fcal.ma</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="st">"plots/spaghetti"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"plots/spaghetti"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-ncs-"</span>, <span class="va">G</span>, <span class="st">".png"</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">17.5</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">300</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>    <span class="va">models.fcal</span>,</span>
<span>    G <span class="op">=</span> <span class="va">G</span>,</span>
<span>    log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>    clusters <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-ncs-"</span>, <span class="va">G</span>, <span class="st">".pdf"</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">17.5</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>    <span class="va">models.fcal</span>,</span>
<span>    G <span class="op">=</span> <span class="va">G</span>,</span>
<span>    log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>    clusters <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>    <span class="va">models.fcal</span>,</span>
<span>    G <span class="op">=</span> <span class="va">G</span>,</span>
<span>    log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>    clusters <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/FCAL spaghetti plots-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
</section></section><section id="chosen-model-1" class="level3"><h3 class="anchored" data-anchor-id="chosen-model-1">Chosen model</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new.fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  calpro_result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  calpro_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">clust</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ids.clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span>, <span class="va">class</span> <span class="op">==</span> <span class="va">clust</span><span class="op">)</span><span class="op">$</span><span class="va">ids</span></span>
<span>  <span class="va">n.clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ids.clust</span><span class="op">)</span></span>
<span>  <span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">n.clust</span>, <span class="va">n.clust</span><span class="op">)</span> <span class="co"># Randomise the order of the ids</span></span>
<span>  <span class="va">iters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">n.clust</span> <span class="op">/</span> <span class="fl">6</span><span class="op">)</span> <span class="co"># How many groups of six are there?</span></span>
<span></span>
<span>  <span class="co"># Matrix to hold the smoothed data</span></span>
<span>  <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">iters</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span>  <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">iters</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">iters</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Find ids for group of five</span></span>
<span>    <span class="va">ids.select</span> <span class="op">&lt;-</span> <span class="va">ids.clust</span><span class="op">[</span><span class="va">rand</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">fcal.subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ids.select</span><span class="op">)</span></span>
<span>    <span class="co"># Median process as per CRP preprocessing</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>          <span class="va">fcal.subset</span>,</span>
<span>          <span class="va">calpro_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">calpro_time</span> <span class="op">&lt;=</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>          <span class="va">fcal.subset</span>,</span>
<span>          <span class="va">calpro_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">calpro_time</span> <span class="op">&lt;</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">fcal.ma</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span></span>
<span>        <span class="va">fcal.time</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">$</span><span class="va">calpro_time</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">iters</span></span>
<span>  <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span>,</span>
<span>    id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"calpro_result"</span><span class="op">)</span></span>
<span>  <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="va">fcal.ma</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co"># Make ids first column</span></span>
<span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">iters</span></span>
<span>  <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span>,</span>
<span>    id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"pred_time"</span><span class="op">)</span></span>
<span>  <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="va">fcal.time</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co"># Make ids first column</span></span>
<span></span>
<span>  <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">fcal.ma</span>, <span class="va">fcal.time</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"calpro_time"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="va">fcal.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>calpro_time <span class="op">=</span> <span class="va">pred_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">pred_time</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">fcal.ma</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="va">clust</span> <span class="co"># Identify cluster assignment</span></span>
<span>  <span class="va">new.fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">new.fc</span>, <span class="va">fcal.ma</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As. a parsimonious choice, we have elected to focus on the 8-cluster model as we believe this strikes a reasonable balance between characterising the LIBDR cohort whilst still presenting trends which likely reflect the IBD population in Western Europe.</p>
<section id="labelling" class="level4"><h4 class="anchored" data-anchor-id="labelling">Labelling</h4>
<p>The labels/order of the clusters generated above are random. To improve the readability and assist with interpretation of associations, it would be beneficial to order clusters by some analogue for disease severity. This section explores possible solutions for this task.</p>
<section id="cumulative-inflammation-across-follow-up" class="level5"><h5 class="anchored" data-anchor-id="cumulative-inflammation-across-follow-up">Cumulative inflammation across follow-up</h5>
<p>One possible solution is to order clusters by cumulative inflammation which is given by the area under the curve for each mean cluster trajectory.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rank.full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/rankCumulative.html">rankCumulative</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span>, tmax <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rank.full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"FC"</span>, <span class="va">New</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">Area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"#745C97"</span>, color <span class="op">=</span> <span class="st">"#39375B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Cumulative inflammation (Area)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-ncs-reordered.png"</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>  <span class="va">models.fcal</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-ncs-reordered.pdf"</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">16</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>  <span class="va">models.fcal</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>  <span class="va">models.fcal</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>With Danish predictions</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dk.fcal</span> <span class="op">&lt;-</span> <span class="va">dk.fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="st">"Ypred_class"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dk.fcal</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">dk.fcal</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>                                   from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>                                   to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-scot-dk.pdf"</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">16</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>  <span class="va">models.fcal</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span>,</span>
<span>  external <span class="op">=</span> <span class="va">dk.fcal</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-scot-dk.png"</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>  <span class="va">models.fcal</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span>,</span>
<span>  external <span class="op">=</span> <span class="va">dk.fcal</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>  <span class="va">models.fcal</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span>,</span>
<span>  external <span class="op">=</span> <span class="va">dk.fcal</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">G</span> <span class="kw">in</span> <span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new.fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    calpro_result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    calpro_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">clust</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">G</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ids.clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="va">G</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span>, <span class="va">class</span> <span class="op">==</span> <span class="va">clust</span><span class="op">)</span><span class="op">$</span><span class="va">ids</span></span>
<span>    <span class="va">n.clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ids.clust</span><span class="op">)</span></span>
<span>    <span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">n.clust</span>, <span class="va">n.clust</span><span class="op">)</span> <span class="co"># Randomise the order of the ids</span></span>
<span>    <span class="va">iters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">n.clust</span> <span class="op">/</span> <span class="fl">6</span><span class="op">)</span> <span class="co"># How many groups of six are there?</span></span>
<span></span>
<span>    <span class="co"># Matrix to hold the smoothed data</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">iters</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span>    <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">iters</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">iters</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Find ids for group of five</span></span>
<span>      <span class="va">ids.select</span> <span class="op">&lt;-</span> <span class="va">ids.clust</span><span class="op">[</span><span class="va">rand</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">fcal.subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ids.select</span><span class="op">)</span></span>
<span>      <span class="co"># Median process as per CRP preprocessing</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>            <span class="va">fcal.subset</span>,</span>
<span>            <span class="va">calpro_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">calpro_time</span> <span class="op">&lt;=</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>            <span class="va">fcal.subset</span>,</span>
<span>            <span class="va">calpro_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">calpro_time</span> <span class="op">&lt;</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">fcal.ma</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span></span>
<span>          <span class="va">fcal.time</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">$</span><span class="va">calpro_time</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">iters</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span>,</span>
<span>      id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span>,</span>
<span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fcal.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"calpro_result"</span><span class="op">)</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="va">fcal.ma</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co"># Make ids first column</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">iters</span></span>
<span>    <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span>,</span>
<span>      id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span>,</span>
<span>      na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fcal.time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"pred_time"</span><span class="op">)</span></span>
<span>    <span class="va">fcal.time</span> <span class="op">&lt;-</span> <span class="va">fcal.time</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="co"># Make ids first column</span></span>
<span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">fcal.ma</span>, <span class="va">fcal.time</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"calpro_time"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">fcal.ma</span> <span class="op">&lt;-</span> <span class="va">fcal.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>calpro_time <span class="op">=</span> <span class="va">pred_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">pred_time</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">fcal.ma</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="va">clust</span> <span class="co"># Identify cluster assignment</span></span>
<span>    <span class="va">new.fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">new.fc</span>, <span class="va">fcal.ma</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span></span>
<span>  <span class="va">rank.full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/rankCumulative.html">rankCumulative</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="va">G</span><span class="op">]</span><span class="op">]</span>, tmax <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-ncs-reordered-"</span>, <span class="va">G</span>, <span class="st">".png"</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">300</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>    <span class="va">models.fcal</span>,</span>
<span>    G <span class="op">=</span> <span class="va">G</span>,</span>
<span>    log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>    clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/cairo.html">cairo_pdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"plots/spaghetti/fcal-ncs-reordered-"</span>, <span class="va">G</span>, <span class="st">".pdf"</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">16</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">new.fc</span>,</span>
<span>    <span class="va">models.fcal</span>,</span>
<span>    G <span class="op">=</span> <span class="va">G</span>,</span>
<span>    log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    var.time <span class="op">=</span> <span class="st">"calpro_time"</span>,</span>
<span>    clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    mapping <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="alluvial-anchored-plot" class="level4"><h4 class="anchored" data-anchor-id="alluvial-anchored-plot">Alluvial anchored plot</h4>
<p>Having chosen the 8-cluster model to be the most appropriate, we have produced a version of <a href="#fig-fcal-alluvial-unadjusted" class="quarto-xref">Figure&nbsp;6</a> using the labels assigned for the 8-cluster model.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"class"</span>, <span class="st">"G"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">G</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">alluvial.df</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="va">G</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, G <span class="op">=</span> <span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># eliminate label switching</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">4</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">4</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">7</span>, <span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">5</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">5</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">7</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">6</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">6</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">6</span>, <span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">7</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">7</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">8</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">8</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">Original</span>,</span>
<span>    to <span class="op">=</span> <span class="va">rank.full</span><span class="op">$</span><span class="va">New</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">9</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">9</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">3</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">10</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">10</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">9</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">alluvial.df</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">G</span>,</span>
<span>    stratum <span class="op">=</span> <span class="va">class</span>,</span>
<span>    alluvium <span class="op">=</span> <span class="va">ids</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">class</span>,</span>
<span>    label <span class="op">=</span> <span class="va">class</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_flow.html">geom_flow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">inferno</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>, <span class="st">"#F2F3C9"</span>, <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Assumed number of clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/alluvial-FCAL-anchored.png"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6.75</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/alluvial-FCAL-anchored.pdf"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6.75</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/plots/fc-alluvial.RDS"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section></section><section id="fixed-effects-specified-via-gaussian-radial-basis-functions" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="fixed-effects-specified-via-gaussian-radial-basis-functions">Fixed effects specified via Gaussian radial basis functions</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">G.grbf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">models.grbf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">G.cand</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">file.name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"/cache/fcal/grbf/final/fcal-"</span>, <span class="va">G.cand</span>, <span class="st">".RDS"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file.name</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">G.grbf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">G.grbf</span>, <span class="va">G.cand</span><span class="op">)</span></span>
<span>    <span class="va">models.grbf</span><span class="op">[[</span><span class="va">G.cand</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">file.name</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">G.cand</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="number-of-gaussian-radial-basis-functions" class="level3"><h3 class="anchored" data-anchor-id="number-of-gaussian-radial-basis-functions">Number of Gaussian radial basis functions</h3>
<section id="two-grbfs" class="level4"><h4 class="anchored" data-anchor-id="two-grbfs">Two GRBFs</h4>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.grbf.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"cache/fcal/grbf/k=2/grbf-1.2.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">knots.grbf.2.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">knots.grbf.2.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">knots.grbf.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="st">"paper/grbf-plots-2.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">7</span>, units <span class="op">=</span> <span class="st">"in"</span>, res <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.grbf.2.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knot.type <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  grbf <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  l <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.grbf.2.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knot.type <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  grbf <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  l <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-grbf-k-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-grbf-k-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-grbf-k-2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-grbf-k-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Cluster profiles for the six-cluster model assuming two knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="three-grbfs" class="level4"><h4 class="anchored" data-anchor-id="three-grbfs">Three GRBFs</h4>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.grbf.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"/cache/fcal/grbf/k=3/grbf-1.2.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">knots.grbf.3.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">knots.grbf.3.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">knots.grbf.3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="st">"paper/grbf-plots-3.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">7</span>, units <span class="op">=</span> <span class="st">"in"</span>, res <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.grbf.3.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knot.type <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  grbf <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  l <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">knots.grbf.3.list</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sizes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  knot.type <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span>  n.knots <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  grbf <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  l <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-grbf-spec-k-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-grbf-spec-k-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-grbf-spec-k-3-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-grbf-spec-k-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Cluster profiles for the six-cluster model assuming three knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"class"</span>, <span class="st">"G"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">G</span> <span class="kw">in</span> <span class="va">G.grbf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">alluvial.df</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="va">G</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, G <span class="op">=</span> <span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">alluvial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># eliminate label switching</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">4</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">4</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">5</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">5</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">6</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">6</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">7</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">7</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">8</span>, <span class="st">"class"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">alluvial.df</span><span class="op">[</span><span class="va">alluvial.df</span><span class="op">[</span>, <span class="st">"G"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">8</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">alluvial.df</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">G</span>,</span>
<span>    stratum <span class="op">=</span> <span class="va">class</span>,</span>
<span>    alluvium <span class="op">=</span> <span class="va">ids</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">class</span>,</span>
<span>    label <span class="op">=</span> <span class="va">class</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_flow.html">geom_flow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Assumed number of clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/alluvial-FCAL-grbf.png"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6.75</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/alluvial-FCAL-grbf.pdf"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6.75</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-grbf-alluvial" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-grbf-alluvial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-grbf-alluvial-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-grbf-alluvial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Alluvial plot of cluster membership across G for FCAL
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">knots.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  Knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2 GRBFs"</span>, <span class="st">"3 GRBFs"</span><span class="op">)</span>,</span>
<span>  loglik <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">knots.grbf.2</span><span class="op">$</span><span class="va">loglik</span>,</span>
<span>    <span class="va">knots.grbf.3</span><span class="op">$</span><span class="va">loglik</span></span>
<span>  <span class="op">)</span>,</span>
<span>  AIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">knots.grbf.2</span><span class="op">$</span><span class="va">AIC</span>,</span>
<span>    <span class="va">knots.grbf.3</span><span class="op">$</span><span class="va">AIC</span></span>
<span>  <span class="op">)</span>,</span>
<span>  BIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">knots.grbf.2</span><span class="op">$</span><span class="va">BIC</span>,</span>
<span>    <span class="va">knots.grbf.3</span><span class="op">$</span><span class="va">BIC</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">knots.df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Knots"</span>,</span>
<span>    <span class="st">"Maxmum log likelihood"</span>,</span>
<span>    <span class="st">"AIC"</span>,</span>
<span>    <span class="st">"BIC"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span></span>
<span>  <span class="va">knots.grbf.2.list</span>,</span>
<span>  <span class="va">knots.grbf.3.list</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-knot-stats-grbf" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-knot-stats-grbf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Model statistics for differing numbers of knots for natural cubic splines
</figcaption><div aria-describedby="tbl-knot-stats-grbf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Knots</th>
<th style="text-align: right;">Maxmum log likelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2 GRBFs</td>
<td style="text-align: right;">-16421.02</td>
<td style="text-align: right;">32924.03</td>
<td style="text-align: right;">33126.70</td>
</tr>
<tr class="even">
<td style="text-align: left;">3 GRBFs</td>
<td style="text-align: right;">-16237.73</td>
<td style="text-align: right;">32569.45</td>
<td style="text-align: right;">32801.78</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section></section><section id="number-of-clusters-1" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="number-of-clusters-1">Number of clusters</h3>
<section id="posterior-classifications-1" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="posterior-classifications-1">Posterior classifications</h4>
<p>From the below data, we can see how posterior probabilities change as the number of assumed clusters increase</p>
<div class="column-page">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">G = 2</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">G = 3</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">G = 4</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">G = 5</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false">G = 6</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-6" role="tab" aria-controls="tabset-4-6" aria-selected="false">G = 7</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-7" role="tab" aria-controls="tabset-4-7" aria-selected="false">G = 8</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">496</td>
<td style="text-align: center;">540</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">47.88</td>
<td style="text-align: center;">52.12</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.8024</td>
<td style="text-align: center;">0.1976</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.2024</td>
<td style="text-align: center;">0.7976</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">68.35</td>
<td style="text-align: center;">67.59</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">55.24</td>
<td style="text-align: center;">51.48</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">36.09</td>
<td style="text-align: center;">34.81</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">310</td>
<td style="text-align: center;">497</td>
<td style="text-align: center;">229</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">29.92</td>
<td style="text-align: center;">47.97</td>
<td style="text-align: center;">22.1</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7767</td>
<td style="text-align: center;">0.1262</td>
<td style="text-align: center;">0.0971</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0985</td>
<td style="text-align: center;">0.7971</td>
<td style="text-align: center;">0.1044</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.1083</td>
<td style="text-align: center;">0.13</td>
<td style="text-align: center;">0.7617</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">66.13</td>
<td style="text-align: center;">68.21</td>
<td style="text-align: center;">60.26</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">52.58</td>
<td style="text-align: center;">55.73</td>
<td style="text-align: center;">48.03</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">34.19</td>
<td style="text-align: center;">39.64</td>
<td style="text-align: center;">35.81</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">277</td>
<td style="text-align: center;">195</td>
<td style="text-align: center;">311</td>
<td style="text-align: center;">253</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">26.74</td>
<td style="text-align: center;">18.82</td>
<td style="text-align: center;">30.02</td>
<td style="text-align: center;">24.42</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7524</td>
<td style="text-align: center;">0.0494</td>
<td style="text-align: center;">0.0663</td>
<td style="text-align: center;">0.1319</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0553</td>
<td style="text-align: center;">0.7415</td>
<td style="text-align: center;">0.0991</td>
<td style="text-align: center;">0.1041</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0648</td>
<td style="text-align: center;">0.0963</td>
<td style="text-align: center;">0.7746</td>
<td style="text-align: center;">0.0643</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.1593</td>
<td style="text-align: center;">0.1106</td>
<td style="text-align: center;">0.0696</td>
<td style="text-align: center;">0.6606</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">59.57</td>
<td style="text-align: center;">57.44</td>
<td style="text-align: center;">67.2</td>
<td style="text-align: center;">39.13</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">48.01</td>
<td style="text-align: center;">47.69</td>
<td style="text-align: center;">55.31</td>
<td style="text-align: center;">27.27</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">32.85</td>
<td style="text-align: center;">34.36</td>
<td style="text-align: center;">35.69</td>
<td style="text-align: center;">19.37</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">114</td>
<td style="text-align: center;">268</td>
<td style="text-align: center;">204</td>
<td style="text-align: center;">166</td>
<td style="text-align: center;">284</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">25.87</td>
<td style="text-align: center;">19.69</td>
<td style="text-align: center;">16.02</td>
<td style="text-align: center;">27.41</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7472</td>
<td style="text-align: center;">0.0951</td>
<td style="text-align: center;">0.0911</td>
<td style="text-align: center;">0.0093</td>
<td style="text-align: center;">0.0572</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0985</td>
<td style="text-align: center;">0.6457</td>
<td style="text-align: center;">0.0624</td>
<td style="text-align: center;">0.0462</td>
<td style="text-align: center;">0.1472</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0937</td>
<td style="text-align: center;">0.0659</td>
<td style="text-align: center;">0.7086</td>
<td style="text-align: center;">0.1028</td>
<td style="text-align: center;">0.029</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0181</td>
<td style="text-align: center;">0.0503</td>
<td style="text-align: center;">0.1333</td>
<td style="text-align: center;">0.7194</td>
<td style="text-align: center;">0.0788</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0527</td>
<td style="text-align: center;">0.13</td>
<td style="text-align: center;">0.0236</td>
<td style="text-align: center;">0.0526</td>
<td style="text-align: center;">0.7411</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">57.02</td>
<td style="text-align: center;">35.82</td>
<td style="text-align: center;">55.39</td>
<td style="text-align: center;">53.01</td>
<td style="text-align: center;">59.51</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">49.12</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">40.69</td>
<td style="text-align: center;">39.76</td>
<td style="text-align: center;">47.89</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">33.33</td>
<td style="text-align: center;">19.78</td>
<td style="text-align: center;">27.45</td>
<td style="text-align: center;">27.71</td>
<td style="text-align: center;">32.04</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">186</td>
<td style="text-align: center;">256</td>
<td style="text-align: center;">117</td>
<td style="text-align: center;">281</td>
<td style="text-align: center;">150</td>
<td style="text-align: center;">46</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">17.95</td>
<td style="text-align: center;">24.71</td>
<td style="text-align: center;">11.29</td>
<td style="text-align: center;">27.12</td>
<td style="text-align: center;">14.48</td>
<td style="text-align: center;">4.44</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.6971</td>
<td style="text-align: center;">0.0182</td>
<td style="text-align: center;">0.0826</td>
<td style="text-align: center;">0.0555</td>
<td style="text-align: center;">0.0902</td>
<td style="text-align: center;">0.0564</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0114</td>
<td style="text-align: center;">0.7392</td>
<td style="text-align: center;">0.0467</td>
<td style="text-align: center;">0.1273</td>
<td style="text-align: center;">0.0372</td>
<td style="text-align: center;">0.0382</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0834</td>
<td style="text-align: center;">0.0391</td>
<td style="text-align: center;">0.7249</td>
<td style="text-align: center;">0.1022</td>
<td style="text-align: center;">0.0093</td>
<td style="text-align: center;">0.0411</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0578</td>
<td style="text-align: center;">0.1309</td>
<td style="text-align: center;">0.1022</td>
<td style="text-align: center;">0.6399</td>
<td style="text-align: center;">0.0436</td>
<td style="text-align: center;">0.0256</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.1135</td>
<td style="text-align: center;">0.054</td>
<td style="text-align: center;">0.0201</td>
<td style="text-align: center;">0.053</td>
<td style="text-align: center;">0.713</td>
<td style="text-align: center;">0.0464</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0639</td>
<td style="text-align: center;">0.0941</td>
<td style="text-align: center;">0.0575</td>
<td style="text-align: center;">0.0176</td>
<td style="text-align: center;">0.063</td>
<td style="text-align: center;">0.7039</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">52.15</td>
<td style="text-align: center;">58.2</td>
<td style="text-align: center;">53.85</td>
<td style="text-align: center;">36.3</td>
<td style="text-align: center;">52</td>
<td style="text-align: center;">50</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">38.17</td>
<td style="text-align: center;">46.09</td>
<td style="text-align: center;">47.86</td>
<td style="text-align: center;">24.56</td>
<td style="text-align: center;">42.67</td>
<td style="text-align: center;">41.3</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">26.88</td>
<td style="text-align: center;">33.59</td>
<td style="text-align: center;">34.19</td>
<td style="text-align: center;">18.86</td>
<td style="text-align: center;">28</td>
<td style="text-align: center;">19.57</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-4-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-6-tab">
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">139</td>
<td style="text-align: center;">149</td>
<td style="text-align: center;">274</td>
<td style="text-align: center;">33</td>
<td style="text-align: center;">255</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">126</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">13.42</td>
<td style="text-align: center;">14.38</td>
<td style="text-align: center;">26.45</td>
<td style="text-align: center;">3.19</td>
<td style="text-align: center;">24.61</td>
<td style="text-align: center;">5.79</td>
<td style="text-align: center;">12.16</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
<th style="text-align: center;">prob7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.7097</td>
<td style="text-align: center;">0.0839</td>
<td style="text-align: center;">0.0394</td>
<td style="text-align: center;">0.0193</td>
<td style="text-align: center;">0.0117</td>
<td style="text-align: center;">0.0553</td>
<td style="text-align: center;">0.0807</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0956</td>
<td style="text-align: center;">0.6875</td>
<td style="text-align: center;">0.059</td>
<td style="text-align: center;">0.0554</td>
<td style="text-align: center;">0.0344</td>
<td style="text-align: center;">0.0357</td>
<td style="text-align: center;">0.0325</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0391</td>
<td style="text-align: center;">0.0405</td>
<td style="text-align: center;">0.6494</td>
<td style="text-align: center;">0.0112</td>
<td style="text-align: center;">0.1266</td>
<td style="text-align: center;">0.027</td>
<td style="text-align: center;">0.1062</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0458</td>
<td style="text-align: center;">0.1192</td>
<td style="text-align: center;">0.0446</td>
<td style="text-align: center;">0.7189</td>
<td style="text-align: center;">0.0409</td>
<td style="text-align: center;">0.0301</td>
<td style="text-align: center;">5e-04</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0067</td>
<td style="text-align: center;">0.025</td>
<td style="text-align: center;">0.1272</td>
<td style="text-align: center;">0.012</td>
<td style="text-align: center;">0.7453</td>
<td style="text-align: center;">0.0377</td>
<td style="text-align: center;">0.046</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0685</td>
<td style="text-align: center;">0.059</td>
<td style="text-align: center;">0.031</td>
<td style="text-align: center;">0.0247</td>
<td style="text-align: center;">0.088</td>
<td style="text-align: center;">0.6833</td>
<td style="text-align: center;">0.0455</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0703</td>
<td style="text-align: center;">0.0331</td>
<td style="text-align: center;">0.093</td>
<td style="text-align: center;">4e-04</td>
<td style="text-align: center;">0.033</td>
<td style="text-align: center;">0.0447</td>
<td style="text-align: center;">0.7255</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">56.12</td>
<td style="text-align: center;">48.32</td>
<td style="text-align: center;">40.51</td>
<td style="text-align: center;">51.52</td>
<td style="text-align: center;">61.18</td>
<td style="text-align: center;">46.67</td>
<td style="text-align: center;">52.38</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">41.01</td>
<td style="text-align: center;">32.21</td>
<td style="text-align: center;">26.64</td>
<td style="text-align: center;">45.45</td>
<td style="text-align: center;">47.45</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">46.83</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">27.34</td>
<td style="text-align: center;">18.79</td>
<td style="text-align: center;">18.98</td>
<td style="text-align: center;">36.36</td>
<td style="text-align: center;">33.73</td>
<td style="text-align: center;">26.67</td>
<td style="text-align: center;">33.33</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-4-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-7-tab">
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
<th style="text-align: center;">class8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">131</td>
<td style="text-align: center;">140</td>
<td style="text-align: center;">166</td>
<td style="text-align: center;">114</td>
<td style="text-align: center;">208</td>
<td style="text-align: center;">66</td>
<td style="text-align: center;">141</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>%</strong></td>
<td style="text-align: center;">6.76</td>
<td style="text-align: center;">12.64</td>
<td style="text-align: center;">13.51</td>
<td style="text-align: center;">16.02</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">20.08</td>
<td style="text-align: center;">6.37</td>
<td style="text-align: center;">13.61</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">prob1</th>
<th style="text-align: center;">prob2</th>
<th style="text-align: center;">prob3</th>
<th style="text-align: center;">prob4</th>
<th style="text-align: center;">prob5</th>
<th style="text-align: center;">prob6</th>
<th style="text-align: center;">prob7</th>
<th style="text-align: center;">prob8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>class1</strong></td>
<td style="text-align: center;">0.644</td>
<td style="text-align: center;">0.067</td>
<td style="text-align: center;">0.0342</td>
<td style="text-align: center;">0.0562</td>
<td style="text-align: center;">0.0262</td>
<td style="text-align: center;">0.0728</td>
<td style="text-align: center;">0.0586</td>
<td style="text-align: center;">0.041</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class2</strong></td>
<td style="text-align: center;">0.0451</td>
<td style="text-align: center;">0.6683</td>
<td style="text-align: center;">0.0792</td>
<td style="text-align: center;">0.0712</td>
<td style="text-align: center;">0.0344</td>
<td style="text-align: center;">0.0258</td>
<td style="text-align: center;">0.0059</td>
<td style="text-align: center;">0.0702</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class3</strong></td>
<td style="text-align: center;">0.0283</td>
<td style="text-align: center;">0.0741</td>
<td style="text-align: center;">0.5651</td>
<td style="text-align: center;">0.0419</td>
<td style="text-align: center;">0.0306</td>
<td style="text-align: center;">0.0622</td>
<td style="text-align: center;">0.0347</td>
<td style="text-align: center;">0.1632</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class4</strong></td>
<td style="text-align: center;">0.0474</td>
<td style="text-align: center;">0.0777</td>
<td style="text-align: center;">0.033</td>
<td style="text-align: center;">0.6829</td>
<td style="text-align: center;">0.0674</td>
<td style="text-align: center;">0.0119</td>
<td style="text-align: center;">0.056</td>
<td style="text-align: center;">0.0237</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class5</strong></td>
<td style="text-align: center;">0.0297</td>
<td style="text-align: center;">0.0314</td>
<td style="text-align: center;">0.038</td>
<td style="text-align: center;">0.1</td>
<td style="text-align: center;">0.6569</td>
<td style="text-align: center;">0.0177</td>
<td style="text-align: center;">0.1012</td>
<td style="text-align: center;">0.0251</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class6</strong></td>
<td style="text-align: center;">0.0385</td>
<td style="text-align: center;">0.0292</td>
<td style="text-align: center;">0.0608</td>
<td style="text-align: center;">0.0029</td>
<td style="text-align: center;">0.0087</td>
<td style="text-align: center;">0.7125</td>
<td style="text-align: center;">0.021</td>
<td style="text-align: center;">0.1264</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>class7</strong></td>
<td style="text-align: center;">0.0443</td>
<td style="text-align: center;">0.0015</td>
<td style="text-align: center;">0.0264</td>
<td style="text-align: center;">0.036</td>
<td style="text-align: center;">0.1159</td>
<td style="text-align: center;">0.0453</td>
<td style="text-align: center;">0.697</td>
<td style="text-align: center;">0.0337</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>class8</strong></td>
<td style="text-align: center;">0.0291</td>
<td style="text-align: center;">0.0683</td>
<td style="text-align: center;">0.1686</td>
<td style="text-align: center;">0.0174</td>
<td style="text-align: center;">0.0117</td>
<td style="text-align: center;">0.1331</td>
<td style="text-align: center;">0.0165</td>
<td style="text-align: center;">0.5553</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">class1</th>
<th style="text-align: center;">class2</th>
<th style="text-align: center;">class3</th>
<th style="text-align: center;">class4</th>
<th style="text-align: center;">class5</th>
<th style="text-align: center;">class6</th>
<th style="text-align: center;">class7</th>
<th style="text-align: center;">class8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.7</strong></td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">47.33</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">51.2</td>
<td style="text-align: center;">45.61</td>
<td style="text-align: center;">52.4</td>
<td style="text-align: center;">51.52</td>
<td style="text-align: center;">24.11</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>prob&gt;0.8</strong></td>
<td style="text-align: center;">32.86</td>
<td style="text-align: center;">41.22</td>
<td style="text-align: center;">22.86</td>
<td style="text-align: center;">42.77</td>
<td style="text-align: center;">29.82</td>
<td style="text-align: center;">42.79</td>
<td style="text-align: center;">34.85</td>
<td style="text-align: center;">19.86</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>prob&gt;0.9</strong></td>
<td style="text-align: center;">21.43</td>
<td style="text-align: center;">31.3</td>
<td style="text-align: center;">12.14</td>
<td style="text-align: center;">28.31</td>
<td style="text-align: center;">13.16</td>
<td style="text-align: center;">29.33</td>
<td style="text-align: center;">28.79</td>
<td style="text-align: center;">10.64</td>
</tr>
</tbody>
</table>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pprobs.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.2</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.3</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.4</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.5</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.6</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.7</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pprobs.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">groups.8</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">class.2</span> <span class="op">&lt;-</span> <span class="va">groups.2</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.2</span>, <span class="va">groups.2</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.2</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.3</span> <span class="op">&lt;-</span> <span class="va">groups.3</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.3</span>, <span class="va">groups.3</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.3</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.4</span> <span class="op">&lt;-</span> <span class="va">groups.4</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.4</span>, <span class="va">groups.4</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.4</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.5</span> <span class="op">&lt;-</span> <span class="va">groups.5</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.5</span>, <span class="va">groups.5</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.5</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.6</span> <span class="op">&lt;-</span> <span class="va">groups.6</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.6</span>, <span class="va">groups.6</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.6</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.7</span> <span class="op">&lt;-</span> <span class="va">groups.7</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.7</span>, <span class="va">groups.7</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.7</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">class.8</span> <span class="op">&lt;-</span> <span class="va">groups.8</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">pprobs.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pprobs.8</span>, <span class="va">groups.8</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span><span class="va">i</span>, <span class="va">class.8</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pprobs.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.2</span><span class="op">)</span></span>
<span><span class="va">pprobs.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.3</span><span class="op">)</span></span>
<span><span class="va">pprobs.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.4</span><span class="op">)</span></span>
<span><span class="va">pprobs.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.5</span><span class="op">)</span></span>
<span><span class="va">pprobs.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.6</span><span class="op">)</span></span>
<span><span class="va">pprobs.7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.7</span><span class="op">)</span></span>
<span><span class="va">pprobs.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">pprobs.8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pprobs.2</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Two clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.3</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Three clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.4</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Four clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.5</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Five clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.6</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Six clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.7</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Seven clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs.8</span><span class="op">$</span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Eight clusters"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pprobs.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pprobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">pprobs.2</span>,</span>
<span>  <span class="va">pprobs.3</span>,</span>
<span>  <span class="va">pprobs.4</span>,</span>
<span>  <span class="va">pprobs.5</span>,</span>
<span>  <span class="va">pprobs.6</span>,</span>
<span>  <span class="va">pprobs.7</span>,</span>
<span>  <span class="va">pprobs.8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">pprobs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prob</span>, y <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_histogram(bins = 40, fill = NA, position="identity")</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slab.html">stat_slab</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="st">"#5D5179"</span>, color <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/geom_dots.html">geom_dots</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#4F759B"</span>, dotsize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Posterior probability for cluster membership"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span></span>
<span>    <span class="st">"Distribution of Posterior Probabilities Across Models"</span>,</span>
<span>    <span class="st">"Subject-specific posterior probabilities for assigned cluster"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">rev</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/pprob-distribution-grbf.png"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8.5</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">7.5</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/pprob-distribution-grbf.pdf"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8.5</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">7.5</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/PProb distributions GRBF-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section><section id="residual-plots-1" class="level4"><h4 class="anchored" data-anchor-id="residual-plots-1">Residual plots</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">G = 2</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p><img src="fcal_files/figure-html/GRBF residuals-1.png" class="img-fluid" width="672">##### G = 3 <img src="fcal_files/figure-html/GRBF residuals-2.png" class="img-fluid" width="672">##### G = 4 <img src="fcal_files/figure-html/GRBF residuals-3.png" class="img-fluid" width="672">##### G = 5 <img src="fcal_files/figure-html/GRBF residuals-4.png" class="img-fluid" width="672">##### G = 6 <img src="fcal_files/figure-html/GRBF residuals-5.png" class="img-fluid" width="672">##### G = 7 <img src="fcal_files/figure-html/GRBF residuals-6.png" class="img-fluid" width="672">##### G = 8 <img src="fcal_files/figure-html/GRBF residuals-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<section id="chosen-model-2" class="level5"><h5 class="anchored" data-anchor-id="chosen-model-2">Chosen model</h5>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#D8829D"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#AF6A80"</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">30</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#023777"</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Residuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_band.html">stat_qq_band</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_qq_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#D8829D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_point.html">stat_qq_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#023777"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Theoretical Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sample Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/Residual-plot-fcal-grbf.pdf"</span>,</span>
<span>  plot <span class="op">=</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-GRBF-norm" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-GRBF-norm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-GRBF-norm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GRBF-norm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Plots assessing normality for the distribution of residuals for the chosen GRBF model for FCAL. (A) Histrogram; (B) Q-Q plot.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">predClass</span> <span class="op">&lt;-</span> <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pred</span>, <span class="va">predClass</span>, by <span class="op">=</span> <span class="st">"ids"</span><span class="op">)</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">class</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">resid_ss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_band.html">stat_qq_band</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_qq_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#D8829D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/qqplotr/man/stat_qq_point.html">stat_qq_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#023777"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Theoretical Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sample Quantiles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">labels</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ArrangedPlot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/cluster-resids-grbf.pdf"</span>,</span>
<span>  <span class="va">ArrangedPlot</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ArrangedPlot</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-GRBF-norm-cluster" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-GRBF-norm-cluster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-GRBF-norm-cluster-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GRBF-norm-cluster-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Q-Q plots assessing normality for the distribution of residuals stratifed by cluster assignment.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="model-metrics-1" class="level4"><h4 class="anchored" data-anchor-id="model-metrics-1">Model metrics</h4>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://cecileproust-lima.github.io/lcmm/reference/summaryplot.html">summaryplot</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">models.grbf</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="co">#  models.grbf[[8]],</span></span>
<span>  which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"loglik"</span>, <span class="st">"AIC"</span>, <span class="st">"BIC"</span>, <span class="st">"entropy"</span>, <span class="st">"ICL"</span><span class="op">)</span>,</span>
<span>  mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  axis <span class="op">=</span> <span class="st">"Class"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-grbf-metrics" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-grbf-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fcal_files/figure-html/fig-grbf-metrics-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-grbf-metrics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Model metrics for FCAL for G = 2-8
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grbf.metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/makeMetrics.html">makeMetrics</a></span><span class="op">(</span><span class="va">G.grbf</span>, <span class="va">models.grbf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/buildDT.html">buildDT</a></span><span class="op">(</span><span class="va">grbf.metrics</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Clusters</th>
<th style="text-align: right;">Maximum log-likelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-16590.47</td>
<td style="text-align: right;">33210.94</td>
<td style="text-align: right;">33285.09</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">-16422.90</td>
<td style="text-align: right;">32891.80</td>
<td style="text-align: right;">33005.49</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">-16340.79</td>
<td style="text-align: right;">32743.58</td>
<td style="text-align: right;">32896.81</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-16272.49</td>
<td style="text-align: right;">32622.98</td>
<td style="text-align: right;">32815.76</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">-16237.73</td>
<td style="text-align: right;">32569.45</td>
<td style="text-align: right;">32801.78</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">-16205.04</td>
<td style="text-align: right;">32520.07</td>
<td style="text-align: right;">32791.94</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">-16187.21</td>
<td style="text-align: right;">32500.41</td>
<td style="text-align: right;">32811.83</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The optimum AIC is <b> 32500.41 </b> with cluster 10. The optimum BIC is <b>32791.94 </b> with cluster 9</p>
</section><section id="spaghetti-plots-per-cluster-1" class="level4"><h4 class="anchored" data-anchor-id="spaghetti-plots-per-cluster-1">Spaghetti plots per cluster</h4>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">G</span> <span class="kw">in</span> <span class="va">G.grbf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"##### G = "</span>, <span class="va">G</span>, <span class="st">"\n\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"###### Log-scale, all subjects \n\n"</span><span class="op">)</span></span>
<span>  <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/libdr/man/spaghettiPlot.html">spaghettiPlot</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>    <span class="va">models.grbf</span>,</span>
<span>    G <span class="op">=</span> <span class="va">G</span>,</span>
<span>    log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tmax <span class="op">=</span> <span class="fl">7</span>,</span>
<span>    sizes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    knots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    knot.type <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span>    grbf <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    var.time <span class="op">=</span> <span class="st">"calpro_time"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>##### G = 2

###### Log-scale, all subjects </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/grbf spaghetti plots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##### G = 3

###### Log-scale, all subjects </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/grbf spaghetti plots-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##### G = 4

###### Log-scale, all subjects </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/grbf spaghetti plots-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##### G = 5

###### Log-scale, all subjects </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/grbf spaghetti plots-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##### G = 6

###### Log-scale, all subjects </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/grbf spaghetti plots-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##### G = 7

###### Log-scale, all subjects </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/grbf spaghetti plots-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##### G = 8

###### Log-scale, all subjects </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/grbf spaghetti plots-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="ibd-associations" class="level4"><h4 class="anchored" data-anchor-id="ibd-associations">IBD Associations</h4>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dict.grbf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="va">dict.grbf</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">cluster</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pprob</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span><span class="op">$</span><span class="va">class</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">dict.grbf</span><span class="op">$</span><span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dict.grbf</span><span class="op">$</span><span class="va">diagnosis</span><span class="op">)</span></span>
<span><span class="va">dict.grbf</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Population</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Cluster = 1</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Cluster = 2</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">Cluster = 3</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-5" role="tab" aria-controls="tabset-6-5" aria-selected="false">Cluster = 4</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-6" role="tab" aria-controls="tabset-6-6" aria-selected="false">Cluster = 5</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-7" role="tab" aria-controls="tabset-6-7" aria-selected="false">Cluster = 6</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/describe_cat.html">describe_cat</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="va">dict.grbf</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
               544                380                112                  0 

   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
         0.5250965          0.3667954          0.1081081          0.0000000 </code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/describe_cat.html">describe_cat</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict.grbf</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
               117                 45                 24                  0 

   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
         0.6290323          0.2419355          0.1290323          0.0000000 </code></pre>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/describe_cat.html">describe_cat</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict.grbf</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
               173                 48                 35                  0 

   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
         0.6757812          0.1875000          0.1367188          0.0000000 </code></pre>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/describe_cat.html">describe_cat</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict.grbf</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
                72                 33                 12                  0 

   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
         0.6153846          0.2820513          0.1025641          0.0000000 </code></pre>
</div>
</div>
</div>
<div id="tabset-6-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-5-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/describe_cat.html">describe_cat</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict.grbf</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
                70                193                 18                  0 

   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
        0.24911032         0.68683274         0.06405694         0.00000000 </code></pre>
</div>
</div>
</div>
<div id="tabset-6-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-6-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/describe_cat.html">describe_cat</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict.grbf</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
                83                 44                 23                  0 

   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
         0.5533333          0.2933333          0.1533333          0.0000000 </code></pre>
</div>
</div>
</div>
<div id="tabset-6-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-7-tab">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/libdr/man/describe_cat.html">describe_cat</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict.grbf</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
                29                 17                  0                  0 

   Crohn's Disease Ulcerative Colitis               IBDU               &lt;NA&gt; 
         0.6304348          0.3695652          0.0000000          0.0000000 </code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="fishers-exact-test" class="level5"><h5 class="anchored" data-anchor-id="fishers-exact-test">Fisher’s exact test</h5>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/fisher.test.html">fisher.test</a></span><span class="op">(</span><span class="va">dict.grbf</span><span class="op">$</span><span class="va">diagnosis</span>,</span>
<span>  <span class="va">dict.grbf</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>  simulate.p.value <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># calculate p-values using Monte Carlo</span></span>
<span>  B <span class="op">=</span> <span class="fl">1e5</span></span>
<span><span class="op">)</span> <span class="co"># replicates for Monte Carlo test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data with simulated p-value (based on
    1e+05 replicates)

data:  dict.grbf$diagnosis and dict.grbf$cluster
p-value = 1e-05
alternative hypothesis: two.sided</code></pre>
</div>
</div>
</section></section></section></section><section id="ncs-vs-grbf-comparison" class="level2"><h2 class="anchored" data-anchor-id="ncs-vs-grbf-comparison">NCS vs GRBF comparison</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  calpro_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>  diagnosis <span class="op">=</span> <span class="st">"Crohn's Disease"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pred.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">pred.df</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    calpro_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    diagnosis <span class="op">=</span> <span class="st">"Ulcerative colitis"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pred.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">pred.df</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    calpro_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    diagnosis <span class="op">=</span> <span class="st">"IBDU"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fl">1.2</span></span>
<span><span class="va">centers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span> <span class="op">/</span> <span class="fl">4</span>, <span class="fl">14</span> <span class="op">/</span> <span class="fl">4</span>, <span class="fl">21</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">pred.df</span><span class="op">$</span><span class="va">grbf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">pred.df</span><span class="op">$</span><span class="va">calpro_time</span> <span class="op">-</span> <span class="va">centers</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred.df</span><span class="op">$</span><span class="va">grbf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">pred.df</span><span class="op">$</span><span class="va">calpro_time</span> <span class="op">-</span> <span class="va">centers</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred.df</span><span class="op">$</span><span class="va">grbf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">pred.df</span><span class="op">$</span><span class="va">calpro_time</span> <span class="op">-</span> <span class="va">centers</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NCS.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cecileproust-lima.github.io/lcmm/reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">models.fcal</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>, <span class="va">pred.df</span>, <span class="st">"calpro_time"</span>, draws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">pred</span></span>
<span><span class="va">GRBF.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cecileproust-lima.github.io/lcmm/reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">models.grbf</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>, <span class="va">pred.df</span>, <span class="st">"calpro_time"</span>, draws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">pred</span></span>
<span></span>
<span><span class="va">NCS.switch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">g</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    time <span class="op">=</span> <span class="va">pred.df</span><span class="op">$</span><span class="va">calpro_time</span>,</span>
<span>    pred <span class="op">=</span> <span class="va">NCS.pred</span><span class="op">[</span>, <span class="va">NCS.switch</span><span class="op">[</span><span class="va">g</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">NCS.pred</span><span class="op">[</span>, <span class="va">NCS.switch</span><span class="op">[</span><span class="va">g</span><span class="op">]</span> <span class="op">+</span> <span class="fl">6</span><span class="op">]</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">NCS.pred</span><span class="op">[</span>, <span class="va">NCS.switch</span><span class="op">[</span><span class="va">g</span><span class="op">]</span> <span class="op">+</span> <span class="fl">12</span><span class="op">]</span>,</span>
<span>    Model <span class="op">=</span> <span class="st">"NCS"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">plot.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>    <span class="va">plot.df</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      time <span class="op">=</span> <span class="va">pred.df</span><span class="op">$</span><span class="va">calpro_time</span>,</span>
<span>      pred <span class="op">=</span> <span class="va">GRBF.pred</span><span class="op">[</span>, <span class="va">g</span><span class="op">]</span>,</span>
<span>      upper <span class="op">=</span> <span class="va">GRBF.pred</span><span class="op">[</span>, <span class="va">g</span> <span class="op">+</span> <span class="fl">6</span><span class="op">]</span>,</span>
<span>      lower <span class="op">=</span> <span class="va">GRBF.pred</span><span class="op">[</span>, <span class="va">g</span> <span class="op">+</span> <span class="fl">12</span><span class="op">]</span>,</span>
<span>      Model <span class="op">=</span> <span class="st">"GRBF"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">plot.df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, color <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">lower</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Predicted cluster mean"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#0E6BA8"</span>, <span class="st">"#EF6461"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p.list</span><span class="op">[[</span><span class="va">g</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">final.plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">p.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p.list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">p.list</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/comparison.pdf"</span>,</span>
<span>  <span class="va">final.plot</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8.3</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">11.7</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"paper/comparison.png"</span>,</span>
<span>  <span class="va">final.plot</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8.3</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">11.7</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">final.plot</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fcal_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">
<p>This work is funded by the Medical Research Council &amp; University of Edinburgh via a Precision Medicine PhD studentship (MR/N013166/1, to <strong>NC-C</strong>).</p>
<p>This work has made use of the resources provided by the <a href="http://www.ecdf.ed.ac.uk/">Edinburgh Compute and Data Facility (ECDF)</a>.</p>
</div></section><section id="author-contributions" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Author contributions</h2><div class="quarto-appendix-contents">
</div></section><section id="references" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-constantine-cooke2023" class="csl-entry" role="listitem">
Constantine-Cooke, Nathan, Karla Monterrubio-Gómez, Nikolas Plevris, Lauranne A. A. P. Derikx, Beatriz Gros, Gareth-Rhys Jones, Riccardo E. Marioni, Charlie W. Lees, and Catalina A. Vallejos. 2023. <span>“Longitudinal <span>Fecal</span> <span>Calprotectin</span> <span>Profiles</span> <span>Characterize</span> <span>Disease</span> <span>Course</span> <span>Heterogeneity</span> in <span>Crohn</span>’s <span>Disease</span>.”</span> <em>Clinical Gastroenterology and Hepatology</em>, March, S1542356523002343. <a href="https://doi.org/10.1016/j.cgh.2023.03.026">https://doi.org/10.1016/j.cgh.2023.03.026</a>.
</div>
<div id="ref-Elhakeem2022" class="csl-entry" role="listitem">
Elhakeem, Ahmed, Rachael A. Hughes, Kate Tilling, Diana L. Cousminer, Stefan A. Jackowski, Tim J. Cole, Alex S. F. Kwong, et al. 2022. <span>“Using Linear and Natural Cubic Splines, SITAR, and Latent Trajectory Models to Characterise Nonlinear Longitudinal Growth Trajectories in Cohort Studies.”</span> <em>BMC Medical Research Methodology</em> 22 (1): 68. <a href="https://doi.org/10.1186/s12874-022-01542-8">https://doi.org/10.1186/s12874-022-01542-8</a>.
</div>
<div id="ref-harrell2015" class="csl-entry" role="listitem">
Harrell, Frank E. 2015. <span>“General <span>Aspects</span> of <span>Fitting Regression Models</span>.”</span> In <em>Regression <span>Modeling Strategies</span>: <span>With Applications</span> to <span>Linear Models</span>, <span>Logistic</span> and <span>Ordinal Regression</span>, and <span>Survival Analysis</span></em>, edited by Jr. Harrell Frank E., 13–44. Springer <span>Series</span> in <span>Statistics</span>. <span>Cham</span>: <span>Springer International Publishing</span>. <a href="https://doi.org/10.1007/978-3-319-19425-7_2">https://doi.org/10.1007/978-3-319-19425-7_2</a>.
</div>
<div id="ref-Proust-Lima2017" class="csl-entry" role="listitem">
Proust-Lima, Cécile, Viviane Philipps, and Benoit Liquet. 2017. <span>“Estimation of Extended Mixed Models Using Latent Classes and Latent Processes: The <span>R</span> Package <span class="nocase">lcmm</span>.”</span> <em>Journal of Statistical Software</em> 78 (2): 1–56. <a href="https://doi.org/10.18637/jss.v078.i02">https://doi.org/10.18637/jss.v078.i02</a>.
</div>
</div>
</div></section><section id="reuse" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents">
<p>Licensed by <a href="https://creativecommons.org/licenses/by/4.0/">CC BY</a> unless otherwise stated.</p>
</div></section><section id="section" class="level2 appendix"><h2 class="anchored quarto-appendix-heading"></h2><div class="quarto-appendix-contents">
<div class="center">
<p><img class="center" src="../../images/MRC_HGU_Edinburgh RGB.png" alt="MRC Human Genetics Unit logo" height="50px"><img src="../../images/cgem-logo.png" alt="Centre for Genomic &amp; Experimental Medicine logo" height="50px"></p>
</div>
<hr></div></section><section id="session-info" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Session info</h2><div class="quarto-appendix-contents">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><strong>R version 4.4.2 (2024-10-31)</strong></p>
<p><strong>Platform:</strong> aarch64-apple-darwin20</p>
<p><strong>locale:</strong> en_GB.UTF-8||en_GB.UTF-8||en_GB.UTF-8||C||en_GB.UTF-8||en_GB.UTF-8</p>
<p><strong>attached base packages:</strong> <em>splines</em>, <em>stats</em>, <em>graphics</em>, <em>grDevices</em>, <em>utils</em>, <em>datasets</em>, <em>methods</em> and <em>base</em></p>
<p><strong>other attached packages:</strong> <em>qqplotr(v.0.0.6)</em>, <em>pander(v.0.6.5)</em>, <em>ggalluvial(v.0.12.5)</em>, <em>ggdist(v.3.3.2)</em>, <em>kml(v.2.5.0)</em>, <em>longitudinalData(v.2.4.7)</em>, <em>misc3d(v.0.9-1)</em>, <em>rgl(v.1.3.16)</em>, <em>clv(v.0.3-2.4)</em>, <em>class(v.7.3-22)</em>, <em>cluster(v.2.1.6)</em>, <em>lcmm(v.2.1.0)</em>, <em>libdr(v.1.0.1)</em>, <em>magrittr(v.2.0.3)</em>, <em>patchwork(v.1.3.0)</em>, <em>lubridate(v.1.9.4)</em>, <em>forcats(v.1.0.0)</em>, <em>stringr(v.1.5.1)</em>, <em>dplyr(v.1.1.4)</em>, <em>purrr(v.1.0.2)</em>, <em>readr(v.2.1.5)</em>, <em>tidyr(v.1.3.1)</em>, <em>tibble(v.3.2.1)</em>, <em>ggplot2(v.3.5.1)</em> and <em>tidyverse(v.2.0.0)</em></p>
<p><strong>loaded via a namespace (and not attached):</strong> <em>tidyselect(v.1.2.1)</em>, <em>viridisLite(v.0.4.2)</em>, <em>farver(v.2.1.2)</em>, <em>viridis(v.0.6.5)</em>, <em>bitops(v.1.0-9)</em>, <em>fastmap(v.1.2.0)</em>, <em>pracma(v.2.4.4)</em>, <em>digest(v.0.6.37)</em>, <em>timechange(v.0.3.0)</em>, <em>lifecycle(v.1.0.4)</em>, <em>survival(v.3.7-0)</em>, <em>compiler(v.4.4.2)</em>, <em>rlang(v.1.1.4)</em>, <em>tools(v.4.4.2)</em>, <em>yaml(v.2.3.10)</em>, <em>knitr(v.1.49)</em>, <em>labeling(v.0.4.3)</em>, <em>htmlwidgets(v.1.6.4)</em>, <em>plyr(v.1.8.9)</em>, <em>withr(v.3.0.2)</em>, <em>numDeriv(v.2016.8-1.1)</em>, <em>grid(v.4.4.2)</em>, <em>opdisDownsampling(v.1.0.1)</em>, <em>caTools(v.1.18.3)</em>, <em>colorspace(v.2.1-1)</em>, <em>extrafontdb(v.1.0)</em>, <em>scales(v.1.3.0)</em>, <em>iterators(v.1.0.14)</em>, <em>MASS(v.7.3-61)</em>, <em>cli(v.3.6.3)</em>, <em>mvtnorm(v.1.3-2)</em>, <em>rmarkdown(v.2.29)</em>, <em>ragg(v.1.3.3)</em>, <em>marqLevAlg(v.2.0.8)</em>, <em>generics(v.0.1.3)</em>, <em>twosamples(v.2.0.1)</em>, <em>robustbase(v.0.99-4-1)</em>, <em>reshape2(v.1.4.4)</em>, <em>tzdb(v.0.4.0)</em>, <em>parallel(v.4.4.2)</em>, <em>base64enc(v.0.1-3)</em>, <em>vctrs(v.0.6.5)</em>, <em>Matrix(v.1.7-1)</em>, <em>jsonlite(v.1.8.9)</em>, <em>hms(v.1.1.3)</em>, <em>pbmcapply(v.1.5.1)</em>, <em>systemfonts(v.1.1.0)</em>, <em>foreach(v.1.5.2)</em>, <em>glue(v.1.8.0)</em>, <em>DEoptimR(v.1.1-3-1)</em>, <em>codetools(v.0.2-20)</em>, <em>rngWELL(v.0.10-10)</em>, <em>distributional(v.0.5.0)</em>, <em>stringi(v.1.8.4)</em>, <em>gtable(v.0.3.6)</em>, <em>quadprog(v.1.5-8)</em>, <em>extrafont(v.0.19)</em>, <em>randtoolbox(v.2.0.5)</em>, <em>munsell(v.0.5.1)</em>, <em>pillar(v.1.10.1)</em>, <em>htmltools(v.0.5.8.1)</em>, <em>R6(v.2.5.1)</em>, <em>textshaping(v.0.4.1)</em>, <em>tcltk(v.4.4.2)</em>, <em>doParallel(v.1.0.17)</em>, <em>evaluate(v.1.0.1)</em>, <em>lattice(v.0.22-6)</em>, <em>qqconf(v.1.3.2)</em>, <em>Rcpp(v.1.0.13-1)</em>, <em>gridExtra(v.2.3)</em>, <em>nlme(v.3.1-166)</em>, <em>Rttf2pt1(v.1.3.12)</em>, <em>xfun(v.0.50)</em> and <em>pkgconfig(v.2.0.3)</em></p>
</div>
</div>


<!-- -->

</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb81" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Model selection"</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Faecal calprotectin"</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Nathan Constantine-Cooke" </span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://scholar.google.com/citations?user=2emHWR0AAAAJ&amp;hl=en&amp;oi=ao</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: true</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: CGEM</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: HGU</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Karla Monterrubio-Gómez"</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://scholar.google.com/citations?user=YmyxSXAAAAAJ&amp;hl=en</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: HGU</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Catalina A. Vallejos"</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://scholar.google.com/citations?user=lkdrwm0AAAAJ&amp;hl=en&amp;oi=ao</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: HGU</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co">#comments:</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  giscus: </span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    repo: quarto-dev/quarto-docs</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Setup}</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="in">if (file.exists("/.dockerenv")) { # Check if running in Docker</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="in">  # Assume igmm/cvallejo-predicct/libdr/ is passed to the data volume</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="in">  prefix &lt;- "data/"</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a><span class="in">  # Assume running outside of a Docker container and the IGC(/IGMM) datastore is</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="in">  # mounted at /Volumes</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a><span class="in">  prefix &lt;- "/Volumes/igmm/cvallejo-predicct/libdr/"</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a><span class="in">##########################</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a><span class="in">#--     Packages       --#</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a><span class="in">##########################</span></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a><span class="in"># Support package (source found in libdr/)</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a><span class="in">library(libdr)</span></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a><span class="in">## Modelling ##</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a><span class="in">library(lcmm)</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="in">library(kml) # K-means</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a><span class="in">## Presentation ##</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggdist)</span></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggalluvial)</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a><span class="in">library(pander)</span></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a><span class="in">library(qqplotr)</span></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a><span class="in">##########################</span></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a><span class="in">#--     Data read      --#</span></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a><span class="in">##########################</span></span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- readRDS(paste0(prefix, "processed/dict.RDS"))</span></span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- readRDS(paste0(prefix, "processed/fcal.RDS"))</span></span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a><span class="in">dk.fcal &lt;- read.csv(paste0(prefix, "Denmark/2024-11-29/Fcal_8_models.csv"),</span></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a><span class="in">                    sep = ";")</span></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a>This page describes how the latent class mixed models (LCMMs) were fitted to </span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a>faecal calprotectin (FC). <span class="co">[</span><span class="ot">A separate page</span><span class="co">](crp.qmd)</span> is dedicated to C-reactive</span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a>protein.</span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a>In order to not present subject-level data, subjects within each cluster have </span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a>been collated into groups of six. </span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model specification</span></span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a>LCMMs are an extension of linear mixed effects models with an added</span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a>cluster-specific fixed effect component. We use LCMMs with a natural cubic</span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a>spline formulation for the fixed effects component. Random effects are specified</span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true" tabindex="-1"></a>as intercepts and the multinomial logistic regression model which assigns</span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a>cluster membership uses IBD type (CD, UC, or IBDU) as a covariate.</span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a>For full formal definitions of the models and statistics we have used in the</span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a>work, please refer to the supplementary material for our paper. </span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model statistics </span></span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model loading</span></span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a>Fitting the LCMMs discussed in this report takes multiple days in some cases and</span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a>uses 25 CPU cores per model. We have fitted these models using </span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Eddie</span><span class="co">](https://www.ed.ac.uk/information-services/research-support/research-computing/ecdf/high-performance-computing)</span>,</span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true" tabindex="-1"></a>the University  of Edinburgh's high performance computing solution. The code in</span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true" tabindex="-1"></a>the dropdown box below was used to fit the models.</span>
<span id="cb81-94"><a href="#cb81-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-95"><a href="#cb81-95" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true" icon=false}</span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code used to fit models</span></span>
<span id="cb81-98"><a href="#cb81-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-99"><a href="#cb81-99" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb81-100"><a href="#cb81-100" aria-hidden="true" tabindex="-1"></a>{{&lt; include fcal-m1.qmd &gt;}}</span>
<span id="cb81-101"><a href="#cb81-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-102"><a href="#cb81-102" aria-hidden="true" tabindex="-1"></a>{{&lt; include fcal-lcmm.qmd &gt;}}</span>
<span id="cb81-103"><a href="#cb81-103" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-104"><a href="#cb81-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-105"><a href="#cb81-105" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-106"><a href="#cb81-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-107"><a href="#cb81-107" aria-hidden="true" tabindex="-1"></a>As recommended by @Proust-Lima2017, a linear mixed effects model is first </span>
<span id="cb81-108"><a href="#cb81-108" aria-hidden="true" tabindex="-1"></a>fitted to generate initial starting values, (the "Initial LME" tab). A</span>
<span id="cb81-109"><a href="#cb81-109" aria-hidden="true" tabindex="-1"></a>grid search approach is then used to converge the LCMMs towards a global maximum</span>
<span id="cb81-110"><a href="#cb81-110" aria-hidden="true" tabindex="-1"></a>for each assumed number of clusters based on maximum likelihood (the "LCMM"</span>
<span id="cb81-111"><a href="#cb81-111" aria-hidden="true" tabindex="-1"></a>tab). </span>
<span id="cb81-112"><a href="#cb81-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-113"><a href="#cb81-113" aria-hidden="true" tabindex="-1"></a>After the above code is run, the resultant models are saved in </span>
<span id="cb81-114"><a href="#cb81-114" aria-hidden="true" tabindex="-1"></a><span class="in">`cvallejo-predicct/libdr/cache/`</span> for use in this report. </span>
<span id="cb81-115"><a href="#cb81-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-116"><a href="#cb81-116" aria-hidden="true" tabindex="-1"></a>When an LCMM is fitted, the assumed number of clusters (*or "classes"*) must be</span>
<span id="cb81-117"><a href="#cb81-117" aria-hidden="true" tabindex="-1"></a>specified a priori. Here we consider 4-8 clusters as 4 clusters were already</span>
<span id="cb81-118"><a href="#cb81-118" aria-hidden="true" tabindex="-1"></a>found in our previous work <span class="co">[</span><span class="ot">@constantine-cooke2023</span><span class="co">]</span>, and we expect to find at</span>
<span id="cb81-119"><a href="#cb81-119" aria-hidden="true" tabindex="-1"></a>least as many clusters given our inclusion criteria is more relaxed.</span>
<span id="cb81-120"><a href="#cb81-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-121"><a href="#cb81-121" aria-hidden="true" tabindex="-1"></a>A posteriori model statistics and visual investigations must be used to decide</span>
<span id="cb81-122"><a href="#cb81-122" aria-hidden="true" tabindex="-1"></a>upon the optimum number of classes.</span>
<span id="cb81-123"><a href="#cb81-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-124"><a href="#cb81-124" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fixed effects specified via Natural Cubic Splines</span></span>
<span id="cb81-125"><a href="#cb81-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-126"><a href="#cb81-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Load NCS FCAL models}</span></span>
<span id="cb81-127"><a href="#cb81-127" aria-hidden="true" tabindex="-1"></a><span class="in"># set the number of groups</span></span>
<span id="cb81-128"><a href="#cb81-128" aria-hidden="true" tabindex="-1"></a><span class="in">G.fcal &lt;- numeric()</span></span>
<span id="cb81-129"><a href="#cb81-129" aria-hidden="true" tabindex="-1"></a><span class="in">models.fcal &lt;- list()</span></span>
<span id="cb81-130"><a href="#cb81-130" aria-hidden="true" tabindex="-1"></a><span class="in">G.cands &lt;- seq(2, 11)</span></span>
<span id="cb81-131"><a href="#cb81-131" aria-hidden="true" tabindex="-1"></a><span class="in">for (G.cand in G.cands) {</span></span>
<span id="cb81-132"><a href="#cb81-132" aria-hidden="true" tabindex="-1"></a><span class="in">  file.name &lt;- paste0(prefix, "/cache/fcal/ncs/fcal-", G.cand, ".RDS")</span></span>
<span id="cb81-133"><a href="#cb81-133" aria-hidden="true" tabindex="-1"></a><span class="in">  if (file.exists(file.name)) {</span></span>
<span id="cb81-134"><a href="#cb81-134" aria-hidden="true" tabindex="-1"></a><span class="in">    G.fcal &lt;- c(G.fcal, G.cand)</span></span>
<span id="cb81-135"><a href="#cb81-135" aria-hidden="true" tabindex="-1"></a><span class="in">    models.fcal[[G.cand]] &lt;- readRDS(file.name)</span></span>
<span id="cb81-136"><a href="#cb81-136" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb81-137"><a href="#cb81-137" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-138"><a href="#cb81-138" aria-hidden="true" tabindex="-1"></a><span class="in">rm(G.cand)</span></span>
<span id="cb81-139"><a href="#cb81-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-140"><a href="#cb81-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-141"><a href="#cb81-141" aria-hidden="true" tabindex="-1"></a>We firstly consider specifying fixed effects using NCS which have a few notable</span>
<span id="cb81-142"><a href="#cb81-142" aria-hidden="true" tabindex="-1"></a>advantages <span class="co">[</span><span class="ot">@Elhakeem2022</span><span class="co">]</span>:</span>
<span id="cb81-143"><a href="#cb81-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-144"><a href="#cb81-144" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Less parameters need to be estimated than either a GRBF</span>
<span id="cb81-145"><a href="#cb81-145" aria-hidden="true" tabindex="-1"></a>   function regression model or a polynomial regression model with the same</span>
<span id="cb81-146"><a href="#cb81-146" aria-hidden="true" tabindex="-1"></a>   flexibility. This reduces the time complexity when fitting the model and in</span>
<span id="cb81-147"><a href="#cb81-147" aria-hidden="true" tabindex="-1"></a>   the future may also make extensions more practically feasible.</span>
<span id="cb81-148"><a href="#cb81-148" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>NCS enforce linearity between $t_0$ and the first knot and</span>
<span id="cb81-149"><a href="#cb81-149" aria-hidden="true" tabindex="-1"></a>   between the last knot and $t_\text{max}$ which ensures the model does not</span>
<span id="cb81-150"><a href="#cb81-150" aria-hidden="true" tabindex="-1"></a>   behave erratically in these sometimes problematic areas.</span>
<span id="cb81-151"><a href="#cb81-151" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>NCS are not highly sensitive to a continuous parameter and instead requires</span>
<span id="cb81-152"><a href="#cb81-152" aria-hidden="true" tabindex="-1"></a>   only $K$, the number of knots to be tuned. NCS are typically robust to where</span>
<span id="cb81-153"><a href="#cb81-153" aria-hidden="true" tabindex="-1"></a>   the knots themselves are placed.</span>
<span id="cb81-154"><a href="#cb81-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-155"><a href="#cb81-155" aria-hidden="true" tabindex="-1"></a><span class="fu">### Knot choice</span></span>
<span id="cb81-156"><a href="#cb81-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-157"><a href="#cb81-157" aria-hidden="true" tabindex="-1"></a>To determine the most appropriate number of knots for the natural cubic splines,</span>
<span id="cb81-158"><a href="#cb81-158" aria-hidden="true" tabindex="-1"></a>we considered two, three, and four knots. We only use six-cluster models for</span>
<span id="cb81-159"><a href="#cb81-159" aria-hidden="true" tabindex="-1"></a>this analysis as this reasonably captures heterogeneity without being too</span>
<span id="cb81-160"><a href="#cb81-160" aria-hidden="true" tabindex="-1"></a>expensive computationally.</span>
<span id="cb81-161"><a href="#cb81-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-162"><a href="#cb81-162" aria-hidden="true" tabindex="-1"></a>Our previous work used three knots across a five-year period. As we are now</span>
<span id="cb81-163"><a href="#cb81-163" aria-hidden="true" tabindex="-1"></a>modelling across a seven-year period, we may need to increase the number of</span>
<span id="cb81-164"><a href="#cb81-164" aria-hidden="true" tabindex="-1"></a>knots to four to ensure the model remains flexible. We also considered two knots]</span>
<span id="cb81-165"><a href="#cb81-165" aria-hidden="true" tabindex="-1"></a>in case a more smoooth model is required.</span>
<span id="cb81-166"><a href="#cb81-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-167"><a href="#cb81-167" aria-hidden="true" tabindex="-1"></a>We place the knots at their default location which is at quantiles. We note that</span>
<span id="cb81-168"><a href="#cb81-168" aria-hidden="true" tabindex="-1"></a>the number of knots is reported by @harrell2015 to be much more important than</span>
<span id="cb81-169"><a href="#cb81-169" aria-hidden="true" tabindex="-1"></a>knot location.</span>
<span id="cb81-170"><a href="#cb81-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-171"><a href="#cb81-171" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model trajectories </span></span>
<span id="cb81-172"><a href="#cb81-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-173"><a href="#cb81-173" aria-hidden="true" tabindex="-1"></a><span class="fu">##### One knot</span></span>
<span id="cb81-174"><a href="#cb81-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-177"><a href="#cb81-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-178"><a href="#cb81-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-1-knots</span></span>
<span id="cb81-179"><a href="#cb81-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cluster profiles for the six-cluster model assuming one knot. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves"</span></span>
<span id="cb81-180"><a href="#cb81-180" aria-hidden="true" tabindex="-1"></a>knots<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(prefix, <span class="st">"/cache/fcal/ncs/1-knots.RDS"</span>))</span>
<span id="cb81-181"><a href="#cb81-181" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">1.</span>list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-182"><a href="#cb81-182" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">1.</span>list[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> knots<span class="fl">.1</span></span>
<span id="cb81-183"><a href="#cb81-183" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="st">"paper/1-knots.pdf"</span>,</span>
<span id="cb81-184"><a href="#cb81-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">9</span>,</span>
<span id="cb81-185"><a href="#cb81-185" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">9</span></span>
<span id="cb81-186"><a href="#cb81-186" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-187"><a href="#cb81-187" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-188"><a href="#cb81-188" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">1.</span>list,</span>
<span id="cb81-189"><a href="#cb81-189" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-190"><a href="#cb81-190" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-191"><a href="#cb81-191" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-192"><a href="#cb81-192" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-193"><a href="#cb81-193" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-194"><a href="#cb81-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">1</span>,</span>
<span id="cb81-195"><a href="#cb81-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-196"><a href="#cb81-196" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-197"><a href="#cb81-197" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-198"><a href="#cb81-198" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-199"><a href="#cb81-199" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">1.</span>list,</span>
<span id="cb81-200"><a href="#cb81-200" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-201"><a href="#cb81-201" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-202"><a href="#cb81-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-203"><a href="#cb81-203" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-204"><a href="#cb81-204" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-205"><a href="#cb81-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">1</span>,</span>
<span id="cb81-206"><a href="#cb81-206" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-207"><a href="#cb81-207" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-208"><a href="#cb81-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-209"><a href="#cb81-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-210"><a href="#cb81-210" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Two knots</span></span>
<span id="cb81-211"><a href="#cb81-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-212"><a href="#cb81-212" aria-hidden="true" tabindex="-1"></a>From @fig-2-knots, we can see specifying only two knots results in very smooth</span>
<span id="cb81-213"><a href="#cb81-213" aria-hidden="true" tabindex="-1"></a>curves for the mean trajectory of each cluster. However, this model appears</span>
<span id="cb81-214"><a href="#cb81-214" aria-hidden="true" tabindex="-1"></a>to be too smooth which results in a relatively poor fit. </span>
<span id="cb81-215"><a href="#cb81-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-218"><a href="#cb81-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-219"><a href="#cb81-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-2-knots</span></span>
<span id="cb81-220"><a href="#cb81-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cluster profiles for the six-cluster model assuming two knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves"</span></span>
<span id="cb81-221"><a href="#cb81-221" aria-hidden="true" tabindex="-1"></a>knots<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(prefix, <span class="st">"/cache/fcal/ncs/2-knots.RDS"</span>))</span>
<span id="cb81-222"><a href="#cb81-222" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">2.</span>list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-223"><a href="#cb81-223" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">2.</span>list[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> knots<span class="fl">.2</span></span>
<span id="cb81-224"><a href="#cb81-224" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="st">"paper/2-knots.pdf"</span>,</span>
<span id="cb81-225"><a href="#cb81-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">9</span>,</span>
<span id="cb81-226"><a href="#cb81-226" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">9</span></span>
<span id="cb81-227"><a href="#cb81-227" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-228"><a href="#cb81-228" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-229"><a href="#cb81-229" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">2.</span>list,</span>
<span id="cb81-230"><a href="#cb81-230" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-231"><a href="#cb81-231" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-232"><a href="#cb81-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-233"><a href="#cb81-233" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-234"><a href="#cb81-234" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-235"><a href="#cb81-235" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">2</span>,</span>
<span id="cb81-236"><a href="#cb81-236" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-237"><a href="#cb81-237" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-238"><a href="#cb81-238" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-239"><a href="#cb81-239" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-240"><a href="#cb81-240" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">2.</span>list,</span>
<span id="cb81-241"><a href="#cb81-241" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-242"><a href="#cb81-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-243"><a href="#cb81-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-244"><a href="#cb81-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-245"><a href="#cb81-245" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-246"><a href="#cb81-246" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">2</span>,</span>
<span id="cb81-247"><a href="#cb81-247" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-248"><a href="#cb81-248" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-249"><a href="#cb81-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-250"><a href="#cb81-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-251"><a href="#cb81-251" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Three knots</span></span>
<span id="cb81-252"><a href="#cb81-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-253"><a href="#cb81-253" aria-hidden="true" tabindex="-1"></a>Three knots appears to be the most appropriate specification (@fig-3-knots).</span>
<span id="cb81-254"><a href="#cb81-254" aria-hidden="true" tabindex="-1"></a>Whilst there is  perhaps some evidence of overfitting, this appears to be</span>
<span id="cb81-255"><a href="#cb81-255" aria-hidden="true" tabindex="-1"></a>minimal. </span>
<span id="cb81-256"><a href="#cb81-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-259"><a href="#cb81-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-260"><a href="#cb81-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-3-knots</span></span>
<span id="cb81-261"><a href="#cb81-261" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cluster profiles for the six-cluster model assuming three knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves"</span></span>
<span id="cb81-262"><a href="#cb81-262" aria-hidden="true" tabindex="-1"></a>knots<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(prefix, <span class="st">"cache/fcal/ncs/fcal-6.RDS"</span>))</span>
<span id="cb81-263"><a href="#cb81-263" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">3.</span>list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-264"><a href="#cb81-264" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">3.</span>list[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> knots<span class="fl">.3</span></span>
<span id="cb81-265"><a href="#cb81-265" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="st">"paper/3-knots.pdf"</span>,</span>
<span id="cb81-266"><a href="#cb81-266" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">9</span>,</span>
<span id="cb81-267"><a href="#cb81-267" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">9</span></span>
<span id="cb81-268"><a href="#cb81-268" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-269"><a href="#cb81-269" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-270"><a href="#cb81-270" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">3.</span>list,</span>
<span id="cb81-271"><a href="#cb81-271" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-272"><a href="#cb81-272" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-273"><a href="#cb81-273" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-274"><a href="#cb81-274" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-275"><a href="#cb81-275" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-276"><a href="#cb81-276" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">3</span>,</span>
<span id="cb81-277"><a href="#cb81-277" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-278"><a href="#cb81-278" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-279"><a href="#cb81-279" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-280"><a href="#cb81-280" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-281"><a href="#cb81-281" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">3.</span>list,</span>
<span id="cb81-282"><a href="#cb81-282" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-283"><a href="#cb81-283" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-284"><a href="#cb81-284" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-285"><a href="#cb81-285" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-286"><a href="#cb81-286" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-287"><a href="#cb81-287" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">3</span>,</span>
<span id="cb81-288"><a href="#cb81-288" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-289"><a href="#cb81-289" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-290"><a href="#cb81-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-291"><a href="#cb81-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-292"><a href="#cb81-292" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Four knots</span></span>
<span id="cb81-293"><a href="#cb81-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-294"><a href="#cb81-294" aria-hidden="true" tabindex="-1"></a>Four knots appears to be too many. @fig-4-knots presents a minor improvement to </span>
<span id="cb81-295"><a href="#cb81-295" aria-hidden="true" tabindex="-1"></a>model fit over the three knot specification, and there are signs of overfitting</span>
<span id="cb81-296"><a href="#cb81-296" aria-hidden="true" tabindex="-1"></a>which is likely driven by the small distances between knots.  </span>
<span id="cb81-297"><a href="#cb81-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-300"><a href="#cb81-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-301"><a href="#cb81-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-4-knots</span></span>
<span id="cb81-302"><a href="#cb81-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cluster profiles for the six-cluster model assuming four knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves"</span></span>
<span id="cb81-303"><a href="#cb81-303" aria-hidden="true" tabindex="-1"></a>knots<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(prefix, <span class="st">"/cache/fcal/ncs/4-knots.RDS"</span>))</span>
<span id="cb81-304"><a href="#cb81-304" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">4.</span>list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-305"><a href="#cb81-305" aria-hidden="true" tabindex="-1"></a>knots.<span class="fl">4.</span>list[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> knots<span class="fl">.4</span></span>
<span id="cb81-306"><a href="#cb81-306" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="st">"paper/4-knots.pdf"</span>,</span>
<span id="cb81-307"><a href="#cb81-307" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">9</span>,</span>
<span id="cb81-308"><a href="#cb81-308" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">9</span></span>
<span id="cb81-309"><a href="#cb81-309" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-310"><a href="#cb81-310" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-311"><a href="#cb81-311" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">4.</span>list,</span>
<span id="cb81-312"><a href="#cb81-312" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-313"><a href="#cb81-313" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-314"><a href="#cb81-314" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-315"><a href="#cb81-315" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-316"><a href="#cb81-316" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-317"><a href="#cb81-317" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">4</span>,</span>
<span id="cb81-318"><a href="#cb81-318" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-319"><a href="#cb81-319" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-320"><a href="#cb81-320" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-321"><a href="#cb81-321" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-322"><a href="#cb81-322" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">4.</span>list,</span>
<span id="cb81-323"><a href="#cb81-323" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-324"><a href="#cb81-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-325"><a href="#cb81-325" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-326"><a href="#cb81-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-327"><a href="#cb81-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-328"><a href="#cb81-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">4</span>,</span>
<span id="cb81-329"><a href="#cb81-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-330"><a href="#cb81-330" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-331"><a href="#cb81-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-332"><a href="#cb81-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-333"><a href="#cb81-333" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model statistics </span></span>
<span id="cb81-334"><a href="#cb81-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-335"><a href="#cb81-335" aria-hidden="true" tabindex="-1"></a>AIC and BIC both suggest a four-knot specification to be optimal</span>
<span id="cb81-336"><a href="#cb81-336" aria-hidden="true" tabindex="-1"></a>(@tbl-knot-stats-ncs). However, visual inspection of the mean cluster</span>
<span id="cb81-337"><a href="#cb81-337" aria-hidden="true" tabindex="-1"></a>trajectories (<span class="co">[</span><span class="ot">see above</span><span class="co">](#model-trajectories)</span>) suggests the four-knot approach</span>
<span id="cb81-338"><a href="#cb81-338" aria-hidden="true" tabindex="-1"></a>results in overfitting, especially around knot locations. This will also become</span>
<span id="cb81-339"><a href="#cb81-339" aria-hidden="true" tabindex="-1"></a>more of an issue as the number of clusters increase and additional sparsity is</span>
<span id="cb81-340"><a href="#cb81-340" aria-hidden="true" tabindex="-1"></a>exhibited for some clusters.</span>
<span id="cb81-341"><a href="#cb81-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-342"><a href="#cb81-342" aria-hidden="true" tabindex="-1"></a>As such, we have elected to use natural cubic splines with three knots placed at </span>
<span id="cb81-343"><a href="#cb81-343" aria-hidden="true" tabindex="-1"></a>quantiles. </span>
<span id="cb81-344"><a href="#cb81-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-347"><a href="#cb81-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-348"><a href="#cb81-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: "hold"</span></span>
<span id="cb81-349"><a href="#cb81-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-knot-stats-ncs</span></span>
<span id="cb81-350"><a href="#cb81-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Model statistics for differing numbers of knots for natural cubic splines</span></span>
<span id="cb81-351"><a href="#cb81-351" aria-hidden="true" tabindex="-1"></a>knots.df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb81-352"><a href="#cb81-352" aria-hidden="true" tabindex="-1"></a>  <span class="at">Knots =</span> <span class="fu">c</span>(<span class="st">"One knot"</span>, <span class="st">"Two knots"</span>, <span class="st">"Three knots"</span>, <span class="st">"Four knots"</span>),</span>
<span id="cb81-353"><a href="#cb81-353" aria-hidden="true" tabindex="-1"></a>  <span class="at">loglik =</span> <span class="fu">c</span>(</span>
<span id="cb81-354"><a href="#cb81-354" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.1</span><span class="sc">$</span>loglik,</span>
<span id="cb81-355"><a href="#cb81-355" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.2</span><span class="sc">$</span>loglik,</span>
<span id="cb81-356"><a href="#cb81-356" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.3</span><span class="sc">$</span>loglik,</span>
<span id="cb81-357"><a href="#cb81-357" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.4</span><span class="sc">$</span>loglik</span>
<span id="cb81-358"><a href="#cb81-358" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb81-359"><a href="#cb81-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(</span>
<span id="cb81-360"><a href="#cb81-360" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.1</span><span class="sc">$</span>AIC,</span>
<span id="cb81-361"><a href="#cb81-361" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.2</span><span class="sc">$</span>AIC,</span>
<span id="cb81-362"><a href="#cb81-362" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.3</span><span class="sc">$</span>AIC,</span>
<span id="cb81-363"><a href="#cb81-363" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.4</span><span class="sc">$</span>AIC</span>
<span id="cb81-364"><a href="#cb81-364" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb81-365"><a href="#cb81-365" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">c</span>(</span>
<span id="cb81-366"><a href="#cb81-366" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.1</span><span class="sc">$</span>BIC,</span>
<span id="cb81-367"><a href="#cb81-367" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.2</span><span class="sc">$</span>BIC,</span>
<span id="cb81-368"><a href="#cb81-368" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.3</span><span class="sc">$</span>BIC,</span>
<span id="cb81-369"><a href="#cb81-369" aria-hidden="true" tabindex="-1"></a>    knots<span class="fl">.4</span><span class="sc">$</span>BIC</span>
<span id="cb81-370"><a href="#cb81-370" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-371"><a href="#cb81-371" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-372"><a href="#cb81-372" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(knots.df,</span>
<span id="cb81-373"><a href="#cb81-373" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb81-374"><a href="#cb81-374" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Knots"</span>,</span>
<span id="cb81-375"><a href="#cb81-375" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Maxmum log likelihood"</span>,</span>
<span id="cb81-376"><a href="#cb81-376" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AIC"</span>,</span>
<span id="cb81-377"><a href="#cb81-377" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span></span>
<span id="cb81-378"><a href="#cb81-378" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-379"><a href="#cb81-379" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-380"><a href="#cb81-380" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(</span>
<span id="cb81-381"><a href="#cb81-381" aria-hidden="true" tabindex="-1"></a>  knots<span class="fl">.1</span>,</span>
<span id="cb81-382"><a href="#cb81-382" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">1.</span>list,</span>
<span id="cb81-383"><a href="#cb81-383" aria-hidden="true" tabindex="-1"></a>  knots<span class="fl">.3</span>,</span>
<span id="cb81-384"><a href="#cb81-384" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">3.</span>list,</span>
<span id="cb81-385"><a href="#cb81-385" aria-hidden="true" tabindex="-1"></a>  knots<span class="fl">.4</span>,</span>
<span id="cb81-386"><a href="#cb81-386" aria-hidden="true" tabindex="-1"></a>  knots.<span class="fl">4.</span>list</span>
<span id="cb81-387"><a href="#cb81-387" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-388"><a href="#cb81-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-389"><a href="#cb81-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-390"><a href="#cb81-390" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of clusters</span></span>
<span id="cb81-391"><a href="#cb81-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-392"><a href="#cb81-392" aria-hidden="true" tabindex="-1"></a>After determining the most appriopate number of knots, we must now decide upon</span>
<span id="cb81-393"><a href="#cb81-393" aria-hidden="true" tabindex="-1"></a>the most appropiate number of clusters.</span>
<span id="cb81-394"><a href="#cb81-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-395"><a href="#cb81-395" aria-hidden="true" tabindex="-1"></a>From the alluvial plot comparing FC models (@fig-fcal-alluvial), we can see</span>
<span id="cb81-396"><a href="#cb81-396" aria-hidden="true" tabindex="-1"></a>newly formed clusters are quite robust- remaining consistent as the number of</span>
<span id="cb81-397"><a href="#cb81-397" aria-hidden="true" tabindex="-1"></a>clusters increases. However, new clusters are formed from multiple clusters</span>
<span id="cb81-398"><a href="#cb81-398" aria-hidden="true" tabindex="-1"></a>which implies these clusters do not have a high degree of separation from one</span>
<span id="cb81-399"><a href="#cb81-399" aria-hidden="true" tabindex="-1"></a>another. From  this figure, six clusters appear to be a reasonable choice. </span>
<span id="cb81-400"><a href="#cb81-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-401"><a href="#cb81-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL alluvial}</span></span>
<span id="cb81-402"><a href="#cb81-402" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-fcal-alluvial</span></span>
<span id="cb81-403"><a href="#cb81-403" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Alluvial plot of cluster membership across G for FC</span></span>
<span id="cb81-404"><a href="#cb81-404" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df &lt;- matrix(nrow = 0, ncol = 3)</span></span>
<span id="cb81-405"><a href="#cb81-405" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(alluvial.df) &lt;- c("ids", "class", "G")</span></span>
<span id="cb81-406"><a href="#cb81-406" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.fcal) {</span></span>
<span id="cb81-407"><a href="#cb81-407" aria-hidden="true" tabindex="-1"></a><span class="in">  alluvial.df &lt;- rbind(alluvial.df, cbind(models.fcal[[G]]$pprob[, 1:2], G = G))</span></span>
<span id="cb81-408"><a href="#cb81-408" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-409"><a href="#cb81-409" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df &lt;- as.data.frame(alluvial.df)</span></span>
<span id="cb81-410"><a href="#cb81-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-411"><a href="#cb81-411" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df$ids &lt;- as.character(alluvial.df$ids)</span></span>
<span id="cb81-412"><a href="#cb81-412" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df$class &lt;- as.factor(alluvial.df$class)</span></span>
<span id="cb81-413"><a href="#cb81-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-414"><a href="#cb81-414" aria-hidden="true" tabindex="-1"></a><span class="in"># eliminate label switching</span></span>
<span id="cb81-415"><a href="#cb81-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-416"><a href="#cb81-416" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 3, "class"] &lt;-</span></span>
<span id="cb81-417"><a href="#cb81-417" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 3, "class"],</span></span>
<span id="cb81-418"><a href="#cb81-418" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 3)),</span></span>
<span id="cb81-419"><a href="#cb81-419" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(3, 1, 2)</span></span>
<span id="cb81-420"><a href="#cb81-420" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-421"><a href="#cb81-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-422"><a href="#cb81-422" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 4, "class"] &lt;-</span></span>
<span id="cb81-423"><a href="#cb81-423" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 4, "class"],</span></span>
<span id="cb81-424"><a href="#cb81-424" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 4)),</span></span>
<span id="cb81-425"><a href="#cb81-425" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(3, 4, 1, 2)</span></span>
<span id="cb81-426"><a href="#cb81-426" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-427"><a href="#cb81-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-428"><a href="#cb81-428" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 5, "class"] &lt;-</span></span>
<span id="cb81-429"><a href="#cb81-429" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 5, "class"],</span></span>
<span id="cb81-430"><a href="#cb81-430" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 5)),</span></span>
<span id="cb81-431"><a href="#cb81-431" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(2, 1, 5, 3, 4)</span></span>
<span id="cb81-432"><a href="#cb81-432" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-433"><a href="#cb81-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-434"><a href="#cb81-434" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 6, "class"] &lt;-</span></span>
<span id="cb81-435"><a href="#cb81-435" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 6, "class"],</span></span>
<span id="cb81-436"><a href="#cb81-436" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 6)),</span></span>
<span id="cb81-437"><a href="#cb81-437" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(6, 4, 5, 2, 3, 1)</span></span>
<span id="cb81-438"><a href="#cb81-438" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-439"><a href="#cb81-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-440"><a href="#cb81-440" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 7, "class"] &lt;-</span></span>
<span id="cb81-441"><a href="#cb81-441" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 7, "class"],</span></span>
<span id="cb81-442"><a href="#cb81-442" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 7)),</span></span>
<span id="cb81-443"><a href="#cb81-443" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(4, 1, 5, 3, 2, 7, 6)</span></span>
<span id="cb81-444"><a href="#cb81-444" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-445"><a href="#cb81-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-446"><a href="#cb81-446" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 8, "class"] &lt;-</span></span>
<span id="cb81-447"><a href="#cb81-447" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 8, "class"],</span></span>
<span id="cb81-448"><a href="#cb81-448" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 8)),</span></span>
<span id="cb81-449"><a href="#cb81-449" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(7, 5, 1, 3, 6, 4, 8, 2)</span></span>
<span id="cb81-450"><a href="#cb81-450" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-451"><a href="#cb81-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-452"><a href="#cb81-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-453"><a href="#cb81-453" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 9, "class"] &lt;-</span></span>
<span id="cb81-454"><a href="#cb81-454" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 9, "class"],</span></span>
<span id="cb81-455"><a href="#cb81-455" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 9)),</span></span>
<span id="cb81-456"><a href="#cb81-456" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(1, 5, 8, 9, 6, 4, 7, 2, 3)</span></span>
<span id="cb81-457"><a href="#cb81-457" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-458"><a href="#cb81-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-459"><a href="#cb81-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-460"><a href="#cb81-460" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 10, "class"] &lt;-</span></span>
<span id="cb81-461"><a href="#cb81-461" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 10, "class"],</span></span>
<span id="cb81-462"><a href="#cb81-462" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 10)),</span></span>
<span id="cb81-463"><a href="#cb81-463" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(2, 4, 9, 1, 7, 10, 6, 8, 5, 3)</span></span>
<span id="cb81-464"><a href="#cb81-464" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-465"><a href="#cb81-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-466"><a href="#cb81-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-467"><a href="#cb81-467" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 11, "class"] &lt;-</span></span>
<span id="cb81-468"><a href="#cb81-468" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 11, "class"],</span></span>
<span id="cb81-469"><a href="#cb81-469" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 11)),</span></span>
<span id="cb81-470"><a href="#cb81-470" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(6, 10, 7, 2, 11, 3, 9, 4, 5, 1, 8)</span></span>
<span id="cb81-471"><a href="#cb81-471" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-472"><a href="#cb81-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-473"><a href="#cb81-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-474"><a href="#cb81-474" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- ggplot(</span></span>
<span id="cb81-475"><a href="#cb81-475" aria-hidden="true" tabindex="-1"></a><span class="in">  alluvial.df,</span></span>
<span id="cb81-476"><a href="#cb81-476" aria-hidden="true" tabindex="-1"></a><span class="in">  aes(</span></span>
<span id="cb81-477"><a href="#cb81-477" aria-hidden="true" tabindex="-1"></a><span class="in">    x = G,</span></span>
<span id="cb81-478"><a href="#cb81-478" aria-hidden="true" tabindex="-1"></a><span class="in">    stratum = class,</span></span>
<span id="cb81-479"><a href="#cb81-479" aria-hidden="true" tabindex="-1"></a><span class="in">    alluvium = ids,</span></span>
<span id="cb81-480"><a href="#cb81-480" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = class,</span></span>
<span id="cb81-481"><a href="#cb81-481" aria-hidden="true" tabindex="-1"></a><span class="in">    label = class</span></span>
<span id="cb81-482"><a href="#cb81-482" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-483"><a href="#cb81-483" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb81-484"><a href="#cb81-484" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_discrete(expand = c(.1, .1)) +</span></span>
<span id="cb81-485"><a href="#cb81-485" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_flow() +</span></span>
<span id="cb81-486"><a href="#cb81-486" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_stratum(alpha = 0.5) +</span></span>
<span id="cb81-487"><a href="#cb81-487" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(stat = "stratum", size = 3) +</span></span>
<span id="cb81-488"><a href="#cb81-488" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb81-489"><a href="#cb81-489" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb81-490"><a href="#cb81-490" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = rainbow(11)) +</span></span>
<span id="cb81-491"><a href="#cb81-491" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Assumed number of clusters") +</span></span>
<span id="cb81-492"><a href="#cb81-492" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency")</span></span>
<span id="cb81-493"><a href="#cb81-493" aria-hidden="true" tabindex="-1"></a><span class="in">print(p)</span></span>
<span id="cb81-494"><a href="#cb81-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-495"><a href="#cb81-495" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- p + ggtitle("", "")</span></span>
<span id="cb81-496"><a href="#cb81-496" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("paper/alluvial-FCAL-all.png",</span></span>
<span id="cb81-497"><a href="#cb81-497" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-498"><a href="#cb81-498" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 12,</span></span>
<span id="cb81-499"><a href="#cb81-499" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 6.75,</span></span>
<span id="cb81-500"><a href="#cb81-500" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-501"><a href="#cb81-501" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-502"><a href="#cb81-502" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("paper/alluvial-FCAL-all.pdf",</span></span>
<span id="cb81-503"><a href="#cb81-503" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-504"><a href="#cb81-504" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 12,</span></span>
<span id="cb81-505"><a href="#cb81-505" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 6.75,</span></span>
<span id="cb81-506"><a href="#cb81-506" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-507"><a href="#cb81-507" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-508"><a href="#cb81-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-509"><a href="#cb81-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-510"><a href="#cb81-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-513"><a href="#cb81-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-514"><a href="#cb81-514" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-fcal-alluvial-unadjusted</span></span>
<span id="cb81-515"><a href="#cb81-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Alluvial plot of cluster membership across G for FC</span></span>
<span id="cb81-516"><a href="#cb81-516" aria-hidden="true" tabindex="-1"></a>alluvial.df <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb81-517"><a href="#cb81-517" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(alluvial.df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ids"</span>, <span class="st">"class"</span>, <span class="st">"G"</span>)</span>
<span id="cb81-518"><a href="#cb81-518" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (G <span class="cf">in</span> G.fcal) {</span>
<span id="cb81-519"><a href="#cb81-519" aria-hidden="true" tabindex="-1"></a>  alluvial.df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(alluvial.df, <span class="fu">cbind</span>(models.fcal[[G]]<span class="sc">$</span>pprob[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">G =</span> G))</span>
<span id="cb81-520"><a href="#cb81-520" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-521"><a href="#cb81-521" aria-hidden="true" tabindex="-1"></a>alluvial.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(alluvial.df)</span>
<span id="cb81-522"><a href="#cb81-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-523"><a href="#cb81-523" aria-hidden="true" tabindex="-1"></a>alluvial.df<span class="sc">$</span>ids <span class="ot">&lt;-</span> <span class="fu">as.character</span>(alluvial.df<span class="sc">$</span>ids)</span>
<span id="cb81-524"><a href="#cb81-524" aria-hidden="true" tabindex="-1"></a>alluvial.df<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(alluvial.df<span class="sc">$</span>class)</span>
<span id="cb81-525"><a href="#cb81-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-526"><a href="#cb81-526" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb81-527"><a href="#cb81-527" aria-hidden="true" tabindex="-1"></a>  alluvial.df,</span>
<span id="cb81-528"><a href="#cb81-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb81-529"><a href="#cb81-529" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> G,</span>
<span id="cb81-530"><a href="#cb81-530" aria-hidden="true" tabindex="-1"></a>    <span class="at">stratum =</span> class,</span>
<span id="cb81-531"><a href="#cb81-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">alluvium =</span> ids,</span>
<span id="cb81-532"><a href="#cb81-532" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> class,</span>
<span id="cb81-533"><a href="#cb81-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> class</span>
<span id="cb81-534"><a href="#cb81-534" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-535"><a href="#cb81-535" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb81-536"><a href="#cb81-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-537"><a href="#cb81-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_flow</span>() <span class="sc">+</span></span>
<span id="cb81-538"><a href="#cb81-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stratum</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb81-539"><a href="#cb81-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"stratum"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-540"><a href="#cb81-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-541"><a href="#cb81-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb81-542"><a href="#cb81-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rainbow</span>(<span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb81-543"><a href="#cb81-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Assumed number of clusters"</span>) <span class="sc">+</span></span>
<span id="cb81-544"><a href="#cb81-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency"</span>)</span>
<span id="cb81-545"><a href="#cb81-545" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb81-546"><a href="#cb81-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-547"><a href="#cb81-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-548"><a href="#cb81-548" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Posterior classifications</span></span>
<span id="cb81-549"><a href="#cb81-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-550"><a href="#cb81-550" aria-hidden="true" tabindex="-1"></a>From the below data, we can see how posterior probabilities change as the number</span>
<span id="cb81-551"><a href="#cb81-551" aria-hidden="true" tabindex="-1"></a>of assumed clusters increase.</span>
<span id="cb81-552"><a href="#cb81-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-553"><a href="#cb81-553" aria-hidden="true" tabindex="-1"></a>::: {.column-page}</span>
<span id="cb81-554"><a href="#cb81-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-555"><a href="#cb81-555" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb81-556"><a href="#cb81-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-557"><a href="#cb81-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL postpro}</span></span>
<span id="cb81-558"><a href="#cb81-558" aria-hidden="true" tabindex="-1"></a><span class="in">#| results: "asis"</span></span>
<span id="cb81-559"><a href="#cb81-559" aria-hidden="true" tabindex="-1"></a><span class="in">postprob_quiet &lt;- quietly(postprob)</span></span>
<span id="cb81-560"><a href="#cb81-560" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.fcal) {</span></span>
<span id="cb81-561"><a href="#cb81-561" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(paste0("##### G = ", G, "\n"))</span></span>
<span id="cb81-562"><a href="#cb81-562" aria-hidden="true" tabindex="-1"></a><span class="in">  output &lt;- postprob_quiet(models.fcal[[G]])$result</span></span>
<span id="cb81-563"><a href="#cb81-563" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(pander::pander(output[[1]]))</span></span>
<span id="cb81-564"><a href="#cb81-564" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(pander::pander(output[[2]]))</span></span>
<span id="cb81-565"><a href="#cb81-565" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(pander::pander(output[[3]]))</span></span>
<span id="cb81-566"><a href="#cb81-566" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-567"><a href="#cb81-567" aria-hidden="true" tabindex="-1"></a><span class="in">rm(output)</span></span>
<span id="cb81-568"><a href="#cb81-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-569"><a href="#cb81-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-570"><a href="#cb81-570" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-571"><a href="#cb81-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-572"><a href="#cb81-572" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-573"><a href="#cb81-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-574"><a href="#cb81-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{R PProb distributions NCS}</span></span>
<span id="cb81-575"><a href="#cb81-575" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 8</span></span>
<span id="cb81-576"><a href="#cb81-576" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 4.5</span></span>
<span id="cb81-577"><a href="#cb81-577" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.2 &lt;- c()</span></span>
<span id="cb81-578"><a href="#cb81-578" aria-hidden="true" tabindex="-1"></a><span class="in">groups.2 &lt;- models.fcal[[2]]</span></span>
<span id="cb81-579"><a href="#cb81-579" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.3 &lt;- c()</span></span>
<span id="cb81-580"><a href="#cb81-580" aria-hidden="true" tabindex="-1"></a><span class="in">groups.3 &lt;- models.fcal[[3]]</span></span>
<span id="cb81-581"><a href="#cb81-581" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.4 &lt;- c()</span></span>
<span id="cb81-582"><a href="#cb81-582" aria-hidden="true" tabindex="-1"></a><span class="in">groups.4 &lt;- models.fcal[[4]]</span></span>
<span id="cb81-583"><a href="#cb81-583" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.5 &lt;- c()</span></span>
<span id="cb81-584"><a href="#cb81-584" aria-hidden="true" tabindex="-1"></a><span class="in">groups.5 &lt;- models.fcal[[5]]</span></span>
<span id="cb81-585"><a href="#cb81-585" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.6 &lt;- c()</span></span>
<span id="cb81-586"><a href="#cb81-586" aria-hidden="true" tabindex="-1"></a><span class="in">groups.6 &lt;- models.fcal[[6]]</span></span>
<span id="cb81-587"><a href="#cb81-587" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.7 &lt;- c()</span></span>
<span id="cb81-588"><a href="#cb81-588" aria-hidden="true" tabindex="-1"></a><span class="in">groups.7 &lt;- models.fcal[[7]]</span></span>
<span id="cb81-589"><a href="#cb81-589" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.8 &lt;- c()</span></span>
<span id="cb81-590"><a href="#cb81-590" aria-hidden="true" tabindex="-1"></a><span class="in">groups.8 &lt;- models.fcal[[8]]</span></span>
<span id="cb81-591"><a href="#cb81-591" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.9 &lt;- c()</span></span>
<span id="cb81-592"><a href="#cb81-592" aria-hidden="true" tabindex="-1"></a><span class="in">groups.9 &lt;- models.fcal[[9]]</span></span>
<span id="cb81-593"><a href="#cb81-593" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.10 &lt;- c()</span></span>
<span id="cb81-594"><a href="#cb81-594" aria-hidden="true" tabindex="-1"></a><span class="in">groups.10 &lt;- models.fcal[[10]]</span></span>
<span id="cb81-595"><a href="#cb81-595" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.11 &lt;- c()</span></span>
<span id="cb81-596"><a href="#cb81-596" aria-hidden="true" tabindex="-1"></a><span class="in">groups.11 &lt;- models.fcal[[11]]</span></span>
<span id="cb81-597"><a href="#cb81-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-598"><a href="#cb81-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-599"><a href="#cb81-599" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nrow(models.fcal[[2]]$pprob)) {</span></span>
<span id="cb81-600"><a href="#cb81-600" aria-hidden="true" tabindex="-1"></a><span class="in">  class.2 &lt;- groups.2$pprob[i, 2]</span></span>
<span id="cb81-601"><a href="#cb81-601" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.2 &lt;- c(pprobs.2, groups.2$pprob[i, class.2 + 2])</span></span>
<span id="cb81-602"><a href="#cb81-602" aria-hidden="true" tabindex="-1"></a><span class="in">  class.3 &lt;- groups.3$pprob[i, 2]</span></span>
<span id="cb81-603"><a href="#cb81-603" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.3 &lt;- c(pprobs.3, groups.3$pprob[i, class.3 + 2])</span></span>
<span id="cb81-604"><a href="#cb81-604" aria-hidden="true" tabindex="-1"></a><span class="in">  class.4 &lt;- groups.4$pprob[i, 2]</span></span>
<span id="cb81-605"><a href="#cb81-605" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.4 &lt;- c(pprobs.4, groups.4$pprob[i, class.4 + 2])</span></span>
<span id="cb81-606"><a href="#cb81-606" aria-hidden="true" tabindex="-1"></a><span class="in">  class.5 &lt;- groups.5$pprob[i, 2]</span></span>
<span id="cb81-607"><a href="#cb81-607" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.5 &lt;- c(pprobs.5, groups.5$pprob[i, class.5 + 2])</span></span>
<span id="cb81-608"><a href="#cb81-608" aria-hidden="true" tabindex="-1"></a><span class="in">  class.6 &lt;- groups.6$pprob[i, 2]</span></span>
<span id="cb81-609"><a href="#cb81-609" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.6 &lt;- c(pprobs.6, groups.6$pprob[i, class.6 + 2])</span></span>
<span id="cb81-610"><a href="#cb81-610" aria-hidden="true" tabindex="-1"></a><span class="in">  class.7 &lt;- groups.7$pprob[i, 2]</span></span>
<span id="cb81-611"><a href="#cb81-611" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.7 &lt;- c(pprobs.7, groups.7$pprob[i, class.7 + 2])</span></span>
<span id="cb81-612"><a href="#cb81-612" aria-hidden="true" tabindex="-1"></a><span class="in">  class.8 &lt;- groups.8$pprob[i, 2]</span></span>
<span id="cb81-613"><a href="#cb81-613" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.8 &lt;- c(pprobs.8, groups.8$pprob[i, class.8 + 2])</span></span>
<span id="cb81-614"><a href="#cb81-614" aria-hidden="true" tabindex="-1"></a><span class="in">  class.9 &lt;- groups.9$pprob[i, 2]</span></span>
<span id="cb81-615"><a href="#cb81-615" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.9 &lt;- c(pprobs.9, groups.9$pprob[i, class.9 + 2])</span></span>
<span id="cb81-616"><a href="#cb81-616" aria-hidden="true" tabindex="-1"></a><span class="in">  class.10 &lt;- groups.10$pprob[i, 2]</span></span>
<span id="cb81-617"><a href="#cb81-617" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.10 &lt;- c(pprobs.10, groups.10$pprob[i, class.10 + 2])</span></span>
<span id="cb81-618"><a href="#cb81-618" aria-hidden="true" tabindex="-1"></a><span class="in">  class.11 &lt;- groups.11$pprob[i, 2]</span></span>
<span id="cb81-619"><a href="#cb81-619" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.11 &lt;- c(pprobs.11, groups.11$pprob[i, class.11 + 2])</span></span>
<span id="cb81-620"><a href="#cb81-620" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-621"><a href="#cb81-621" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.2 &lt;- tibble(prob = pprobs.2)</span></span>
<span id="cb81-622"><a href="#cb81-622" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.3 &lt;- tibble(prob = pprobs.3)</span></span>
<span id="cb81-623"><a href="#cb81-623" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.4 &lt;- tibble(prob = pprobs.4)</span></span>
<span id="cb81-624"><a href="#cb81-624" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.5 &lt;- tibble(prob = pprobs.5)</span></span>
<span id="cb81-625"><a href="#cb81-625" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.6 &lt;- tibble(prob = pprobs.6)</span></span>
<span id="cb81-626"><a href="#cb81-626" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.7 &lt;- tibble(prob = pprobs.7)</span></span>
<span id="cb81-627"><a href="#cb81-627" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.8 &lt;- tibble(prob = pprobs.8)</span></span>
<span id="cb81-628"><a href="#cb81-628" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.9 &lt;- tibble(prob = pprobs.9)</span></span>
<span id="cb81-629"><a href="#cb81-629" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.10 &lt;- tibble(prob = pprobs.10)</span></span>
<span id="cb81-630"><a href="#cb81-630" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.11 &lt;- tibble(prob = pprobs.11)</span></span>
<span id="cb81-631"><a href="#cb81-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-632"><a href="#cb81-632" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.2$Model &lt;- as.factor(rep("Two clusters", nrow(pprobs.2)))</span></span>
<span id="cb81-633"><a href="#cb81-633" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.3$Model &lt;- as.factor(rep("Three clusters", nrow(pprobs.3)))</span></span>
<span id="cb81-634"><a href="#cb81-634" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.4$Model &lt;- as.factor(rep("Four clusters", nrow(pprobs.4)))</span></span>
<span id="cb81-635"><a href="#cb81-635" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.5$Model &lt;- as.factor(rep("Five clusters", nrow(pprobs.5)))</span></span>
<span id="cb81-636"><a href="#cb81-636" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.6$Model &lt;- as.factor(rep("Six clusters", nrow(pprobs.6)))</span></span>
<span id="cb81-637"><a href="#cb81-637" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.7$Model &lt;- as.factor(rep("Seven clusters", nrow(pprobs.7)))</span></span>
<span id="cb81-638"><a href="#cb81-638" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.8$Model &lt;- as.factor(rep("Eight clusters", nrow(pprobs.8)))</span></span>
<span id="cb81-639"><a href="#cb81-639" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.9$Model &lt;- as.factor(rep("Nine clusters", nrow(pprobs.9)))</span></span>
<span id="cb81-640"><a href="#cb81-640" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.10$Model &lt;- as.factor(rep("Ten clusters", nrow(pprobs.10)))</span></span>
<span id="cb81-641"><a href="#cb81-641" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.11$Model &lt;- as.factor(rep("Eleven clusters", nrow(pprobs.11)))</span></span>
<span id="cb81-642"><a href="#cb81-642" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs &lt;- rbind(</span></span>
<span id="cb81-643"><a href="#cb81-643" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.2,</span></span>
<span id="cb81-644"><a href="#cb81-644" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.3,</span></span>
<span id="cb81-645"><a href="#cb81-645" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.4,</span></span>
<span id="cb81-646"><a href="#cb81-646" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.5,</span></span>
<span id="cb81-647"><a href="#cb81-647" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.6,</span></span>
<span id="cb81-648"><a href="#cb81-648" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.7,</span></span>
<span id="cb81-649"><a href="#cb81-649" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.8,</span></span>
<span id="cb81-650"><a href="#cb81-650" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.9,</span></span>
<span id="cb81-651"><a href="#cb81-651" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.10,</span></span>
<span id="cb81-652"><a href="#cb81-652" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.11</span></span>
<span id="cb81-653"><a href="#cb81-653" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-654"><a href="#cb81-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-655"><a href="#cb81-655" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- pprobs %&gt;%</span></span>
<span id="cb81-656"><a href="#cb81-656" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = prob, y = Model)) +</span></span>
<span id="cb81-657"><a href="#cb81-657" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_slab(</span></span>
<span id="cb81-658"><a href="#cb81-658" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#5D5179", color = "gray",</span></span>
<span id="cb81-659"><a href="#cb81-659" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 0.8,</span></span>
<span id="cb81-660"><a href="#cb81-660" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.7</span></span>
<span id="cb81-661"><a href="#cb81-661" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb81-662"><a href="#cb81-662" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dots(color = "#4F759B", dotsize = 1) +</span></span>
<span id="cb81-663"><a href="#cb81-663" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Posterior probability for cluster membership") +</span></span>
<span id="cb81-664"><a href="#cb81-664" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("") +</span></span>
<span id="cb81-665"><a href="#cb81-665" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle(</span></span>
<span id="cb81-666"><a href="#cb81-666" aria-hidden="true" tabindex="-1"></a><span class="in">    "Distribution of Posterior Probabilities Across Models",</span></span>
<span id="cb81-667"><a href="#cb81-667" aria-hidden="true" tabindex="-1"></a><span class="in">    "Subject-specific posterior probabilities for assigned cluster"</span></span>
<span id="cb81-668"><a href="#cb81-668" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb81-669"><a href="#cb81-669" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb81-670"><a href="#cb81-670" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(limits = rev)</span></span>
<span id="cb81-671"><a href="#cb81-671" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("plots/pprob-distribution.png",</span></span>
<span id="cb81-672"><a href="#cb81-672" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-673"><a href="#cb81-673" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 8.5,</span></span>
<span id="cb81-674"><a href="#cb81-674" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 7.5,</span></span>
<span id="cb81-675"><a href="#cb81-675" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-676"><a href="#cb81-676" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-677"><a href="#cb81-677" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("plots/pprob-distribution.pdf",</span></span>
<span id="cb81-678"><a href="#cb81-678" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-679"><a href="#cb81-679" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 8.5,</span></span>
<span id="cb81-680"><a href="#cb81-680" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 7.5,</span></span>
<span id="cb81-681"><a href="#cb81-681" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-682"><a href="#cb81-682" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-683"><a href="#cb81-683" aria-hidden="true" tabindex="-1"></a><span class="in">print(p)</span></span>
<span id="cb81-684"><a href="#cb81-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-685"><a href="#cb81-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-686"><a href="#cb81-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-687"><a href="#cb81-687" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residual plots</span></span>
<span id="cb81-688"><a href="#cb81-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-689"><a href="#cb81-689" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb81-690"><a href="#cb81-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-691"><a href="#cb81-691" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL residuals}</span></span>
<span id="cb81-692"><a href="#cb81-692" aria-hidden="true" tabindex="-1"></a><span class="in">#| output: "asis"</span></span>
<span id="cb81-693"><a href="#cb81-693" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.fcal) {</span></span>
<span id="cb81-694"><a href="#cb81-694" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(paste0("##### G = ", G, "\n"))</span></span>
<span id="cb81-695"><a href="#cb81-695" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(models.fcal[[G]], shades = TRUE)</span></span>
<span id="cb81-696"><a href="#cb81-696" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-697"><a href="#cb81-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-698"><a href="#cb81-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-699"><a href="#cb81-699" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-700"><a href="#cb81-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-701"><a href="#cb81-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-702"><a href="#cb81-702" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Chosen model</span></span>
<span id="cb81-703"><a href="#cb81-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-704"><a href="#cb81-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Assess FCAL NCS normality}</span></span>
<span id="cb81-705"><a href="#cb81-705" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-NCS-norm</span></span>
<span id="cb81-706"><a href="#cb81-706" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Plots assessing normality for the distribution of residuals for the chosen NCS model for FCAL. (A) Histrogram; (B) Q-Q plot."</span></span>
<span id="cb81-707"><a href="#cb81-707" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- data.frame(residuals = resid(models.fcal[[8]])) %&gt;%</span></span>
<span id="cb81-708"><a href="#cb81-708" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = residuals)) +</span></span>
<span id="cb81-709"><a href="#cb81-709" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(aes(y = after_stat(density)),</span></span>
<span id="cb81-710"><a href="#cb81-710" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#D8829D",</span></span>
<span id="cb81-711"><a href="#cb81-711" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "#AF6A80",</span></span>
<span id="cb81-712"><a href="#cb81-712" aria-hidden="true" tabindex="-1"></a><span class="in">    bins = 30</span></span>
<span id="cb81-713"><a href="#cb81-713" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb81-714"><a href="#cb81-714" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(color = "#023777", linewidth = 1.2) +</span></span>
<span id="cb81-715"><a href="#cb81-715" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb81-716"><a href="#cb81-716" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.line = element_line(colour = "gray")) +</span></span>
<span id="cb81-717"><a href="#cb81-717" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Density") +</span></span>
<span id="cb81-718"><a href="#cb81-718" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Residuals") +</span></span>
<span id="cb81-719"><a href="#cb81-719" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("A")</span></span>
<span id="cb81-720"><a href="#cb81-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-721"><a href="#cb81-721" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- data.frame(residuals = resid(models.fcal[[8]])) %&gt;%</span></span>
<span id="cb81-722"><a href="#cb81-722" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(sample = residuals)) +</span></span>
<span id="cb81-723"><a href="#cb81-723" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_qq_band() +</span></span>
<span id="cb81-724"><a href="#cb81-724" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_qq_line(color = "#D8829D") +</span></span>
<span id="cb81-725"><a href="#cb81-725" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_qq_point(color = "#023777") +</span></span>
<span id="cb81-726"><a href="#cb81-726" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb81-727"><a href="#cb81-727" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.line = element_line(colour = "gray")) +</span></span>
<span id="cb81-728"><a href="#cb81-728" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Theoretical Quantiles") +</span></span>
<span id="cb81-729"><a href="#cb81-729" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Sample Quantiles") +</span></span>
<span id="cb81-730"><a href="#cb81-730" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("B")</span></span>
<span id="cb81-731"><a href="#cb81-731" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("paper/Residual-plot-fcal-ncs.pdf",</span></span>
<span id="cb81-732"><a href="#cb81-732" aria-hidden="true" tabindex="-1"></a><span class="in">  plot = p1 / p2,</span></span>
<span id="cb81-733"><a href="#cb81-733" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 8,</span></span>
<span id="cb81-734"><a href="#cb81-734" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 8,</span></span>
<span id="cb81-735"><a href="#cb81-735" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-736"><a href="#cb81-736" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-737"><a href="#cb81-737" aria-hidden="true" tabindex="-1"></a><span class="in">print(p1 / p2)</span></span>
<span id="cb81-738"><a href="#cb81-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-739"><a href="#cb81-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-742"><a href="#cb81-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-743"><a href="#cb81-743" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-NCS-norm-cluster</span></span>
<span id="cb81-744"><a href="#cb81-744" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Q-Q plots assessing normality for the distribution of residuals stratifed by cluster assignment."</span></span>
<span id="cb81-745"><a href="#cb81-745" aria-hidden="true" tabindex="-1"></a>predClass <span class="ot">&lt;-</span> models.fcal[[<span class="dv">8</span>]]<span class="sc">$</span>pprob[, <span class="fu">c</span>(<span class="st">"ids"</span>, <span class="st">"class"</span>)]</span>
<span id="cb81-746"><a href="#cb81-746" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">merge</span>(models.fcal[[<span class="dv">8</span>]]<span class="sc">$</span>pred, predClass, <span class="at">by =</span> <span class="st">"ids"</span>)</span>
<span id="cb81-747"><a href="#cb81-747" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span>)</span>
<span id="cb81-748"><a href="#cb81-748" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-749"><a href="#cb81-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-750"><a href="#cb81-750" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb81-751"><a href="#cb81-751" aria-hidden="true" tabindex="-1"></a>  p[[i]] <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp, class <span class="sc">==</span> i) <span class="sc">%&gt;%</span></span>
<span id="cb81-752"><a href="#cb81-752" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> resid_ss)) <span class="sc">+</span></span>
<span id="cb81-753"><a href="#cb81-753" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_band</span>() <span class="sc">+</span></span>
<span id="cb81-754"><a href="#cb81-754" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"#D8829D"</span>) <span class="sc">+</span></span>
<span id="cb81-755"><a href="#cb81-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_point</span>(<span class="at">color =</span> <span class="st">"#023777"</span>) <span class="sc">+</span></span>
<span id="cb81-756"><a href="#cb81-756" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb81-757"><a href="#cb81-757" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray"</span>)) <span class="sc">+</span></span>
<span id="cb81-758"><a href="#cb81-758" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Theoretical Quantiles"</span>) <span class="sc">+</span></span>
<span id="cb81-759"><a href="#cb81-759" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Sample Quantiles"</span>) <span class="sc">+</span></span>
<span id="cb81-760"><a href="#cb81-760" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(labels[i])</span>
<span id="cb81-761"><a href="#cb81-761" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-762"><a href="#cb81-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-763"><a href="#cb81-763" aria-hidden="true" tabindex="-1"></a>ArrangedPlot <span class="ot">&lt;-</span> (p[[<span class="dv">1</span>]] <span class="sc">+</span> p[[<span class="dv">2</span>]]) <span class="sc">/</span></span>
<span id="cb81-764"><a href="#cb81-764" aria-hidden="true" tabindex="-1"></a>  (p[[<span class="dv">3</span>]] <span class="sc">+</span> p[[<span class="dv">4</span>]]) <span class="sc">/</span></span>
<span id="cb81-765"><a href="#cb81-765" aria-hidden="true" tabindex="-1"></a>  (p[[<span class="dv">5</span>]] <span class="sc">+</span> p[[<span class="dv">6</span>]]) <span class="sc">/</span></span>
<span id="cb81-766"><a href="#cb81-766" aria-hidden="true" tabindex="-1"></a>  (p[[<span class="dv">7</span>]] <span class="sc">+</span> p[[<span class="dv">8</span>]])</span>
<span id="cb81-767"><a href="#cb81-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-768"><a href="#cb81-768" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"paper/cluster-resids-ncs.pdf"</span>,</span>
<span id="cb81-769"><a href="#cb81-769" aria-hidden="true" tabindex="-1"></a>  ArrangedPlot,</span>
<span id="cb81-770"><a href="#cb81-770" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb81-771"><a href="#cb81-771" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb81-772"><a href="#cb81-772" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb81-773"><a href="#cb81-773" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-774"><a href="#cb81-774" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ArrangedPlot)</span>
<span id="cb81-775"><a href="#cb81-775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-776"><a href="#cb81-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-777"><a href="#cb81-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-778"><a href="#cb81-778" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model metrics</span></span>
<span id="cb81-779"><a href="#cb81-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-780"><a href="#cb81-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL metrics plot}</span></span>
<span id="cb81-781"><a href="#cb81-781" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-fcal-metrics</span></span>
<span id="cb81-782"><a href="#cb81-782" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Model metrics for FCAL for G = 4-9"</span></span>
<span id="cb81-783"><a href="#cb81-783" aria-hidden="true" tabindex="-1"></a><span class="in">summaryplot(models.fcal[[4]],</span></span>
<span id="cb81-784"><a href="#cb81-784" aria-hidden="true" tabindex="-1"></a><span class="in">  models.fcal[[5]],</span></span>
<span id="cb81-785"><a href="#cb81-785" aria-hidden="true" tabindex="-1"></a><span class="in">  models.fcal[[6]],</span></span>
<span id="cb81-786"><a href="#cb81-786" aria-hidden="true" tabindex="-1"></a><span class="in">  models.fcal[[7]],</span></span>
<span id="cb81-787"><a href="#cb81-787" aria-hidden="true" tabindex="-1"></a><span class="in">  models.fcal[[8]],</span></span>
<span id="cb81-788"><a href="#cb81-788" aria-hidden="true" tabindex="-1"></a><span class="in">  models.fcal[[9]],</span></span>
<span id="cb81-789"><a href="#cb81-789" aria-hidden="true" tabindex="-1"></a><span class="in">  models.fcal[[10]],</span></span>
<span id="cb81-790"><a href="#cb81-790" aria-hidden="true" tabindex="-1"></a><span class="in">  models.fcal[[11]],</span></span>
<span id="cb81-791"><a href="#cb81-791" aria-hidden="true" tabindex="-1"></a><span class="in">  which = c("loglik", "AIC", "BIC", "entropy", "ICL"),</span></span>
<span id="cb81-792"><a href="#cb81-792" aria-hidden="true" tabindex="-1"></a><span class="in">  mfrow = c(2, 3),</span></span>
<span id="cb81-793"><a href="#cb81-793" aria-hidden="true" tabindex="-1"></a><span class="in">  axis = "Class"</span></span>
<span id="cb81-794"><a href="#cb81-794" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-795"><a href="#cb81-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-796"><a href="#cb81-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-797"><a href="#cb81-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL metrics table}</span></span>
<span id="cb81-798"><a href="#cb81-798" aria-hidden="true" tabindex="-1"></a><span class="in">fcal.metrics &lt;- makeMetrics(G.fcal, models.fcal)</span></span>
<span id="cb81-799"><a href="#cb81-799" aria-hidden="true" tabindex="-1"></a><span class="in">buildDT(fcal.metrics)</span></span>
<span id="cb81-800"><a href="#cb81-800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-801"><a href="#cb81-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-802"><a href="#cb81-802" aria-hidden="true" tabindex="-1"></a>The optimum AIC is &lt;b&gt;</span>
<span id="cb81-803"><a href="#cb81-803" aria-hidden="true" tabindex="-1"></a><span class="in">`r format(sort(fcal.metrics[, 2])[1], scientific = FALSE)`</span> &lt;/b&gt; with cluster</span>
<span id="cb81-804"><a href="#cb81-804" aria-hidden="true" tabindex="-1"></a><span class="in">`r order(fcal.metrics[,2])[1] + 3`</span>. The optimum BIC is</span>
<span id="cb81-805"><a href="#cb81-805" aria-hidden="true" tabindex="-1"></a>&lt;b&gt;<span class="in">`r format(sort(fcal.metrics[, 3])[1], scientific = FALSE)`</span> &lt;/b&gt; with cluster</span>
<span id="cb81-806"><a href="#cb81-806" aria-hidden="true" tabindex="-1"></a><span class="in">`r order(fcal.metrics[, 3])[1] + 3`</span></span>
<span id="cb81-807"><a href="#cb81-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-808"><a href="#cb81-808" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spaghetti plots per cluster</span></span>
<span id="cb81-809"><a href="#cb81-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-810"><a href="#cb81-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL spaghetti plots}</span></span>
<span id="cb81-811"><a href="#cb81-811" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.fcal) {</span></span>
<span id="cb81-812"><a href="#cb81-812" aria-hidden="true" tabindex="-1"></a><span class="in">  # Data frame to hold processed data</span></span>
<span id="cb81-813"><a href="#cb81-813" aria-hidden="true" tabindex="-1"></a><span class="in">  new.fc &lt;- data.frame(</span></span>
<span id="cb81-814"><a href="#cb81-814" aria-hidden="true" tabindex="-1"></a><span class="in">    ids = numeric(),</span></span>
<span id="cb81-815"><a href="#cb81-815" aria-hidden="true" tabindex="-1"></a><span class="in">    calpro_result = numeric(),</span></span>
<span id="cb81-816"><a href="#cb81-816" aria-hidden="true" tabindex="-1"></a><span class="in">    calpro_time = numeric(),</span></span>
<span id="cb81-817"><a href="#cb81-817" aria-hidden="true" tabindex="-1"></a><span class="in">    class = numeric()</span></span>
<span id="cb81-818"><a href="#cb81-818" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-819"><a href="#cb81-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-820"><a href="#cb81-820" aria-hidden="true" tabindex="-1"></a><span class="in">  for (clust in 1:G) {</span></span>
<span id="cb81-821"><a href="#cb81-821" aria-hidden="true" tabindex="-1"></a><span class="in">    ids.clust &lt;- subset(models.fcal[[G]]$pprob, class == clust)$ids</span></span>
<span id="cb81-822"><a href="#cb81-822" aria-hidden="true" tabindex="-1"></a><span class="in">    n.clust &lt;- length(ids.clust)</span></span>
<span id="cb81-823"><a href="#cb81-823" aria-hidden="true" tabindex="-1"></a><span class="in">    rand &lt;- sample(n.clust, n.clust) # Randomise the order of the ids</span></span>
<span id="cb81-824"><a href="#cb81-824" aria-hidden="true" tabindex="-1"></a><span class="in">    iters &lt;- floor(n.clust / 6) # How many groups of six are there?</span></span>
<span id="cb81-825"><a href="#cb81-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-826"><a href="#cb81-826" aria-hidden="true" tabindex="-1"></a><span class="in">    # Matrix to hold the smoothed data</span></span>
<span id="cb81-827"><a href="#cb81-827" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.ma &lt;- matrix(NA, nrow = iters, ncol = 7)</span></span>
<span id="cb81-828"><a href="#cb81-828" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.time &lt;- matrix(NA, nrow = iters, ncol = 7)</span></span>
<span id="cb81-829"><a href="#cb81-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-830"><a href="#cb81-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-831"><a href="#cb81-831" aria-hidden="true" tabindex="-1"></a><span class="in">    for (i in 0:(iters - 1)) {</span></span>
<span id="cb81-832"><a href="#cb81-832" aria-hidden="true" tabindex="-1"></a><span class="in">      # Find ids for group of five</span></span>
<span id="cb81-833"><a href="#cb81-833" aria-hidden="true" tabindex="-1"></a><span class="in">      ids.select &lt;- ids.clust[rand[((i * 6) + 1):((i * 6) + 6)]]</span></span>
<span id="cb81-834"><a href="#cb81-834" aria-hidden="true" tabindex="-1"></a><span class="in">      fcal.subset &lt;- subset(fcal, ids %in% ids.select)</span></span>
<span id="cb81-835"><a href="#cb81-835" aria-hidden="true" tabindex="-1"></a><span class="in">      # Median process as per CRP preprocessing</span></span>
<span id="cb81-836"><a href="#cb81-836" aria-hidden="true" tabindex="-1"></a><span class="in">      for (j in seq(0, 6)) {</span></span>
<span id="cb81-837"><a href="#cb81-837" aria-hidden="true" tabindex="-1"></a><span class="in">        if (j == 6) {</span></span>
<span id="cb81-838"><a href="#cb81-838" aria-hidden="true" tabindex="-1"></a><span class="in">          sub.obs &lt;- subset(</span></span>
<span id="cb81-839"><a href="#cb81-839" aria-hidden="true" tabindex="-1"></a><span class="in">            fcal.subset,</span></span>
<span id="cb81-840"><a href="#cb81-840" aria-hidden="true" tabindex="-1"></a><span class="in">            calpro_time &gt;= j - 0.5 &amp; calpro_time &lt;= j + 1</span></span>
<span id="cb81-841"><a href="#cb81-841" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb81-842"><a href="#cb81-842" aria-hidden="true" tabindex="-1"></a><span class="in">        } else {</span></span>
<span id="cb81-843"><a href="#cb81-843" aria-hidden="true" tabindex="-1"></a><span class="in">          sub.obs &lt;- subset(</span></span>
<span id="cb81-844"><a href="#cb81-844" aria-hidden="true" tabindex="-1"></a><span class="in">            fcal.subset,</span></span>
<span id="cb81-845"><a href="#cb81-845" aria-hidden="true" tabindex="-1"></a><span class="in">            calpro_time &gt;= j - 0.5 &amp; calpro_time &lt; j + 0.5</span></span>
<span id="cb81-846"><a href="#cb81-846" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb81-847"><a href="#cb81-847" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb81-848"><a href="#cb81-848" aria-hidden="true" tabindex="-1"></a><span class="in">        if (nrow(sub.obs) &gt; 0) {</span></span>
<span id="cb81-849"><a href="#cb81-849" aria-hidden="true" tabindex="-1"></a><span class="in">          fcal.ma[i + 1, j + 1] &lt;- median(sub.obs$calpro_result)</span></span>
<span id="cb81-850"><a href="#cb81-850" aria-hidden="true" tabindex="-1"></a><span class="in">          fcal.time[i + 1, j + 1] &lt;- median(sub.obs$calpro_time)</span></span>
<span id="cb81-851"><a href="#cb81-851" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb81-852"><a href="#cb81-852" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb81-853"><a href="#cb81-853" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb81-854"><a href="#cb81-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-855"><a href="#cb81-855" aria-hidden="true" tabindex="-1"></a><span class="in">    rownames(fcal.ma) &lt;- 1:iters</span></span>
<span id="cb81-856"><a href="#cb81-856" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.ma &lt;- reshape2::melt(t(fcal.ma),</span></span>
<span id="cb81-857"><a href="#cb81-857" aria-hidden="true" tabindex="-1"></a><span class="in">      id.vars = row.names(fcal.ma),</span></span>
<span id="cb81-858"><a href="#cb81-858" aria-hidden="true" tabindex="-1"></a><span class="in">      na.rm = TRUE</span></span>
<span id="cb81-859"><a href="#cb81-859" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb81-860"><a href="#cb81-860" aria-hidden="true" tabindex="-1"></a><span class="in">    colnames(fcal.ma) &lt;- c("calpro_time", "ids", "calpro_result")</span></span>
<span id="cb81-861"><a href="#cb81-861" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.ma &lt;- fcal.ma[, c(2, 3, 1)] # Make ids first column</span></span>
<span id="cb81-862"><a href="#cb81-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-863"><a href="#cb81-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-864"><a href="#cb81-864" aria-hidden="true" tabindex="-1"></a><span class="in">    rownames(fcal.time) &lt;- 1:iters</span></span>
<span id="cb81-865"><a href="#cb81-865" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.time &lt;- reshape2::melt(t(fcal.time),</span></span>
<span id="cb81-866"><a href="#cb81-866" aria-hidden="true" tabindex="-1"></a><span class="in">      id.vars = row.names(fcal.time),</span></span>
<span id="cb81-867"><a href="#cb81-867" aria-hidden="true" tabindex="-1"></a><span class="in">      na.rm = TRUE</span></span>
<span id="cb81-868"><a href="#cb81-868" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb81-869"><a href="#cb81-869" aria-hidden="true" tabindex="-1"></a><span class="in">    colnames(fcal.time) &lt;- c("calpro_time", "ids", "pred_time")</span></span>
<span id="cb81-870"><a href="#cb81-870" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.time &lt;- fcal.time[, c(2, 3, 1)] # Make ids first column</span></span>
<span id="cb81-871"><a href="#cb81-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-872"><a href="#cb81-872" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.ma &lt;- merge(fcal.ma, fcal.time, by = c("ids", "calpro_time"))</span></span>
<span id="cb81-873"><a href="#cb81-873" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.ma &lt;- fcal.ma %&gt;%</span></span>
<span id="cb81-874"><a href="#cb81-874" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(calpro_time = pred_time) %&gt;%</span></span>
<span id="cb81-875"><a href="#cb81-875" aria-hidden="true" tabindex="-1"></a><span class="in">      select(-pred_time)</span></span>
<span id="cb81-876"><a href="#cb81-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-877"><a href="#cb81-877" aria-hidden="true" tabindex="-1"></a><span class="in">    fcal.ma$class &lt;- clust # Identify cluster assignment</span></span>
<span id="cb81-878"><a href="#cb81-878" aria-hidden="true" tabindex="-1"></a><span class="in">    new.fc &lt;- rbind(new.fc, fcal.ma)</span></span>
<span id="cb81-879"><a href="#cb81-879" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb81-880"><a href="#cb81-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-881"><a href="#cb81-881" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!dir.exists("plots/spaghetti")) dir.create("plots/spaghetti")</span></span>
<span id="cb81-882"><a href="#cb81-882" aria-hidden="true" tabindex="-1"></a><span class="in">  png(paste0("plots/spaghetti/fcal-ncs-", G, ".png"),</span></span>
<span id="cb81-883"><a href="#cb81-883" aria-hidden="true" tabindex="-1"></a><span class="in">    width = 10,</span></span>
<span id="cb81-884"><a href="#cb81-884" aria-hidden="true" tabindex="-1"></a><span class="in">    height = 17.5,</span></span>
<span id="cb81-885"><a href="#cb81-885" aria-hidden="true" tabindex="-1"></a><span class="in">    units = "in",</span></span>
<span id="cb81-886"><a href="#cb81-886" aria-hidden="true" tabindex="-1"></a><span class="in">    res = 300</span></span>
<span id="cb81-887"><a href="#cb81-887" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-888"><a href="#cb81-888" aria-hidden="true" tabindex="-1"></a><span class="in">  grid::grid.newpage()</span></span>
<span id="cb81-889"><a href="#cb81-889" aria-hidden="true" tabindex="-1"></a><span class="in">  spaghettiPlot(new.fc,</span></span>
<span id="cb81-890"><a href="#cb81-890" aria-hidden="true" tabindex="-1"></a><span class="in">    models.fcal,</span></span>
<span id="cb81-891"><a href="#cb81-891" aria-hidden="true" tabindex="-1"></a><span class="in">    G = G,</span></span>
<span id="cb81-892"><a href="#cb81-892" aria-hidden="true" tabindex="-1"></a><span class="in">    log = TRUE,</span></span>
<span id="cb81-893"><a href="#cb81-893" aria-hidden="true" tabindex="-1"></a><span class="in">    tmax = 7,</span></span>
<span id="cb81-894"><a href="#cb81-894" aria-hidden="true" tabindex="-1"></a><span class="in">    sizes = TRUE,</span></span>
<span id="cb81-895"><a href="#cb81-895" aria-hidden="true" tabindex="-1"></a><span class="in">    knots = FALSE,</span></span>
<span id="cb81-896"><a href="#cb81-896" aria-hidden="true" tabindex="-1"></a><span class="in">    var.time = "calpro_time",</span></span>
<span id="cb81-897"><a href="#cb81-897" aria-hidden="true" tabindex="-1"></a><span class="in">    clusters = TRUE</span></span>
<span id="cb81-898"><a href="#cb81-898" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-899"><a href="#cb81-899" aria-hidden="true" tabindex="-1"></a><span class="in">  invisible(dev.off())</span></span>
<span id="cb81-900"><a href="#cb81-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-901"><a href="#cb81-901" aria-hidden="true" tabindex="-1"></a><span class="in">  cairo_pdf(paste0("plots/spaghetti/fcal-ncs-", G, ".pdf"),</span></span>
<span id="cb81-902"><a href="#cb81-902" aria-hidden="true" tabindex="-1"></a><span class="in">    width = 10,</span></span>
<span id="cb81-903"><a href="#cb81-903" aria-hidden="true" tabindex="-1"></a><span class="in">    height = 17.5</span></span>
<span id="cb81-904"><a href="#cb81-904" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-905"><a href="#cb81-905" aria-hidden="true" tabindex="-1"></a><span class="in">  grid::grid.newpage()</span></span>
<span id="cb81-906"><a href="#cb81-906" aria-hidden="true" tabindex="-1"></a><span class="in">  spaghettiPlot(new.fc,</span></span>
<span id="cb81-907"><a href="#cb81-907" aria-hidden="true" tabindex="-1"></a><span class="in">    models.fcal,</span></span>
<span id="cb81-908"><a href="#cb81-908" aria-hidden="true" tabindex="-1"></a><span class="in">    G = G,</span></span>
<span id="cb81-909"><a href="#cb81-909" aria-hidden="true" tabindex="-1"></a><span class="in">    log = TRUE,</span></span>
<span id="cb81-910"><a href="#cb81-910" aria-hidden="true" tabindex="-1"></a><span class="in">    tmax = 7,</span></span>
<span id="cb81-911"><a href="#cb81-911" aria-hidden="true" tabindex="-1"></a><span class="in">    sizes = TRUE,</span></span>
<span id="cb81-912"><a href="#cb81-912" aria-hidden="true" tabindex="-1"></a><span class="in">    knots = FALSE,</span></span>
<span id="cb81-913"><a href="#cb81-913" aria-hidden="true" tabindex="-1"></a><span class="in">    var.time = "calpro_time",</span></span>
<span id="cb81-914"><a href="#cb81-914" aria-hidden="true" tabindex="-1"></a><span class="in">    clusters = TRUE</span></span>
<span id="cb81-915"><a href="#cb81-915" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-916"><a href="#cb81-916" aria-hidden="true" tabindex="-1"></a><span class="in">  invisible(dev.off())</span></span>
<span id="cb81-917"><a href="#cb81-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-918"><a href="#cb81-918" aria-hidden="true" tabindex="-1"></a><span class="in">  grid::grid.newpage()</span></span>
<span id="cb81-919"><a href="#cb81-919" aria-hidden="true" tabindex="-1"></a><span class="in">  print(spaghettiPlot(new.fc,</span></span>
<span id="cb81-920"><a href="#cb81-920" aria-hidden="true" tabindex="-1"></a><span class="in">    models.fcal,</span></span>
<span id="cb81-921"><a href="#cb81-921" aria-hidden="true" tabindex="-1"></a><span class="in">    G = G,</span></span>
<span id="cb81-922"><a href="#cb81-922" aria-hidden="true" tabindex="-1"></a><span class="in">    log = TRUE,</span></span>
<span id="cb81-923"><a href="#cb81-923" aria-hidden="true" tabindex="-1"></a><span class="in">    tmax = 7,</span></span>
<span id="cb81-924"><a href="#cb81-924" aria-hidden="true" tabindex="-1"></a><span class="in">    sizes = TRUE,</span></span>
<span id="cb81-925"><a href="#cb81-925" aria-hidden="true" tabindex="-1"></a><span class="in">    knots = FALSE,</span></span>
<span id="cb81-926"><a href="#cb81-926" aria-hidden="true" tabindex="-1"></a><span class="in">    var.time = "calpro_time",</span></span>
<span id="cb81-927"><a href="#cb81-927" aria-hidden="true" tabindex="-1"></a><span class="in">    clusters = TRUE</span></span>
<span id="cb81-928"><a href="#cb81-928" aria-hidden="true" tabindex="-1"></a><span class="in">  ))</span></span>
<span id="cb81-929"><a href="#cb81-929" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-930"><a href="#cb81-930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-931"><a href="#cb81-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-932"><a href="#cb81-932" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chosen model</span></span>
<span id="cb81-933"><a href="#cb81-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-936"><a href="#cb81-936" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-937"><a href="#cb81-937" aria-hidden="true" tabindex="-1"></a>new.fc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-938"><a href="#cb81-938" aria-hidden="true" tabindex="-1"></a>  <span class="at">ids =</span> <span class="fu">numeric</span>(),</span>
<span id="cb81-939"><a href="#cb81-939" aria-hidden="true" tabindex="-1"></a>  <span class="at">calpro_result =</span> <span class="fu">numeric</span>(),</span>
<span id="cb81-940"><a href="#cb81-940" aria-hidden="true" tabindex="-1"></a>  <span class="at">calpro_time =</span> <span class="fu">numeric</span>(),</span>
<span id="cb81-941"><a href="#cb81-941" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="fu">numeric</span>()</span>
<span id="cb81-942"><a href="#cb81-942" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-943"><a href="#cb81-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-944"><a href="#cb81-944" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (clust <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb81-945"><a href="#cb81-945" aria-hidden="true" tabindex="-1"></a>  ids.clust <span class="ot">&lt;-</span> <span class="fu">subset</span>(models.fcal[[<span class="dv">8</span>]]<span class="sc">$</span>pprob, class <span class="sc">==</span> clust)<span class="sc">$</span>ids</span>
<span id="cb81-946"><a href="#cb81-946" aria-hidden="true" tabindex="-1"></a>  n.clust <span class="ot">&lt;-</span> <span class="fu">length</span>(ids.clust)</span>
<span id="cb81-947"><a href="#cb81-947" aria-hidden="true" tabindex="-1"></a>  rand <span class="ot">&lt;-</span> <span class="fu">sample</span>(n.clust, n.clust) <span class="co"># Randomise the order of the ids</span></span>
<span id="cb81-948"><a href="#cb81-948" aria-hidden="true" tabindex="-1"></a>  iters <span class="ot">&lt;-</span> <span class="fu">floor</span>(n.clust <span class="sc">/</span> <span class="dv">6</span>) <span class="co"># How many groups of six are there?</span></span>
<span id="cb81-949"><a href="#cb81-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-950"><a href="#cb81-950" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Matrix to hold the smoothed data</span></span>
<span id="cb81-951"><a href="#cb81-951" aria-hidden="true" tabindex="-1"></a>  fcal.ma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> iters, <span class="at">ncol =</span> <span class="dv">7</span>)</span>
<span id="cb81-952"><a href="#cb81-952" aria-hidden="true" tabindex="-1"></a>  fcal.time <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> iters, <span class="at">ncol =</span> <span class="dv">7</span>)</span>
<span id="cb81-953"><a href="#cb81-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-954"><a href="#cb81-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-955"><a href="#cb81-955" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>(iters <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb81-956"><a href="#cb81-956" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find ids for group of five</span></span>
<span id="cb81-957"><a href="#cb81-957" aria-hidden="true" tabindex="-1"></a>    ids.select <span class="ot">&lt;-</span> ids.clust[rand[((i <span class="sc">*</span> <span class="dv">6</span>) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>((i <span class="sc">*</span> <span class="dv">6</span>) <span class="sc">+</span> <span class="dv">6</span>)]]</span>
<span id="cb81-958"><a href="#cb81-958" aria-hidden="true" tabindex="-1"></a>    fcal.subset <span class="ot">&lt;-</span> <span class="fu">subset</span>(fcal, ids <span class="sc">%in%</span> ids.select)</span>
<span id="cb81-959"><a href="#cb81-959" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Median process as per CRP preprocessing</span></span>
<span id="cb81-960"><a href="#cb81-960" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>)) {</span>
<span id="cb81-961"><a href="#cb81-961" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (j <span class="sc">==</span> <span class="dv">6</span>) {</span>
<span id="cb81-962"><a href="#cb81-962" aria-hidden="true" tabindex="-1"></a>        sub.obs <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb81-963"><a href="#cb81-963" aria-hidden="true" tabindex="-1"></a>          fcal.subset,</span>
<span id="cb81-964"><a href="#cb81-964" aria-hidden="true" tabindex="-1"></a>          calpro_time <span class="sc">&gt;=</span> j <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> calpro_time <span class="sc">&lt;=</span> j <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-965"><a href="#cb81-965" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb81-966"><a href="#cb81-966" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb81-967"><a href="#cb81-967" aria-hidden="true" tabindex="-1"></a>        sub.obs <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb81-968"><a href="#cb81-968" aria-hidden="true" tabindex="-1"></a>          fcal.subset,</span>
<span id="cb81-969"><a href="#cb81-969" aria-hidden="true" tabindex="-1"></a>          calpro_time <span class="sc">&gt;=</span> j <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> calpro_time <span class="sc">&lt;</span> j <span class="sc">+</span> <span class="fl">0.5</span></span>
<span id="cb81-970"><a href="#cb81-970" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb81-971"><a href="#cb81-971" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb81-972"><a href="#cb81-972" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(sub.obs) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb81-973"><a href="#cb81-973" aria-hidden="true" tabindex="-1"></a>        fcal.ma[i <span class="sc">+</span> <span class="dv">1</span>, j <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">median</span>(sub.obs<span class="sc">$</span>calpro_result)</span>
<span id="cb81-974"><a href="#cb81-974" aria-hidden="true" tabindex="-1"></a>        fcal.time[i <span class="sc">+</span> <span class="dv">1</span>, j <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">median</span>(sub.obs<span class="sc">$</span>calpro_time)</span>
<span id="cb81-975"><a href="#cb81-975" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb81-976"><a href="#cb81-976" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-977"><a href="#cb81-977" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-978"><a href="#cb81-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-979"><a href="#cb81-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(fcal.ma) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>iters</span>
<span id="cb81-980"><a href="#cb81-980" aria-hidden="true" tabindex="-1"></a>  fcal.ma <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(<span class="fu">t</span>(fcal.ma),</span>
<span id="cb81-981"><a href="#cb81-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">id.vars =</span> <span class="fu">row.names</span>(fcal.ma),</span>
<span id="cb81-982"><a href="#cb81-982" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb81-983"><a href="#cb81-983" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-984"><a href="#cb81-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(fcal.ma) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"calpro_result"</span>)</span>
<span id="cb81-985"><a href="#cb81-985" aria-hidden="true" tabindex="-1"></a>  fcal.ma <span class="ot">&lt;-</span> fcal.ma[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)] <span class="co"># Make ids first column</span></span>
<span id="cb81-986"><a href="#cb81-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-987"><a href="#cb81-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-988"><a href="#cb81-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(fcal.time) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>iters</span>
<span id="cb81-989"><a href="#cb81-989" aria-hidden="true" tabindex="-1"></a>  fcal.time <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(<span class="fu">t</span>(fcal.time),</span>
<span id="cb81-990"><a href="#cb81-990" aria-hidden="true" tabindex="-1"></a>    <span class="at">id.vars =</span> <span class="fu">row.names</span>(fcal.time),</span>
<span id="cb81-991"><a href="#cb81-991" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb81-992"><a href="#cb81-992" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-993"><a href="#cb81-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(fcal.time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"pred_time"</span>)</span>
<span id="cb81-994"><a href="#cb81-994" aria-hidden="true" tabindex="-1"></a>  fcal.time <span class="ot">&lt;-</span> fcal.time[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)] <span class="co"># Make ids first column</span></span>
<span id="cb81-995"><a href="#cb81-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-996"><a href="#cb81-996" aria-hidden="true" tabindex="-1"></a>  fcal.ma <span class="ot">&lt;-</span> <span class="fu">merge</span>(fcal.ma, fcal.time, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ids"</span>, <span class="st">"calpro_time"</span>))</span>
<span id="cb81-997"><a href="#cb81-997" aria-hidden="true" tabindex="-1"></a>  fcal.ma <span class="ot">&lt;-</span> fcal.ma <span class="sc">%&gt;%</span></span>
<span id="cb81-998"><a href="#cb81-998" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">calpro_time =</span> pred_time) <span class="sc">%&gt;%</span></span>
<span id="cb81-999"><a href="#cb81-999" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>pred_time)</span>
<span id="cb81-1000"><a href="#cb81-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1001"><a href="#cb81-1001" aria-hidden="true" tabindex="-1"></a>  fcal.ma<span class="sc">$</span>class <span class="ot">&lt;-</span> clust <span class="co"># Identify cluster assignment</span></span>
<span id="cb81-1002"><a href="#cb81-1002" aria-hidden="true" tabindex="-1"></a>  new.fc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(new.fc, fcal.ma)</span>
<span id="cb81-1003"><a href="#cb81-1003" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1004"><a href="#cb81-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1005"><a href="#cb81-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1006"><a href="#cb81-1006" aria-hidden="true" tabindex="-1"></a>As. a parsimonious choice, we have elected to focus on the 8-cluster model as</span>
<span id="cb81-1007"><a href="#cb81-1007" aria-hidden="true" tabindex="-1"></a>we believe this strikes a reasonable balance between characterising the LIBDR</span>
<span id="cb81-1008"><a href="#cb81-1008" aria-hidden="true" tabindex="-1"></a>cohort whilst still presenting trends which likely reflect the IBD population in</span>
<span id="cb81-1009"><a href="#cb81-1009" aria-hidden="true" tabindex="-1"></a>Western Europe. </span>
<span id="cb81-1010"><a href="#cb81-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1011"><a href="#cb81-1011" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Labelling</span></span>
<span id="cb81-1012"><a href="#cb81-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1013"><a href="#cb81-1013" aria-hidden="true" tabindex="-1"></a>The labels/order of the clusters generated above are random. To improve the</span>
<span id="cb81-1014"><a href="#cb81-1014" aria-hidden="true" tabindex="-1"></a>readability and assist with interpretation of associations, it would be</span>
<span id="cb81-1015"><a href="#cb81-1015" aria-hidden="true" tabindex="-1"></a>beneficial to order clusters by some analogue for disease severity. This section</span>
<span id="cb81-1016"><a href="#cb81-1016" aria-hidden="true" tabindex="-1"></a>explores possible solutions for this task. </span>
<span id="cb81-1017"><a href="#cb81-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1018"><a href="#cb81-1018" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Cumulative inflammation across follow-up</span></span>
<span id="cb81-1019"><a href="#cb81-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1020"><a href="#cb81-1020" aria-hidden="true" tabindex="-1"></a>One possible solution is to order clusters by cumulative inflammation which is</span>
<span id="cb81-1021"><a href="#cb81-1021" aria-hidden="true" tabindex="-1"></a>given by the area under the curve for each mean cluster trajectory.</span>
<span id="cb81-1022"><a href="#cb81-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1025"><a href="#cb81-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1026"><a href="#cb81-1026" aria-hidden="true" tabindex="-1"></a>rank.full <span class="ot">&lt;-</span> <span class="fu">rankCumulative</span>(models.fcal[[<span class="dv">8</span>]], <span class="at">tmax =</span> <span class="dv">7</span>)</span>
<span id="cb81-1027"><a href="#cb81-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1028"><a href="#cb81-1028" aria-hidden="true" tabindex="-1"></a>rank.full <span class="sc">%&gt;%</span></span>
<span id="cb81-1029"><a href="#cb81-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">"FC"</span>, New), <span class="at">y =</span> Area)) <span class="sc">+</span></span>
<span id="cb81-1030"><a href="#cb81-1030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"#745C97"</span>, <span class="at">color =</span> <span class="st">"#39375B"</span>) <span class="sc">+</span></span>
<span id="cb81-1031"><a href="#cb81-1031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative inflammation (Area)"</span>) <span class="sc">+</span></span>
<span id="cb81-1032"><a href="#cb81-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb81-1033"><a href="#cb81-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb81-1034"><a href="#cb81-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1035"><a href="#cb81-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1038"><a href="#cb81-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1039"><a href="#cb81-1039" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">"plots/spaghetti/fcal-ncs-reordered.png"</span>),</span>
<span id="cb81-1040"><a href="#cb81-1040" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb81-1041"><a href="#cb81-1041" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">16</span>,</span>
<span id="cb81-1042"><a href="#cb81-1042" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb81-1043"><a href="#cb81-1043" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">300</span></span>
<span id="cb81-1044"><a href="#cb81-1044" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1045"><a href="#cb81-1045" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb81-1046"><a href="#cb81-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1047"><a href="#cb81-1047" aria-hidden="true" tabindex="-1"></a>  models.fcal,</span>
<span id="cb81-1048"><a href="#cb81-1048" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">8</span>,</span>
<span id="cb81-1049"><a href="#cb81-1049" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1050"><a href="#cb81-1050" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1051"><a href="#cb81-1051" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1052"><a href="#cb81-1052" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1053"><a href="#cb81-1053" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1054"><a href="#cb81-1054" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1055"><a href="#cb81-1055" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original</span>
<span id="cb81-1056"><a href="#cb81-1056" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1057"><a href="#cb81-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1058"><a href="#cb81-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1059"><a href="#cb81-1059" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="fu">paste0</span>(<span class="st">"plots/spaghetti/fcal-ncs-reordered.pdf"</span>),</span>
<span id="cb81-1060"><a href="#cb81-1060" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb81-1061"><a href="#cb81-1061" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">16</span></span>
<span id="cb81-1062"><a href="#cb81-1062" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1063"><a href="#cb81-1063" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb81-1064"><a href="#cb81-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1065"><a href="#cb81-1065" aria-hidden="true" tabindex="-1"></a>  models.fcal,</span>
<span id="cb81-1066"><a href="#cb81-1066" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">8</span>,</span>
<span id="cb81-1067"><a href="#cb81-1067" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1068"><a href="#cb81-1068" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1069"><a href="#cb81-1069" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1070"><a href="#cb81-1070" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1071"><a href="#cb81-1071" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1072"><a href="#cb81-1072" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1073"><a href="#cb81-1073" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original</span>
<span id="cb81-1074"><a href="#cb81-1074" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1075"><a href="#cb81-1075" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1076"><a href="#cb81-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1077"><a href="#cb81-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1078"><a href="#cb81-1078" aria-hidden="true" tabindex="-1"></a>  models.fcal,</span>
<span id="cb81-1079"><a href="#cb81-1079" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">8</span>,</span>
<span id="cb81-1080"><a href="#cb81-1080" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1081"><a href="#cb81-1081" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1082"><a href="#cb81-1082" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1083"><a href="#cb81-1083" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1084"><a href="#cb81-1084" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1085"><a href="#cb81-1085" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1086"><a href="#cb81-1086" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original</span>
<span id="cb81-1087"><a href="#cb81-1087" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1088"><a href="#cb81-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1089"><a href="#cb81-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1090"><a href="#cb81-1090" aria-hidden="true" tabindex="-1"></a>With Danish predictions</span>
<span id="cb81-1091"><a href="#cb81-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1094"><a href="#cb81-1094" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1095"><a href="#cb81-1095" aria-hidden="true" tabindex="-1"></a>dk.fcal <span class="ot">&lt;-</span> dk.fcal <span class="sc">%&gt;%</span></span>
<span id="cb81-1096"><a href="#cb81-1096" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">str_replace_all</span>(cluster, <span class="st">"Ypred_class"</span>, <span class="st">""</span>))</span>
<span id="cb81-1097"><a href="#cb81-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1098"><a href="#cb81-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1101"><a href="#cb81-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1102"><a href="#cb81-1102" aria-hidden="true" tabindex="-1"></a>dk.fcal<span class="sc">$</span>cluster <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">mapvalues</span>(dk.fcal<span class="sc">$</span>cluster,</span>
<span id="cb81-1103"><a href="#cb81-1103" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">from =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb81-1104"><a href="#cb81-1104" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))</span>
<span id="cb81-1105"><a href="#cb81-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1106"><a href="#cb81-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1109"><a href="#cb81-1109" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1110"><a href="#cb81-1110" aria-hidden="true" tabindex="-1"></a><span class="fu">cairo_pdf</span>(<span class="fu">paste0</span>(<span class="st">"plots/spaghetti/fcal-scot-dk.pdf"</span>),</span>
<span id="cb81-1111"><a href="#cb81-1111" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb81-1112"><a href="#cb81-1112" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">16</span></span>
<span id="cb81-1113"><a href="#cb81-1113" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1114"><a href="#cb81-1114" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb81-1115"><a href="#cb81-1115" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1116"><a href="#cb81-1116" aria-hidden="true" tabindex="-1"></a>  models.fcal,</span>
<span id="cb81-1117"><a href="#cb81-1117" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">8</span>,</span>
<span id="cb81-1118"><a href="#cb81-1118" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1119"><a href="#cb81-1119" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1120"><a href="#cb81-1120" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1121"><a href="#cb81-1121" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1122"><a href="#cb81-1122" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1123"><a href="#cb81-1123" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1124"><a href="#cb81-1124" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original,</span>
<span id="cb81-1125"><a href="#cb81-1125" aria-hidden="true" tabindex="-1"></a>  <span class="at">external =</span> dk.fcal</span>
<span id="cb81-1126"><a href="#cb81-1126" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1127"><a href="#cb81-1127" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1128"><a href="#cb81-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1129"><a href="#cb81-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">"plots/spaghetti/fcal-scot-dk.png"</span>),</span>
<span id="cb81-1130"><a href="#cb81-1130" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb81-1131"><a href="#cb81-1131" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">16</span>,</span>
<span id="cb81-1132"><a href="#cb81-1132" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb81-1133"><a href="#cb81-1133" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">300</span></span>
<span id="cb81-1134"><a href="#cb81-1134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1135"><a href="#cb81-1135" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb81-1136"><a href="#cb81-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1137"><a href="#cb81-1137" aria-hidden="true" tabindex="-1"></a>  models.fcal,</span>
<span id="cb81-1138"><a href="#cb81-1138" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">8</span>,</span>
<span id="cb81-1139"><a href="#cb81-1139" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1140"><a href="#cb81-1140" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1141"><a href="#cb81-1141" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1142"><a href="#cb81-1142" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1143"><a href="#cb81-1143" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1144"><a href="#cb81-1144" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1145"><a href="#cb81-1145" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original,</span>
<span id="cb81-1146"><a href="#cb81-1146" aria-hidden="true" tabindex="-1"></a>  <span class="at">external =</span> dk.fcal</span>
<span id="cb81-1147"><a href="#cb81-1147" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1148"><a href="#cb81-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1149"><a href="#cb81-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1150"><a href="#cb81-1150" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb81-1151"><a href="#cb81-1151" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1152"><a href="#cb81-1152" aria-hidden="true" tabindex="-1"></a>  models.fcal,</span>
<span id="cb81-1153"><a href="#cb81-1153" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">8</span>,</span>
<span id="cb81-1154"><a href="#cb81-1154" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1155"><a href="#cb81-1155" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1156"><a href="#cb81-1156" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1157"><a href="#cb81-1157" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1158"><a href="#cb81-1158" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1159"><a href="#cb81-1159" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1160"><a href="#cb81-1160" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original,</span>
<span id="cb81-1161"><a href="#cb81-1161" aria-hidden="true" tabindex="-1"></a>  <span class="at">external =</span> dk.fcal</span>
<span id="cb81-1162"><a href="#cb81-1162" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1163"><a href="#cb81-1163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1164"><a href="#cb81-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1167"><a href="#cb81-1167" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1168"><a href="#cb81-1168" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (G <span class="cf">in</span> (<span class="dv">9</span><span class="sc">:</span><span class="dv">10</span>)) {</span>
<span id="cb81-1169"><a href="#cb81-1169" aria-hidden="true" tabindex="-1"></a>  new.fc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-1170"><a href="#cb81-1170" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">numeric</span>(),</span>
<span id="cb81-1171"><a href="#cb81-1171" aria-hidden="true" tabindex="-1"></a>    <span class="at">calpro_result =</span> <span class="fu">numeric</span>(), </span>
<span id="cb81-1172"><a href="#cb81-1172" aria-hidden="true" tabindex="-1"></a>    <span class="at">calpro_time =</span> <span class="fu">numeric</span>(),</span>
<span id="cb81-1173"><a href="#cb81-1173" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="fu">numeric</span>()</span>
<span id="cb81-1174"><a href="#cb81-1174" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1175"><a href="#cb81-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1176"><a href="#cb81-1176" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (clust <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>G) {</span>
<span id="cb81-1177"><a href="#cb81-1177" aria-hidden="true" tabindex="-1"></a>    ids.clust <span class="ot">&lt;-</span> <span class="fu">subset</span>(models.fcal[[G]]<span class="sc">$</span>pprob, class <span class="sc">==</span> clust)<span class="sc">$</span>ids</span>
<span id="cb81-1178"><a href="#cb81-1178" aria-hidden="true" tabindex="-1"></a>    n.clust <span class="ot">&lt;-</span> <span class="fu">length</span>(ids.clust)</span>
<span id="cb81-1179"><a href="#cb81-1179" aria-hidden="true" tabindex="-1"></a>    rand <span class="ot">&lt;-</span> <span class="fu">sample</span>(n.clust, n.clust) <span class="co"># Randomise the order of the ids</span></span>
<span id="cb81-1180"><a href="#cb81-1180" aria-hidden="true" tabindex="-1"></a>    iters <span class="ot">&lt;-</span> <span class="fu">floor</span>(n.clust <span class="sc">/</span> <span class="dv">6</span>) <span class="co"># How many groups of six are there?</span></span>
<span id="cb81-1181"><a href="#cb81-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1182"><a href="#cb81-1182" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Matrix to hold the smoothed data</span></span>
<span id="cb81-1183"><a href="#cb81-1183" aria-hidden="true" tabindex="-1"></a>    fcal.ma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> iters, <span class="at">ncol =</span> <span class="dv">7</span>)</span>
<span id="cb81-1184"><a href="#cb81-1184" aria-hidden="true" tabindex="-1"></a>    fcal.time <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> iters, <span class="at">ncol =</span> <span class="dv">7</span>)</span>
<span id="cb81-1185"><a href="#cb81-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1186"><a href="#cb81-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1187"><a href="#cb81-1187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>(iters <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb81-1188"><a href="#cb81-1188" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Find ids for group of five</span></span>
<span id="cb81-1189"><a href="#cb81-1189" aria-hidden="true" tabindex="-1"></a>      ids.select <span class="ot">&lt;-</span> ids.clust[rand[((i <span class="sc">*</span> <span class="dv">6</span>) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>((i <span class="sc">*</span> <span class="dv">6</span>) <span class="sc">+</span> <span class="dv">6</span>)]]</span>
<span id="cb81-1190"><a href="#cb81-1190" aria-hidden="true" tabindex="-1"></a>      fcal.subset <span class="ot">&lt;-</span> <span class="fu">subset</span>(fcal, ids <span class="sc">%in%</span> ids.select)</span>
<span id="cb81-1191"><a href="#cb81-1191" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Median process as per CRP preprocessing</span></span>
<span id="cb81-1192"><a href="#cb81-1192" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>)) {</span>
<span id="cb81-1193"><a href="#cb81-1193" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (j <span class="sc">==</span> <span class="dv">6</span>) {</span>
<span id="cb81-1194"><a href="#cb81-1194" aria-hidden="true" tabindex="-1"></a>          sub.obs <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb81-1195"><a href="#cb81-1195" aria-hidden="true" tabindex="-1"></a>            fcal.subset,</span>
<span id="cb81-1196"><a href="#cb81-1196" aria-hidden="true" tabindex="-1"></a>            calpro_time <span class="sc">&gt;=</span> j <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> calpro_time <span class="sc">&lt;=</span> j <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-1197"><a href="#cb81-1197" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb81-1198"><a href="#cb81-1198" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb81-1199"><a href="#cb81-1199" aria-hidden="true" tabindex="-1"></a>          sub.obs <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb81-1200"><a href="#cb81-1200" aria-hidden="true" tabindex="-1"></a>            fcal.subset,</span>
<span id="cb81-1201"><a href="#cb81-1201" aria-hidden="true" tabindex="-1"></a>            calpro_time <span class="sc">&gt;=</span> j <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> calpro_time <span class="sc">&lt;</span> j <span class="sc">+</span> <span class="fl">0.5</span></span>
<span id="cb81-1202"><a href="#cb81-1202" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb81-1203"><a href="#cb81-1203" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb81-1204"><a href="#cb81-1204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">nrow</span>(sub.obs) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb81-1205"><a href="#cb81-1205" aria-hidden="true" tabindex="-1"></a>          fcal.ma[i <span class="sc">+</span> <span class="dv">1</span>, j <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">median</span>(sub.obs<span class="sc">$</span>calpro_result)</span>
<span id="cb81-1206"><a href="#cb81-1206" aria-hidden="true" tabindex="-1"></a>          fcal.time[i <span class="sc">+</span> <span class="dv">1</span>, j <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">median</span>(sub.obs<span class="sc">$</span>calpro_time)</span>
<span id="cb81-1207"><a href="#cb81-1207" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb81-1208"><a href="#cb81-1208" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb81-1209"><a href="#cb81-1209" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-1210"><a href="#cb81-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1211"><a href="#cb81-1211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(fcal.ma) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>iters</span>
<span id="cb81-1212"><a href="#cb81-1212" aria-hidden="true" tabindex="-1"></a>    fcal.ma <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(<span class="fu">t</span>(fcal.ma),</span>
<span id="cb81-1213"><a href="#cb81-1213" aria-hidden="true" tabindex="-1"></a>      <span class="at">id.vars =</span> <span class="fu">row.names</span>(fcal.ma),</span>
<span id="cb81-1214"><a href="#cb81-1214" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb81-1215"><a href="#cb81-1215" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-1216"><a href="#cb81-1216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(fcal.ma) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"calpro_result"</span>)</span>
<span id="cb81-1217"><a href="#cb81-1217" aria-hidden="true" tabindex="-1"></a>    fcal.ma <span class="ot">&lt;-</span> fcal.ma[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)] <span class="co"># Make ids first column</span></span>
<span id="cb81-1218"><a href="#cb81-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1219"><a href="#cb81-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1220"><a href="#cb81-1220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(fcal.time) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>iters</span>
<span id="cb81-1221"><a href="#cb81-1221" aria-hidden="true" tabindex="-1"></a>    fcal.time <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(<span class="fu">t</span>(fcal.time),</span>
<span id="cb81-1222"><a href="#cb81-1222" aria-hidden="true" tabindex="-1"></a>      <span class="at">id.vars =</span> <span class="fu">row.names</span>(fcal.time),</span>
<span id="cb81-1223"><a href="#cb81-1223" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb81-1224"><a href="#cb81-1224" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-1225"><a href="#cb81-1225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(fcal.time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"calpro_time"</span>, <span class="st">"ids"</span>, <span class="st">"pred_time"</span>)</span>
<span id="cb81-1226"><a href="#cb81-1226" aria-hidden="true" tabindex="-1"></a>    fcal.time <span class="ot">&lt;-</span> fcal.time[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)] <span class="co"># Make ids first column</span></span>
<span id="cb81-1227"><a href="#cb81-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1228"><a href="#cb81-1228" aria-hidden="true" tabindex="-1"></a>    fcal.ma <span class="ot">&lt;-</span> <span class="fu">merge</span>(fcal.ma, fcal.time, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ids"</span>, <span class="st">"calpro_time"</span>))</span>
<span id="cb81-1229"><a href="#cb81-1229" aria-hidden="true" tabindex="-1"></a>    fcal.ma <span class="ot">&lt;-</span> fcal.ma <span class="sc">%&gt;%</span></span>
<span id="cb81-1230"><a href="#cb81-1230" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">calpro_time =</span> pred_time) <span class="sc">%&gt;%</span></span>
<span id="cb81-1231"><a href="#cb81-1231" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>pred_time)</span>
<span id="cb81-1232"><a href="#cb81-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1233"><a href="#cb81-1233" aria-hidden="true" tabindex="-1"></a>    fcal.ma<span class="sc">$</span>class <span class="ot">&lt;-</span> clust <span class="co"># Identify cluster assignment</span></span>
<span id="cb81-1234"><a href="#cb81-1234" aria-hidden="true" tabindex="-1"></a>    new.fc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(new.fc, fcal.ma)</span>
<span id="cb81-1235"><a href="#cb81-1235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-1236"><a href="#cb81-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1237"><a href="#cb81-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1238"><a href="#cb81-1238" aria-hidden="true" tabindex="-1"></a>  rank.full <span class="ot">&lt;-</span> <span class="fu">rankCumulative</span>(models.fcal[[G]], <span class="at">tmax =</span> <span class="dv">7</span>)</span>
<span id="cb81-1239"><a href="#cb81-1239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">"plots/spaghetti/fcal-ncs-reordered-"</span>, G, <span class="st">".png"</span>),</span>
<span id="cb81-1240"><a href="#cb81-1240" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb81-1241"><a href="#cb81-1241" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">16</span>,</span>
<span id="cb81-1242"><a href="#cb81-1242" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb81-1243"><a href="#cb81-1243" aria-hidden="true" tabindex="-1"></a>    <span class="at">res =</span> <span class="dv">300</span></span>
<span id="cb81-1244"><a href="#cb81-1244" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1245"><a href="#cb81-1245" aria-hidden="true" tabindex="-1"></a>  grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb81-1246"><a href="#cb81-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1247"><a href="#cb81-1247" aria-hidden="true" tabindex="-1"></a>    models.fcal,</span>
<span id="cb81-1248"><a href="#cb81-1248" aria-hidden="true" tabindex="-1"></a>    <span class="at">G =</span> G,</span>
<span id="cb81-1249"><a href="#cb81-1249" aria-hidden="true" tabindex="-1"></a>    <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1250"><a href="#cb81-1250" aria-hidden="true" tabindex="-1"></a>    <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1251"><a href="#cb81-1251" aria-hidden="true" tabindex="-1"></a>    <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1252"><a href="#cb81-1252" aria-hidden="true" tabindex="-1"></a>    <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1253"><a href="#cb81-1253" aria-hidden="true" tabindex="-1"></a>    <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1254"><a href="#cb81-1254" aria-hidden="true" tabindex="-1"></a>    <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1255"><a href="#cb81-1255" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original</span>
<span id="cb81-1256"><a href="#cb81-1256" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1257"><a href="#cb81-1257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1258"><a href="#cb81-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1259"><a href="#cb81-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cairo_pdf</span>(<span class="fu">paste0</span>(<span class="st">"plots/spaghetti/fcal-ncs-reordered-"</span>, G, <span class="st">".pdf"</span>),</span>
<span id="cb81-1260"><a href="#cb81-1260" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb81-1261"><a href="#cb81-1261" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">16</span></span>
<span id="cb81-1262"><a href="#cb81-1262" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1263"><a href="#cb81-1263" aria-hidden="true" tabindex="-1"></a>  grid<span class="sc">::</span><span class="fu">grid.newpage</span>()</span>
<span id="cb81-1264"><a href="#cb81-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spaghettiPlot</span>(new.fc,</span>
<span id="cb81-1265"><a href="#cb81-1265" aria-hidden="true" tabindex="-1"></a>    models.fcal,</span>
<span id="cb81-1266"><a href="#cb81-1266" aria-hidden="true" tabindex="-1"></a>    <span class="at">G =</span> G,</span>
<span id="cb81-1267"><a href="#cb81-1267" aria-hidden="true" tabindex="-1"></a>    <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1268"><a href="#cb81-1268" aria-hidden="true" tabindex="-1"></a>    <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1269"><a href="#cb81-1269" aria-hidden="true" tabindex="-1"></a>    <span class="at">sizes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1270"><a href="#cb81-1270" aria-hidden="true" tabindex="-1"></a>    <span class="at">knots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1271"><a href="#cb81-1271" aria-hidden="true" tabindex="-1"></a>    <span class="at">var.time =</span> <span class="st">"calpro_time"</span>,</span>
<span id="cb81-1272"><a href="#cb81-1272" aria-hidden="true" tabindex="-1"></a>    <span class="at">clusters =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1273"><a href="#cb81-1273" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> rank.full<span class="sc">$</span>Original</span>
<span id="cb81-1274"><a href="#cb81-1274" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1275"><a href="#cb81-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1276"><a href="#cb81-1276" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1277"><a href="#cb81-1277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1278"><a href="#cb81-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1279"><a href="#cb81-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1280"><a href="#cb81-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1281"><a href="#cb81-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1282"><a href="#cb81-1282" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Alluvial anchored plot</span></span>
<span id="cb81-1283"><a href="#cb81-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1284"><a href="#cb81-1284" aria-hidden="true" tabindex="-1"></a>Having chosen the 8-cluster model to be the most appropriate, we have produced</span>
<span id="cb81-1285"><a href="#cb81-1285" aria-hidden="true" tabindex="-1"></a>a version of @fig-fcal-alluvial-unadjusted using the labels assigned for the</span>
<span id="cb81-1286"><a href="#cb81-1286" aria-hidden="true" tabindex="-1"></a>8-cluster model. </span>
<span id="cb81-1287"><a href="#cb81-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1290"><a href="#cb81-1290" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1291"><a href="#cb81-1291" aria-hidden="true" tabindex="-1"></a>alluvial.df <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb81-1292"><a href="#cb81-1292" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(alluvial.df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ids"</span>, <span class="st">"class"</span>, <span class="st">"G"</span>)</span>
<span id="cb81-1293"><a href="#cb81-1293" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (G <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb81-1294"><a href="#cb81-1294" aria-hidden="true" tabindex="-1"></a>  alluvial.df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(alluvial.df, <span class="fu">cbind</span>(models.fcal[[G]]<span class="sc">$</span>pprob[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">G =</span> G))</span>
<span id="cb81-1295"><a href="#cb81-1295" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1296"><a href="#cb81-1296" aria-hidden="true" tabindex="-1"></a>alluvial.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(alluvial.df)</span>
<span id="cb81-1297"><a href="#cb81-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1298"><a href="#cb81-1298" aria-hidden="true" tabindex="-1"></a>alluvial.df<span class="sc">$</span>ids <span class="ot">&lt;-</span> <span class="fu">as.character</span>(alluvial.df<span class="sc">$</span>ids)</span>
<span id="cb81-1299"><a href="#cb81-1299" aria-hidden="true" tabindex="-1"></a>alluvial.df<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(alluvial.df<span class="sc">$</span>class)</span>
<span id="cb81-1300"><a href="#cb81-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1301"><a href="#cb81-1301" aria-hidden="true" tabindex="-1"></a><span class="co"># eliminate label switching</span></span>
<span id="cb81-1302"><a href="#cb81-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1303"><a href="#cb81-1303" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">2</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1304"><a href="#cb81-1304" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">2</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1305"><a href="#cb81-1305" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb81-1306"><a href="#cb81-1306" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>)</span>
<span id="cb81-1307"><a href="#cb81-1307" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1308"><a href="#cb81-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1309"><a href="#cb81-1309" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">3</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1310"><a href="#cb81-1310" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">3</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1311"><a href="#cb81-1311" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>)),</span>
<span id="cb81-1312"><a href="#cb81-1312" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb81-1313"><a href="#cb81-1313" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1314"><a href="#cb81-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1315"><a href="#cb81-1315" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">4</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1316"><a href="#cb81-1316" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">4</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1317"><a href="#cb81-1317" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb81-1318"><a href="#cb81-1318" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb81-1319"><a href="#cb81-1319" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1320"><a href="#cb81-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1321"><a href="#cb81-1321" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">5</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1322"><a href="#cb81-1322" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">5</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1323"><a href="#cb81-1323" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>)),</span>
<span id="cb81-1324"><a href="#cb81-1324" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">7</span>)</span>
<span id="cb81-1325"><a href="#cb81-1325" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1326"><a href="#cb81-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1327"><a href="#cb81-1327" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">6</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1328"><a href="#cb81-1328" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">6</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1329"><a href="#cb81-1329" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">6</span>)),</span>
<span id="cb81-1330"><a href="#cb81-1330" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">4</span>)</span>
<span id="cb81-1331"><a href="#cb81-1331" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1332"><a href="#cb81-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1333"><a href="#cb81-1333" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">7</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1334"><a href="#cb81-1334" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">7</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1335"><a href="#cb81-1335" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">7</span>)),</span>
<span id="cb81-1336"><a href="#cb81-1336" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">1</span>)</span>
<span id="cb81-1337"><a href="#cb81-1337" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1338"><a href="#cb81-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1339"><a href="#cb81-1339" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">8</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1340"><a href="#cb81-1340" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">8</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1341"><a href="#cb81-1341" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> rank.full<span class="sc">$</span>Original,</span>
<span id="cb81-1342"><a href="#cb81-1342" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> rank.full<span class="sc">$</span>New</span>
<span id="cb81-1343"><a href="#cb81-1343" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1344"><a href="#cb81-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1345"><a href="#cb81-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1346"><a href="#cb81-1346" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">9</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1347"><a href="#cb81-1347" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">9</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1348"><a href="#cb81-1348" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>)),</span>
<span id="cb81-1349"><a href="#cb81-1349" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">8</span>)</span>
<span id="cb81-1350"><a href="#cb81-1350" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1351"><a href="#cb81-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1352"><a href="#cb81-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1353"><a href="#cb81-1353" aria-hidden="true" tabindex="-1"></a>alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">10</span>, <span class="st">"class"</span>] <span class="ot">&lt;-</span></span>
<span id="cb81-1354"><a href="#cb81-1354" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">mapvalues</span>(alluvial.df[alluvial.df[, <span class="st">"G"</span>] <span class="sc">==</span> <span class="dv">10</span>, <span class="st">"class"</span>],</span>
<span id="cb81-1355"><a href="#cb81-1355" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)),</span>
<span id="cb81-1356"><a href="#cb81-1356" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">8</span>)</span>
<span id="cb81-1357"><a href="#cb81-1357" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1358"><a href="#cb81-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1359"><a href="#cb81-1359" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb81-1360"><a href="#cb81-1360" aria-hidden="true" tabindex="-1"></a>  alluvial.df,</span>
<span id="cb81-1361"><a href="#cb81-1361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb81-1362"><a href="#cb81-1362" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> G,</span>
<span id="cb81-1363"><a href="#cb81-1363" aria-hidden="true" tabindex="-1"></a>    <span class="at">stratum =</span> class,</span>
<span id="cb81-1364"><a href="#cb81-1364" aria-hidden="true" tabindex="-1"></a>    <span class="at">alluvium =</span> ids,</span>
<span id="cb81-1365"><a href="#cb81-1365" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> class,</span>
<span id="cb81-1366"><a href="#cb81-1366" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> class</span>
<span id="cb81-1367"><a href="#cb81-1367" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1368"><a href="#cb81-1368" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb81-1369"><a href="#cb81-1369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-1370"><a href="#cb81-1370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_flow</span>() <span class="sc">+</span></span>
<span id="cb81-1371"><a href="#cb81-1371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stratum</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb81-1372"><a href="#cb81-1372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"stratum"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-1373"><a href="#cb81-1373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-1374"><a href="#cb81-1374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb81-1375"><a href="#cb81-1375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(viridis<span class="sc">::</span><span class="fu">inferno</span>(<span class="dv">8</span>), <span class="st">"#F2F3C9"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb81-1376"><a href="#cb81-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Assumed number of clusters"</span>) <span class="sc">+</span></span>
<span id="cb81-1377"><a href="#cb81-1377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency"</span>)</span>
<span id="cb81-1378"><a href="#cb81-1378" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span>
<span id="cb81-1379"><a href="#cb81-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1380"><a href="#cb81-1380" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>, <span class="st">""</span>)</span>
<span id="cb81-1381"><a href="#cb81-1381" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"paper/alluvial-FCAL-anchored.png"</span>,</span>
<span id="cb81-1382"><a href="#cb81-1382" aria-hidden="true" tabindex="-1"></a>  p,</span>
<span id="cb81-1383"><a href="#cb81-1383" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb81-1384"><a href="#cb81-1384" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fl">6.75</span>,</span>
<span id="cb81-1385"><a href="#cb81-1385" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb81-1386"><a href="#cb81-1386" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1387"><a href="#cb81-1387" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"paper/alluvial-FCAL-anchored.pdf"</span>,</span>
<span id="cb81-1388"><a href="#cb81-1388" aria-hidden="true" tabindex="-1"></a>  p,</span>
<span id="cb81-1389"><a href="#cb81-1389" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb81-1390"><a href="#cb81-1390" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fl">6.75</span>,</span>
<span id="cb81-1391"><a href="#cb81-1391" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb81-1392"><a href="#cb81-1392" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1393"><a href="#cb81-1393" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(p, <span class="fu">paste0</span>(prefix, <span class="st">"processed/plots/fc-alluvial.RDS"</span>))</span>
<span id="cb81-1394"><a href="#cb81-1394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1395"><a href="#cb81-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1396"><a href="#cb81-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1397"><a href="#cb81-1397" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fixed effects specified via Gaussian radial basis functions</span></span>
<span id="cb81-1398"><a href="#cb81-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1401"><a href="#cb81-1401" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1402"><a href="#cb81-1402" aria-hidden="true" tabindex="-1"></a>G.grbf <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb81-1403"><a href="#cb81-1403" aria-hidden="true" tabindex="-1"></a>models.grbf <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-1404"><a href="#cb81-1404" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (G.cand <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb81-1405"><a href="#cb81-1405" aria-hidden="true" tabindex="-1"></a>  file.name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prefix, <span class="st">"/cache/fcal/grbf/final/fcal-"</span>, G.cand, <span class="st">".RDS"</span>)</span>
<span id="cb81-1406"><a href="#cb81-1406" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(file.name)) {</span>
<span id="cb81-1407"><a href="#cb81-1407" aria-hidden="true" tabindex="-1"></a>    G.grbf <span class="ot">&lt;-</span> <span class="fu">c</span>(G.grbf, G.cand)</span>
<span id="cb81-1408"><a href="#cb81-1408" aria-hidden="true" tabindex="-1"></a>    models.grbf[[G.cand]] <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(file.name)</span>
<span id="cb81-1409"><a href="#cb81-1409" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-1410"><a href="#cb81-1410" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1411"><a href="#cb81-1411" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(G.cand)</span>
<span id="cb81-1412"><a href="#cb81-1412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1413"><a href="#cb81-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1414"><a href="#cb81-1414" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of Gaussian radial basis functions</span></span>
<span id="cb81-1415"><a href="#cb81-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1416"><a href="#cb81-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Two GRBFs </span></span>
<span id="cb81-1417"><a href="#cb81-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1420"><a href="#cb81-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1421"><a href="#cb81-1421" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-grbf-k-2</span></span>
<span id="cb81-1422"><a href="#cb81-1422" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cluster profiles for the six-cluster model assuming two knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves."</span></span>
<span id="cb81-1423"><a href="#cb81-1423" aria-hidden="true" tabindex="-1"></a>knots.grbf<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(prefix, <span class="st">"cache/fcal/grbf/k=2/grbf-1.2.RDS"</span>))</span>
<span id="cb81-1424"><a href="#cb81-1424" aria-hidden="true" tabindex="-1"></a>knots.grbf.<span class="fl">2.</span>list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-1425"><a href="#cb81-1425" aria-hidden="true" tabindex="-1"></a>knots.grbf.<span class="fl">2.</span>list[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> knots.grbf<span class="fl">.2</span></span>
<span id="cb81-1426"><a href="#cb81-1426" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"paper/grbf-plots-2.png"</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">res =</span> <span class="dv">300</span>)</span>
<span id="cb81-1427"><a href="#cb81-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-1428"><a href="#cb81-1428" aria-hidden="true" tabindex="-1"></a>  knots.grbf.<span class="fl">2.</span>list,</span>
<span id="cb81-1429"><a href="#cb81-1429" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-1430"><a href="#cb81-1430" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1431"><a href="#cb81-1431" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1432"><a href="#cb81-1432" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1433"><a href="#cb81-1433" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1434"><a href="#cb81-1434" aria-hidden="true" tabindex="-1"></a>  <span class="at">knot.type =</span> <span class="st">"equal"</span>,</span>
<span id="cb81-1435"><a href="#cb81-1435" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">2</span>,</span>
<span id="cb81-1436"><a href="#cb81-1436" aria-hidden="true" tabindex="-1"></a>  <span class="at">grbf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1437"><a href="#cb81-1437" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> <span class="fl">1.2</span>,</span>
<span id="cb81-1438"><a href="#cb81-1438" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-1439"><a href="#cb81-1439" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1440"><a href="#cb81-1440" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1441"><a href="#cb81-1441" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-1442"><a href="#cb81-1442" aria-hidden="true" tabindex="-1"></a>  knots.grbf.<span class="fl">2.</span>list,</span>
<span id="cb81-1443"><a href="#cb81-1443" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-1444"><a href="#cb81-1444" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1445"><a href="#cb81-1445" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1446"><a href="#cb81-1446" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1447"><a href="#cb81-1447" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1448"><a href="#cb81-1448" aria-hidden="true" tabindex="-1"></a>  <span class="at">knot.type =</span> <span class="st">"equal"</span>,</span>
<span id="cb81-1449"><a href="#cb81-1449" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">2</span>,</span>
<span id="cb81-1450"><a href="#cb81-1450" aria-hidden="true" tabindex="-1"></a>  <span class="at">grbf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1451"><a href="#cb81-1451" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> <span class="fl">1.2</span>,</span>
<span id="cb81-1452"><a href="#cb81-1452" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-1453"><a href="#cb81-1453" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1454"><a href="#cb81-1454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1455"><a href="#cb81-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1456"><a href="#cb81-1456" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Three GRBFs </span></span>
<span id="cb81-1457"><a href="#cb81-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1460"><a href="#cb81-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1461"><a href="#cb81-1461" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-grbf-spec-k-3</span></span>
<span id="cb81-1462"><a href="#cb81-1462" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Cluster profiles for the six-cluster model assuming three knots. The vertical teal lines indicate knot location. Mean cluster profiles are denoted by the red curves."</span></span>
<span id="cb81-1463"><a href="#cb81-1463" aria-hidden="true" tabindex="-1"></a>knots.grbf<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(prefix, <span class="st">"/cache/fcal/grbf/k=3/grbf-1.2.RDS"</span>))</span>
<span id="cb81-1464"><a href="#cb81-1464" aria-hidden="true" tabindex="-1"></a>knots.grbf.<span class="fl">3.</span>list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-1465"><a href="#cb81-1465" aria-hidden="true" tabindex="-1"></a>knots.grbf.<span class="fl">3.</span>list[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> knots.grbf<span class="fl">.3</span></span>
<span id="cb81-1466"><a href="#cb81-1466" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"paper/grbf-plots-3.png"</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">res =</span> <span class="dv">300</span>)</span>
<span id="cb81-1467"><a href="#cb81-1467" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-1468"><a href="#cb81-1468" aria-hidden="true" tabindex="-1"></a>  knots.grbf.<span class="fl">3.</span>list,</span>
<span id="cb81-1469"><a href="#cb81-1469" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-1470"><a href="#cb81-1470" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1471"><a href="#cb81-1471" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1472"><a href="#cb81-1472" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1473"><a href="#cb81-1473" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1474"><a href="#cb81-1474" aria-hidden="true" tabindex="-1"></a>  <span class="at">knot.type =</span> <span class="st">"equal"</span>,</span>
<span id="cb81-1475"><a href="#cb81-1475" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">3</span>,</span>
<span id="cb81-1476"><a href="#cb81-1476" aria-hidden="true" tabindex="-1"></a>  <span class="at">grbf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1477"><a href="#cb81-1477" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> <span class="fl">1.2</span>,</span>
<span id="cb81-1478"><a href="#cb81-1478" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-1479"><a href="#cb81-1479" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1480"><a href="#cb81-1480" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb81-1481"><a href="#cb81-1481" aria-hidden="true" tabindex="-1"></a><span class="fu">spaghettiPlot</span>(fcal,</span>
<span id="cb81-1482"><a href="#cb81-1482" aria-hidden="true" tabindex="-1"></a>  knots.grbf.<span class="fl">3.</span>list,</span>
<span id="cb81-1483"><a href="#cb81-1483" aria-hidden="true" tabindex="-1"></a>  <span class="at">G =</span> <span class="dv">6</span>,</span>
<span id="cb81-1484"><a href="#cb81-1484" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1485"><a href="#cb81-1485" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmax =</span> <span class="dv">7</span>,</span>
<span id="cb81-1486"><a href="#cb81-1486" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb81-1487"><a href="#cb81-1487" aria-hidden="true" tabindex="-1"></a>  <span class="at">knots =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1488"><a href="#cb81-1488" aria-hidden="true" tabindex="-1"></a>  <span class="at">knot.type =</span> <span class="st">"equal"</span>,</span>
<span id="cb81-1489"><a href="#cb81-1489" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.knots =</span> <span class="dv">3</span>,</span>
<span id="cb81-1490"><a href="#cb81-1490" aria-hidden="true" tabindex="-1"></a>  <span class="at">grbf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-1491"><a href="#cb81-1491" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> <span class="fl">1.2</span>,</span>
<span id="cb81-1492"><a href="#cb81-1492" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.time =</span> <span class="st">"calpro_time"</span></span>
<span id="cb81-1493"><a href="#cb81-1493" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1494"><a href="#cb81-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1495"><a href="#cb81-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1496"><a href="#cb81-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1497"><a href="#cb81-1497" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL alluvial}</span></span>
<span id="cb81-1498"><a href="#cb81-1498" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-grbf-alluvial</span></span>
<span id="cb81-1499"><a href="#cb81-1499" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Alluvial plot of cluster membership across G for FCAL</span></span>
<span id="cb81-1500"><a href="#cb81-1500" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df &lt;- matrix(nrow = 0, ncol = 3)</span></span>
<span id="cb81-1501"><a href="#cb81-1501" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(alluvial.df) &lt;- c("ids", "class", "G")</span></span>
<span id="cb81-1502"><a href="#cb81-1502" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.grbf) {</span></span>
<span id="cb81-1503"><a href="#cb81-1503" aria-hidden="true" tabindex="-1"></a><span class="in">  alluvial.df &lt;- rbind(alluvial.df, cbind(models.grbf[[G]]$pprob[, 1:2], G = G))</span></span>
<span id="cb81-1504"><a href="#cb81-1504" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-1505"><a href="#cb81-1505" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df &lt;- as.data.frame(alluvial.df)</span></span>
<span id="cb81-1506"><a href="#cb81-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1507"><a href="#cb81-1507" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df$ids &lt;- as.character(alluvial.df$ids)</span></span>
<span id="cb81-1508"><a href="#cb81-1508" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df$class &lt;- as.factor(alluvial.df$class)</span></span>
<span id="cb81-1509"><a href="#cb81-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1510"><a href="#cb81-1510" aria-hidden="true" tabindex="-1"></a><span class="in"># eliminate label switching</span></span>
<span id="cb81-1511"><a href="#cb81-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1512"><a href="#cb81-1512" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 3, "class"] &lt;-</span></span>
<span id="cb81-1513"><a href="#cb81-1513" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 3, "class"],</span></span>
<span id="cb81-1514"><a href="#cb81-1514" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 3)),</span></span>
<span id="cb81-1515"><a href="#cb81-1515" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(1, 3, 2)</span></span>
<span id="cb81-1516"><a href="#cb81-1516" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1517"><a href="#cb81-1517" aria-hidden="true" tabindex="-1"></a><span class="in">#</span></span>
<span id="cb81-1518"><a href="#cb81-1518" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 4, "class"] &lt;-</span></span>
<span id="cb81-1519"><a href="#cb81-1519" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 4, "class"],</span></span>
<span id="cb81-1520"><a href="#cb81-1520" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 4)),</span></span>
<span id="cb81-1521"><a href="#cb81-1521" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(3, 2, 1, 4)</span></span>
<span id="cb81-1522"><a href="#cb81-1522" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1523"><a href="#cb81-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1524"><a href="#cb81-1524" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 5, "class"] &lt;-</span></span>
<span id="cb81-1525"><a href="#cb81-1525" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 5, "class"],</span></span>
<span id="cb81-1526"><a href="#cb81-1526" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 5)),</span></span>
<span id="cb81-1527"><a href="#cb81-1527" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(2, 4, 5, 1, 3)</span></span>
<span id="cb81-1528"><a href="#cb81-1528" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1529"><a href="#cb81-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1530"><a href="#cb81-1530" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 6, "class"] &lt;-</span></span>
<span id="cb81-1531"><a href="#cb81-1531" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 6, "class"],</span></span>
<span id="cb81-1532"><a href="#cb81-1532" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 6)),</span></span>
<span id="cb81-1533"><a href="#cb81-1533" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(5, 3, 2, 4, 1, 6)</span></span>
<span id="cb81-1534"><a href="#cb81-1534" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1535"><a href="#cb81-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1536"><a href="#cb81-1536" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 7, "class"] &lt;-</span></span>
<span id="cb81-1537"><a href="#cb81-1537" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 7, "class"],</span></span>
<span id="cb81-1538"><a href="#cb81-1538" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 7)),</span></span>
<span id="cb81-1539"><a href="#cb81-1539" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(5, 1, 4, 7, 3, 6, 2)</span></span>
<span id="cb81-1540"><a href="#cb81-1540" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1541"><a href="#cb81-1541" aria-hidden="true" tabindex="-1"></a><span class="in">#</span></span>
<span id="cb81-1542"><a href="#cb81-1542" aria-hidden="true" tabindex="-1"></a><span class="in">alluvial.df[alluvial.df[, "G"] == 8, "class"] &lt;-</span></span>
<span id="cb81-1543"><a href="#cb81-1543" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(alluvial.df[alluvial.df[, "G"] == 8, "class"],</span></span>
<span id="cb81-1544"><a href="#cb81-1544" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(seq(1, 8)),</span></span>
<span id="cb81-1545"><a href="#cb81-1545" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(6, 2, 4, 5, 1, 3, 7, 8)</span></span>
<span id="cb81-1546"><a href="#cb81-1546" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1547"><a href="#cb81-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1548"><a href="#cb81-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1549"><a href="#cb81-1549" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- ggplot(</span></span>
<span id="cb81-1550"><a href="#cb81-1550" aria-hidden="true" tabindex="-1"></a><span class="in">  alluvial.df,</span></span>
<span id="cb81-1551"><a href="#cb81-1551" aria-hidden="true" tabindex="-1"></a><span class="in">  aes(</span></span>
<span id="cb81-1552"><a href="#cb81-1552" aria-hidden="true" tabindex="-1"></a><span class="in">    x = G,</span></span>
<span id="cb81-1553"><a href="#cb81-1553" aria-hidden="true" tabindex="-1"></a><span class="in">    stratum = class,</span></span>
<span id="cb81-1554"><a href="#cb81-1554" aria-hidden="true" tabindex="-1"></a><span class="in">    alluvium = ids,</span></span>
<span id="cb81-1555"><a href="#cb81-1555" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = class,</span></span>
<span id="cb81-1556"><a href="#cb81-1556" aria-hidden="true" tabindex="-1"></a><span class="in">    label = class</span></span>
<span id="cb81-1557"><a href="#cb81-1557" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1558"><a href="#cb81-1558" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb81-1559"><a href="#cb81-1559" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_discrete(expand = c(.1, .1)) +</span></span>
<span id="cb81-1560"><a href="#cb81-1560" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_flow() +</span></span>
<span id="cb81-1561"><a href="#cb81-1561" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_stratum(alpha = 0.5) +</span></span>
<span id="cb81-1562"><a href="#cb81-1562" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(stat = "stratum", size = 3) +</span></span>
<span id="cb81-1563"><a href="#cb81-1563" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb81-1564"><a href="#cb81-1564" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb81-1565"><a href="#cb81-1565" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = rainbow(8)) +</span></span>
<span id="cb81-1566"><a href="#cb81-1566" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Assumed number of clusters") +</span></span>
<span id="cb81-1567"><a href="#cb81-1567" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency")</span></span>
<span id="cb81-1568"><a href="#cb81-1568" aria-hidden="true" tabindex="-1"></a><span class="in">print(p)</span></span>
<span id="cb81-1569"><a href="#cb81-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1570"><a href="#cb81-1570" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- p + ggtitle("", "")</span></span>
<span id="cb81-1571"><a href="#cb81-1571" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("paper/alluvial-FCAL-grbf.png",</span></span>
<span id="cb81-1572"><a href="#cb81-1572" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-1573"><a href="#cb81-1573" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 12,</span></span>
<span id="cb81-1574"><a href="#cb81-1574" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 6.75,</span></span>
<span id="cb81-1575"><a href="#cb81-1575" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-1576"><a href="#cb81-1576" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-1577"><a href="#cb81-1577" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("paper/alluvial-FCAL-grbf.pdf",</span></span>
<span id="cb81-1578"><a href="#cb81-1578" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-1579"><a href="#cb81-1579" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 12,</span></span>
<span id="cb81-1580"><a href="#cb81-1580" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 6.75,</span></span>
<span id="cb81-1581"><a href="#cb81-1581" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-1582"><a href="#cb81-1582" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-1583"><a href="#cb81-1583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1584"><a href="#cb81-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1587"><a href="#cb81-1587" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1588"><a href="#cb81-1588" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: "hold"</span></span>
<span id="cb81-1589"><a href="#cb81-1589" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-knot-stats-grbf</span></span>
<span id="cb81-1590"><a href="#cb81-1590" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Model statistics for differing numbers of knots for natural cubic splines</span></span>
<span id="cb81-1591"><a href="#cb81-1591" aria-hidden="true" tabindex="-1"></a>knots.df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb81-1592"><a href="#cb81-1592" aria-hidden="true" tabindex="-1"></a>  <span class="at">Knots =</span> <span class="fu">c</span>(<span class="st">"2 GRBFs"</span>, <span class="st">"3 GRBFs"</span>),</span>
<span id="cb81-1593"><a href="#cb81-1593" aria-hidden="true" tabindex="-1"></a>  <span class="at">loglik =</span> <span class="fu">c</span>(</span>
<span id="cb81-1594"><a href="#cb81-1594" aria-hidden="true" tabindex="-1"></a>    knots.grbf<span class="fl">.2</span><span class="sc">$</span>loglik,</span>
<span id="cb81-1595"><a href="#cb81-1595" aria-hidden="true" tabindex="-1"></a>    knots.grbf<span class="fl">.3</span><span class="sc">$</span>loglik</span>
<span id="cb81-1596"><a href="#cb81-1596" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb81-1597"><a href="#cb81-1597" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(</span>
<span id="cb81-1598"><a href="#cb81-1598" aria-hidden="true" tabindex="-1"></a>    knots.grbf<span class="fl">.2</span><span class="sc">$</span>AIC,</span>
<span id="cb81-1599"><a href="#cb81-1599" aria-hidden="true" tabindex="-1"></a>    knots.grbf<span class="fl">.3</span><span class="sc">$</span>AIC</span>
<span id="cb81-1600"><a href="#cb81-1600" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb81-1601"><a href="#cb81-1601" aria-hidden="true" tabindex="-1"></a>  <span class="at">BIC =</span> <span class="fu">c</span>(</span>
<span id="cb81-1602"><a href="#cb81-1602" aria-hidden="true" tabindex="-1"></a>    knots.grbf<span class="fl">.2</span><span class="sc">$</span>BIC,</span>
<span id="cb81-1603"><a href="#cb81-1603" aria-hidden="true" tabindex="-1"></a>    knots.grbf<span class="fl">.3</span><span class="sc">$</span>BIC</span>
<span id="cb81-1604"><a href="#cb81-1604" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1605"><a href="#cb81-1605" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1606"><a href="#cb81-1606" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(knots.df,</span>
<span id="cb81-1607"><a href="#cb81-1607" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb81-1608"><a href="#cb81-1608" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Knots"</span>,</span>
<span id="cb81-1609"><a href="#cb81-1609" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Maxmum log likelihood"</span>,</span>
<span id="cb81-1610"><a href="#cb81-1610" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AIC"</span>,</span>
<span id="cb81-1611"><a href="#cb81-1611" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BIC"</span></span>
<span id="cb81-1612"><a href="#cb81-1612" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1613"><a href="#cb81-1613" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1614"><a href="#cb81-1614" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(</span>
<span id="cb81-1615"><a href="#cb81-1615" aria-hidden="true" tabindex="-1"></a>  knots.grbf.<span class="fl">2.</span>list,</span>
<span id="cb81-1616"><a href="#cb81-1616" aria-hidden="true" tabindex="-1"></a>  knots.grbf.<span class="fl">3.</span>list</span>
<span id="cb81-1617"><a href="#cb81-1617" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1618"><a href="#cb81-1618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1619"><a href="#cb81-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1620"><a href="#cb81-1620" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of clusters</span></span>
<span id="cb81-1621"><a href="#cb81-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1622"><a href="#cb81-1622" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Posterior classifications</span></span>
<span id="cb81-1623"><a href="#cb81-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1624"><a href="#cb81-1624" aria-hidden="true" tabindex="-1"></a>From the below data, we can see how posterior probabilities change as the number</span>
<span id="cb81-1625"><a href="#cb81-1625" aria-hidden="true" tabindex="-1"></a>of assumed clusters increase</span>
<span id="cb81-1626"><a href="#cb81-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1627"><a href="#cb81-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1628"><a href="#cb81-1628" aria-hidden="true" tabindex="-1"></a>:::{.column-page}</span>
<span id="cb81-1629"><a href="#cb81-1629" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb81-1630"><a href="#cb81-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1631"><a href="#cb81-1631" aria-hidden="true" tabindex="-1"></a><span class="in">```{R grbf postpro}</span></span>
<span id="cb81-1632"><a href="#cb81-1632" aria-hidden="true" tabindex="-1"></a><span class="in">#| results: "asis"</span></span>
<span id="cb81-1633"><a href="#cb81-1633" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.grbf) {</span></span>
<span id="cb81-1634"><a href="#cb81-1634" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(paste0("##### G = ", G, "\n"))</span></span>
<span id="cb81-1635"><a href="#cb81-1635" aria-hidden="true" tabindex="-1"></a><span class="in">  output &lt;- postprob_quiet(models.grbf[[G]])$result</span></span>
<span id="cb81-1636"><a href="#cb81-1636" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(pander::pander(output[[1]]))</span></span>
<span id="cb81-1637"><a href="#cb81-1637" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(pander::pander(output[[2]]))</span></span>
<span id="cb81-1638"><a href="#cb81-1638" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(pander::pander(output[[3]]))</span></span>
<span id="cb81-1639"><a href="#cb81-1639" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-1640"><a href="#cb81-1640" aria-hidden="true" tabindex="-1"></a><span class="in">rm(output)</span></span>
<span id="cb81-1641"><a href="#cb81-1641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1642"><a href="#cb81-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1643"><a href="#cb81-1643" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1644"><a href="#cb81-1644" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1645"><a href="#cb81-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1646"><a href="#cb81-1646" aria-hidden="true" tabindex="-1"></a><span class="in">```{R PProb distributions GRBF}</span></span>
<span id="cb81-1647"><a href="#cb81-1647" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 8</span></span>
<span id="cb81-1648"><a href="#cb81-1648" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 4.5</span></span>
<span id="cb81-1649"><a href="#cb81-1649" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.2 &lt;- c()</span></span>
<span id="cb81-1650"><a href="#cb81-1650" aria-hidden="true" tabindex="-1"></a><span class="in">groups.2 &lt;- models.grbf[[2]]</span></span>
<span id="cb81-1651"><a href="#cb81-1651" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.3 &lt;- c()</span></span>
<span id="cb81-1652"><a href="#cb81-1652" aria-hidden="true" tabindex="-1"></a><span class="in">groups.3 &lt;- models.grbf[[3]]</span></span>
<span id="cb81-1653"><a href="#cb81-1653" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.4 &lt;- c()</span></span>
<span id="cb81-1654"><a href="#cb81-1654" aria-hidden="true" tabindex="-1"></a><span class="in">groups.4 &lt;- models.grbf[[4]]</span></span>
<span id="cb81-1655"><a href="#cb81-1655" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.5 &lt;- c()</span></span>
<span id="cb81-1656"><a href="#cb81-1656" aria-hidden="true" tabindex="-1"></a><span class="in">groups.5 &lt;- models.grbf[[5]]</span></span>
<span id="cb81-1657"><a href="#cb81-1657" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.6 &lt;- c()</span></span>
<span id="cb81-1658"><a href="#cb81-1658" aria-hidden="true" tabindex="-1"></a><span class="in">groups.6 &lt;- models.grbf[[6]]</span></span>
<span id="cb81-1659"><a href="#cb81-1659" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.7 &lt;- c()</span></span>
<span id="cb81-1660"><a href="#cb81-1660" aria-hidden="true" tabindex="-1"></a><span class="in">groups.7 &lt;- models.grbf[[7]]</span></span>
<span id="cb81-1661"><a href="#cb81-1661" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.8 &lt;- c()</span></span>
<span id="cb81-1662"><a href="#cb81-1662" aria-hidden="true" tabindex="-1"></a><span class="in">groups.8 &lt;- models.grbf[[8]]</span></span>
<span id="cb81-1663"><a href="#cb81-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1664"><a href="#cb81-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1665"><a href="#cb81-1665" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nrow(models.grbf[[2]]$pprob)) {</span></span>
<span id="cb81-1666"><a href="#cb81-1666" aria-hidden="true" tabindex="-1"></a><span class="in">  class.2 &lt;- groups.2$pprob[i, 2]</span></span>
<span id="cb81-1667"><a href="#cb81-1667" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.2 &lt;- c(pprobs.2, groups.2$pprob[i, class.2 + 2])</span></span>
<span id="cb81-1668"><a href="#cb81-1668" aria-hidden="true" tabindex="-1"></a><span class="in">  class.3 &lt;- groups.3$pprob[i, 2]</span></span>
<span id="cb81-1669"><a href="#cb81-1669" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.3 &lt;- c(pprobs.3, groups.3$pprob[i, class.3 + 2])</span></span>
<span id="cb81-1670"><a href="#cb81-1670" aria-hidden="true" tabindex="-1"></a><span class="in">  class.4 &lt;- groups.4$pprob[i, 2]</span></span>
<span id="cb81-1671"><a href="#cb81-1671" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.4 &lt;- c(pprobs.4, groups.4$pprob[i, class.4 + 2])</span></span>
<span id="cb81-1672"><a href="#cb81-1672" aria-hidden="true" tabindex="-1"></a><span class="in">  class.5 &lt;- groups.5$pprob[i, 2]</span></span>
<span id="cb81-1673"><a href="#cb81-1673" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.5 &lt;- c(pprobs.5, groups.5$pprob[i, class.5 + 2])</span></span>
<span id="cb81-1674"><a href="#cb81-1674" aria-hidden="true" tabindex="-1"></a><span class="in">  class.6 &lt;- groups.6$pprob[i, 2]</span></span>
<span id="cb81-1675"><a href="#cb81-1675" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.6 &lt;- c(pprobs.6, groups.6$pprob[i, class.6 + 2])</span></span>
<span id="cb81-1676"><a href="#cb81-1676" aria-hidden="true" tabindex="-1"></a><span class="in">  class.7 &lt;- groups.7$pprob[i, 2]</span></span>
<span id="cb81-1677"><a href="#cb81-1677" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.7 &lt;- c(pprobs.7, groups.7$pprob[i, class.7 + 2])</span></span>
<span id="cb81-1678"><a href="#cb81-1678" aria-hidden="true" tabindex="-1"></a><span class="in">  class.8 &lt;- groups.8$pprob[i, 2]</span></span>
<span id="cb81-1679"><a href="#cb81-1679" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.8 &lt;- c(pprobs.8, groups.8$pprob[i, class.8 + 2])</span></span>
<span id="cb81-1680"><a href="#cb81-1680" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-1681"><a href="#cb81-1681" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.2 &lt;- tibble(prob = pprobs.2)</span></span>
<span id="cb81-1682"><a href="#cb81-1682" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.3 &lt;- tibble(prob = pprobs.3)</span></span>
<span id="cb81-1683"><a href="#cb81-1683" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.4 &lt;- tibble(prob = pprobs.4)</span></span>
<span id="cb81-1684"><a href="#cb81-1684" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.5 &lt;- tibble(prob = pprobs.5)</span></span>
<span id="cb81-1685"><a href="#cb81-1685" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.6 &lt;- tibble(prob = pprobs.6)</span></span>
<span id="cb81-1686"><a href="#cb81-1686" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.7 &lt;- tibble(prob = pprobs.7)</span></span>
<span id="cb81-1687"><a href="#cb81-1687" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.8 &lt;- tibble(prob = pprobs.8)</span></span>
<span id="cb81-1688"><a href="#cb81-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1689"><a href="#cb81-1689" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.2$Model &lt;- as.factor(rep("Two clusters", nrow(pprobs.2)))</span></span>
<span id="cb81-1690"><a href="#cb81-1690" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.3$Model &lt;- as.factor(rep("Three clusters", nrow(pprobs.3)))</span></span>
<span id="cb81-1691"><a href="#cb81-1691" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.4$Model &lt;- as.factor(rep("Four clusters", nrow(pprobs.4)))</span></span>
<span id="cb81-1692"><a href="#cb81-1692" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.5$Model &lt;- as.factor(rep("Five clusters", nrow(pprobs.5)))</span></span>
<span id="cb81-1693"><a href="#cb81-1693" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.6$Model &lt;- as.factor(rep("Six clusters", nrow(pprobs.6)))</span></span>
<span id="cb81-1694"><a href="#cb81-1694" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.7$Model &lt;- as.factor(rep("Seven clusters", nrow(pprobs.7)))</span></span>
<span id="cb81-1695"><a href="#cb81-1695" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs.8$Model &lt;- as.factor(rep("Eight clusters", nrow(pprobs.8)))</span></span>
<span id="cb81-1696"><a href="#cb81-1696" aria-hidden="true" tabindex="-1"></a><span class="in">pprobs &lt;- rbind(</span></span>
<span id="cb81-1697"><a href="#cb81-1697" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.2,</span></span>
<span id="cb81-1698"><a href="#cb81-1698" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.3,</span></span>
<span id="cb81-1699"><a href="#cb81-1699" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.4,</span></span>
<span id="cb81-1700"><a href="#cb81-1700" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.5,</span></span>
<span id="cb81-1701"><a href="#cb81-1701" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.6,</span></span>
<span id="cb81-1702"><a href="#cb81-1702" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.7,</span></span>
<span id="cb81-1703"><a href="#cb81-1703" aria-hidden="true" tabindex="-1"></a><span class="in">  pprobs.8</span></span>
<span id="cb81-1704"><a href="#cb81-1704" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-1705"><a href="#cb81-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1706"><a href="#cb81-1706" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- pprobs %&gt;%</span></span>
<span id="cb81-1707"><a href="#cb81-1707" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = prob, y = Model)) +</span></span>
<span id="cb81-1708"><a href="#cb81-1708" aria-hidden="true" tabindex="-1"></a><span class="in">  # geom_histogram(bins = 40, fill = NA, position="identity")</span></span>
<span id="cb81-1709"><a href="#cb81-1709" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_slab(</span></span>
<span id="cb81-1710"><a href="#cb81-1710" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#5D5179", color = "gray",</span></span>
<span id="cb81-1711"><a href="#cb81-1711" aria-hidden="true" tabindex="-1"></a><span class="in">    size = 0.8,</span></span>
<span id="cb81-1712"><a href="#cb81-1712" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.7</span></span>
<span id="cb81-1713"><a href="#cb81-1713" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb81-1714"><a href="#cb81-1714" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dots(color = "#4F759B", dotsize = 1) +</span></span>
<span id="cb81-1715"><a href="#cb81-1715" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Posterior probability for cluster membership") +</span></span>
<span id="cb81-1716"><a href="#cb81-1716" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("") +</span></span>
<span id="cb81-1717"><a href="#cb81-1717" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle(</span></span>
<span id="cb81-1718"><a href="#cb81-1718" aria-hidden="true" tabindex="-1"></a><span class="in">    "Distribution of Posterior Probabilities Across Models",</span></span>
<span id="cb81-1719"><a href="#cb81-1719" aria-hidden="true" tabindex="-1"></a><span class="in">    "Subject-specific posterior probabilities for assigned cluster"</span></span>
<span id="cb81-1720"><a href="#cb81-1720" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb81-1721"><a href="#cb81-1721" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb81-1722"><a href="#cb81-1722" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(limits = rev)</span></span>
<span id="cb81-1723"><a href="#cb81-1723" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("plots/pprob-distribution-grbf.png",</span></span>
<span id="cb81-1724"><a href="#cb81-1724" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-1725"><a href="#cb81-1725" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 8.5,</span></span>
<span id="cb81-1726"><a href="#cb81-1726" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 7.5,</span></span>
<span id="cb81-1727"><a href="#cb81-1727" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-1728"><a href="#cb81-1728" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-1729"><a href="#cb81-1729" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("plots/pprob-distribution-grbf.pdf",</span></span>
<span id="cb81-1730"><a href="#cb81-1730" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb81-1731"><a href="#cb81-1731" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 8.5,</span></span>
<span id="cb81-1732"><a href="#cb81-1732" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 7.5,</span></span>
<span id="cb81-1733"><a href="#cb81-1733" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-1734"><a href="#cb81-1734" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-1735"><a href="#cb81-1735" aria-hidden="true" tabindex="-1"></a><span class="in">print(p)</span></span>
<span id="cb81-1736"><a href="#cb81-1736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1737"><a href="#cb81-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1738"><a href="#cb81-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1739"><a href="#cb81-1739" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residual plots</span></span>
<span id="cb81-1740"><a href="#cb81-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1741"><a href="#cb81-1741" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb81-1742"><a href="#cb81-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1743"><a href="#cb81-1743" aria-hidden="true" tabindex="-1"></a><span class="in">```{R GRBF residuals}</span></span>
<span id="cb81-1744"><a href="#cb81-1744" aria-hidden="true" tabindex="-1"></a><span class="in">#| results: "asis"</span></span>
<span id="cb81-1745"><a href="#cb81-1745" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.grbf) {</span></span>
<span id="cb81-1746"><a href="#cb81-1746" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(paste0("##### G = ", G, "\n"))</span></span>
<span id="cb81-1747"><a href="#cb81-1747" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(models.grbf[[G]], shades = TRUE)</span></span>
<span id="cb81-1748"><a href="#cb81-1748" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-1749"><a href="#cb81-1749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1750"><a href="#cb81-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1751"><a href="#cb81-1751" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1752"><a href="#cb81-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1753"><a href="#cb81-1753" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Chosen model</span></span>
<span id="cb81-1754"><a href="#cb81-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1755"><a href="#cb81-1755" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Assess FCAL NCS normality}</span></span>
<span id="cb81-1756"><a href="#cb81-1756" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-GRBF-norm</span></span>
<span id="cb81-1757"><a href="#cb81-1757" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Plots assessing normality for the distribution of residuals for the chosen GRBF model for FCAL. (A) Histrogram; (B) Q-Q plot."</span></span>
<span id="cb81-1758"><a href="#cb81-1758" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- data.frame(residuals = resid(models.grbf[[6]])) %&gt;%</span></span>
<span id="cb81-1759"><a href="#cb81-1759" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = residuals)) +</span></span>
<span id="cb81-1760"><a href="#cb81-1760" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(aes(y = after_stat(density)),</span></span>
<span id="cb81-1761"><a href="#cb81-1761" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#D8829D",</span></span>
<span id="cb81-1762"><a href="#cb81-1762" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "#AF6A80",</span></span>
<span id="cb81-1763"><a href="#cb81-1763" aria-hidden="true" tabindex="-1"></a><span class="in">    bins = 30</span></span>
<span id="cb81-1764"><a href="#cb81-1764" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb81-1765"><a href="#cb81-1765" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(color = "#023777", size = 1.2) +</span></span>
<span id="cb81-1766"><a href="#cb81-1766" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb81-1767"><a href="#cb81-1767" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.line = element_line(colour = "gray")) +</span></span>
<span id="cb81-1768"><a href="#cb81-1768" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Density") +</span></span>
<span id="cb81-1769"><a href="#cb81-1769" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Residuals") +</span></span>
<span id="cb81-1770"><a href="#cb81-1770" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("A")</span></span>
<span id="cb81-1771"><a href="#cb81-1771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1772"><a href="#cb81-1772" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- data.frame(residuals = resid(models.grbf[[6]])) %&gt;%</span></span>
<span id="cb81-1773"><a href="#cb81-1773" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(sample = residuals)) +</span></span>
<span id="cb81-1774"><a href="#cb81-1774" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_qq_band() +</span></span>
<span id="cb81-1775"><a href="#cb81-1775" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_qq_line(color = "#D8829D") +</span></span>
<span id="cb81-1776"><a href="#cb81-1776" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_qq_point(color = "#023777") +</span></span>
<span id="cb81-1777"><a href="#cb81-1777" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_classic() +</span></span>
<span id="cb81-1778"><a href="#cb81-1778" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.line = element_line(colour = "gray")) +</span></span>
<span id="cb81-1779"><a href="#cb81-1779" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Theoretical Quantiles") +</span></span>
<span id="cb81-1780"><a href="#cb81-1780" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Sample Quantiles") +</span></span>
<span id="cb81-1781"><a href="#cb81-1781" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("B")</span></span>
<span id="cb81-1782"><a href="#cb81-1782" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("paper/Residual-plot-fcal-grbf.pdf",</span></span>
<span id="cb81-1783"><a href="#cb81-1783" aria-hidden="true" tabindex="-1"></a><span class="in">  plot = p1 / p2,</span></span>
<span id="cb81-1784"><a href="#cb81-1784" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 8,</span></span>
<span id="cb81-1785"><a href="#cb81-1785" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 8,</span></span>
<span id="cb81-1786"><a href="#cb81-1786" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb81-1787"><a href="#cb81-1787" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-1788"><a href="#cb81-1788" aria-hidden="true" tabindex="-1"></a><span class="in">print(p1 / p2)</span></span>
<span id="cb81-1789"><a href="#cb81-1789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1790"><a href="#cb81-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1793"><a href="#cb81-1793" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1794"><a href="#cb81-1794" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-GRBF-norm-cluster</span></span>
<span id="cb81-1795"><a href="#cb81-1795" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Q-Q plots assessing normality for the distribution of residuals stratifed by cluster assignment."</span></span>
<span id="cb81-1796"><a href="#cb81-1796" aria-hidden="true" tabindex="-1"></a>predClass <span class="ot">&lt;-</span> models.grbf[[<span class="dv">6</span>]]<span class="sc">$</span>pprob[, <span class="fu">c</span>(<span class="st">"ids"</span>, <span class="st">"class"</span>)]</span>
<span id="cb81-1797"><a href="#cb81-1797" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">merge</span>(models.grbf[[<span class="dv">6</span>]]<span class="sc">$</span>pred, predClass, <span class="at">by =</span> <span class="st">"ids"</span>)</span>
<span id="cb81-1798"><a href="#cb81-1798" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>)</span>
<span id="cb81-1799"><a href="#cb81-1799" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-1800"><a href="#cb81-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1801"><a href="#cb81-1801" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb81-1802"><a href="#cb81-1802" aria-hidden="true" tabindex="-1"></a>  p[[i]] <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp, class <span class="sc">==</span> i) <span class="sc">%&gt;%</span></span>
<span id="cb81-1803"><a href="#cb81-1803" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> resid_ss)) <span class="sc">+</span></span>
<span id="cb81-1804"><a href="#cb81-1804" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_band</span>() <span class="sc">+</span></span>
<span id="cb81-1805"><a href="#cb81-1805" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"#D8829D"</span>) <span class="sc">+</span></span>
<span id="cb81-1806"><a href="#cb81-1806" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_point</span>(<span class="at">color =</span> <span class="st">"#023777"</span>) <span class="sc">+</span></span>
<span id="cb81-1807"><a href="#cb81-1807" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb81-1808"><a href="#cb81-1808" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray"</span>)) <span class="sc">+</span></span>
<span id="cb81-1809"><a href="#cb81-1809" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Theoretical Quantiles"</span>) <span class="sc">+</span></span>
<span id="cb81-1810"><a href="#cb81-1810" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Sample Quantiles"</span>) <span class="sc">+</span></span>
<span id="cb81-1811"><a href="#cb81-1811" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(labels[i])</span>
<span id="cb81-1812"><a href="#cb81-1812" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1813"><a href="#cb81-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1814"><a href="#cb81-1814" aria-hidden="true" tabindex="-1"></a>ArrangedPlot <span class="ot">&lt;-</span> (p[[<span class="dv">1</span>]] <span class="sc">+</span> p[[<span class="dv">2</span>]]) <span class="sc">/</span> (p[[<span class="dv">3</span>]] <span class="sc">+</span> p[[<span class="dv">4</span>]]) <span class="sc">/</span> (p[[<span class="dv">5</span>]] <span class="sc">+</span> p[[<span class="dv">6</span>]])</span>
<span id="cb81-1815"><a href="#cb81-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1816"><a href="#cb81-1816" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"paper/cluster-resids-grbf.pdf"</span>,</span>
<span id="cb81-1817"><a href="#cb81-1817" aria-hidden="true" tabindex="-1"></a>  ArrangedPlot,</span>
<span id="cb81-1818"><a href="#cb81-1818" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb81-1819"><a href="#cb81-1819" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb81-1820"><a href="#cb81-1820" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb81-1821"><a href="#cb81-1821" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1822"><a href="#cb81-1822" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ArrangedPlot)</span>
<span id="cb81-1823"><a href="#cb81-1823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1824"><a href="#cb81-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1825"><a href="#cb81-1825" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model metrics</span></span>
<span id="cb81-1826"><a href="#cb81-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1827"><a href="#cb81-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1828"><a href="#cb81-1828" aria-hidden="true" tabindex="-1"></a><span class="in">```{R GRBF metrics plot}</span></span>
<span id="cb81-1829"><a href="#cb81-1829" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-grbf-metrics</span></span>
<span id="cb81-1830"><a href="#cb81-1830" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Model metrics for FCAL for G = 2-8"</span></span>
<span id="cb81-1831"><a href="#cb81-1831" aria-hidden="true" tabindex="-1"></a><span class="in">summaryplot(models.grbf[[2]],</span></span>
<span id="cb81-1832"><a href="#cb81-1832" aria-hidden="true" tabindex="-1"></a><span class="in">  models.grbf[[3]],</span></span>
<span id="cb81-1833"><a href="#cb81-1833" aria-hidden="true" tabindex="-1"></a><span class="in">  models.grbf[[4]],</span></span>
<span id="cb81-1834"><a href="#cb81-1834" aria-hidden="true" tabindex="-1"></a><span class="in">  models.grbf[[5]],</span></span>
<span id="cb81-1835"><a href="#cb81-1835" aria-hidden="true" tabindex="-1"></a><span class="in">  models.grbf[[6]],</span></span>
<span id="cb81-1836"><a href="#cb81-1836" aria-hidden="true" tabindex="-1"></a><span class="in">  models.grbf[[7]],</span></span>
<span id="cb81-1837"><a href="#cb81-1837" aria-hidden="true" tabindex="-1"></a><span class="in">  #  models.grbf[[8]],</span></span>
<span id="cb81-1838"><a href="#cb81-1838" aria-hidden="true" tabindex="-1"></a><span class="in">  which = c("loglik", "AIC", "BIC", "entropy", "ICL"),</span></span>
<span id="cb81-1839"><a href="#cb81-1839" aria-hidden="true" tabindex="-1"></a><span class="in">  mfrow = c(2, 3),</span></span>
<span id="cb81-1840"><a href="#cb81-1840" aria-hidden="true" tabindex="-1"></a><span class="in">  axis = "Class"</span></span>
<span id="cb81-1841"><a href="#cb81-1841" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb81-1842"><a href="#cb81-1842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1843"><a href="#cb81-1843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1844"><a href="#cb81-1844" aria-hidden="true" tabindex="-1"></a><span class="in">```{R grbf metrics table}</span></span>
<span id="cb81-1845"><a href="#cb81-1845" aria-hidden="true" tabindex="-1"></a><span class="in">grbf.metrics &lt;- makeMetrics(G.grbf, models.grbf)</span></span>
<span id="cb81-1846"><a href="#cb81-1846" aria-hidden="true" tabindex="-1"></a><span class="in">buildDT(grbf.metrics)</span></span>
<span id="cb81-1847"><a href="#cb81-1847" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1848"><a href="#cb81-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1849"><a href="#cb81-1849" aria-hidden="true" tabindex="-1"></a>The optimum AIC is &lt;b&gt;</span>
<span id="cb81-1850"><a href="#cb81-1850" aria-hidden="true" tabindex="-1"></a><span class="in">`r format(sort(grbf.metrics[, 2])[1], scientific = FALSE)`</span> &lt;/b&gt; with cluster</span>
<span id="cb81-1851"><a href="#cb81-1851" aria-hidden="true" tabindex="-1"></a><span class="in">`r order(grbf.metrics[,2])[1] + 3`</span>. The optimum BIC is</span>
<span id="cb81-1852"><a href="#cb81-1852" aria-hidden="true" tabindex="-1"></a>&lt;b&gt;<span class="in">`r format(sort(grbf.metrics[, 3])[1], scientific = FALSE)`</span> &lt;/b&gt; with cluster</span>
<span id="cb81-1853"><a href="#cb81-1853" aria-hidden="true" tabindex="-1"></a><span class="in">`r order(grbf.metrics[, 3])[1] + 3`</span></span>
<span id="cb81-1854"><a href="#cb81-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1855"><a href="#cb81-1855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1856"><a href="#cb81-1856" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Spaghetti plots per cluster</span></span>
<span id="cb81-1857"><a href="#cb81-1857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1858"><a href="#cb81-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1859"><a href="#cb81-1859" aria-hidden="true" tabindex="-1"></a><span class="in">```{R grbf spaghetti plots}</span></span>
<span id="cb81-1860"><a href="#cb81-1860" aria-hidden="true" tabindex="-1"></a><span class="in">for (G in G.grbf) {</span></span>
<span id="cb81-1861"><a href="#cb81-1861" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(paste0("##### G = ", G, "\n\n"))</span></span>
<span id="cb81-1862"><a href="#cb81-1862" aria-hidden="true" tabindex="-1"></a><span class="in">  cat("###### Log-scale, all subjects \n\n")</span></span>
<span id="cb81-1863"><a href="#cb81-1863" aria-hidden="true" tabindex="-1"></a><span class="in">  grid::grid.newpage()</span></span>
<span id="cb81-1864"><a href="#cb81-1864" aria-hidden="true" tabindex="-1"></a><span class="in">  spaghettiPlot(fcal,</span></span>
<span id="cb81-1865"><a href="#cb81-1865" aria-hidden="true" tabindex="-1"></a><span class="in">    models.grbf,</span></span>
<span id="cb81-1866"><a href="#cb81-1866" aria-hidden="true" tabindex="-1"></a><span class="in">    G = G,</span></span>
<span id="cb81-1867"><a href="#cb81-1867" aria-hidden="true" tabindex="-1"></a><span class="in">    log = TRUE,</span></span>
<span id="cb81-1868"><a href="#cb81-1868" aria-hidden="true" tabindex="-1"></a><span class="in">    tmax = 7,</span></span>
<span id="cb81-1869"><a href="#cb81-1869" aria-hidden="true" tabindex="-1"></a><span class="in">    sizes = TRUE,</span></span>
<span id="cb81-1870"><a href="#cb81-1870" aria-hidden="true" tabindex="-1"></a><span class="in">    knots = TRUE,</span></span>
<span id="cb81-1871"><a href="#cb81-1871" aria-hidden="true" tabindex="-1"></a><span class="in">    knot.type = "equal",</span></span>
<span id="cb81-1872"><a href="#cb81-1872" aria-hidden="true" tabindex="-1"></a><span class="in">    grbf = TRUE,</span></span>
<span id="cb81-1873"><a href="#cb81-1873" aria-hidden="true" tabindex="-1"></a><span class="in">    var.time = "calpro_time"</span></span>
<span id="cb81-1874"><a href="#cb81-1874" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1875"><a href="#cb81-1875" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb81-1876"><a href="#cb81-1876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1877"><a href="#cb81-1877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1878"><a href="#cb81-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1879"><a href="#cb81-1879" aria-hidden="true" tabindex="-1"></a><span class="fu">#### IBD Associations</span></span>
<span id="cb81-1880"><a href="#cb81-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1883"><a href="#cb81-1883" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1884"><a href="#cb81-1884" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb81-1885"><a href="#cb81-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1886"><a href="#cb81-1886" aria-hidden="true" tabindex="-1"></a>dict.grbf <span class="ot">&lt;-</span> <span class="fu">subset</span>(dict, ids <span class="sc">%in%</span> <span class="fu">unique</span>(fcal<span class="sc">$</span>ids))</span>
<span id="cb81-1887"><a href="#cb81-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1888"><a href="#cb81-1888" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> dict.grbf<span class="sc">$</span>ids) {</span>
<span id="cb81-1889"><a href="#cb81-1889" aria-hidden="true" tabindex="-1"></a>  cluster <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb81-1890"><a href="#cb81-1890" aria-hidden="true" tabindex="-1"></a>    cluster,</span>
<span id="cb81-1891"><a href="#cb81-1891" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(models.grbf[[<span class="dv">6</span>]]<span class="sc">$</span>pprob, ids <span class="sc">==</span> id)<span class="sc">$</span>class</span>
<span id="cb81-1892"><a href="#cb81-1892" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1893"><a href="#cb81-1893" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1894"><a href="#cb81-1894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1895"><a href="#cb81-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1896"><a href="#cb81-1896" aria-hidden="true" tabindex="-1"></a>dict.grbf<span class="sc">$</span>diagnosis <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dict.grbf<span class="sc">$</span>diagnosis)</span>
<span id="cb81-1897"><a href="#cb81-1897" aria-hidden="true" tabindex="-1"></a>dict.grbf<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(cluster)</span>
<span id="cb81-1898"><a href="#cb81-1898" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cluster)</span>
<span id="cb81-1899"><a href="#cb81-1899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1900"><a href="#cb81-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1901"><a href="#cb81-1901" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb81-1902"><a href="#cb81-1902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1903"><a href="#cb81-1903" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Population</span></span>
<span id="cb81-1904"><a href="#cb81-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1907"><a href="#cb81-1907" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1908"><a href="#cb81-1908" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_cat</span>(<span class="st">"diagnosis"</span>, dict.grbf)</span>
<span id="cb81-1909"><a href="#cb81-1909" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1910"><a href="#cb81-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1911"><a href="#cb81-1911" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Cluster = 1</span></span>
<span id="cb81-1912"><a href="#cb81-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1915"><a href="#cb81-1915" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1916"><a href="#cb81-1916" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_cat</span>(<span class="st">"diagnosis"</span>, <span class="fu">subset</span>(dict.grbf, cluster <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb81-1917"><a href="#cb81-1917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1918"><a href="#cb81-1918" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Cluster = 2</span></span>
<span id="cb81-1919"><a href="#cb81-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1922"><a href="#cb81-1922" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1923"><a href="#cb81-1923" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_cat</span>(<span class="st">"diagnosis"</span>, <span class="fu">subset</span>(dict.grbf, cluster <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb81-1924"><a href="#cb81-1924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1925"><a href="#cb81-1925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1926"><a href="#cb81-1926" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Cluster = 3</span></span>
<span id="cb81-1927"><a href="#cb81-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1930"><a href="#cb81-1930" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1931"><a href="#cb81-1931" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_cat</span>(<span class="st">"diagnosis"</span>, <span class="fu">subset</span>(dict.grbf, cluster <span class="sc">==</span> <span class="dv">3</span>))</span>
<span id="cb81-1932"><a href="#cb81-1932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1933"><a href="#cb81-1933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1934"><a href="#cb81-1934" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Cluster = 4</span></span>
<span id="cb81-1935"><a href="#cb81-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1938"><a href="#cb81-1938" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1939"><a href="#cb81-1939" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_cat</span>(<span class="st">"diagnosis"</span>, <span class="fu">subset</span>(dict.grbf, cluster <span class="sc">==</span> <span class="dv">4</span>))</span>
<span id="cb81-1940"><a href="#cb81-1940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1941"><a href="#cb81-1941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1942"><a href="#cb81-1942" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Cluster = 5</span></span>
<span id="cb81-1943"><a href="#cb81-1943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1946"><a href="#cb81-1946" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1947"><a href="#cb81-1947" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_cat</span>(<span class="st">"diagnosis"</span>, <span class="fu">subset</span>(dict.grbf, cluster <span class="sc">==</span> <span class="dv">5</span>))</span>
<span id="cb81-1948"><a href="#cb81-1948" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1949"><a href="#cb81-1949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1950"><a href="#cb81-1950" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Cluster = 6</span></span>
<span id="cb81-1951"><a href="#cb81-1951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1954"><a href="#cb81-1954" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1955"><a href="#cb81-1955" aria-hidden="true" tabindex="-1"></a><span class="fu">describe_cat</span>(<span class="st">"diagnosis"</span>, <span class="fu">subset</span>(dict.grbf, cluster <span class="sc">==</span> <span class="dv">6</span>))</span>
<span id="cb81-1956"><a href="#cb81-1956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1957"><a href="#cb81-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1958"><a href="#cb81-1958" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-1959"><a href="#cb81-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1960"><a href="#cb81-1960" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Fisher’s exact test</span></span>
<span id="cb81-1961"><a href="#cb81-1961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1964"><a href="#cb81-1964" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1965"><a href="#cb81-1965" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(dict.grbf<span class="sc">$</span>diagnosis,</span>
<span id="cb81-1966"><a href="#cb81-1966" aria-hidden="true" tabindex="-1"></a>  dict.grbf<span class="sc">$</span>cluster,</span>
<span id="cb81-1967"><a href="#cb81-1967" aria-hidden="true" tabindex="-1"></a>  <span class="at">simulate.p.value =</span> <span class="cn">TRUE</span>, <span class="co"># calculate p-values using Monte Carlo</span></span>
<span id="cb81-1968"><a href="#cb81-1968" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fl">1e5</span></span>
<span id="cb81-1969"><a href="#cb81-1969" aria-hidden="true" tabindex="-1"></a>) <span class="co"># replicates for Monte Carlo test</span></span>
<span id="cb81-1970"><a href="#cb81-1970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1971"><a href="#cb81-1971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1972"><a href="#cb81-1972" aria-hidden="true" tabindex="-1"></a><span class="fu">## NCS vs GRBF comparison</span></span>
<span id="cb81-1973"><a href="#cb81-1973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1976"><a href="#cb81-1976" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb81-1977"><a href="#cb81-1977" aria-hidden="true" tabindex="-1"></a>pred.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-1978"><a href="#cb81-1978" aria-hidden="true" tabindex="-1"></a>  <span class="at">calpro_time =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb81-1979"><a href="#cb81-1979" aria-hidden="true" tabindex="-1"></a>  <span class="at">diagnosis =</span> <span class="st">"Crohn's Disease"</span></span>
<span id="cb81-1980"><a href="#cb81-1980" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1981"><a href="#cb81-1981" aria-hidden="true" tabindex="-1"></a>pred.df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb81-1982"><a href="#cb81-1982" aria-hidden="true" tabindex="-1"></a>  pred.df,</span>
<span id="cb81-1983"><a href="#cb81-1983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb81-1984"><a href="#cb81-1984" aria-hidden="true" tabindex="-1"></a>    <span class="at">calpro_time =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb81-1985"><a href="#cb81-1985" aria-hidden="true" tabindex="-1"></a>    <span class="at">diagnosis =</span> <span class="st">"Ulcerative colitis"</span></span>
<span id="cb81-1986"><a href="#cb81-1986" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1987"><a href="#cb81-1987" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1988"><a href="#cb81-1988" aria-hidden="true" tabindex="-1"></a>pred.df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb81-1989"><a href="#cb81-1989" aria-hidden="true" tabindex="-1"></a>  pred.df,</span>
<span id="cb81-1990"><a href="#cb81-1990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb81-1991"><a href="#cb81-1991" aria-hidden="true" tabindex="-1"></a>    <span class="at">calpro_time =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb81-1992"><a href="#cb81-1992" aria-hidden="true" tabindex="-1"></a>    <span class="at">diagnosis =</span> <span class="st">"IBDU"</span></span>
<span id="cb81-1993"><a href="#cb81-1993" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-1994"><a href="#cb81-1994" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-1995"><a href="#cb81-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1996"><a href="#cb81-1996" aria-hidden="true" tabindex="-1"></a>p.list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb81-1997"><a href="#cb81-1997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1998"><a href="#cb81-1998" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb81-1999"><a href="#cb81-1999" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">7</span> <span class="sc">/</span> <span class="dv">4</span>, <span class="dv">14</span> <span class="sc">/</span> <span class="dv">4</span>, <span class="dv">21</span> <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb81-2000"><a href="#cb81-2000" aria-hidden="true" tabindex="-1"></a>pred.df<span class="sc">$</span>grbf1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> ((pred.df<span class="sc">$</span>calpro_time <span class="sc">-</span> centers[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> l<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb81-2001"><a href="#cb81-2001" aria-hidden="true" tabindex="-1"></a>pred.df<span class="sc">$</span>grbf2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> ((pred.df<span class="sc">$</span>calpro_time <span class="sc">-</span> centers[<span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> l<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb81-2002"><a href="#cb81-2002" aria-hidden="true" tabindex="-1"></a>pred.df<span class="sc">$</span>grbf3 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> ((pred.df<span class="sc">$</span>calpro_time <span class="sc">-</span> centers[<span class="dv">3</span>])<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> l<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb81-2003"><a href="#cb81-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2004"><a href="#cb81-2004" aria-hidden="true" tabindex="-1"></a>NCS.pred <span class="ot">&lt;-</span> <span class="fu">predictY</span>(models.fcal[[<span class="dv">6</span>]], pred.df, <span class="st">"calpro_time"</span>, <span class="at">draws =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>pred</span>
<span id="cb81-2005"><a href="#cb81-2005" aria-hidden="true" tabindex="-1"></a>GRBF.pred <span class="ot">&lt;-</span> <span class="fu">predictY</span>(models.grbf[[<span class="dv">6</span>]], pred.df, <span class="st">"calpro_time"</span>, <span class="at">draws =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>pred</span>
<span id="cb81-2006"><a href="#cb81-2006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2007"><a href="#cb81-2007" aria-hidden="true" tabindex="-1"></a>NCS.switch <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span>
<span id="cb81-2008"><a href="#cb81-2008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2009"><a href="#cb81-2009" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb81-2010"><a href="#cb81-2010" aria-hidden="true" tabindex="-1"></a>  plot.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-2011"><a href="#cb81-2011" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> pred.df<span class="sc">$</span>calpro_time,</span>
<span id="cb81-2012"><a href="#cb81-2012" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred =</span> NCS.pred[, NCS.switch[g]],</span>
<span id="cb81-2013"><a href="#cb81-2013" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> NCS.pred[, NCS.switch[g] <span class="sc">+</span> <span class="dv">6</span>],</span>
<span id="cb81-2014"><a href="#cb81-2014" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> NCS.pred[, NCS.switch[g] <span class="sc">+</span> <span class="dv">12</span>],</span>
<span id="cb81-2015"><a href="#cb81-2015" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="st">"NCS"</span></span>
<span id="cb81-2016"><a href="#cb81-2016" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-2017"><a href="#cb81-2017" aria-hidden="true" tabindex="-1"></a>  plot.df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb81-2018"><a href="#cb81-2018" aria-hidden="true" tabindex="-1"></a>    plot.df,</span>
<span id="cb81-2019"><a href="#cb81-2019" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb81-2020"><a href="#cb81-2020" aria-hidden="true" tabindex="-1"></a>      <span class="at">time =</span> pred.df<span class="sc">$</span>calpro_time,</span>
<span id="cb81-2021"><a href="#cb81-2021" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred =</span> GRBF.pred[, g],</span>
<span id="cb81-2022"><a href="#cb81-2022" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> GRBF.pred[, g <span class="sc">+</span> <span class="dv">6</span>],</span>
<span id="cb81-2023"><a href="#cb81-2023" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> GRBF.pred[, g <span class="sc">+</span> <span class="dv">12</span>],</span>
<span id="cb81-2024"><a href="#cb81-2024" aria-hidden="true" tabindex="-1"></a>      <span class="at">Model =</span> <span class="st">"GRBF"</span></span>
<span id="cb81-2025"><a href="#cb81-2025" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-2026"><a href="#cb81-2026" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-2027"><a href="#cb81-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2028"><a href="#cb81-2028" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> plot.df <span class="sc">%&gt;%</span></span>
<span id="cb81-2029"><a href="#cb81-2029" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb81-2030"><a href="#cb81-2030" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb81-2031"><a href="#cb81-2031" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> upper), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-2032"><a href="#cb81-2032" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> lower), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-2033"><a href="#cb81-2033" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span></span>
<span id="cb81-2034"><a href="#cb81-2034" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Predicted cluster mean"</span>) <span class="sc">+</span></span>
<span id="cb81-2035"><a href="#cb81-2035" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">3</span>, <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb81-2036"><a href="#cb81-2036" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-2037"><a href="#cb81-2037" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#0E6BA8"</span>, <span class="st">"#EF6461"</span>))</span>
<span id="cb81-2038"><a href="#cb81-2038" aria-hidden="true" tabindex="-1"></a>  p.list[[g]] <span class="ot">&lt;-</span> p</span>
<span id="cb81-2039"><a href="#cb81-2039" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-2040"><a href="#cb81-2040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2041"><a href="#cb81-2041" aria-hidden="true" tabindex="-1"></a>final.plot <span class="ot">&lt;-</span> (p.list[[<span class="dv">1</span>]] <span class="sc">+</span> p.list[[<span class="dv">2</span>]]) <span class="sc">/</span></span>
<span id="cb81-2042"><a href="#cb81-2042" aria-hidden="true" tabindex="-1"></a>  (p.list[[<span class="dv">3</span>]] <span class="sc">+</span> p.list[[<span class="dv">4</span>]]) <span class="sc">/</span></span>
<span id="cb81-2043"><a href="#cb81-2043" aria-hidden="true" tabindex="-1"></a>  (p.list[[<span class="dv">5</span>]] <span class="sc">+</span> p.list[[<span class="dv">6</span>]]) <span class="sc">+</span></span>
<span id="cb81-2044"><a href="#cb81-2044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">+</span></span>
<span id="cb81-2045"><a href="#cb81-2045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb81-2046"><a href="#cb81-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2047"><a href="#cb81-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2048"><a href="#cb81-2048" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"paper/comparison.pdf"</span>,</span>
<span id="cb81-2049"><a href="#cb81-2049" aria-hidden="true" tabindex="-1"></a>  final.plot,</span>
<span id="cb81-2050"><a href="#cb81-2050" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">8.3</span>,</span>
<span id="cb81-2051"><a href="#cb81-2051" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fl">11.7</span>,</span>
<span id="cb81-2052"><a href="#cb81-2052" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb81-2053"><a href="#cb81-2053" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-2054"><a href="#cb81-2054" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"paper/comparison.png"</span>,</span>
<span id="cb81-2055"><a href="#cb81-2055" aria-hidden="true" tabindex="-1"></a>  final.plot,</span>
<span id="cb81-2056"><a href="#cb81-2056" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">8.3</span>,</span>
<span id="cb81-2057"><a href="#cb81-2057" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fl">11.7</span>,</span>
<span id="cb81-2058"><a href="#cb81-2058" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb81-2059"><a href="#cb81-2059" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-2060"><a href="#cb81-2060" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final.plot)</span>
<span id="cb81-2061"><a href="#cb81-2061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-2062"><a href="#cb81-2062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2063"><a href="#cb81-2063" aria-hidden="true" tabindex="-1"></a><span class="fu">## Acknowledgments {.appendix}</span></span>
<span id="cb81-2064"><a href="#cb81-2064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2065"><a href="#cb81-2065" aria-hidden="true" tabindex="-1"></a>This work is funded by the Medical Research Council &amp; University of Edinburgh</span>
<span id="cb81-2066"><a href="#cb81-2066" aria-hidden="true" tabindex="-1"></a>via a Precision Medicine PhD studentship (MR/N013166/1, to **NC-C**).</span>
<span id="cb81-2067"><a href="#cb81-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2068"><a href="#cb81-2068" aria-hidden="true" tabindex="-1"></a>This work has made use of the resources provided by the [Edinburgh Compute and</span>
<span id="cb81-2069"><a href="#cb81-2069" aria-hidden="true" tabindex="-1"></a>Data Facility (ECDF)](http://www.ecdf.ed.ac.uk/).</span>
<span id="cb81-2070"><a href="#cb81-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2071"><a href="#cb81-2071" aria-hidden="true" tabindex="-1"></a><span class="fu">## Author contributions {.appendix}</span></span>
<span id="cb81-2072"><a href="#cb81-2072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2073"><a href="#cb81-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2074"><a href="#cb81-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2075"><a href="#cb81-2075" aria-hidden="true" tabindex="-1"></a><span class="fu">## References {.appendix}</span></span>
<span id="cb81-2076"><a href="#cb81-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2077"><a href="#cb81-2077" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb81-2078"><a href="#cb81-2078" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-2079"><a href="#cb81-2079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2080"><a href="#cb81-2080" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reuse {.appendix}</span></span>
<span id="cb81-2081"><a href="#cb81-2081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2082"><a href="#cb81-2082" aria-hidden="true" tabindex="-1"></a>Licensed by </span>
<span id="cb81-2083"><a href="#cb81-2083" aria-hidden="true" tabindex="-1"></a>&lt;a href="https://creativecommons.org/licenses/by/4.0/"&gt;CC BY&lt;/a&gt;</span>
<span id="cb81-2084"><a href="#cb81-2084" aria-hidden="true" tabindex="-1"></a> unless otherwise stated.</span>
<span id="cb81-2085"><a href="#cb81-2085" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-2086"><a href="#cb81-2086" aria-hidden="true" tabindex="-1"></a><span class="fu">## {.appendix}</span></span>
<span id="cb81-2087"><a href="#cb81-2087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2088"><a href="#cb81-2088" aria-hidden="true" tabindex="-1"></a>&lt;div class = "center"&gt;</span>
<span id="cb81-2089"><a href="#cb81-2089" aria-hidden="true" tabindex="-1"></a>  &lt;img class = "center" src="../../images/MRC_HGU_Edinburgh RGB.png" alt="MRC Human Genetics Unit logo" height = 50px&gt;</span>
<span id="cb81-2090"><a href="#cb81-2090" aria-hidden="true" tabindex="-1"></a>  &lt;img src="../../images/cgem-logo.png" alt="Centre for Genomic &amp; Experimental Medicine logo" height = 50px&gt;</span>
<span id="cb81-2091"><a href="#cb81-2091" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb81-2092"><a href="#cb81-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2093"><a href="#cb81-2093" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb81-2094"><a href="#cb81-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2095"><a href="#cb81-2095" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session info {.appendix}</span></span>
<span id="cb81-2096"><a href="#cb81-2096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2097"><a href="#cb81-2097" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Session info}</span></span>
<span id="cb81-2098"><a href="#cb81-2098" aria-hidden="true" tabindex="-1"></a><span class="in">pander(sessionInfo())</span></span>
<span id="cb81-2099"><a href="#cb81-2099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/VallejosGroup/Lothian-IBDR/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://x.com/IBDNathan">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>