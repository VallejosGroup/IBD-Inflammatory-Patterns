<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Nathan Constantine-Cooke">
<meta name="author" content="Karla Monterrubio-Gómez">
<meta name="author" content="Catalina A. Vallejos">
<meta name="dcterms.date" content="2024-11-10">
<title>Analysis by Constantine-Cooke et al.&nbsp;- Preprocessing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Analysis by Constantine-Cooke et al.&nbsp;- Preprocessing">
<meta property="og:description" content="">
<meta property="og:site_name" content="Analysis by Constantine-Cooke et al.">
<meta name="twitter:title" content="Analysis by Constantine-Cooke et al.&nbsp;- Preprocessing">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@IBDNathan">
<meta name="twitter:site" content="@EdinUni_IGC">
<meta name="twitter:card" content="summary">
<meta name="citation_title" content="Preprocessing">
<meta name="citation_author" content="Nathan Constantine-Cooke">
<meta name="citation_author" content="Karla Monterrubio-Gómez">
<meta name="citation_author" content="Catalina A. Vallejos">
<meta name="citation_publication_date" content="2024-11-10">
<meta name="citation_cover_date" content="2024-11-10">
<meta name="citation_year" content="2024">
<meta name="citation_online_date" content="2024-11-10">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Longitudinal Fecal Calprotectin Profiles Characterize Disease Course Heterogeneity in Crohn’s Disease;,citation_author=Nathan Constantine-Cooke;,citation_author=Karla Monterrubio-Gómez;,citation_author=Nikolas Plevris;,citation_author=Lauranne A. A. P. Derikx;,citation_author=Beatriz Gros;,citation_author=Gareth-Rhys Jones;,citation_author=Riccardo E. Marioni;,citation_author=Charlie W. Lees;,citation_author=Catalina A. Vallejos;,citation_publication_date=2023-03;,citation_cover_date=2023-03;,citation_year=2023;,citation_fulltext_html_url=https://linkinghub.elsevier.com/retrieve/pii/S1542356523002343;,citation_doi=10.1016/j.cgh.2023.03.026;,citation_issn=15423565;,citation_journal_title=Clinical Gastroenterology and Hepatology;">
<meta name="citation_reference" content="citation_title=Increasing incidences of inflammatory bowel disease and decreasing surgery rates in copenhagen city and county, 20032005: A population-based study from the danish crohn colitis database;,citation_author=Ida Vind;,citation_author=Lene Riis;,citation_author=Tine Jess;,citation_author=Elisabeth Knudsen;,citation_author=Natalia Pedersen;,citation_author=Margarita Elkjær;,citation_author=Inger Bak Andersen;,citation_author=Vibeke Wewer;,citation_author=Peter Nørregaard;,citation_author=Flemming Moesgaard;,citation_author=Flemming Bendtsen;,citation_author=Pia Munkholm;,citation_publication_date=2006-06;,citation_cover_date=2006-06;,citation_year=2006;,citation_fulltext_html_url=https://doi.org/10.1111%2Fj.1572-0241.2006.00552.x;,citation_issue=6;,citation_doi=10.1111/j.1572-0241.2006.00552.x;,citation_volume=101;,citation_journal_title=The American Journal of Gastroenterology;,citation_publisher=Ovid Technologies (Wolters Kluwer Health);">
<meta name="citation_reference" content="citation_title=Using linear and natural cubic splines, SITAR, and latent trajectory models to characterise nonlinear longitudinal growth trajectories in cohort studies;,citation_abstract=Longitudinal data analysis can improve our understanding of the influences on health trajectories across the life-course. There are a variety of statistical models which can be used, and their fitting and interpretation can be complex, particularly where there is a nonlinear trajectory. Our aim was to provide an accessible guide along with applied examples to using four sophisticated modelling procedures for describing nonlinear growth trajectories.;,citation_author=Ahmed Elhakeem;,citation_author=Rachael A. Hughes;,citation_author=Kate Tilling;,citation_author=Diana L. Cousminer;,citation_author=Stefan A. Jackowski;,citation_author=Tim J. Cole;,citation_author=Alex S. F. Kwong;,citation_author=Zheyuan Li;,citation_author=Struan F. A. Grant;,citation_author=Adam D. G. Baxter-Jones;,citation_author=Babette S. Zemel;,citation_author=Deborah A. Lawlor;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://doi.org/10.1186/s12874-022-01542-8;,citation_issue=1;,citation_doi=10.1186/s12874-022-01542-8;,citation_isbn=1471-2288;,citation_volume=22;,citation_journal_title=BMC Medical Research Methodology;">
<meta name="citation_reference" content="citation_title=Estimation of extended mixed models using latent classes and latent processes: The R package lcmm;,citation_author=Cécile Proust-Lima;,citation_author=Viviane Philipps;,citation_author=Benoit Liquet;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=2;,citation_doi=10.18637/jss.v078.i02;,citation_volume=78;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=Temporal trends in surgical resection rates and biologic prescribing in crohn’s disease: A population-based cohort study;,citation_author=P W Jenkinson;,citation_author=N Plevris;,citation_author=S Siakavellas;,citation_author=M Lyons;,citation_author=I D Arnott;,citation_author=D Wilson;,citation_author=A J M Watson;,citation_author=G-R Jones;,citation_author=C W Lees;,citation_publication_date=2020-08;,citation_cover_date=2020-08;,citation_year=2020;,citation_fulltext_html_url=https://doi.org/10.1093%2Fecco-jcc%2Fjjaa044;,citation_issue=9;,citation_doi=10.1093/ecco-jcc/jjaa044;,citation_volume=14;,citation_journal_title=Journal of Crohns and Colitis;,citation_publisher=Oxford University Press (OUP);">
<meta name="citation_reference" content="citation_title=IBD prevalence in lothian, scotland, derived by capture-recapture methodology;,citation_author=Gareth-Rhys Jones;,citation_author=Mathew Lyons;,citation_author=Nikolas Plevris;,citation_author=Philip W Jenkinson;,citation_author=Cathy Bisset;,citation_author=Christopher Burgess;,citation_author=Shahida Din;,citation_author=James Fulforth;,citation_author=Paul Henderson;,citation_author=Gwo-Tzer Ho;,citation_author=Kathryn Kirkwood;,citation_author=Colin Noble;,citation_author=Alan G Shand;,citation_author=David C Wilson;,citation_author=Ian DR Arnott;,citation_author=Charlie W Lees;,citation_publication_date=2019-07;,citation_cover_date=2019-07;,citation_year=2019;,citation_fulltext_html_url=https://doi.org/10.1136%2Fgutjnl-2019-318936;,citation_issue=11;,citation_doi=10.1136/gutjnl-2019-318936;,citation_volume=68;,citation_journal_title=Gut;,citation_publisher=BMJ;">
<meta name="citation_reference" content="citation_title=General Aspects of Fitting Regression Models;,citation_abstract=The ordinary multiple linear regression model is frequently used and has parameters that are easily interpreted. In this chapter we study a general class of regression models, those stated in terms of a weighted sum of a set of independent or predictor variables. It is shown that after linearizing the model with respect to the predictor variables, the parameters in such regression models are also readily interpreted. Also, all the designs used in ordinary linear regression can be used in this general setting. These designs include analysis of variance (ANOVAANOVA) setups, interaction effects, and nonlinear effects. Besides describing and interpreting general regression models, this chapter also describes, in general terms, how the three types of assumptions of regression models can be examined.;,citation_author=Frank E. Harrell;,citation_editor=Jr. Harrell;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_doi=10.1007/978-3-319-19425-7_2;,citation_isbn=978-3-319-19425-7;,citation_language=en-US;,citation_inbook_title=Regression Modeling Strategies: With Applications to Linear Models, Logistic and Ordinal Regression, and Survival Analysis;,citation_series_title=Springer Series in Statistics;">
<meta name="citation_reference" content="citation_title=A biomarker-stratified comparison of top-down versus accelerated step-up treatment strategies for patients with newly diagnosed crohn’s disease (PROFILE): A multicentre, open-label randomised controlled trial;,citation_abstract=Summary Background Management strategies and clinical outcomes vary substantially in patients newly diagnosed with Crohn’s disease. We evaluated the use of a putative prognostic biomarker to guide therapy by assessing outcomes in patients randomised to either top-down (ie, early combined immunosuppression with infliximab and immunomodulator) or accelerated step-up (conventional) treatment strategies. Methods PROFILE (PRedicting Outcomes For Crohn’s disease using a moLecular biomarker) was a multicentre, open-label, biomarker-stratified, randomised controlled trial that enrolled adults with newly diagnosed active Crohn’s disease (Harvey-Bradshaw Index ≥7, either elevated C-reactive protein or faecal calprotectin or both, and endoscopic evidence of active inflammation). Potential participants had blood drawn to be tested for a prognostic biomarker derived from T-cell transcriptional signatures (PredictSURE-IBD assay). Following testing, patients were randomly assigned, via a secure online platform, to top-down or accelerated step-up treatment stratified by biomarker subgroup (IBDhi or IBDlo), endoscopic inflammation (mild, moderate, or severe), and extent (colonic or other). Blinding to biomarker status was maintained throughout the trial. The primary endpoint was sustained steroid-free and surgery-free remission to week 48. Remission was defined by a composite of symptoms and inflammatory markers at all visits. Flare required active symptoms (HBI ≥5) plus raised inflammatory markers (CRP &amp;amp;amp;gt;upper limit of normal or faecal calprotectin ≥200 μg/g, or both), while remission was the converse—ie, quiescent symptoms (HBI &amp;lt;5) or resolved inflammatory markers (both CRP ≤ the upper limit of normal and calprotectin &amp;lt;200 μg/g) or both. Analyses were done in the full analysis (intention-to-treat) population. The trial has completed and is registered (ISRCTN11808228). Findings Between Dec 29, 2017, and Jan 5, 2022, 386 patients (mean age 33·6 years [SD 13·2]; 179 [46 Interpretation Top-down treatment with combination infliximab plus immunomodulator achieved substantially better outcomes at 1 year than accelerated step-up treatment. The biomarker did not show clinical utility. Top-down treatment should be considered standard of care for patients with newly diagnosed active Crohn’s disease. Funding Wellcome and PredictImmune Ltd.;,citation_author=Nurulamin M Noor;,citation_author=James C Lee;,citation_author=Simon Bond;,citation_author=Francis Dowling;,citation_author=Biljana Brezina;,citation_author=Kamal V Patel;,citation_author=Tariq Ahmad;,citation_author=Paul J Banim;,citation_author=James W Berrill;,citation_author=Rachel Cooney;,citation_author=Juan De La Revilla Negro;,citation_author=Shanika Silva;,citation_author=Shahida Din;,citation_author=Dharmaraj Durai;,citation_author=John N Gordon;,citation_author=Peter M Irving;,citation_author=Matthew Johnson;,citation_author=Alexandra J Kent;,citation_author=Klaartje B Kok;,citation_author=Gordon W Moran;,citation_author=Craig Mowat;,citation_author=Pritash Patel;,citation_author=Chris S Probert;,citation_author=Tim Raine;,citation_author=Rebecca Saich;,citation_author=Abigail Seward;,citation_author=Dan Sharpstone;,citation_author=Melissa A Smith;,citation_author=Sreedhar Subramanian;,citation_author=Sara S Upponi;,citation_author=Alan Wiles;,citation_author=Horace R T Williams;,citation_author=Gijs R Brink;,citation_author=Séverine Vermeire;,citation_author=Vipul Jairath;,citation_author=Geert R D’Haens;,citation_author=Eoin F McKinney;,citation_author=Paul A Lyons;,citation_author=James O Lindsay;,citation_author=Nicholas A Kennedy;,citation_author=Kenneth G C Smith;,citation_author=Miles Parkes;,citation_author=Nurulamin Noor;,citation_author=James Lee;,citation_author=Simon Bond;,citation_author=Francis Dowling;,citation_author=Biljana Brezina;,citation_author=Kamal Patel;,citation_author=Tariq Ahmad;,citation_author=Paul Banim;,citation_author=James Berrill;,citation_author=Rachel Cooney;,citation_author=Juan De La Revilla Negro;,citation_author=Shanika Silva;,citation_author=Shahida Din;,citation_author=Dharmaraj Durai;,citation_author=John Gordon;,citation_author=Peter Irving;,citation_author=Matthew Johnson;,citation_author=Alexandra Kent;,citation_author=Klaartje Bel Kok;,citation_author=Gordon Moran;,citation_author=Craig Mowat;,citation_author=Pritash Patel;,citation_author=Chris Probert;,citation_author=Tim Raine;,citation_author=Rebecca Saich;,citation_author=Abigail Seward;,citation_author=Dan Sharpstone;,citation_author=Melissa Smith;,citation_author=Sreedhar Subramanian;,citation_author=Sara Upponi;,citation_author=Alan Wiles;,citation_author=Horace Williams;,citation_author=Gijs Den Brink;,citation_author=Severine Vermeire;,citation_author=Vipul Jairath;,citation_author=Geert D’Haens;,citation_author=Eoin McKinney;,citation_author=Paul Lyons;,citation_author=James Lindsay;,citation_author=Nicholas Kennedy;,citation_author=Kenneth Smith;,citation_author=Miles Parkes;,citation_author=Clare Allcock;,citation_author=Suhaylah Bhatti;,citation_author=Jonathan Blackwell;,citation_author=Robert Boulton-Jones;,citation_author=Matthew Brookes;,citation_author=Rhys Butcher;,citation_author=Jeffrey Butterworth;,citation_author=Karlena Champion;,citation_author=Rakesh Chaudhary;,citation_author=Andy Cole;,citation_author=Lauranne Derikx;,citation_author=Anjan Dhar;,citation_author=Mary Flowerdew;,citation_author=Rishi Goel;,citation_author=Ailsa Hart;,citation_author=Rory Hughes;,citation_author=Babur Javaid;,citation_author=Paul Knight;,citation_author=Jacinta Lee;,citation_author=Charlie Lees;,citation_author=Emma Levell;,citation_author=Andy Li;,citation_author=Charles Murray;,citation_author=Leisha O’Brien;,citation_author=Gareth Parkes;,citation_author=Richard Pollok;,citation_author=Sam Powles;,citation_author=Arvind Ramdas;,citation_author=Philip Smith;,citation_author=Richard Ally Speight;,citation_author=Simon Travis;,citation_author=Sean Weaver;,citation_author=Emma Wesley;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S2468125324000347;,citation_issue=5;,citation_doi=https://doi.org/10.1016/S2468-1253(24)00034-7;,citation_issn=2468-1253;,citation_volume=9;,citation_journal_title=The Lancet Gastroenterology &amp;amp; Hepatology;">
<meta name="citation_reference" content="citation_title=Early combined immunosuppression or conventional management in patients with newly diagnosed crohn’s disease: An open randomised trial;,citation_abstract=Summary Background Most patients who have active Crohn’s disease are treated initially with corticosteroids. Although this approach usually controls symptoms, many patients become resistant to or dependent on corticosteroids, and long exposure is associated with an increased risk of mortality. We aimed to compare the effectiveness of early use of combined immunosuppression with conventional management in patients with active Crohn’s disease who had not previously received glucocorticoids, antimetabolites, or infliximab. Methods We did a 2-year open-label randomised trial at 18 centres in Belgium, Holland, and Germany between May, 2001, and January, 2004. We randomly assigned 133 patients to either early combined immunosuppression or conventional treatment. The 67 patients assigned to combined immunosuppression received three infusions of infliximab (5 mg/kg of bodyweight) at weeks 0, 2, and 6, with azathioprine. We gave additional treatment with infliximab and, if necessary, corticosteroids, to control disease activity. 66 patients assigned to conventional management received corticosteroids, followed, in sequence, by azathioprine and infliximab. The primary outcome measures were remission without corticosteroids and without bowel resection at weeks 26 and 52. Analysis was by modified intention to treat. This trial was registered with ClinicalTrials.gov, number NCT00554710. Findings Four patients (two in each group) did not receive treatment as per protocol. At week 26, 39 (60·0 Interpretation Combined immunosuppression was more effective than conventional management for induction of remission and reduction of corticosteroid use in patients who had been recently diagnosed with Crohn’s disease. Initiation of more intensive treatment early in the course of the disease could result in better outcomes.;,citation_author=Geert D’Haens;,citation_author=Filip Baert;,citation_author=Gert Assche;,citation_author=Philip Caenepeel;,citation_author=Philippe Vergauwe;,citation_author=Hans Tuynman;,citation_author=Martine De Vos;,citation_author=Sander Deventer;,citation_author=Larry Stitt;,citation_author=Allan Donner;,citation_author=Severine Vermeire;,citation_author=Frank J Van De Mierop;,citation_author=Jean-Charles R Coche;,citation_author=Janneke Woude;,citation_author=Thomas Ochsenkühn;,citation_author=Ad A Bodegraven;,citation_author=Philippe P Van Hootegem;,citation_author=Guy L Lambrecht;,citation_author=Fazia Mana;,citation_author=Paul Rutgeerts;,citation_author=Brian G Feagan;,citation_author=Daniel Hommes;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S0140673608603049;,citation_issue=9613;,citation_doi=https://doi.org/10.1016/S0140-6736(08)60304-9;,citation_issn=0140-6736;,citation_volume=371;,citation_journal_title=The Lancet;">
<meta name="citation_reference" content="citation_title=Incidence, prevalence, and racial and ethnic distribution of inflammatory bowel disease in the united states;,citation_author=James D. Lewis;,citation_author=Lauren E. Parlett;,citation_author=Michele L. Jonsson Funk;,citation_author=Colleen Brensinger;,citation_author=Virginia Pate;,citation_author=Qufei Wu;,citation_author=Ghadeer K. Dawwas;,citation_author=Alexandra Weiss;,citation_author=Brad D. Constant;,citation_author=Maureen McCauley;,citation_author=Kevin Haynes;,citation_author=Jeff Yufeng Yang;,citation_author=Douglas E. Schaubel;,citation_author=Andres Hurtado-Lorenzo;,citation_author=Michael David Kappelman;,citation_publication_date=2023-11;,citation_cover_date=2023-11;,citation_year=2023;,citation_fulltext_html_url=http://dx.doi.org/10.1053/j.gastro.2023.07.003;,citation_issue=5;,citation_doi=10.1053/j.gastro.2023.07.003;,citation_issn=0016-5085;,citation_volume=165;,citation_journal_title=Gastroenterology;,citation_publisher=Elsevier BV;">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Analysis by Constantine-Cooke et al.</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-before-model-fitting" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Before model fitting</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-before-model-fitting">
<li>
    <a class="dropdown-item" href="../../source/pre/preprocessing.html">
 <span class="dropdown-text">Preprocessing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/pre/baseline.html">
 <span class="dropdown-text">Baseline data</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-model-fitting" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Model fitting</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-model-fitting">
<li>
    <a class="dropdown-item" href="../../source/selection/fcal.html">
 <span class="dropdown-text">Faecal calprotectin</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/selection/crp.html">
 <span class="dropdown-text">C-reactive protein</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-after-model-fitting" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">After model fitting</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-after-model-fitting">
<li>
    <a class="dropdown-item" href="../../source/post/associations.html">
 <span class="dropdown-text">Associations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/post/FCALvsCRP.html">
 <span class="dropdown-text">Comparison between FC and CRP</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/VallejosGroup/Lothian-IBDR"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
<li><a href="#inclusionexclusion-criteria-definitions" id="toc-inclusionexclusion-criteria-definitions" class="nav-link" data-scroll-target="#inclusionexclusion-criteria-definitions">Inclusion/exclusion criteria definitions</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets">Datasets</a></li>
  </ul>
</li>
  <li>
<a href="#subject-data" id="toc-subject-data" class="nav-link" data-scroll-target="#subject-data">Subject data</a>
  <ul class="collapse">
<li><a href="#diagnosis-and-diagnosis-date" id="toc-diagnosis-and-diagnosis-date" class="nav-link" data-scroll-target="#diagnosis-and-diagnosis-date">Diagnosis and diagnosis date</a></li>
  <li><a href="#age-and-sex" id="toc-age-and-sex" class="nav-link" data-scroll-target="#age-and-sex">Age and sex</a></li>
  <li><a href="#date-of-death" id="toc-date-of-death" class="nav-link" data-scroll-target="#date-of-death">Date of death</a></li>
  </ul>
</li>
  <li><a href="#exclusion-criteria-according-to-diagnosis-and-date-of-diagnosis" id="toc-exclusion-criteria-according-to-diagnosis-and-date-of-diagnosis" class="nav-link" data-scroll-target="#exclusion-criteria-according-to-diagnosis-and-date-of-diagnosis">Exclusion criteria according to diagnosis and date of diagnosis</a></li>
  <li><a href="#exploration" id="toc-exploration" class="nav-link" data-scroll-target="#exploration">Exploration</a></li>
  <li>
<a href="#faecal-calprotectin" id="toc-faecal-calprotectin" class="nav-link" data-scroll-target="#faecal-calprotectin">Faecal calprotectin</a>
  <ul class="collapse">
<li><a href="#incorporating-later-extract" id="toc-incorporating-later-extract" class="nav-link" data-scroll-target="#incorporating-later-extract">Incorporating later extract</a></li>
  <li><a href="#pre-processing-of-test-results" id="toc-pre-processing-of-test-results" class="nav-link" data-scroll-target="#pre-processing-of-test-results">Pre-processing of test results</a></li>
  <li><a href="#removal-of-duplicate-fcal-measurements" id="toc-removal-of-duplicate-fcal-measurements" class="nav-link" data-scroll-target="#removal-of-duplicate-fcal-measurements">Removal of duplicate FCAL measurements</a></li>
  <li><a href="#retiming---part-1" id="toc-retiming---part-1" class="nav-link" data-scroll-target="#retiming---part-1">Retiming - part 1</a></li>
  <li><a href="#inclusionexclusion-removal-of-subjects-without-a-diagnostic-fc-test" id="toc-inclusionexclusion-removal-of-subjects-without-a-diagnostic-fc-test" class="nav-link" data-scroll-target="#inclusionexclusion-removal-of-subjects-without-a-diagnostic-fc-test">Inclusion/exclusion: removal of subjects without a diagnostic FC test</a></li>
  <li><a href="#retiming---part-2" id="toc-retiming---part-2" class="nav-link" data-scroll-target="#retiming---part-2">Retiming - part 2</a></li>
  <li><a href="#inclusionexclusion-a-minimum-number-of-fcal-measurements" id="toc-inclusionexclusion-a-minimum-number-of-fcal-measurements" class="nav-link" data-scroll-target="#inclusionexclusion-a-minimum-number-of-fcal-measurements">Inclusion/exclusion: a minimum number of FCAL measurements</a></li>
  <li><a href="#revisiting-month-of-diagnosis" id="toc-revisiting-month-of-diagnosis" class="nav-link" data-scroll-target="#revisiting-month-of-diagnosis">Revisiting month of diagnosis</a></li>
  </ul>
</li>
  <li>
<a href="#c-reactive-protein" id="toc-c-reactive-protein" class="nav-link" data-scroll-target="#c-reactive-protein">C-reactive protein</a>
  <ul class="collapse">
<li><a href="#pre-processing-of-test-results-1" id="toc-pre-processing-of-test-results-1" class="nav-link" data-scroll-target="#pre-processing-of-test-results-1">Pre-processing of test results</a></li>
  <li><a href="#removal-of-duplicates" id="toc-removal-of-duplicates" class="nav-link" data-scroll-target="#removal-of-duplicates">Removal of duplicates</a></li>
  <li><a href="#retiming---part-1-1" id="toc-retiming---part-1-1" class="nav-link" data-scroll-target="#retiming---part-1-1">Retiming - part 1</a></li>
  <li><a href="#inclusionexclusion-removal-of-subjects-without-a-diagnostic-crp-test" id="toc-inclusionexclusion-removal-of-subjects-without-a-diagnostic-crp-test" class="nav-link" data-scroll-target="#inclusionexclusion-removal-of-subjects-without-a-diagnostic-crp-test">Inclusion/exclusion: removal of subjects without a diagnostic CRP test</a></li>
  <li><a href="#retiming---part-2-1" id="toc-retiming---part-2-1" class="nav-link" data-scroll-target="#retiming---part-2-1">Retiming - part 2</a></li>
  <li><a href="#additional-pre-processing" id="toc-additional-pre-processing" class="nav-link" data-scroll-target="#additional-pre-processing">Additional pre-processing</a></li>
  <li><a href="#inclusionexclusion-a-minimum-number-of-crp-measurements" id="toc-inclusionexclusion-a-minimum-number-of-crp-measurements" class="nav-link" data-scroll-target="#inclusionexclusion-a-minimum-number-of-crp-measurements">Inclusion/exclusion: a minimum number of CRP measurements</a></li>
  <li><a href="#additional-pre-processing-1" id="toc-additional-pre-processing-1" class="nav-link" data-scroll-target="#additional-pre-processing-1">Additional pre-processing</a></li>
  <li><a href="#revisiting-month-of-diagnosis-1" id="toc-revisiting-month-of-diagnosis-1" class="nav-link" data-scroll-target="#revisiting-month-of-diagnosis-1">Revisiting month of diagnosis</a></li>
  </ul>
</li>
  <li><a href="#updated-density-plots" id="toc-updated-density-plots" class="nav-link" data-scroll-target="#updated-density-plots">Updated density plots</a></li>
  <li><a href="#data-saving" id="toc-data-saving" class="nav-link" data-scroll-target="#data-saving">Data saving</a></li>
  
  
  
  
  
  
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/VallejosGroup/Lothian-IBDR/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Preprocessing</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://scholar.google.com/citations?user=2emHWR0AAAAJ&amp;hl=en&amp;oi=ao">Nathan Constantine-Cooke</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/centre-genomic-medicine">
            Centre for Genomic and Experimental Medicine
            </a>
          </p>
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/mrc-human-genetics-unit">
            MRC Human Genetics Unit
            </a>
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://scholar.google.com/citations?user=YmyxSXAAAAAJ&amp;hl=en">Karla Monterrubio-Gómez</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/mrc-human-genetics-unit">
            MRC Human Genetics Unit
            </a>
          </p>
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/centre-genomic-medicine">
            Centre for Genomic and Experimental Medicine
            </a>
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://scholar.google.com/citations?user=lkdrwm0AAAAJ&amp;hl=en&amp;oi=ao">Catalina A. Vallejos</a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.ed.ac.uk/mrc-human-genetics-unit">
            MRC Human Genetics Unit
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co">### Required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># ggplot2, dplyr, and magrittr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span> <span class="co"># Markdown utilities</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/">pander</a></span><span class="op">)</span> <span class="co"># Pretty markdown rendering</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/datefixR/">datefixR</a></span><span class="op">)</span> <span class="co"># Standardising dates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span> <span class="co"># Date handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span> <span class="co"># Arranging plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This page details preprocessing steps undertaken prior to model fitting. These steps include examining data quality, performing data cleaning, and deriving the study cohort.</p>
<p>The biomarker (FC and CRP) data used in this pipeline have been primarily obtained from TRAK, a system used by NHS Lothian for the electronic ordering of laboratory tests. However, we also use phenotyping data manually curated by the Lees group for previous studies (see <span class="citation" data-cites="Jenkinson2020">Jenkinson et al. (<a href="#ref-Jenkinson2020" role="doc-biblioref">2020</a>)</span>).</p>
<p>Prior to this report, all subject CHI (community health index) numbers, which uniquely identifies a patient when they interact with NHS Scotland services, were pseudoanonymised. Each CHI has been replaced with a unique random number.</p>
<section id="inclusionexclusion-criteria-definitions" class="level3"><h3 class="anchored" data-anchor-id="inclusionexclusion-criteria-definitions">Inclusion/exclusion criteria definitions</h3>
<p>The inclusion criteria for this study can broadly be categorised into two classifications: baseline and longitudinal. Baseline criteria can be applied using information known at diagnosis whilst longitudinal criteria are based on biomarker measurements taken over time.</p>
<p>The longitudinal criteria for each biomarker (FC and CRP) are considered independently. If a subject meets the below criteria for FC but not CRP, then only the FC for the subject will be modelled and vice versa.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Baseline</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Longitudinal</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<section id="diagnosis-of-inflammatory-bowel-disease" class="level5"><h5 class="anchored" data-anchor-id="diagnosis-of-inflammatory-bowel-disease">Diagnosis of Inflammatory bowel disease</h5>
<p>As inflammatory bowel disease (IBD) is the disease of interest for this study, subjects are required to have a confirmed diagnosis of either Crohn’s disease, ulcerative colitis, or inflammatory bowel disease unclassified.</p>
</section><section id="diagnosis-date" class="level5"><h5 class="anchored" data-anchor-id="diagnosis-date">Diagnosis date</h5>
<p>Study subjects are required to have been diagnosed with IBD between October 2004 and December 2017. The lower bound is required as FC tests were not introduced until 2005 and we require study subjects to have a FC available close to diagnosis (see the longitudinal tab). The upper bound is required to ensure subjects have the opportunity to have at least five years of follow-up. The most recent FC observation in this dataset is January 2023 which informed when deciding upon this cut-off.</p>
</section>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<section id="diagnostic-measurement" class="level5"><h5 class="anchored" data-anchor-id="diagnostic-measurement">Diagnostic measurement</h5>
<p>We require study subjects to have a biomarker measurement taken ±90 days of reported date of diagnosis.</p>
</section><section id="at-least-three-non-censored-measurements" class="level5"><h5 class="anchored" data-anchor-id="at-least-three-non-censored-measurements">At least three non-censored measurements</h5>
<p>To ensure stability and interpretability, study subjects are also required to have at three non-censored biomarker measurements taken across follow-up. Like most biomarkers, the biomarkers used in this study are subject to censoring. However, these censored observations make it impossible to detect changes over time and we therefore do not wish to be reliant on censored observations.</p>
</section>
</div>
</div>
</div>
</section><section id="datasets" class="level3"><h3 class="anchored" data-anchor-id="datasets">Datasets</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"/.dockerenv"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># Check if running in Docker</span></span>
<span>  <span class="co"># Assume igmm/Vallejo-predict/libdr/ is passed to the data volume</span></span>
<span>  <span class="va">prefix</span> <span class="op">&lt;-</span> <span class="st">"data/"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Assume running outside of a Docker container and the IGC(/IGMM) datastore is</span></span>
<span>  <span class="co"># mounted at /Volumes</span></span>
<span>  <span class="va">prefix</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/igmm/cvallejo-predicct/libdr/"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fcal.pheno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"2024-10-03/fcal-cleaned.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract from TRAK which also now introduces CRP.</span></span>
<span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"2024-10-03/markers-cleaned.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">labs</span>, <span class="va">TEST</span> <span class="op">==</span> <span class="st">"f-Calprotectin-ALP"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add sex and diagnosis type from fcal.pheno</span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="va">fcal.pheno</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ids</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span>, <span class="va">sex</span>, <span class="va">diagnosis</span>, <span class="va">diagnosis_date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fcal</span>, by <span class="op">=</span> <span class="st">"ids"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">labs</span>, <span class="va">TEST</span> <span class="op">==</span> <span class="st">"C-Reactive Prot"</span><span class="op">)</span></span>
<span><span class="va">updated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"2024-10-03/allPatientsNathanCleaned.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"2024-10-03/cd-cleaned.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">non.ibd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span> <span class="op">(</span><span class="va">prefix</span>, <span class="st">"2024-10-24/non-ibd.csv"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Multiple datasets are used in this report with varying degrees of previous curation.</p>
<ul>
<li>
<code>markers.csv</code> is a 2024 extraction from TRAKcare describing 286294 test results (FC: 60866; CRP: 225428). Each row represents a test result with columns indicating the corresponding subject ID, the test type (FC or CRP), the time of the test, and the test result. This dataset contains the most recent data out of the other datasets. However, there has been no manual curation of these data, and no information about the patient’s characteristics are available (other than their ID).</li>
<li>
<code>fcal-cleaned.csv</code> does not describe CRP data. However, these data have been curated by the Lees group. In addition to 60866 FC test results, each row also provides the sex, IBD type, date of diagnosis, and date of death (if applicable) for the corresponding subject.</li>
<li>
<code>allPatientsNathanCleaned.csv</code> provides sex, IBD type, and diagnosis date for most (but not all) subjects in <code>labs.csv</code> not described by <code>fcal-cleaned.csv</code>.</li>
<li>
<code>cd-cleaned.csv</code> describes CD patient data (n = 1753). In addition to the same basic patient characteristic variables in other datasets, this dataset also describes surgical outcomes and biologic treatments prescribed to the subject.</li>
<li>
<code>non-ibd.csv</code> describes subjects who were found to not have IBD during the phenotyping process. This dataset is used to remove subjects who do not have IBD from the analysis.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The “cleaned” in the above file names refers to the CHI numbers having been replaced. No further processing of the data has been undertaken for this study prior to the steps outlined in this report.</p>
</div>
</div>
</section></section><section id="subject-data" class="level2"><h2 class="anchored" data-anchor-id="subject-data">Subject data</h2>
<p>We will create a “dictionary” which, for each subject, lists their subject ID, their IBD type, and their date of diagnosis. In addition to ensuring inclusion criteria are met, date of diagnosis will be used to retime all biomarker measurements of a subject such that <span class="math inline">t=0</span> corresponds to their diagnosis date. IBD types are used to test if clusters are enriched by IBD type and may be used to adjust the clustering.</p>
<p>There are multiple potential sources for date of diagnosis and IBD type: the CD outcomes dataset, a demographics dataset maintained by the Lees group, and a raw TRAK extraction. For every subject listed in at least one of these datasets, we have tried to extract their date of diagnosis and diagnosis type. We have assumed a hierarchy of datasets where manually curated datasets are preferred for extracting data over a dataset generated with minimal human involvement.</p>
<section id="diagnosis-and-diagnosis-date" class="level3"><h3 class="anchored" data-anchor-id="diagnosis-and-diagnosis-date">Diagnosis and diagnosis date</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">outcomes</span><span class="op">$</span><span class="va">ids</span>, <span class="va">fcal</span><span class="op">$</span><span class="va">ids</span>, <span class="va">updated</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">date.of.diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="va">ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">outcomes</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Outcomes data only contains CD subjects</span></span>
<span>    <span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="st">"Crohn's Disease"</span><span class="op">)</span></span>
<span>    <span class="va">date.of.diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="va">date.of.diag</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">outcomes</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span><span class="op">$</span><span class="va">diagnosisDate</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">updated</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">updated</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"diagnosis"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">date.of.diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="va">date.of.diag</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">updated</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"diagnosisDate"</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"diagnosis"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">date.of.diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="va">date.of.diag</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"diagnosis_date"</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="st">"Unknown"</span><span class="op">)</span></span>
<span>    <span class="va">date.of.diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="va">date.of.diag</span>,</span>
<span>      <span class="st">"Unknown"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  ids <span class="op">=</span> <span class="va">ids</span>,</span>
<span>  diagnosis <span class="op">=</span> <span class="va">diagnosis</span>,</span>
<span>  date.of.diag <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/datefixR/reference/fix_date_char.html">fix_date_char</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">ids</span>, <span class="va">diagnosis</span>, <span class="va">date.of.diag</span><span class="op">)</span> <span class="co"># clean up</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datefixR/reference/fix_date_df.html">fix_date_df</a></span><span class="op">(</span><span class="va">dict</span>, <span class="st">"date.of.diag"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Before filtering by inclusion/exclusion criteria, there are 7 individuals for which a diagnostic date is missing. However, 0 missing values are observed for diagnosis (IBD type).</p>
<p>As can be seen in the below table, two spellings of Crohn’s disease (with and without an apostrophe (’)) and three names for IBDU are used. There are also subjects reported to not have IBD. These will be removed, leaving 10153 subjects included in the subsequent analyses.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dict</span><span class="op">$</span><span class="va">diagnosis</span><span class="op">)</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Diagnosis"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">diagnosis</span> <span class="op">!=</span> <span class="st">"Not IBD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">non.ibd</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-diag-pre" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-diag-pre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Reported IBD types
</figcaption><div aria-describedby="tbl-diag-pre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Diagnosis</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Crohn’s Disease</td>
</tr>
<tr class="even">
<td style="text-align: left;">Inflamatory Bowel Disease - Unknown Subtype</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Crohns Disease</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ulcerative Colitis</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Inflamatory Bowel Disease</td>
</tr>
<tr class="even">
<td style="text-align: left;">IBDU</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Not IBD</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The Crohn’s disease and IBDU names have been standardised (IBDU, Inflammatory Bowel Disease, Inflammatory Bowel Disease - Unknown Subtype are assumed to be equivalent). The subject reported to not have IBD has been removed.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict</span><span class="op">$</span><span class="va">old</span> <span class="op">&lt;-</span> <span class="va">dict</span><span class="op">$</span><span class="va">diagnosis</span></span>
<span><span class="va">dict</span><span class="op">$</span><span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span></span>
<span>  <span class="va">dict</span><span class="op">$</span><span class="va">diagnosis</span>,</span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Crohns Disease"</span>,</span>
<span>    <span class="st">"Inflamatory Bowel Disease"</span>,</span>
<span>    <span class="st">"Inflamatory Bowel Disease - Unknown Subtype"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Crohn's Disease"</span>,</span>
<span>    <span class="st">"IBDU"</span>,</span>
<span>    <span class="st">"IBDU"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/addmargins.html">addmargins</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dict</span><span class="op">$</span><span class="va">diagnosis</span>, <span class="va">dict</span><span class="op">$</span><span class="va">old</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dict</span><span class="op">$</span><span class="va">old</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-diag-post" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-diag-post-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Contingency table showing mapping of IBD types to a standardised format
</figcaption><div aria-describedby="tbl-diag-post-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 3%">
<col style="width: 17%">
<col style="width: 29%">
<col style="width: 12%">
<col style="width: 3%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Crohn’s Disease</th>
<th style="text-align: right;">Crohns Disease</th>
<th style="text-align: right;">IBDU</th>
<th style="text-align: right;">Inflamatory Bowel Disease</th>
<th style="text-align: right;">Inflamatory Bowel Disease - Unknown Subtype</th>
<th style="text-align: right;">Ulcerative Colitis</th>
<th style="text-align: right;">Sum</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Crohn’s Disease</td>
<td style="text-align: right;">2471</td>
<td style="text-align: right;">1328</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3799</td>
</tr>
<tr class="even">
<td style="text-align: left;">IBDU</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">841</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1084</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ulcerative Colitis</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5270</td>
<td style="text-align: right;">5270</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section id="age-and-sex" class="level3"><h3 class="anchored" data-anchor-id="age-and-sex">Age and sex</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Merge with fcal to add sex information</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="va">fcal.pheno</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ids</span>,</span>
<span>    .keep_all <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dict</span>, by <span class="op">=</span> <span class="st">"ids"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Update NA sex if sex available from updated</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">dict</span>,</span>
<span>  <span class="va">updated</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"ids"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  all.y <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dict</span><span class="op">[</span><span class="va">i</span>, <span class="st">"sex.x"</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dict</span><span class="op">[</span><span class="va">i</span>, <span class="st">"sex.y"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dict</span><span class="op">[</span><span class="va">i</span>, <span class="st">"sex.x"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dict</span><span class="op">[</span><span class="va">i</span>, <span class="st">"sex.y"</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dict</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="va">dict</span><span class="op">$</span><span class="va">sex.x</span></span>
<span><span class="va">dict</span><span class="op">$</span><span class="va">sex.x</span> <span class="op">&lt;-</span> <span class="va">dict</span><span class="op">$</span><span class="va">sex.y</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># Add age at IBD diagnosis</span></span>
<span><span class="va">updated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datefixR/reference/fix_date_df.html">fix_date_df</a></span><span class="op">(</span><span class="va">updated</span>, <span class="st">"diagnosisDate"</span><span class="op">)</span></span>
<span><span class="va">updated</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">updated</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">diagnosisDate</span><span class="op">)</span> <span class="op">-</span> <span class="va">dateOfBirth</span><span class="op">)</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">dict</span>,</span>
<span>  <span class="va">updated</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"age"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"ids"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  all.y <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that there 7 individuals for which age at diagnosis is missing (this is due to missing diagnostic dates). However, there are 0 individuals for which sex is missing.</p>
</section><section id="date-of-death" class="level3"><h3 class="anchored" data-anchor-id="date-of-death">Date of death</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">dict</span>,</span>
<span>  <span class="va">updated</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"death"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"ids"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  all.y <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>date.of.death <span class="op">=</span> <span class="va">death</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/datefixR/reference/fix_date_df.html">fix_date_df</a></span><span class="op">(</span><span class="va">dict</span>, <span class="st">"date.of.death"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Date of death information is available for 1136 individuals. We assume that all remaining individuals have not died by the date of data extraction.</p>
</section></section><section id="exclusion-criteria-according-to-diagnosis-and-date-of-diagnosis" class="level2"><h2 class="anchored" data-anchor-id="exclusion-criteria-according-to-diagnosis-and-date-of-diagnosis">Exclusion criteria according to diagnosis and date of diagnosis</h2>
<p>Date of diagnosis in an integral aspect of the inclusion criteria and also used to retime biomarker measurements.</p>
<p>Firstly, we remove 7 individuals with a missing date of diagnosis.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="va">dict</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dict</span><span class="op">$</span><span class="va">date.of.diag</span><span class="op">)</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This leaves 10146 for subsequent analyses.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># no. subjects over upper bound</span></span>
<span><span class="va">max_fup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">labs</span><span class="op">$</span><span class="va">COLLECTION_DATE</span><span class="op">)</span></span>
<span><span class="va">max_fup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">max_fup</span><span class="op">)</span></span>
<span><span class="va">n.upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict</span>, <span class="va">max_fup</span> <span class="op">-</span> <span class="va">date.of.diag</span> <span class="op">&lt;</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">365.25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># no. subjects under lower bound</span></span>
<span><span class="va">n.lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict</span>, <span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2004</span><span class="op">)</span> <span class="op">|</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2004</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># subset to subjects meeting the criteria.</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict</span>, <span class="va">max_fup</span> <span class="op">-</span> <span class="va">date.of.diag</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">365.25</span><span class="op">)</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict</span>, <span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2005</span><span class="op">)</span> <span class="op">|</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2004</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As described in the <a href="#inclusionexclusion-criteria-definitions">inclusion/exclusion criteria section</a>, the inclusion criteria considers upper and lower bounds for the diagnostic dates. In this case, we only consider subjects diagnosed after October 2004 and 13 August 2019 (this ensures individuals can be followed up by at least 5 year by the time of the last longitudinal measument obtained for the cohort; 2024-08-13). As such, subjects who do not meet this criteria will be excluded. 77 subjects were diagnosed on 13 August 2019 or later and were removed, and 4561 subjects were diagnosed prior to October 2004 and were likewise removed. This results in a cohort size of 5508 subjects.</p>
</section><section id="exploration" class="level2"><h2 class="anchored" data-anchor-id="exploration">Exploration</h2>
<!--- CAV: we should move this into an EDA script --->
<p>We now explore date of diagnosis to ensure data quality is at a suitable standard.</p>
<section id="year-of-diagnosis" class="level5"><h5 class="anchored" data-anchor-id="year-of-diagnosis">Year of diagnosis</h5>
<p>From <a href="#fig-diag-year" class="quarto-xref">Figure&nbsp;1</a>, we can see the number of IBD diagnoses each year is relatively static with the exception of 2004 and 2005. The former describes only three months of the year, and incidence was likely still increasing across both of these two years. <span class="citation" data-cites="Jones2019">Jones et al. (<a href="#ref-Jones2019" role="doc-biblioref">2019</a>)</span> found IBD incidence from 2008 onwards to be consistent over time for patients diagnosed by NHS Lothian which is in agreement with our findings.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#B8F2E6"</span>, color <span class="op">=</span> <span class="st">"black"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year of IBD diagnosis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diag-year" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diag-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-diag-year-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diag-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Distribution of year of diagnosis
</figcaption></figure>
</div>
</div>
</div>
</section><section id="month-of-diagnosis" class="level5"><h5 class="anchored" data-anchor-id="month-of-diagnosis">Month of diagnosis</h5>
<p>It appears there are subjects for whom only year of diagnosis was available. This has resulted in the 1<sup>st</sup> of January for that year being recorded as the date of diagnosis for that subject. As such, far more diagnoses are reported in January than in other months (<a href="#fig-diag-month" class="quarto-xref">Figure&nbsp;3</a>). There are 1062 subjects reported to have been diagnosed on New Year’s day .</p>
<p>If a subject’s exact date of diagnosis is not known, then this is most likely because the subject was not diagnosed by NHS Lothian. Instead, the date of diagnosis would have needed to be recalled by the subject which introduces the inaccuracy observed.</p>
<p>As subjects are require a diagnostic biomarker measurement to be available within 90 days of reported date of diagnosis to be included in this study and patients diagnosed outside of NHS Lothian will not have a biomarker test result available within this period, the effect on our study should be minimal. However, we will revisit month of diagnosis after filtering by existence of diagnostic biomarker measurements to confirm our assumption.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date.of.diag</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#FEC601"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year of IBD Diagnosis"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diag-year-processed" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diag-year-processed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-diag-year-processed-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diag-year-processed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Bar plot of year of diagnosis
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date.of.diag</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#FEC601"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Month of IBD Diagnosis"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diag-month" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diag-month-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-diag-month-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diag-month-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Bar plot of month of diagnosis
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diag.ts</span> <span class="op">&lt;-</span> <span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    date.of.diag.month <span class="op">=</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">date.of.diag</span>, <span class="st">"%Y-%m"</span><span class="op">)</span>, <span class="st">"-01"</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date.of.diag.month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diag.ts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">date.of.diag.month</span>, <span class="st">"%Y-%m"</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">count</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Diagnosis date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of diagnosis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%Y-%m"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="preprocessing_files/figure-html/diagnostic trend-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="faecal-calprotectin" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="faecal-calprotectin">Faecal calprotectin</h2>
<p>Faecal calprotectin (FC), a marker of intestinal inflammation, has been obtained from two datasets. The first dataset has been curated by members of the Lees group whilst the second dataset is a direct extract from TRAK, a patient monitoring system used by NHS Lothian.</p>
<section id="incorporating-later-extract" class="level3"><h3 class="anchored" data-anchor-id="incorporating-later-extract">Incorporating later extract</h3>
<p>Data from these datasets has been merged and duplicates of data (same subject ID, measurement date, and recorded value) were removed. We also reduced the FC dataset to only describe subjects for whom IBD type and date of diagnosis are available for.</p>
<p>For the TRAK extract, times for test results are given in datetime format (where both date and time of the day are provided). The times have been dropped as this degree of granularity is not required. Duplicate tests (same id, date and test value) are removed here.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="va">fcal</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"ids"</span>,</span>
<span>  <span class="st">"COLLECTION_DATE"</span>,</span>
<span>  <span class="st">"TEST_DATA"</span>,</span>
<span>  <span class="st">"sex"</span>,</span>
<span>  <span class="st">"diagnosis"</span>,</span>
<span>  <span class="st">"diagnosis_date"</span></span>
<span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Subset to only include those that passed the earlier inclusion/exclusion</span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">dict</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collection dates include collection times which are not required. Discarding.</span></span>
<span></span>
<span><span class="va">fcal</span><span class="op">$</span><span class="va">COLLECTION_DATE</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">parse_date</a></span><span class="op">(</span></span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">COLLECTION_DATE</span>, <span class="st">" "</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"calpro_date"</span>, <span class="st">"calpro_result"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">dict</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">diagnosis</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">fcal</span>,</span>
<span>  <span class="va">dict</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"diagnosis"</span>, <span class="st">"date.of.diag"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"ids"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="pre-processing-of-test-results" class="level3"><h3 class="anchored" data-anchor-id="pre-processing-of-test-results">Pre-processing of test results</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Some values cannot be directly coerced as numeric</span></span>
<span></span>
<span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span></span>
<span>  <span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span>,</span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"&lt;20"</span>,</span>
<span>    <span class="st">"&lt;25"</span>,</span>
<span>    <span class="st">"&lt;50"</span>,</span>
<span>    <span class="st">"&gt;1250"</span>,</span>
<span>    <span class="st">"&gt;2500"</span>,</span>
<span>    <span class="st">"&gt;3000"</span>,</span>
<span>    <span class="st">"&gt;6000"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"20"</span>,</span>
<span>    <span class="st">"25"</span>,</span>
<span>    <span class="st">"50"</span>,</span>
<span>    <span class="st">"1250"</span>,</span>
<span>    <span class="st">"2500"</span>,</span>
<span>    <span class="st">"3000"</span>,</span>
<span>    <span class="st">"6000"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Here, values that cannot be converted into a numeric value will be excluded</span></span>
<span><span class="co"># (they are converted to NA)</span></span>
<span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span> <span class="co"># Remove error codes</span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="va">fcal</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">[</span>, <span class="st">"calpro_result"</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Apply limits of detection</span></span>
<span><span class="va">fcal</span><span class="op">[</span><span class="va">fcal</span><span class="op">[</span>, <span class="st">"calpro_result"</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">20</span>, <span class="st">"calpro_result"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">fcal</span><span class="op">[</span><span class="va">fcal</span><span class="op">[</span>, <span class="st">"calpro_result"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1250</span>, <span class="st">"calpro_result"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1250</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>FC data can be both left and right censored. FC recorded as “&lt;20” were mapped to “20”. FC recorded as “&gt;1250”, “&gt;2500”, or “&gt;6000” were all mapped to “1250”. Any FC tests given an error code (e.g.&nbsp;marked as an insufficient sample by the laboratory) have been removed.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
More information on FC censoring
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The lower limit of detection is <span class="math inline">&lt;20 \mu g/g</span> (<span class="math inline">20 \mu g</span> of calprotectin per <span class="math inline">g</span> of stool). By reducing the upper limit, it is possible to run more tests in parallel. As a higher throughput has been required over time, the upper threshold for tests has become lower. Initially test results over <span class="math inline">6000 \mu g/g</span> were censored, then <span class="math inline">2500 \mu g/g</span> and now <span class="math inline">1250 \mu g /g</span> is the upper limit for FC tests. This change has resulted in minimal impact in clinics as <span class="math inline">1250 \mu g/g</span> is still considered a high result. However, this change has potential implications for research.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">calpro_result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#9FD8CB"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#517664"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"FCAL (µg/g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">250</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-fcal-meas" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcal-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-fcal-meas-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Density plot of FCAL measurements by observed value
</figcaption></figure>
</div>
</div>
</div>
<p>FC test results on the original measurement scale are heavily right-skewed towards <span class="math inline">100 \mu g/g</span>. These data will be log transformed- resulting in the multi-modal distribution seen in <a href="#fig-logfcal-meas" class="quarto-xref">Figure&nbsp;5</a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">calpro_result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#9FD8CB"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#517664"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(FCAL (µg/g))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">250</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logfcal-meas" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-logfcal-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-logfcal-meas-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logfcal-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Density plot of logged FCAL test results
</figcaption></figure>
</div>
</div>
</div>
</section><section id="removal-of-duplicate-fcal-measurements" class="level3"><h3 class="anchored" data-anchor-id="removal-of-duplicate-fcal-measurements">Removal of duplicate FCAL measurements</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">duplicated.ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sub.fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span> <span class="co"># Get FC data for a subject</span></span>
<span>  <span class="va">sub.fcal</span> <span class="op">&lt;-</span> <span class="va">sub.fcal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">sub.fcal</span><span class="op">$</span><span class="va">calpro_date</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># Order by dates</span></span>
<span>  <span class="va">time.diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">sub.fcal</span><span class="op">$</span><span class="va">calpro_date</span><span class="op">)</span> <span class="co"># Find time between ordered dates</span></span>
<span>  <span class="va">value.diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">sub.fcal</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span> <span class="co"># Find difference in observed values</span></span>
<span>  <span class="co"># If two measurements are within 10 days of each other and have the same value</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">time.diff</span> <span class="op">&lt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">value.diff</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">duplicated.ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">duplicated.ids</span>, <span class="va">id</span><span class="op">)</span></span>
<span>    <span class="co"># Remove suspected duplicates (taking into account difference is lagged)</span></span>
<span>    <span class="va">sub.fcal</span> <span class="op">&lt;-</span> <span class="va">sub.fcal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="op">!</span><span class="op">(</span><span class="va">time.diff</span> <span class="op">&lt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">value.diff</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span>    <span class="co"># Remove data for subject with duplicates</span></span>
<span>    <span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op">!=</span> <span class="va">id</span><span class="op">)</span></span>
<span>    <span class="co"># Add non duplicated data back</span></span>
<span>    <span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">sub.fcal</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Given FC was retrospectively collected from observational data, it is possible duplicate tests have been recorded in the extract. As it is NHS Lothian policy to not test FC days apart, we can assume that any tests with the same observation within a small time frame are likely to be duplicates. This may occur when collection dates and testing dates have been used interchangeably.</p>
<p>If a subsequent FC test for a subject was dated within 10 days of a previous test and has the same observed value, this observation was dropped.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"There are"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">duplicated.ids</span><span class="op">)</span>,</span>
<span>  <span class="st">"subjects who appear to have duplicated FC measurements"</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p>There are 27 subjects who appear to have duplicated FC measurements</p>
</div>
</div>
</section><section id="retiming---part-1" class="level3"><h3 class="anchored" data-anchor-id="retiming---part-1">Retiming - part 1</h3>
<p>Time of FC measurements were retimed and scaled to be the number of years since IBD diagnosis.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Dates have already been converted to Date class by fix_date_char() for dict</span></span>
<span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_date</span> <span class="op">-</span> <span class="va">fcal</span><span class="op">$</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365.25</span></span>
<span></span>
<span><span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">calpro_time</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">calpro_result</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time (years)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Log(FCAL (µg/g))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-fcal-spag-pre" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcal-spag-pre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-fcal-spag-pre-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-spag-pre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Spaghetti plot of FC trajectories (preprocessed)
</figcaption></figure>
</div>
</div>
</div>
<p>After retiming, it is clear some FC observations are earlier than diagnosis and in some cases substantially earlier (<a href="#fig-fcal-spag-pre" class="quarto-xref">Figure&nbsp;6</a>). Tests taken close to the reported date of diagnosis are likely “early” as a result of diagnostic delay whereas tests from much earlier were likely requested due to other conditions.</p>
<p>As such, FC results earlier than 90 days prior to diagnosis will be discarded. If a subject has an FC within 90 days before diagnosis, then all of their FC tests will be retimed such that their earliest FC within this period is equal to 0 and all later measurements are shifted accordingly to maintain the same differences between measurement times.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">calpro_time</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">0.25</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="inclusionexclusion-removal-of-subjects-without-a-diagnostic-fc-test" class="level3"><h3 class="anchored" data-anchor-id="inclusionexclusion-removal-of-subjects-without-a-diagnostic-fc-test">Inclusion/exclusion: removal of subjects without a diagnostic FC test</h3>
<p>As indicated in our inclusion/exclusion criteria, we reduce the dataset to only subjects with a diagnostic FC. This equates to subjects with at least one FCAL measurement within 3 months of diagnosis <span class="math inline">t \leq 0.25</span>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diagnostic</span> <span class="op">&lt;-</span> <span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">calpro_time</span> <span class="op">&lt;</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">diagnostic</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After this exclusion, 1554 subjects remain in the data.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">##The following code is used to save the cleaned data generated so far. </span></span>
<span></span>
<span><span class="va">diag.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fc.ids</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="va">fc.ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">calpro_time</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">diag.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">diag.time</span>, <span class="va">temp</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"calpro_time"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">fc.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">fc.ids</span>, diagnostic <span class="op">=</span> <span class="va">diag.time</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fc.dist</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/fc-diag-dist.RDS"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="retiming---part-2" class="level3"><h3 class="anchored" data-anchor-id="retiming---part-2">Retiming - part 2</h3>
<p>Here, we show the distribution of the diagnostic FCAL measurements with respect to diagnosis date (in days).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">calpro_time</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">calpro_time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">calpro_time</span> <span class="op">*</span> <span class="fl">365.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#20A39E"</span>, color <span class="op">=</span> <span class="st">"#187370"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time from diagnosis to first faecal calprotectin (days)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/fc-diagnostic-dist.png"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">16</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Although most diagnostic measurements were observed around the recorded diagnosis time (near zero), this is not always the case. As such, we decided to retime measurements/diagnosis time as described above (i.e.&nbsp;time = 0 matches the time of first available FCAL measurement). This is only applied to individuals for which the first available CRP is prior to the recorded diagnosis time.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retime so that t_0 = 0.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">calpro_time</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">calpro_time</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">fcal</span><span class="op">[</span><span class="va">fcal</span><span class="op">[</span>, <span class="st">"ids"</span><span class="op">]</span> <span class="op">==</span> <span class="va">id</span>, <span class="st">"calpro_time"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="va">fcal</span><span class="op">[</span><span class="va">fcal</span><span class="op">[</span>, <span class="st">"ids"</span><span class="op">]</span> <span class="op">==</span> <span class="va">id</span>, <span class="st">"calpro_time"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">add</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1554</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">calpro_time</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">calpro_result</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time (years)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Log(FCAL (µg/g))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-fcal-spag-post" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcal-spag-post-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-fcal-spag-post-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-spag-post-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Spaghetti plot of FC trajectories (processed)
</figcaption></figure>
</div>
</div>
</div>
<p>At this stage, we also exclude FCAL measurements recorded beyond 7 years post diagnosis.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="va">calpro_time</span> <span class="op">&lt;=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1554</code></pre>
</div>
</div>
<p>At this point, the data contains 11582 FCAL measurements across all 1554 individuals.</p>
</section><section id="inclusionexclusion-a-minimum-number-of-fcal-measurements" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="inclusionexclusion-a-minimum-number-of-fcal-measurements">Inclusion/exclusion: a minimum number of FCAL measurements</h3>
<p>Here, we summarise the number of observations per individual (with and without considering censored values) as well as length of follow-up. The latter is defined as the difference (in years) between diagnosis time and the time of the latest FCAL measurement.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">countsDF</span> <span class="op">&lt;-</span> <span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n.total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    censored.left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">calpro_result</span> <span class="op">==</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>    censored.right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">calpro_result</span> <span class="op">==</span> <span class="fl">1250</span><span class="op">)</span>,</span>
<span>    n.noncensored <span class="op">=</span> <span class="va">n.total</span> <span class="op">-</span> <span class="va">censored.left</span> <span class="op">-</span> <span class="va">censored.right</span>,</span>
<span>    n.negtime.nondiag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">calpro_time</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">calpro_date</span> <span class="op">-</span> <span class="va">date.of.diag</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    followup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">calpro_time</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell page-columns page-full">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n.total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Measurements per subject"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years)"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">n.total</span>, x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years since diagnosis)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of FC measurements"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-fcal-follow-up" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-fcal-follow-up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="preprocessing_files/figure-html/fig-fcal-follow-up-1.png" class="img-fluid figure-img column-body-outset" width="1152">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-follow-up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: (A) Histogram of the number of FCAL measurements per subject. (B) Histogram of FCAL follow-up per subject (before exclusions). (C) Scatterplot with number of FCAL measurements vs follow-up.
</figcaption></figure>
</div>
</div>
</div>
<p>Summary observations:</p>
<ul>
<li>The number of FC measurements per subject is skewed towards low values. However, there are also subjects with many FC observations. These subjects were investigated and found to often have a complex disease course, such as acute severe ulcerative colitis, and required close monitoring as a result.</li>
<li>We do not directly require a minimum follow-up for a subject as this may bias our findings. For example, UC patients who undergo a proctocolectomy (surgical removal of the colon and rectum) are less likely to have FC measurements after their surgery than patients who did not require surgery. By applying criteria based on follow-up, we could indirectly exclude subjects based on disease outcomes.</li>
<li>However, the requirement of at least 3 FCAL measurements (within 7 years from diagnosis) will indirectly remove individuals with a very short follow-up time.</li>
</ul>
<p>Note that our inclusion criteria requires at least 3 non-censored FCAL measurements per individual. As such, censoring needs to be taken into account before applying filtering out individuals.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n.noncensored</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Number of non-censored measurements per subject"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">n.noncensored</span>, x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#FF4F79"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years since diagnosis)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of non-censored FCAL measurements"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="preprocessing_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of individuals with at least 3 FCAL measurements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1155</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of individuals with at least 3 non-censored FCAL measurements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.noncensored</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1036</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of individuals with at least 3 non-censored FCAL measurements after</span></span>
<span><span class="co"># discarding non-diagnostic values with negative calpro_time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.noncensored</span> <span class="op">-</span> <span class="va">countsDF</span><span class="op">$</span><span class="va">n.negtime.nondiag</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1028</code></pre>
</div>
</div>
<p>The following is used to select individuals with at least 3 non-censored FCAL measurements.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op">&lt;-</span> <span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">countsDF</span><span class="op">$</span><span class="va">ids</span><span class="op">[</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.noncensored</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1036</code></pre>
</div>
</div>
<p>This leaves a cohort with 1036 individuals.</p>
<div class="cell page-columns page-full">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n.noncensored</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n.total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Measurements per subject"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n.noncensored</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years)"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n.noncensored</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">n.total</span>, x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years since diagnosis)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of FC measurements"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-fcal-follow-up-post" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-fcal-follow-up-post-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="preprocessing_files/figure-html/fig-fcal-follow-up-post-1.png" class="img-fluid figure-img column-body-outset" width="1152">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-follow-up-post-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: (A) Histogram of the number of FCAL measurements per subject. (B) Histogram of FCAL follow-up per subject (before exclusions). (C) Scatterplot with number of FCAL measurements vs follow-up. In all cases, only individuals with at least 3 non-censored measurements are included.
</figcaption></figure>
</div>
</div>
</div>
<!--- CAV: do we need this here? may remove and keep in an EDA file --->
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  25%   50%   75% 
 5.75  9.00 13.00 </code></pre>
</div>
</div>
</section><section id="revisiting-month-of-diagnosis" class="level3"><h3 class="anchored" data-anchor-id="revisiting-month-of-diagnosis">Revisiting month of diagnosis</h3>
<p>After filtering by subjects who have a diagnostic FC available, January is no longer over-represented for month of diagnosis as we hypothesised (<a href="#fig-diag-month-redux" class="quarto-xref">Figure&nbsp;10</a>)</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict.temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dict.temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date.of.diag</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#FEC601"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Month of IBD Diagnosis"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diag-month-redux" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diag-month-redux-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-diag-month-redux-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diag-month-redux-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Bar plot of month of diagnosis
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="c-reactive-protein" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="c-reactive-protein">C-reactive protein</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="va">crp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"COLLECTION_DATE"</span>, <span class="st">"TEST_DATA"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">dict</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collection dates include collection times which are not required. Discarding.</span></span>
<span><span class="va">crp</span><span class="op">$</span><span class="va">COLLECTION_DATE</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">parse_date</a></span><span class="op">(</span></span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">COLLECTION_DATE</span>, <span class="st">" "</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">crp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"crp_date"</span>, <span class="st">"crp_result"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">crp</span>,</span>
<span>  <span class="va">dict</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"diagnosis"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"ids"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>C-reactive protein (CRP) is a blood-based marker of inflammation. Unlike FCAL, which is highly specific to gastrointestinal inflammation, CRP levels are indicative of overall inflammation and are more likely to be affected by extra-intestinal factors such as infections. However, patient adherence to CRP testing is very strong, and CRP has seen historic usage in the field of IBD. Although CRP has been used for many years, we unfortunately only have test results from as early as 2008 due to the transition towards using TRAK for storing CRP results instead of the previous system.</p>
<p>As there is only one extract for CRP data (obtained from TRAK), merging multiple datasets is not required. As with the FCAL data, the recorded time of day for each test has been discarded in favour of the date. Any potential duplicate results have been removed.</p>
<section id="pre-processing-of-test-results-1" class="level3"><h3 class="anchored" data-anchor-id="pre-processing-of-test-results-1">Pre-processing of test results</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span><span class="op">$</span><span class="va">crp_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span></span>
<span>    <span class="va">crp</span><span class="op">$</span><span class="va">crp_result</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"&lt;0.2"</span>, <span class="st">"&lt;1"</span>, <span class="st">"&lt;1."</span>, <span class="st">"&lt;1.0"</span>, <span class="st">"&lt;2"</span>, <span class="st">"&lt;3"</span>, <span class="st">"&lt;3.0"</span>, <span class="st">"&lt;5"</span>,</span>
<span>      <span class="st">"&gt;90"</span>, <span class="st">"&gt;320"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">90</span>, <span class="fl">320</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Lower-bound censoring</span></span>
<span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>crp_result <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">crp_result</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">crp_result</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove error test results</span></span>
<span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="va">crp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">crp</span><span class="op">[</span>, <span class="st">"crp_result"</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># Map numerical &lt;1 test results (e.g 0.2) to 1.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>CRP is left-censored, but does not appear to be right-censored. Multiple cut-offs are reported (1.1, 1.5, 1.6, 2, 3, 3.5, 4) with there also being variations for how <span class="math inline">&lt; 1mg/L</span> is reported (1.5, 1.6, 2). We map every observation <span class="math inline">&lt; 1</span> to 1 and map &lt;2, &lt;3, and &lt; 5 to 2, 3, and 5 respectively. Any failed tests (e.g due to contamination or an insufficient sample being provided) are discarded. As such, <span class="math inline">1mg/L</span> is used as a left censoring value for CRP.</p>
<p>As can be seen in <a href="#fig-crp-meas" class="quarto-xref">Figure&nbsp;11</a>, extremely elevated CRP has been observed in some cases. These observations are physiologically valid. However, these data may skew our models and may be candidates for removal.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">crp_result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#FFC800"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#FF8427"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"CRP (mg/L)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-crp-meas" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crp-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-crp-meas-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crp-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Density plot of FC measurements by observed value
</figcaption></figure>
</div>
</div>
</div>
<p>As with the FC data, the CRP data is also log transformed (<a href="#fig-logcrp-meas" class="quarto-xref">Figure&nbsp;12</a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">crp_result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#FFC800"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#FF8427"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(CRP (mg/L))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logcrp-meas" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-logcrp-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-logcrp-meas-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logcrp-meas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Density plot of logged CRP test results
</figcaption></figure>
</div>
</div>
</div>
<p>Observing <a href="#fig-logcrp-meas" class="quarto-xref">Figure&nbsp;12</a>, it would appear the influence of extremely elevated CRP results will be minimal.</p>
</section><section id="removal-of-duplicates" class="level3"><h3 class="anchored" data-anchor-id="removal-of-duplicates">Removal of duplicates</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">ids</span>,</span>
<span>  <span class="va">crp_date</span>,</span>
<span>  <span class="va">crp_result</span>,</span>
<span>  .keep_all <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As multiple CRP measurements are possible within a short time-frame, we only consider as duplicates those with an exact match by <code>ids</code>, <code>crp_date</code> and <code>crp_result</code>.</p>
</section><section id="retiming---part-1-1" class="level3"><h3 class="anchored" data-anchor-id="retiming---part-1-1">Retiming - part 1</h3>
<p>As with the FCAL data, the times of CRP measurements are retimed and scaled to be the number of years since IBD diagnosis.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">crp</span>, <span class="va">dict</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ids"</span>, <span class="st">"date.of.diag"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"ids"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dates have already been converted to Date class by fix_date_char() for dict</span></span>
<span><span class="va">crp</span><span class="op">$</span><span class="va">crp_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">crp_date</span> <span class="op">-</span> <span class="va">crp</span><span class="op">$</span><span class="va">date.of.diag</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365.25</span></span>
<span></span>
<span><span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">crp_time</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">crp_result</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time (years)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Log(CRP (mg/L))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-crp-spag-pre" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crp-spag-pre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-crp-spag-pre-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crp-spag-pre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Spaghetti plot of CRP trajectories (preprocessed)
</figcaption></figure>
</div>
</div>
</div>
<p>As should be expected given the ubiquitous nature of CRP testing, many CRP observations are earlier than diagnosis (<a href="#fig-crp-spag-pre" class="quarto-xref">Figure&nbsp;13</a>). Tests taken close to reported date of diagnosis are likely “early” as a result of diagnostic delay whereas tests from much earlier were likely requested due to other conditions.</p>
<p>As with FCAL, CRP results earlier than 90 days prior to diagnosis will be discarded. If a subject has a CRP within 90 days before diagnosis, then all of their CRP tests will be retimed such that their earliest CRP within this period is equal to 0 and all later measurements are shifted accordingly to maintain the same differences between measurement times.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This may mean <span class="math inline">t_0</span> corresponds to slightly different dates across FCAL and CRP for the same subject.</p>
</div>
</div>
<p>We also reduce the dataset to only subjects with a diagnostic CRP which equates to subjects with a CRP measurement within 3 months of diagnosis <span class="math inline">t \leq 0.25</span></p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">crp</span>, <span class="va">crp_time</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">0.25</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="inclusionexclusion-removal-of-subjects-without-a-diagnostic-crp-test" class="level3"><h3 class="anchored" data-anchor-id="inclusionexclusion-removal-of-subjects-without-a-diagnostic-crp-test">Inclusion/exclusion: removal of subjects without a diagnostic CRP test</h3>
<p>As indicated in our inclusion/exclusion criteria, we reduce the dataset to only subjects with a diagnostic FC. This equates to subjects with at least one FCAL measurement within 3 months of diagnosis <span class="math inline">t \leq 0.25</span>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diagnostic</span> <span class="op">&lt;-</span> <span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">crp_time</span> <span class="op">&lt;</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">crp</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">diagnostic</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After this exclusion, 2406 remain in the data.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diag.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">crp.ids</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="va">crp.ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">crp</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">crp_time</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">diag.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">diag.time</span>, <span class="va">temp</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"crp_time"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">crp.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">crp.ids</span>, diagnostic <span class="op">=</span> <span class="va">diag.time</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">crp.dist</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/crp-diag-dist.RDS"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="retiming---part-2-1" class="level3"><h3 class="anchored" data-anchor-id="retiming---part-2-1">Retiming - part 2</h3>
<p>Here, we show the distribution of the diagnostic CRP measurements with respect to diagnosis date (in days).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">crp_time</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">crp_time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">crp_time</span> <span class="op">*</span> <span class="fl">365.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#415A77"</span>, color <span class="op">=</span> <span class="st">"#1B263B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time from diagnosis to first CRP (days)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/crp-diagnostic-dist.png"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">16</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Similar to what was observed for FC, most diagnostic measurements were around the recorded diagnosis time (near zero). Here, we also retime measurements/diagnosis time as described above (i.e.&nbsp;time = 0 matches the time of first available CRP measurement). This is only applied to individuals for which the first available CRP is prior to the recorded diagnosis time.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retime so that t_0 = 0.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">crp</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">crp_time</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">crp_time</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">crp</span><span class="op">[</span><span class="va">crp</span><span class="op">[</span>, <span class="st">"ids"</span><span class="op">]</span> <span class="op">==</span> <span class="va">id</span>, <span class="st">"crp_time"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="va">crp</span><span class="op">[</span><span class="va">crp</span><span class="op">[</span>, <span class="st">"ids"</span><span class="op">]</span> <span class="op">==</span> <span class="va">id</span>, <span class="st">"crp_time"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">add</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2406</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">crp_time</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">crp_result</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time (years)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Log(CRP (mg/L))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="preprocessing_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>At this stage, we also exclude CRP measurements recorded beyond 7-years post diagnosis.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">crp</span>, <span class="va">crp_time</span> <span class="op">&lt;=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2406</code></pre>
</div>
</div>
<p>At this point, the data contains 10545 FCAL measurements across all 1036 individuals.</p>
</section><section id="additional-pre-processing" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="additional-pre-processing">Additional pre-processing</h3>
<p>Here, we summarise the number of observations per individual (with and without considering censored values) as well as length of follow-up. The latter is defined as the difference (in years) between diagnosis time and the time of the latest CRP measurement.</p>
<div class="cell page-columns page-full">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">countsDF</span> <span class="op">&lt;-</span> <span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n.total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    censored.left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">crp_result</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    n.noncensored <span class="op">=</span> <span class="va">n.total</span> <span class="op">-</span> <span class="va">censored.left</span>,</span>
<span>    n.negtime.nondiag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">crp_time</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">crp_date</span> <span class="op">-</span> <span class="va">date.of.diag</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    followup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">crp_time</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n.total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Measurements per subject"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years)"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">n.total</span>, x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years since diagnosis)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of CRP measurements"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-crp-follow-up" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-crp-follow-up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="preprocessing_files/figure-html/fig-crp-follow-up-1.png" class="img-fluid figure-img column-body-outset" width="1152">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crp-follow-up-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: (A) Histogram of the number of CRP measurements per subject. (B) Histogram of CRP follow-up per subject (before exclusions). (C) Scatterplot with number of CRP measurements vs follow-up.
</figcaption></figure>
</div>
</div>
</div>
<p>Our observations are very similar to what we had for FCAL. However, as CRP measurement frequency is higher, we find a lower proportion of individuals with a low follow-up time.</p>
<p>As CRP is not specific to gastrointestinal inflammation, a variety of factors (e.g.&nbsp;infection) can affect the measurements. To focus on long-term trends, further processing was applied to smooth out short-term fluctuations. Measurements were grouped into intervals of t: [0, 0.5), [0.5, 1.5), [1.5, 2.5), [2.5, 3.5), [3.5, 4.5), [4.5, 5.5), [5.5, 7], where t = 0 (years) is the time of diagnosis. The median CRP for each interval was calculated for each subject and used as input for subsequent analyses. The centre of each interval was used as the corresponding observation time.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">id.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span></span>
<span><span class="va">crp.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">id.list</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">id.list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">subject_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">crp</span>, <span class="va">ids</span> <span class="op">==</span> <span class="va">id.list</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>        <span class="va">subject_data</span>,</span>
<span>        <span class="va">crp_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">crp_time</span> <span class="op">&lt;=</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">sub.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>        <span class="va">subject_data</span>,</span>
<span>        <span class="va">crp_time</span> <span class="op">&gt;=</span> <span class="va">j</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">crp_time</span> <span class="op">&lt;</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">crp.ma</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">sub.obs</span><span class="op">$</span><span class="va">crp_result</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id.list</span></span>
<span></span>
<span><span class="co"># Convert back to a long-format dataset and rename columns</span></span>
<span><span class="va">crp.ma</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">)</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"crp_time"</span>, <span class="st">"ids"</span>, <span class="st">"crp_result"</span><span class="op">)</span></span>
<span><span class="va">crp.ma</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Reset the time to start at zero</span></span>
<span><span class="va">crp.ma</span><span class="op">$</span><span class="va">crp_time</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span><span class="op">$</span><span class="va">crp_time</span> <span class="op">-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Take into account uneven spacing at start and end</span></span>
<span><span class="va">crp.ma</span><span class="op">$</span><span class="va">crp_time</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">$</span><span class="va">crp_time</span>,</span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">6.25</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add diagnosis type back</span></span>
<span><span class="va">crp.ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">crp.ma</span>, <span class="va">dict</span><span class="op">[</span>, <span class="op">-</span><span class="fl">3</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"ids"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="inclusionexclusion-a-minimum-number-of-crp-measurements" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="inclusionexclusion-a-minimum-number-of-crp-measurements">Inclusion/exclusion: a minimum number of CRP measurements</h3>
<p>Note that our inclusion criteria requires at least 3 CRP measurements per individual. This is applied after the additional pre-processing applied in the previous section. Here, we re-calculate relevant summary statistics.</p>
<div class="cell page-columns page-full">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">countsDF</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n.total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    censored.left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">crp_result</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># 0 because it was log transformed</span></span>
<span>    n.noncensored <span class="op">=</span> <span class="va">n.total</span> <span class="op">-</span> <span class="va">censored.left</span>,</span>
<span>    followup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">crp_time</span><span class="op">)</span>,</span>
<span>    crp.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">crp_result</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n.total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Measurements per subject"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years)"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">n.total</span>, x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years since diagnosis)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of CRP measurements"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-crp-follow-up-postproc" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-crp-follow-up-postproc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="preprocessing_files/figure-html/fig-crp-follow-up-postproc-1.png" class="img-fluid figure-img column-body-outset" width="1152">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crp-follow-up-postproc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: (A) Histogram of the number of CRP measurements per subject. (B) Histogram of CRP follow-up per subject (before exclusions). (C) Scatterplot with number of CRP measurements vs follow-up.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of individuals with at least 3 CRP measurements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1939</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of individuals with at least 3 CRP measurements and non zero variance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">countsDF</span><span class="op">$</span><span class="va">crp.var</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1838</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of individuals with at least 3 non-censored FCAL measurements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.noncensored</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1939</code></pre>
</div>
</div>
<p>The following is used to select individuals with at least 3 CRP measurements and non-zero variance.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp.ma.0</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">countsDF</span><span class="op">$</span><span class="va">ids</span><span class="op">[</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">countsDF</span><span class="op">$</span><span class="va">crp.var</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">crp.ma.0</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/crp-ma-0.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crp.ma</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">countsDF</span><span class="op">$</span><span class="va">ids</span><span class="op">[</span><span class="va">countsDF</span><span class="op">$</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">countsDF</span><span class="op">$</span><span class="va">crp.var</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1838</code></pre>
</div>
</div>
<p>This leaves a cohort with 2406 individuals.</p>
<!--- CAV: I think we could include the nonzero variance subjects here --->
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">crp.var</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n.total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Measurements per subject"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">crp.var</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#5BBA6F"</span>, binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years)"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">countsDF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">n.total</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">crp.var</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">n.total</span>, x <span class="op">=</span> <span class="va">followup</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#FF4F79"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Follow-up (years since diagnosis)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of FCAL measurements"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-crp-follow-up-post-exclusions" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crp-follow-up-post-exclusions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-crp-follow-up-post-exclusions-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crp-follow-up-post-exclusions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: (A) Histogram of the number of CRP measurements per subject. (B) Histogram of FCAL follow-up per subject (before exclusions). (C) Scatterplot with number of CRP measurements vs follow-up. In all cases, only individuals with at least 3 measurements and non-zero variance are included.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="additional-pre-processing-1" class="level3"><h3 class="anchored" data-anchor-id="additional-pre-processing-1">Additional pre-processing</h3>
<p>Some subjects have the same median log-transformed CRP across all of their observations, effectively having a variance of 0. These subjects will be extracted and considered as their own cluster, as they may cause numerical issues when model fitting but remain of note.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">crp_result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#EE92C2"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#7B5D6F"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"CRP (mg/L)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">crp_result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#ADF1D2"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#50635A"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(CRP (mg/L))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="preprocessing_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/crp-dist-ma.pdf"</span>, <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4.5</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are 9898 total data points after the additional preprocessing describing 1838 subjects.</p>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-crp-ma-freq" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-crp-ma-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Quantiles for number of CRP observations per subject after additional preprocessing.
</figcaption><div aria-describedby="tbl-crp-ma-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>25% 50% 75% 
  4   6   7 </code></pre>
</div>
</div>
</figure>
</div>
</section><section id="revisiting-month-of-diagnosis-1" class="level3"><h3 class="anchored" data-anchor-id="revisiting-month-of-diagnosis-1">Revisiting month of diagnosis</h3>
<p>After filtering by subjects who have a diagnostic CRP available, January is no longer over-represented for month of diagnosis. This is a comparable finding to FC (<a href="#fig-diag-month-redux" class="quarto-xref">Figure&nbsp;10</a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dict.temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dict</span>, <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dict.temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date.of.diag</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"#FEC601"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Month of IBD Diagnosis"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diag-month-redux-crp" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diag-month-redux-crp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-diag-month-redux-crp-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diag-month-redux-crp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Bar plot of month of diagnosis
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="updated-density-plots" class="level2"><h2 class="anchored" data-anchor-id="updated-density-plots">Updated density plots</h2>
<p>The following plots are updated versions of previous density plots (<a href="#fig-fcal-meas" class="quarto-xref">Figure&nbsp;4</a>, <a href="#fig-logfcal-meas" class="quarto-xref">Figure&nbsp;5</a>, <a href="#fig-crp-meas" class="quarto-xref">Figure&nbsp;11</a> and <a href="#fig-logcrp-meas" class="quarto-xref">Figure&nbsp;12</a>). These plots only include subjects who have met the inclusion criteria.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">calpro_result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#2E86AB"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#07004D"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"FC (µg/g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-fcal-meas-update" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcal-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-fcal-meas-update-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcal-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Updated density plot of FC measurements by observed value
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">calpro_result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#F7A072"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#936136"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(FC (µg/g))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/fcal-dist.pdf"</span>, <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4.5</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logfcal-meas-update" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-logfcal-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-logfcal-meas-update-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logfcal-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Updated density plot of logged FC test results
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">crp_result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#EE92C2"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#7B5D6F"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"CRP (mg/L)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-crp-meas-update" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crp-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-crp-meas-update-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crp-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Updated density plot of CRP measurements by observed value
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">crp_result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#ADF1D2"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#50635A"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(CRP (mg/L))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/crp-dist.pdf"</span>, <span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4.5</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logcrp-meas-update" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-logcrp-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-logcrp-meas-update-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logcrp-meas-update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: Updated density plot of logged CRP test results
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">crp_result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#EE92C2"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#7B5D6F"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Processed CRP (mg/L)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-crp-meas-processed" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-crp-meas-processed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-crp-meas-processed-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crp-meas-processed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Updated density plot of CRP after additional preprocessing
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p6</span> <span class="op">&lt;-</span> <span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">crp_result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#ADF1D2"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#50635A"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(processed CRP (mg/L))"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/crp-processed-dist.pdf"</span>,</span>
<span>  <span class="va">p5</span> <span class="op">+</span> <span class="va">p6</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p5</span> <span class="op">+</span> <span class="va">p6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.tag <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"plots/Sup-Figure-1.pdf"</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"in"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logcrp-meas-processed" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-logcrp-meas-processed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="preprocessing_files/figure-html/fig-logcrp-meas-processed-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logcrp-meas-processed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23: Updated density plot of logged CRP after additional preprocessing
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of CRP observations (unprocessed) per subject</span></span>
<span><span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>25% 50% 75% 
 10  20  36 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 49364</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Number of CRP observations (unprocessed) per subject for the overlap cohort</span></span>
<span><span class="va">crp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>25% 50% 75% 
 14  26  43 </code></pre>
</div>
</div>
</section><section id="data-saving" class="level2"><h2 class="anchored" data-anchor-id="data-saving">Data saving</h2>
<p>The processed subject dictionary and FC and CRP datasets have been saved to files, so they can be used for the primary analysis.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">fcal</span><span class="op">$</span><span class="va">calpro_result</span><span class="op">)</span></span>
<span><span class="va">crp.ma</span><span class="op">$</span><span class="va">crp_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">crp.ma</span><span class="op">$</span><span class="va">crp_result</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">dict</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/dict-initial.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fcal</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/fcal.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">crp</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/crp.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">crp.ma</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="st">"processed/median-crp.RDS"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fcal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">crp.ma</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>25% 50% 75% 
  6   9  14 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crp.ma</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ids</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">fcal</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>25% 50% 75% 
  5   6   7 </code></pre>
</div>
</div>
</section><div id="quarto-appendix" class="default"><section id="acknowledgments" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">
<p>This work is funded by the Medical Research Council &amp; University of Edinburgh via a Precision Medicine PhD studentship (MR/N013166/1, to <strong>NC-C</strong>).</p>
</div></section><section id="author-contributions" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Author contributions</h2><div class="quarto-appendix-contents">
<p><strong>NC-C</strong> performed the processing and wrote the text. <strong>NP</strong>, <strong>ML</strong>, curated and provided datasets. <strong>KM-G</strong>, <strong>CWL</strong>, and <strong>CAV</strong> provided supervisory support and assisted with revisions.</p>
</div></section><section id="references" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Jenkinson2020" class="csl-entry" role="listitem">
Jenkinson, P W, N Plevris, S Siakavellas, M Lyons, I D Arnott, D Wilson, A J M Watson, G-R Jones, and C W Lees. 2020. <span>“Temporal Trends in Surgical Resection Rates and Biologic Prescribing in Crohn’s Disease: A Population-Based Cohort Study.”</span> <em>Journal of Crohn<span></span>s and Colitis</em> 14 (9): 1241–47. <a href="https://doi.org/10.1093/ecco-jcc/jjaa044">https://doi.org/10.1093/ecco-jcc/jjaa044</a>.
</div>
<div id="ref-Jones2019" class="csl-entry" role="listitem">
Jones, Gareth-Rhys, Mathew Lyons, Nikolas Plevris, Philip W Jenkinson, Cathy Bisset, Christopher Burgess, Shahida Din, et al. 2019. <span>“<span>IBD</span> Prevalence in Lothian, Scotland, Derived by Capture-Recapture Methodology.”</span> <em>Gut</em> 68 (11): 1953–60. <a href="https://doi.org/10.1136/gutjnl-2019-318936">https://doi.org/10.1136/gutjnl-2019-318936</a>.
</div>
</div>
</div></section><section id="reuse" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents">
<p>Licensed by <a href="https://creativecommons.org/licenses/by/4.0/">CC BY</a> unless otherwise stated.</p>
</div></section><section id="section" class="level2 appendix"><h2 class="anchored quarto-appendix-heading"></h2><div class="quarto-appendix-contents">
<div class="center">
<p><img src="../../images/MRC_HGU_Edinburgh RGB.png" alt="MRC Human Genetics Unit logo" class="center" height="50px"><img src="../../images/cgem-logo.png" alt="Centre for Genomic &amp; Experimental Medicine logo" height="50px"></p>
</div>
<hr></div></section><section id="session-info" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Session info</h2><div class="quarto-appendix-contents">
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><strong>R version 4.4.1 (2024-06-14)</strong></p>
<p><strong>Platform:</strong> aarch64-apple-darwin20</p>
<p><strong>locale:</strong> en_GB.UTF-8||en_GB.UTF-8||en_GB.UTF-8||C||en_GB.UTF-8||en_GB.UTF-8</p>
<p><strong>attached base packages:</strong> <em>stats</em>, <em>graphics</em>, <em>grDevices</em>, <em>utils</em>, <em>datasets</em>, <em>methods</em> and <em>base</em></p>
<p><strong>other attached packages:</strong> <em>patchwork(v.1.3.0)</em>, <em>datefixR(v.1.7.0)</em>, <em>pander(v.0.6.5)</em>, <em>knitr(v.1.48)</em>, <em>lubridate(v.1.9.3)</em>, <em>forcats(v.1.0.0)</em>, <em>stringr(v.1.5.1)</em>, <em>dplyr(v.1.1.4)</em>, <em>purrr(v.1.0.2)</em>, <em>readr(v.2.1.5)</em>, <em>tidyr(v.1.3.1)</em>, <em>tibble(v.3.2.1)</em>, <em>ggplot2(v.3.5.1)</em> and <em>tidyverse(v.2.0.0)</em></p>
<p><strong>loaded via a namespace (and not attached):</strong> <em>viridis(v.0.6.5)</em>, <em>utf8(v.1.2.4)</em>, <em>generics(v.0.1.3)</em>, <em>lattice(v.0.22-6)</em>, <em>stringi(v.1.8.4)</em>, <em>hms(v.1.1.3)</em>, <em>digest(v.0.6.37)</em>, <em>magrittr(v.2.0.3)</em>, <em>evaluate(v.1.0.1)</em>, <em>grid(v.4.4.1)</em>, <em>timechange(v.0.3.0)</em>, <em>fastmap(v.1.2.0)</em>, <em>plyr(v.1.8.9)</em>, <em>jsonlite(v.1.8.9)</em>, <em>gridExtra(v.2.3)</em>, <em>fansi(v.1.0.6)</em>, <em>viridisLite(v.0.4.2)</em>, <em>scales(v.1.3.0)</em>, <em>textshaping(v.0.4.0)</em>, <em>codetools(v.0.2-20)</em>, <em>cli(v.3.6.3)</em>, <em>rlang(v.1.1.4)</em>, <em>munsell(v.0.5.1)</em>, <em>withr(v.3.0.2)</em>, <em>yaml(v.2.3.10)</em>, <em>tools(v.4.4.1)</em>, <em>reshape2(v.1.4.4)</em>, <em>tzdb(v.0.4.0)</em>, <em>colorspace(v.2.1-1)</em>, <em>vctrs(v.0.6.5)</em>, <em>R6(v.2.5.1)</em>, <em>lifecycle(v.1.0.4)</em>, <em>htmlwidgets(v.1.6.4)</em>, <em>ragg(v.1.3.3)</em>, <em>pkgconfig(v.2.0.3)</em>, <em>hexbin(v.1.28.4)</em>, <em>pillar(v.1.9.0)</em>, <em>gtable(v.0.3.6)</em>, <em>glue(v.1.8.0)</em>, <em>Rcpp(v.1.0.13-1)</em>, <em>systemfonts(v.1.1.0)</em>, <em>xfun(v.0.49)</em>, <em>tidyselect(v.1.2.1)</em>, <em>farver(v.2.1.2)</em>, <em>htmltools(v.0.5.8.1)</em>, <em>rmarkdown(v.2.28)</em>, <em>labeling(v.0.4.3)</em> and <em>compiler(v.4.4.1)</em></p>
</div>
</div>


<!-- -->

</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb95" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Preprocessing"</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Nathan Constantine-Cooke"</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: true</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://scholar.google.com/citations?user=2emHWR0AAAAJ&amp;hl=en&amp;oi=ao</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: CGEM</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: HGU</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Karla Monterrubio-Gómez"</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://scholar.google.com/citations?user=YmyxSXAAAAAJ&amp;hl=en</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: HGU</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: CGEM</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Catalina A. Vallejos"</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://scholar.google.com/citations?user=lkdrwm0AAAAJ&amp;hl=en&amp;oi=ao</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: HGU</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a><span class="co">#comments:</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  giscus: </span></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    repo: quarto-dev/quarto-docs</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Package load}</span></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a><span class="in">#| cache: false</span></span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a><span class="in">### Required packages</span></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse) # ggplot2, dplyr, and magrittr</span></span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr) # Markdown utilities</span></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(pander) # Pretty markdown rendering</span></span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(datefixR) # Standardising dates</span></span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(lubridate) # Date handling</span></span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork) # Arranging plots</span></span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a>This page details preprocessing steps undertaken prior to model fitting.</span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a>These steps include examining data quality, performing data cleaning,</span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a>and deriving the study cohort.</span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a>The biomarker (FC and CRP) data used in this pipeline have been</span>
<span id="cb95-48"><a href="#cb95-48" aria-hidden="true" tabindex="-1"></a>primarily obtained from TRAK, a system used by NHS Lothian for the</span>
<span id="cb95-49"><a href="#cb95-49" aria-hidden="true" tabindex="-1"></a>electronic ordering of laboratory tests. However, we also use</span>
<span id="cb95-50"><a href="#cb95-50" aria-hidden="true" tabindex="-1"></a>phenotyping data manually curated by the Lees group for previous studies</span>
<span id="cb95-51"><a href="#cb95-51" aria-hidden="true" tabindex="-1"></a>(see @Jenkinson2020).</span>
<span id="cb95-52"><a href="#cb95-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-53"><a href="#cb95-53" aria-hidden="true" tabindex="-1"></a>Prior to this report, all subject CHI (community health index) numbers,</span>
<span id="cb95-54"><a href="#cb95-54" aria-hidden="true" tabindex="-1"></a>which uniquely identifies a patient when they interact with NHS Scotland</span>
<span id="cb95-55"><a href="#cb95-55" aria-hidden="true" tabindex="-1"></a>services, were pseudoanonymised. Each CHI has been replaced with a</span>
<span id="cb95-56"><a href="#cb95-56" aria-hidden="true" tabindex="-1"></a>unique random number.</span>
<span id="cb95-57"><a href="#cb95-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-58"><a href="#cb95-58" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inclusion/exclusion criteria definitions {#inclusionexclusion-criteria-definitions}</span></span>
<span id="cb95-59"><a href="#cb95-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-60"><a href="#cb95-60" aria-hidden="true" tabindex="-1"></a>The inclusion criteria for this study can broadly be categorised into</span>
<span id="cb95-61"><a href="#cb95-61" aria-hidden="true" tabindex="-1"></a>two classifications: baseline and longitudinal. Baseline criteria can be</span>
<span id="cb95-62"><a href="#cb95-62" aria-hidden="true" tabindex="-1"></a>applied using information known at diagnosis whilst longitudinal</span>
<span id="cb95-63"><a href="#cb95-63" aria-hidden="true" tabindex="-1"></a>criteria are based on biomarker measurements taken over time.</span>
<span id="cb95-64"><a href="#cb95-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-65"><a href="#cb95-65" aria-hidden="true" tabindex="-1"></a>The longitudinal criteria for each biomarker (FC and CRP) are considered</span>
<span id="cb95-66"><a href="#cb95-66" aria-hidden="true" tabindex="-1"></a>independently. If a subject meets the below criteria for FC but not CRP,</span>
<span id="cb95-67"><a href="#cb95-67" aria-hidden="true" tabindex="-1"></a>then only the FC for the subject will be modelled and vice versa.</span>
<span id="cb95-68"><a href="#cb95-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-69"><a href="#cb95-69" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb95-70"><a href="#cb95-70" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Baseline</span></span>
<span id="cb95-71"><a href="#cb95-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-72"><a href="#cb95-72" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Diagnosis of Inflammatory bowel disease</span></span>
<span id="cb95-73"><a href="#cb95-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-74"><a href="#cb95-74" aria-hidden="true" tabindex="-1"></a>As inflammatory bowel disease (IBD) is the disease of interest for this</span>
<span id="cb95-75"><a href="#cb95-75" aria-hidden="true" tabindex="-1"></a>study, subjects are required to have a confirmed diagnosis of either</span>
<span id="cb95-76"><a href="#cb95-76" aria-hidden="true" tabindex="-1"></a>Crohn's disease, ulcerative colitis, or inflammatory bowel disease</span>
<span id="cb95-77"><a href="#cb95-77" aria-hidden="true" tabindex="-1"></a>unclassified.</span>
<span id="cb95-78"><a href="#cb95-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-79"><a href="#cb95-79" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Diagnosis date</span></span>
<span id="cb95-80"><a href="#cb95-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-81"><a href="#cb95-81" aria-hidden="true" tabindex="-1"></a>Study subjects are required to have been diagnosed with IBD between</span>
<span id="cb95-82"><a href="#cb95-82" aria-hidden="true" tabindex="-1"></a>October 2004 and December 2017. The lower bound is required as FC tests</span>
<span id="cb95-83"><a href="#cb95-83" aria-hidden="true" tabindex="-1"></a>were not introduced until 2005 and we require study subjects to have a</span>
<span id="cb95-84"><a href="#cb95-84" aria-hidden="true" tabindex="-1"></a>FC available close to diagnosis (see the longitudinal tab). The upper</span>
<span id="cb95-85"><a href="#cb95-85" aria-hidden="true" tabindex="-1"></a>bound is required to ensure subjects have the opportunity to have at</span>
<span id="cb95-86"><a href="#cb95-86" aria-hidden="true" tabindex="-1"></a>least five years of follow-up. The most recent FC observation in this</span>
<span id="cb95-87"><a href="#cb95-87" aria-hidden="true" tabindex="-1"></a>dataset is January 2023 which informed when deciding upon this cut-off.</span>
<span id="cb95-88"><a href="#cb95-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-89"><a href="#cb95-89" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Longitudinal</span></span>
<span id="cb95-90"><a href="#cb95-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-91"><a href="#cb95-91" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Diagnostic measurement</span></span>
<span id="cb95-92"><a href="#cb95-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-93"><a href="#cb95-93" aria-hidden="true" tabindex="-1"></a>We require study subjects to have a biomarker measurement taken ±90 days</span>
<span id="cb95-94"><a href="#cb95-94" aria-hidden="true" tabindex="-1"></a>of reported date of diagnosis.</span>
<span id="cb95-95"><a href="#cb95-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-96"><a href="#cb95-96" aria-hidden="true" tabindex="-1"></a><span class="fu">##### At least three non-censored measurements</span></span>
<span id="cb95-97"><a href="#cb95-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-98"><a href="#cb95-98" aria-hidden="true" tabindex="-1"></a>To ensure stability and interpretability, study subjects are also</span>
<span id="cb95-99"><a href="#cb95-99" aria-hidden="true" tabindex="-1"></a>required to have at three non-censored biomarker measurements taken</span>
<span id="cb95-100"><a href="#cb95-100" aria-hidden="true" tabindex="-1"></a>across follow-up. Like most biomarkers, the biomarkers used in this</span>
<span id="cb95-101"><a href="#cb95-101" aria-hidden="true" tabindex="-1"></a>study are subject to censoring. However, these censored observations</span>
<span id="cb95-102"><a href="#cb95-102" aria-hidden="true" tabindex="-1"></a>make it impossible to detect changes over time and we therefore do not</span>
<span id="cb95-103"><a href="#cb95-103" aria-hidden="true" tabindex="-1"></a>wish to be reliant on censored observations.</span>
<span id="cb95-104"><a href="#cb95-104" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb95-105"><a href="#cb95-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-106"><a href="#cb95-106" aria-hidden="true" tabindex="-1"></a><span class="fu">### Datasets</span></span>
<span id="cb95-107"><a href="#cb95-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-108"><a href="#cb95-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Read files}</span></span>
<span id="cb95-109"><a href="#cb95-109" aria-hidden="true" tabindex="-1"></a><span class="in">if (file.exists("/.dockerenv")) { # Check if running in Docker</span></span>
<span id="cb95-110"><a href="#cb95-110" aria-hidden="true" tabindex="-1"></a><span class="in">  # Assume igmm/Vallejo-predict/libdr/ is passed to the data volume</span></span>
<span id="cb95-111"><a href="#cb95-111" aria-hidden="true" tabindex="-1"></a><span class="in">  prefix &lt;- "data/"</span></span>
<span id="cb95-112"><a href="#cb95-112" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb95-113"><a href="#cb95-113" aria-hidden="true" tabindex="-1"></a><span class="in">  # Assume running outside of a Docker container and the IGC(/IGMM) datastore is</span></span>
<span id="cb95-114"><a href="#cb95-114" aria-hidden="true" tabindex="-1"></a><span class="in">  # mounted at /Volumes</span></span>
<span id="cb95-115"><a href="#cb95-115" aria-hidden="true" tabindex="-1"></a><span class="in">  prefix &lt;- "/Volumes/igmm/cvallejo-predicct/libdr/"</span></span>
<span id="cb95-116"><a href="#cb95-116" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb95-117"><a href="#cb95-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-118"><a href="#cb95-118" aria-hidden="true" tabindex="-1"></a><span class="in">fcal.pheno &lt;- read.csv(file.path(prefix, "2024-10-03/fcal-cleaned.csv"))</span></span>
<span id="cb95-119"><a href="#cb95-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-120"><a href="#cb95-120" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract from TRAK which also now introduces CRP.</span></span>
<span id="cb95-121"><a href="#cb95-121" aria-hidden="true" tabindex="-1"></a><span class="in">labs &lt;- read.csv(file.path(prefix, "2024-10-03/markers-cleaned.csv"))</span></span>
<span id="cb95-122"><a href="#cb95-122" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- subset(labs, TEST == "f-Calprotectin-ALP")</span></span>
<span id="cb95-123"><a href="#cb95-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-124"><a href="#cb95-124" aria-hidden="true" tabindex="-1"></a><span class="in"># Add sex and diagnosis type from fcal.pheno</span></span>
<span id="cb95-125"><a href="#cb95-125" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- fcal.pheno %&gt;%</span></span>
<span id="cb95-126"><a href="#cb95-126" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(ids, .keep_all = TRUE) %&gt;%</span></span>
<span id="cb95-127"><a href="#cb95-127" aria-hidden="true" tabindex="-1"></a><span class="in">  select(ids, sex, diagnosis, diagnosis_date) %&gt;%</span></span>
<span id="cb95-128"><a href="#cb95-128" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(x = fcal, by = "ids", all.x = TRUE, all.y = FALSE)</span></span>
<span id="cb95-129"><a href="#cb95-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-130"><a href="#cb95-130" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- subset(labs, TEST == "C-Reactive Prot")</span></span>
<span id="cb95-131"><a href="#cb95-131" aria-hidden="true" tabindex="-1"></a><span class="in">updated &lt;- read.csv(file.path(prefix, "2024-10-03/allPatientsNathanCleaned.csv"))</span></span>
<span id="cb95-132"><a href="#cb95-132" aria-hidden="true" tabindex="-1"></a><span class="in">outcomes &lt;- read.csv(file.path(prefix, "2024-10-03/cd-cleaned.csv"))</span></span>
<span id="cb95-133"><a href="#cb95-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-134"><a href="#cb95-134" aria-hidden="true" tabindex="-1"></a><span class="in">non.ibd &lt;- read.csv(file.path (prefix, "2024-10-24/non-ibd.csv"))</span></span>
<span id="cb95-135"><a href="#cb95-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-136"><a href="#cb95-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-137"><a href="#cb95-137" aria-hidden="true" tabindex="-1"></a>Multiple datasets are used in this report with varying degrees of</span>
<span id="cb95-138"><a href="#cb95-138" aria-hidden="true" tabindex="-1"></a>previous curation.</span>
<span id="cb95-139"><a href="#cb95-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-140"><a href="#cb95-140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`markers.csv`</span> is a 2024 extraction from TRAKcare describing</span>
<span id="cb95-141"><a href="#cb95-141" aria-hidden="true" tabindex="-1"></a>    <span class="in">`r nrow(labs)`</span> test results (FC: <span class="in">`r nrow(fcal)`</span>; CRP:</span>
<span id="cb95-142"><a href="#cb95-142" aria-hidden="true" tabindex="-1"></a>    <span class="in">`r nrow(crp)`</span>). Each row represents a test result with columns</span>
<span id="cb95-143"><a href="#cb95-143" aria-hidden="true" tabindex="-1"></a>    indicating the corresponding subject ID, the test type (FC or CRP),</span>
<span id="cb95-144"><a href="#cb95-144" aria-hidden="true" tabindex="-1"></a>    the time of the test, and the test result. This dataset contains the</span>
<span id="cb95-145"><a href="#cb95-145" aria-hidden="true" tabindex="-1"></a>    most recent data out of the other datasets. However, there has been</span>
<span id="cb95-146"><a href="#cb95-146" aria-hidden="true" tabindex="-1"></a>    no manual curation of these data, and no information about the</span>
<span id="cb95-147"><a href="#cb95-147" aria-hidden="true" tabindex="-1"></a>    patient's characteristics are available (other than their ID).</span>
<span id="cb95-148"><a href="#cb95-148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`fcal-cleaned.csv`</span> does not describe CRP data. However, these data</span>
<span id="cb95-149"><a href="#cb95-149" aria-hidden="true" tabindex="-1"></a>    have been curated by the Lees group. In addition to</span>
<span id="cb95-150"><a href="#cb95-150" aria-hidden="true" tabindex="-1"></a>    <span class="in">`r nrow(fcal)`</span> FC test results, each row also provides the sex, IBD</span>
<span id="cb95-151"><a href="#cb95-151" aria-hidden="true" tabindex="-1"></a>    type, date of diagnosis, and date of death (if applicable) for the</span>
<span id="cb95-152"><a href="#cb95-152" aria-hidden="true" tabindex="-1"></a>    corresponding subject.</span>
<span id="cb95-153"><a href="#cb95-153" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`allPatientsNathanCleaned.csv`</span> provides sex, IBD type, and diagnosis</span>
<span id="cb95-154"><a href="#cb95-154" aria-hidden="true" tabindex="-1"></a>    date for most (but not all) subjects in <span class="in">`labs.csv`</span> not described by</span>
<span id="cb95-155"><a href="#cb95-155" aria-hidden="true" tabindex="-1"></a>    <span class="in">`fcal-cleaned.csv`</span>.</span>
<span id="cb95-156"><a href="#cb95-156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`cd-cleaned.csv`</span> describes CD patient data (n = <span class="in">`r nrow(outcomes)`</span>).</span>
<span id="cb95-157"><a href="#cb95-157" aria-hidden="true" tabindex="-1"></a>    In addition to the same basic patient characteristic variables in</span>
<span id="cb95-158"><a href="#cb95-158" aria-hidden="true" tabindex="-1"></a>    other datasets, this dataset also describes surgical outcomes and</span>
<span id="cb95-159"><a href="#cb95-159" aria-hidden="true" tabindex="-1"></a>    biologic treatments prescribed to the subject.</span>
<span id="cb95-160"><a href="#cb95-160" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span><span class="in">`non-ibd.csv`</span> describes subjects who were found to not have IBD during the</span>
<span id="cb95-161"><a href="#cb95-161" aria-hidden="true" tabindex="-1"></a>    phenotyping process. This dataset is used to remove subjects who do not have</span>
<span id="cb95-162"><a href="#cb95-162" aria-hidden="true" tabindex="-1"></a>    IBD from the analysis.</span>
<span id="cb95-163"><a href="#cb95-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-164"><a href="#cb95-164" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb95-165"><a href="#cb95-165" aria-hidden="true" tabindex="-1"></a>The "cleaned" in the above file names refers to the CHI numbers having</span>
<span id="cb95-166"><a href="#cb95-166" aria-hidden="true" tabindex="-1"></a>been replaced. No further processing of the data has been undertaken for</span>
<span id="cb95-167"><a href="#cb95-167" aria-hidden="true" tabindex="-1"></a>this study prior to the steps outlined in this report.</span>
<span id="cb95-168"><a href="#cb95-168" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb95-169"><a href="#cb95-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-170"><a href="#cb95-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## Subject data</span></span>
<span id="cb95-171"><a href="#cb95-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-172"><a href="#cb95-172" aria-hidden="true" tabindex="-1"></a>We will create a "dictionary" which, for each subject, lists their</span>
<span id="cb95-173"><a href="#cb95-173" aria-hidden="true" tabindex="-1"></a>subject ID, their IBD type, and their date of diagnosis. In addition to</span>
<span id="cb95-174"><a href="#cb95-174" aria-hidden="true" tabindex="-1"></a>ensuring inclusion criteria are met, date of diagnosis will be used to</span>
<span id="cb95-175"><a href="#cb95-175" aria-hidden="true" tabindex="-1"></a>retime all biomarker measurements of a subject such that $t=0$</span>
<span id="cb95-176"><a href="#cb95-176" aria-hidden="true" tabindex="-1"></a>corresponds to their diagnosis date. IBD types are used to test if</span>
<span id="cb95-177"><a href="#cb95-177" aria-hidden="true" tabindex="-1"></a>clusters are enriched by IBD type and may be used to adjust the</span>
<span id="cb95-178"><a href="#cb95-178" aria-hidden="true" tabindex="-1"></a>clustering.</span>
<span id="cb95-179"><a href="#cb95-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-180"><a href="#cb95-180" aria-hidden="true" tabindex="-1"></a>There are multiple potential sources for date of diagnosis and IBD type:</span>
<span id="cb95-181"><a href="#cb95-181" aria-hidden="true" tabindex="-1"></a>the CD outcomes dataset, a demographics dataset maintained by the Lees</span>
<span id="cb95-182"><a href="#cb95-182" aria-hidden="true" tabindex="-1"></a>group, and a raw TRAK extraction. For every subject listed in at least</span>
<span id="cb95-183"><a href="#cb95-183" aria-hidden="true" tabindex="-1"></a>one of these datasets, we have tried to extract their date of diagnosis</span>
<span id="cb95-184"><a href="#cb95-184" aria-hidden="true" tabindex="-1"></a>and diagnosis type. We have assumed a hierarchy of datasets where</span>
<span id="cb95-185"><a href="#cb95-185" aria-hidden="true" tabindex="-1"></a>manually curated datasets are preferred for extracting data over a</span>
<span id="cb95-186"><a href="#cb95-186" aria-hidden="true" tabindex="-1"></a>dataset generated with minimal human involvement.</span>
<span id="cb95-187"><a href="#cb95-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-188"><a href="#cb95-188" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagnosis and diagnosis date</span></span>
<span id="cb95-189"><a href="#cb95-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-190"><a href="#cb95-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Create subject dictionary}</span></span>
<span id="cb95-191"><a href="#cb95-191" aria-hidden="true" tabindex="-1"></a><span class="in">ids &lt;- unique(c(outcomes$ids, fcal$ids, updated$ids))</span></span>
<span id="cb95-192"><a href="#cb95-192" aria-hidden="true" tabindex="-1"></a><span class="in">diagnosis &lt;- character()</span></span>
<span id="cb95-193"><a href="#cb95-193" aria-hidden="true" tabindex="-1"></a><span class="in">date.of.diag &lt;- character()</span></span>
<span id="cb95-194"><a href="#cb95-194" aria-hidden="true" tabindex="-1"></a><span class="in">for (id in ids) {</span></span>
<span id="cb95-195"><a href="#cb95-195" aria-hidden="true" tabindex="-1"></a><span class="in">  if (id %in% outcomes$ids) {</span></span>
<span id="cb95-196"><a href="#cb95-196" aria-hidden="true" tabindex="-1"></a><span class="in">    # Outcomes data only contains CD subjects</span></span>
<span id="cb95-197"><a href="#cb95-197" aria-hidden="true" tabindex="-1"></a><span class="in">    diagnosis &lt;- c(diagnosis, "Crohn's Disease")</span></span>
<span id="cb95-198"><a href="#cb95-198" aria-hidden="true" tabindex="-1"></a><span class="in">    date.of.diag &lt;- c(</span></span>
<span id="cb95-199"><a href="#cb95-199" aria-hidden="true" tabindex="-1"></a><span class="in">      date.of.diag,</span></span>
<span id="cb95-200"><a href="#cb95-200" aria-hidden="true" tabindex="-1"></a><span class="in">      subset(outcomes, ids == id)$diagnosisDate</span></span>
<span id="cb95-201"><a href="#cb95-201" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb95-202"><a href="#cb95-202" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (id %in% updated$ids) {</span></span>
<span id="cb95-203"><a href="#cb95-203" aria-hidden="true" tabindex="-1"></a><span class="in">    diagnosis &lt;- c(diagnosis, subset(updated, ids == id)[1, "diagnosis"])</span></span>
<span id="cb95-204"><a href="#cb95-204" aria-hidden="true" tabindex="-1"></a><span class="in">    date.of.diag &lt;- c(</span></span>
<span id="cb95-205"><a href="#cb95-205" aria-hidden="true" tabindex="-1"></a><span class="in">      date.of.diag,</span></span>
<span id="cb95-206"><a href="#cb95-206" aria-hidden="true" tabindex="-1"></a><span class="in">      subset(updated, ids == id)[1, "diagnosisDate"]</span></span>
<span id="cb95-207"><a href="#cb95-207" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb95-208"><a href="#cb95-208" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (id %in% fcal$ids) {</span></span>
<span id="cb95-209"><a href="#cb95-209" aria-hidden="true" tabindex="-1"></a><span class="in">    diagnosis &lt;- c(diagnosis, subset(fcal, ids == id)[1, "diagnosis"])</span></span>
<span id="cb95-210"><a href="#cb95-210" aria-hidden="true" tabindex="-1"></a><span class="in">    date.of.diag &lt;- c(</span></span>
<span id="cb95-211"><a href="#cb95-211" aria-hidden="true" tabindex="-1"></a><span class="in">      date.of.diag,</span></span>
<span id="cb95-212"><a href="#cb95-212" aria-hidden="true" tabindex="-1"></a><span class="in">      subset(fcal, ids == id)[1, "diagnosis_date"]</span></span>
<span id="cb95-213"><a href="#cb95-213" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb95-214"><a href="#cb95-214" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb95-215"><a href="#cb95-215" aria-hidden="true" tabindex="-1"></a><span class="in">    diagnosis &lt;- c(diagnosis, "Unknown")</span></span>
<span id="cb95-216"><a href="#cb95-216" aria-hidden="true" tabindex="-1"></a><span class="in">    date.of.diag &lt;- c(</span></span>
<span id="cb95-217"><a href="#cb95-217" aria-hidden="true" tabindex="-1"></a><span class="in">      date.of.diag,</span></span>
<span id="cb95-218"><a href="#cb95-218" aria-hidden="true" tabindex="-1"></a><span class="in">      "Unknown"</span></span>
<span id="cb95-219"><a href="#cb95-219" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb95-220"><a href="#cb95-220" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb95-221"><a href="#cb95-221" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb95-222"><a href="#cb95-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-223"><a href="#cb95-223" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- data.frame(</span></span>
<span id="cb95-224"><a href="#cb95-224" aria-hidden="true" tabindex="-1"></a><span class="in">  ids = ids,</span></span>
<span id="cb95-225"><a href="#cb95-225" aria-hidden="true" tabindex="-1"></a><span class="in">  diagnosis = diagnosis,</span></span>
<span id="cb95-226"><a href="#cb95-226" aria-hidden="true" tabindex="-1"></a><span class="in">  date.of.diag = fix_date_char(date.of.diag)</span></span>
<span id="cb95-227"><a href="#cb95-227" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-228"><a href="#cb95-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-229"><a href="#cb95-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-230"><a href="#cb95-230" aria-hidden="true" tabindex="-1"></a><span class="in">rm(id, ids, diagnosis, date.of.diag) # clean up</span></span>
<span id="cb95-231"><a href="#cb95-231" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- fix_date_df(dict, "date.of.diag")</span></span>
<span id="cb95-232"><a href="#cb95-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-233"><a href="#cb95-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-234"><a href="#cb95-234" aria-hidden="true" tabindex="-1"></a>Before filtering by inclusion/exclusion criteria, there are</span>
<span id="cb95-235"><a href="#cb95-235" aria-hidden="true" tabindex="-1"></a><span class="in">`r sum(is.na(dict$date.of.diag))`</span> individuals for which a diagnostic</span>
<span id="cb95-236"><a href="#cb95-236" aria-hidden="true" tabindex="-1"></a>date is missing. However, <span class="in">`r sum(is.na(dict$diagnosis))`</span> missing values</span>
<span id="cb95-237"><a href="#cb95-237" aria-hidden="true" tabindex="-1"></a>are observed for diagnosis (IBD type). </span>
<span id="cb95-238"><a href="#cb95-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-239"><a href="#cb95-239" aria-hidden="true" tabindex="-1"></a>As can be seen in the below table, two spellings of Crohn's disease (with and </span>
<span id="cb95-240"><a href="#cb95-240" aria-hidden="true" tabindex="-1"></a>without an apostrophe (')) and three names for IBDU are used. There are also </span>
<span id="cb95-241"><a href="#cb95-241" aria-hidden="true" tabindex="-1"></a>subjects reported to not have IBD. These will be removed, leaving </span>
<span id="cb95-242"><a href="#cb95-242" aria-hidden="true" tabindex="-1"></a><span class="in">`r sum(dict$diagnosis != "Not IBD") - nrow(non.ibd)`</span> subjects included in the</span>
<span id="cb95-243"><a href="#cb95-243" aria-hidden="true" tabindex="-1"></a>subsequent analyses.</span>
<span id="cb95-244"><a href="#cb95-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-245"><a href="#cb95-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Frequency table to diagnosis pre-process}</span></span>
<span id="cb95-246"><a href="#cb95-246" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-diag-pre</span></span>
<span id="cb95-247"><a href="#cb95-247" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: Reported IBD types</span></span>
<span id="cb95-248"><a href="#cb95-248" aria-hidden="true" tabindex="-1"></a><span class="in">kable(unique(dict$diagnosis),</span></span>
<span id="cb95-249"><a href="#cb95-249" aria-hidden="true" tabindex="-1"></a><span class="in">  col.names = c("Diagnosis")</span></span>
<span id="cb95-250"><a href="#cb95-250" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-251"><a href="#cb95-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-252"><a href="#cb95-252" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- dict %&gt;%</span></span>
<span id="cb95-253"><a href="#cb95-253" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(diagnosis != "Not IBD") %&gt;%</span></span>
<span id="cb95-254"><a href="#cb95-254" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(!(ids %in% non.ibd$ids))</span></span>
<span id="cb95-255"><a href="#cb95-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-256"><a href="#cb95-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-257"><a href="#cb95-257" aria-hidden="true" tabindex="-1"></a>The Crohn's disease and IBDU names have been standardised (IBDU,</span>
<span id="cb95-258"><a href="#cb95-258" aria-hidden="true" tabindex="-1"></a>Inflammatory Bowel Disease, Inflammatory Bowel Disease - Unknown Subtype</span>
<span id="cb95-259"><a href="#cb95-259" aria-hidden="true" tabindex="-1"></a>are assumed to be equivalent). The subject reported to not have IBD has</span>
<span id="cb95-260"><a href="#cb95-260" aria-hidden="true" tabindex="-1"></a>been removed.</span>
<span id="cb95-261"><a href="#cb95-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-262"><a href="#cb95-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Contingency table of IBD diagnosis pre and post processing}</span></span>
<span id="cb95-263"><a href="#cb95-263" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-diag-post</span></span>
<span id="cb95-264"><a href="#cb95-264" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: Contingency table showing mapping of IBD types to a standardised format</span></span>
<span id="cb95-265"><a href="#cb95-265" aria-hidden="true" tabindex="-1"></a><span class="in">#| results: "hold"</span></span>
<span id="cb95-266"><a href="#cb95-266" aria-hidden="true" tabindex="-1"></a><span class="in">dict$old &lt;- dict$diagnosis</span></span>
<span id="cb95-267"><a href="#cb95-267" aria-hidden="true" tabindex="-1"></a><span class="in">dict$diagnosis &lt;- plyr::mapvalues(</span></span>
<span id="cb95-268"><a href="#cb95-268" aria-hidden="true" tabindex="-1"></a><span class="in">  dict$diagnosis,</span></span>
<span id="cb95-269"><a href="#cb95-269" aria-hidden="true" tabindex="-1"></a><span class="in">  from = c(</span></span>
<span id="cb95-270"><a href="#cb95-270" aria-hidden="true" tabindex="-1"></a><span class="in">    "Crohns Disease",</span></span>
<span id="cb95-271"><a href="#cb95-271" aria-hidden="true" tabindex="-1"></a><span class="in">    "Inflamatory Bowel Disease",</span></span>
<span id="cb95-272"><a href="#cb95-272" aria-hidden="true" tabindex="-1"></a><span class="in">    "Inflamatory Bowel Disease - Unknown Subtype"</span></span>
<span id="cb95-273"><a href="#cb95-273" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb95-274"><a href="#cb95-274" aria-hidden="true" tabindex="-1"></a><span class="in">  to = c(</span></span>
<span id="cb95-275"><a href="#cb95-275" aria-hidden="true" tabindex="-1"></a><span class="in">    "Crohn's Disease",</span></span>
<span id="cb95-276"><a href="#cb95-276" aria-hidden="true" tabindex="-1"></a><span class="in">    "IBDU",</span></span>
<span id="cb95-277"><a href="#cb95-277" aria-hidden="true" tabindex="-1"></a><span class="in">    "IBDU"</span></span>
<span id="cb95-278"><a href="#cb95-278" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb95-279"><a href="#cb95-279" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-280"><a href="#cb95-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-281"><a href="#cb95-281" aria-hidden="true" tabindex="-1"></a><span class="in">kable(addmargins(table(dict$diagnosis, dict$old), margin = 2))</span></span>
<span id="cb95-282"><a href="#cb95-282" aria-hidden="true" tabindex="-1"></a><span class="in">dict$old &lt;- NULL</span></span>
<span id="cb95-283"><a href="#cb95-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-284"><a href="#cb95-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-285"><a href="#cb95-285" aria-hidden="true" tabindex="-1"></a><span class="fu">### Age and sex</span></span>
<span id="cb95-286"><a href="#cb95-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-287"><a href="#cb95-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add sex to dict}</span></span>
<span id="cb95-288"><a href="#cb95-288" aria-hidden="true" tabindex="-1"></a><span class="in"># Merge with fcal to add sex information</span></span>
<span id="cb95-289"><a href="#cb95-289" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- fcal.pheno[, c("ids", "sex")] %&gt;%</span></span>
<span id="cb95-290"><a href="#cb95-290" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(ids,</span></span>
<span id="cb95-291"><a href="#cb95-291" aria-hidden="true" tabindex="-1"></a><span class="in">    .keep_all = TRUE</span></span>
<span id="cb95-292"><a href="#cb95-292" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb95-293"><a href="#cb95-293" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(x = dict, by = "ids", all.x = TRUE, all.y = FALSE)</span></span>
<span id="cb95-294"><a href="#cb95-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-295"><a href="#cb95-295" aria-hidden="true" tabindex="-1"></a><span class="in"># Update NA sex if sex available from updated</span></span>
<span id="cb95-296"><a href="#cb95-296" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- merge(dict,</span></span>
<span id="cb95-297"><a href="#cb95-297" aria-hidden="true" tabindex="-1"></a><span class="in">  updated[, c("ids", "sex")],</span></span>
<span id="cb95-298"><a href="#cb95-298" aria-hidden="true" tabindex="-1"></a><span class="in">  by = "ids",</span></span>
<span id="cb95-299"><a href="#cb95-299" aria-hidden="true" tabindex="-1"></a><span class="in">  all.x = TRUE,</span></span>
<span id="cb95-300"><a href="#cb95-300" aria-hidden="true" tabindex="-1"></a><span class="in">  all.y = FALSE</span></span>
<span id="cb95-301"><a href="#cb95-301" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-302"><a href="#cb95-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-303"><a href="#cb95-303" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nrow(dict)) {</span></span>
<span id="cb95-304"><a href="#cb95-304" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.na(dict[i, "sex.x"]) &amp; !is.na(dict[i, "sex.y"])) {</span></span>
<span id="cb95-305"><a href="#cb95-305" aria-hidden="true" tabindex="-1"></a><span class="in">    dict[i, "sex.x"] &lt;- dict[i, "sex.y"]</span></span>
<span id="cb95-306"><a href="#cb95-306" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb95-307"><a href="#cb95-307" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb95-308"><a href="#cb95-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-309"><a href="#cb95-309" aria-hidden="true" tabindex="-1"></a><span class="in">dict$sex &lt;- dict$sex.x</span></span>
<span id="cb95-310"><a href="#cb95-310" aria-hidden="true" tabindex="-1"></a><span class="in">dict$sex.x &lt;- dict$sex.y &lt;- NULL</span></span>
<span id="cb95-311"><a href="#cb95-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-312"><a href="#cb95-312" aria-hidden="true" tabindex="-1"></a><span class="in"># Add age at IBD diagnosis</span></span>
<span id="cb95-313"><a href="#cb95-313" aria-hidden="true" tabindex="-1"></a><span class="in">updated &lt;- fix_date_df(updated, "diagnosisDate")</span></span>
<span id="cb95-314"><a href="#cb95-314" aria-hidden="true" tabindex="-1"></a><span class="in">updated$age &lt;- with(updated, year(diagnosisDate) - dateOfBirth)</span></span>
<span id="cb95-315"><a href="#cb95-315" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- merge(dict,</span></span>
<span id="cb95-316"><a href="#cb95-316" aria-hidden="true" tabindex="-1"></a><span class="in">  updated[, c("ids", "age")],</span></span>
<span id="cb95-317"><a href="#cb95-317" aria-hidden="true" tabindex="-1"></a><span class="in">  by = "ids",</span></span>
<span id="cb95-318"><a href="#cb95-318" aria-hidden="true" tabindex="-1"></a><span class="in">  all.x = TRUE,</span></span>
<span id="cb95-319"><a href="#cb95-319" aria-hidden="true" tabindex="-1"></a><span class="in">  all.y = FALSE</span></span>
<span id="cb95-320"><a href="#cb95-320" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-321"><a href="#cb95-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-322"><a href="#cb95-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-323"><a href="#cb95-323" aria-hidden="true" tabindex="-1"></a>Note that there <span class="in">`r sum(is.na(dict$age))`</span> individuals for which age at</span>
<span id="cb95-324"><a href="#cb95-324" aria-hidden="true" tabindex="-1"></a>diagnosis is missing (this is due to missing diagnostic dates). However,</span>
<span id="cb95-325"><a href="#cb95-325" aria-hidden="true" tabindex="-1"></a>there are <span class="in">`r sum(is.na(dict$sex))`</span> individuals for which sex is missing.</span>
<span id="cb95-326"><a href="#cb95-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-327"><a href="#cb95-327" aria-hidden="true" tabindex="-1"></a><span class="fu">### Date of death</span></span>
<span id="cb95-328"><a href="#cb95-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-329"><a href="#cb95-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add date.of.death}</span></span>
<span id="cb95-330"><a href="#cb95-330" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- merge(dict,</span></span>
<span id="cb95-331"><a href="#cb95-331" aria-hidden="true" tabindex="-1"></a><span class="in">  updated[, c("ids", "death")],</span></span>
<span id="cb95-332"><a href="#cb95-332" aria-hidden="true" tabindex="-1"></a><span class="in">  by = "ids",</span></span>
<span id="cb95-333"><a href="#cb95-333" aria-hidden="true" tabindex="-1"></a><span class="in">  all.x = TRUE,</span></span>
<span id="cb95-334"><a href="#cb95-334" aria-hidden="true" tabindex="-1"></a><span class="in">  all.y = FALSE</span></span>
<span id="cb95-335"><a href="#cb95-335" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb95-336"><a href="#cb95-336" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(date.of.death = death)</span></span>
<span id="cb95-337"><a href="#cb95-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-338"><a href="#cb95-338" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- fix_date_df(dict, "date.of.death")</span></span>
<span id="cb95-339"><a href="#cb95-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-340"><a href="#cb95-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-341"><a href="#cb95-341" aria-hidden="true" tabindex="-1"></a>Date of death information is available for</span>
<span id="cb95-342"><a href="#cb95-342" aria-hidden="true" tabindex="-1"></a><span class="in">`r sum(!is.na(dict$date.of.death))`</span> individuals. We assume that all</span>
<span id="cb95-343"><a href="#cb95-343" aria-hidden="true" tabindex="-1"></a>remaining individuals have not died by the date of data extraction.</span>
<span id="cb95-344"><a href="#cb95-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-345"><a href="#cb95-345" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exclusion criteria according to diagnosis and date of diagnosis</span></span>
<span id="cb95-346"><a href="#cb95-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-347"><a href="#cb95-347" aria-hidden="true" tabindex="-1"></a>Date of diagnosis in an integral aspect of the inclusion criteria and</span>
<span id="cb95-348"><a href="#cb95-348" aria-hidden="true" tabindex="-1"></a>also used to retime biomarker measurements.</span>
<span id="cb95-349"><a href="#cb95-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-350"><a href="#cb95-350" aria-hidden="true" tabindex="-1"></a>Firstly, we remove <span class="in">`r sum(is.na(dict$date.of.diag))`</span> individuals with a missing date of diagnosis. </span>
<span id="cb95-351"><a href="#cb95-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-352"><a href="#cb95-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Remove NA date of diagnosis}</span></span>
<span id="cb95-353"><a href="#cb95-353" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- dict[!is.na(dict$date.of.diag), ]</span></span>
<span id="cb95-354"><a href="#cb95-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-355"><a href="#cb95-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-356"><a href="#cb95-356" aria-hidden="true" tabindex="-1"></a>This leaves <span class="in">`r nrow(dict)`</span> for subsequent analyses. </span>
<span id="cb95-357"><a href="#cb95-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-358"><a href="#cb95-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Apply date of diagnosis exclusion}</span></span>
<span id="cb95-359"><a href="#cb95-359" aria-hidden="true" tabindex="-1"></a><span class="in"># no. subjects over upper bound</span></span>
<span id="cb95-360"><a href="#cb95-360" aria-hidden="true" tabindex="-1"></a><span class="in">max_fup &lt;- max(labs$COLLECTION_DATE)</span></span>
<span id="cb95-361"><a href="#cb95-361" aria-hidden="true" tabindex="-1"></a><span class="in">max_fup &lt;- as.Date(max_fup)</span></span>
<span id="cb95-362"><a href="#cb95-362" aria-hidden="true" tabindex="-1"></a><span class="in">n.upper &lt;- nrow(subset(dict, max_fup - date.of.diag &lt; 5 * 365.25))</span></span>
<span id="cb95-363"><a href="#cb95-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-364"><a href="#cb95-364" aria-hidden="true" tabindex="-1"></a><span class="in"># no. subjects under lower bound</span></span>
<span id="cb95-365"><a href="#cb95-365" aria-hidden="true" tabindex="-1"></a><span class="in">n.lower &lt;- nrow(subset(dict, (year(date.of.diag) &lt; 2004) |</span></span>
<span id="cb95-366"><a href="#cb95-366" aria-hidden="true" tabindex="-1"></a><span class="in">  (year(date.of.diag) == 2004 &amp; month(date.of.diag) &lt;= 9)))</span></span>
<span id="cb95-367"><a href="#cb95-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-368"><a href="#cb95-368" aria-hidden="true" tabindex="-1"></a><span class="in"># subset to subjects meeting the criteria.</span></span>
<span id="cb95-369"><a href="#cb95-369" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- subset(dict, max_fup - date.of.diag &gt;= 5 * 365.25)</span></span>
<span id="cb95-370"><a href="#cb95-370" aria-hidden="true" tabindex="-1"></a><span class="in">dict &lt;- subset(dict, (year(date.of.diag) &gt;= 2005) |</span></span>
<span id="cb95-371"><a href="#cb95-371" aria-hidden="true" tabindex="-1"></a><span class="in">  (year(date.of.diag) == 2004 &amp; month(date.of.diag) &gt;= 10))</span></span>
<span id="cb95-372"><a href="#cb95-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-373"><a href="#cb95-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-374"><a href="#cb95-374" aria-hidden="true" tabindex="-1"></a>As described in the [inclusion/exclusion criteria</span>
<span id="cb95-375"><a href="#cb95-375" aria-hidden="true" tabindex="-1"></a>section](#inclusionexclusion-criteria-definitions), the inclusion criteria </span>
<span id="cb95-376"><a href="#cb95-376" aria-hidden="true" tabindex="-1"></a>considers upper and lower bounds for the diagnostic dates. In this case, we</span>
<span id="cb95-377"><a href="#cb95-377" aria-hidden="true" tabindex="-1"></a>only consider subjects diagnosed after October 2004 and 13 August 2019 (this</span>
<span id="cb95-378"><a href="#cb95-378" aria-hidden="true" tabindex="-1"></a>ensures individuals can be followed up by at least 5 year by the time of the</span>
<span id="cb95-379"><a href="#cb95-379" aria-hidden="true" tabindex="-1"></a>last longitudinal measument obtained for the cohort; <span class="in">`r max_fup`</span>). As</span>
<span id="cb95-380"><a href="#cb95-380" aria-hidden="true" tabindex="-1"></a>such, subjects who do not meet this criteria will be excluded.</span>
<span id="cb95-381"><a href="#cb95-381" aria-hidden="true" tabindex="-1"></a><span class="in">`r n.upper`</span> subjects were diagnosed on 13 August 2019 or later and were removed,</span>
<span id="cb95-382"><a href="#cb95-382" aria-hidden="true" tabindex="-1"></a>and <span class="in">`r n.lower`</span> subjects were diagnosed prior to October 2004 and were</span>
<span id="cb95-383"><a href="#cb95-383" aria-hidden="true" tabindex="-1"></a>likewise removed. This results in a cohort size of <span class="in">`r nrow(dict)`</span></span>
<span id="cb95-384"><a href="#cb95-384" aria-hidden="true" tabindex="-1"></a>subjects.</span>
<span id="cb95-385"><a href="#cb95-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-386"><a href="#cb95-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Clean up excluded date of diagnosis counts}</span></span>
<span id="cb95-387"><a href="#cb95-387" aria-hidden="true" tabindex="-1"></a><span class="in">#| include: false</span></span>
<span id="cb95-388"><a href="#cb95-388" aria-hidden="true" tabindex="-1"></a><span class="in">rm(n.upper, n.lower) # clean up</span></span>
<span id="cb95-389"><a href="#cb95-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-390"><a href="#cb95-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-391"><a href="#cb95-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-392"><a href="#cb95-392" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploration</span></span>
<span id="cb95-393"><a href="#cb95-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-394"><a href="#cb95-394" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--- CAV: we should move this into an EDA script ---&gt;</span> </span>
<span id="cb95-395"><a href="#cb95-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-396"><a href="#cb95-396" aria-hidden="true" tabindex="-1"></a>We now explore date of diagnosis to ensure data quality is at a suitable</span>
<span id="cb95-397"><a href="#cb95-397" aria-hidden="true" tabindex="-1"></a>standard.</span>
<span id="cb95-398"><a href="#cb95-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-399"><a href="#cb95-399" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Year of diagnosis</span></span>
<span id="cb95-400"><a href="#cb95-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-401"><a href="#cb95-401" aria-hidden="true" tabindex="-1"></a>From @fig-diag-year, we can see the number of IBD diagnoses each year is</span>
<span id="cb95-402"><a href="#cb95-402" aria-hidden="true" tabindex="-1"></a>relatively static with the exception of 2004 and 2005. The former</span>
<span id="cb95-403"><a href="#cb95-403" aria-hidden="true" tabindex="-1"></a>describes only three months of the year, and incidence was likely still</span>
<span id="cb95-404"><a href="#cb95-404" aria-hidden="true" tabindex="-1"></a>increasing across both of these two years. @Jones2019 found IBD</span>
<span id="cb95-405"><a href="#cb95-405" aria-hidden="true" tabindex="-1"></a>incidence from 2008 onwards to be consistent over time for patients</span>
<span id="cb95-406"><a href="#cb95-406" aria-hidden="true" tabindex="-1"></a>diagnosed by NHS Lothian which is in agreement with our findings.</span>
<span id="cb95-407"><a href="#cb95-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-408"><a href="#cb95-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Year of diagnosis}</span></span>
<span id="cb95-409"><a href="#cb95-409" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-diag-year</span></span>
<span id="cb95-410"><a href="#cb95-410" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Distribution of year of diagnosis"</span></span>
<span id="cb95-411"><a href="#cb95-411" aria-hidden="true" tabindex="-1"></a><span class="in">dict %&gt;%</span></span>
<span id="cb95-412"><a href="#cb95-412" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = year(date.of.diag))) +</span></span>
<span id="cb95-413"><a href="#cb95-413" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(fill = "#B8F2E6", color = "black", binwidth = 1) +</span></span>
<span id="cb95-414"><a href="#cb95-414" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-415"><a href="#cb95-415" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Year of IBD diagnosis") +</span></span>
<span id="cb95-416"><a href="#cb95-416" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency")</span></span>
<span id="cb95-417"><a href="#cb95-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-418"><a href="#cb95-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-419"><a href="#cb95-419" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Month of diagnosis</span></span>
<span id="cb95-420"><a href="#cb95-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-421"><a href="#cb95-421" aria-hidden="true" tabindex="-1"></a>It appears there are subjects for whom only year of diagnosis was</span>
<span id="cb95-422"><a href="#cb95-422" aria-hidden="true" tabindex="-1"></a>available. This has resulted in the 1&lt;sup&gt;st&lt;/sup&gt; of January for that</span>
<span id="cb95-423"><a href="#cb95-423" aria-hidden="true" tabindex="-1"></a>year being recorded as the date of diagnosis for that subject. As such,</span>
<span id="cb95-424"><a href="#cb95-424" aria-hidden="true" tabindex="-1"></a>far more diagnoses are reported in January than in other months</span>
<span id="cb95-425"><a href="#cb95-425" aria-hidden="true" tabindex="-1"></a>(@fig-diag-month). There are</span>
<span id="cb95-426"><a href="#cb95-426" aria-hidden="true" tabindex="-1"></a><span class="in">`r sum(day(dict$date.of.diag) == 1 &amp; month(dict$date.of.diag) == 1)`</span></span>
<span id="cb95-427"><a href="#cb95-427" aria-hidden="true" tabindex="-1"></a>subjects reported to have been diagnosed on New Year's day .</span>
<span id="cb95-428"><a href="#cb95-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-429"><a href="#cb95-429" aria-hidden="true" tabindex="-1"></a>If a subject's exact date of diagnosis is not known, then this is most</span>
<span id="cb95-430"><a href="#cb95-430" aria-hidden="true" tabindex="-1"></a>likely because the subject was not diagnosed by NHS Lothian. Instead,</span>
<span id="cb95-431"><a href="#cb95-431" aria-hidden="true" tabindex="-1"></a>the date of diagnosis would have needed to be recalled by the subject</span>
<span id="cb95-432"><a href="#cb95-432" aria-hidden="true" tabindex="-1"></a>which introduces the inaccuracy observed.</span>
<span id="cb95-433"><a href="#cb95-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-434"><a href="#cb95-434" aria-hidden="true" tabindex="-1"></a>As subjects are require a diagnostic biomarker measurement to be</span>
<span id="cb95-435"><a href="#cb95-435" aria-hidden="true" tabindex="-1"></a>available within 90 days of reported date of diagnosis to be included in</span>
<span id="cb95-436"><a href="#cb95-436" aria-hidden="true" tabindex="-1"></a>this study and patients diagnosed outside of NHS Lothian will not have a</span>
<span id="cb95-437"><a href="#cb95-437" aria-hidden="true" tabindex="-1"></a>biomarker test result available within this period, the effect on our</span>
<span id="cb95-438"><a href="#cb95-438" aria-hidden="true" tabindex="-1"></a>study should be minimal. However, we will revisit month of diagnosis</span>
<span id="cb95-439"><a href="#cb95-439" aria-hidden="true" tabindex="-1"></a>after filtering by existence of diagnostic biomarker measurements to</span>
<span id="cb95-440"><a href="#cb95-440" aria-hidden="true" tabindex="-1"></a>confirm our assumption.</span>
<span id="cb95-441"><a href="#cb95-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-442"><a href="#cb95-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Year of diagnosis (preprocessed)}</span></span>
<span id="cb95-443"><a href="#cb95-443" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-diag-year-processed</span></span>
<span id="cb95-444"><a href="#cb95-444" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Bar plot of year of diagnosis"</span></span>
<span id="cb95-445"><a href="#cb95-445" aria-hidden="true" tabindex="-1"></a><span class="in">dict %&gt;%</span></span>
<span id="cb95-446"><a href="#cb95-446" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as.factor(year(date.of.diag)))) +</span></span>
<span id="cb95-447"><a href="#cb95-447" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(color = "black", fill = "#FEC601", linewidth = 0.3) +</span></span>
<span id="cb95-448"><a href="#cb95-448" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-449"><a href="#cb95-449" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency") +</span></span>
<span id="cb95-450"><a href="#cb95-450" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Year of IBD Diagnosis")</span></span>
<span id="cb95-451"><a href="#cb95-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-452"><a href="#cb95-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-453"><a href="#cb95-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Month of diagnosis (preprocessed)}</span></span>
<span id="cb95-454"><a href="#cb95-454" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-diag-month</span></span>
<span id="cb95-455"><a href="#cb95-455" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Bar plot of month of diagnosis"</span></span>
<span id="cb95-456"><a href="#cb95-456" aria-hidden="true" tabindex="-1"></a><span class="in">dict %&gt;%</span></span>
<span id="cb95-457"><a href="#cb95-457" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as.factor(month(date.of.diag, label = TRUE)))) +</span></span>
<span id="cb95-458"><a href="#cb95-458" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(color = "black", fill = "#FEC601", linewidth = 0.3) +</span></span>
<span id="cb95-459"><a href="#cb95-459" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-460"><a href="#cb95-460" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency") +</span></span>
<span id="cb95-461"><a href="#cb95-461" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Month of IBD Diagnosis")</span></span>
<span id="cb95-462"><a href="#cb95-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-463"><a href="#cb95-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-464"><a href="#cb95-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r diagnostic trend}</span></span>
<span id="cb95-465"><a href="#cb95-465" aria-hidden="true" tabindex="-1"></a><span class="in">diag.ts &lt;- dict %&gt;%</span></span>
<span id="cb95-466"><a href="#cb95-466" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb95-467"><a href="#cb95-467" aria-hidden="true" tabindex="-1"></a><span class="in">    date.of.diag.month =</span></span>
<span id="cb95-468"><a href="#cb95-468" aria-hidden="true" tabindex="-1"></a><span class="in">      as.Date(paste0(format(date.of.diag, "%Y-%m"), "-01"), format = "%Y-%m-%d")</span></span>
<span id="cb95-469"><a href="#cb95-469" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb95-470"><a href="#cb95-470" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(date.of.diag.month) %&gt;%</span></span>
<span id="cb95-471"><a href="#cb95-471" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count = n()) %&gt;%</span></span>
<span id="cb95-472"><a href="#cb95-472" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb95-473"><a href="#cb95-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-474"><a href="#cb95-474" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(diag.ts, aes(x = as.Date(date.of.diag.month, "%Y-%m"), y = count, group = 1)) +</span></span>
<span id="cb95-475"><a href="#cb95-475" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line() +</span></span>
<span id="cb95-476"><a href="#cb95-476" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Diagnosis date") +</span></span>
<span id="cb95-477"><a href="#cb95-477" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Number of diagnosis") +</span></span>
<span id="cb95-478"><a href="#cb95-478" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%Y-%m") +</span></span>
<span id="cb95-479"><a href="#cb95-479" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb95-480"><a href="#cb95-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-481"><a href="#cb95-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-482"><a href="#cb95-482" aria-hidden="true" tabindex="-1"></a><span class="fu">## Faecal calprotectin</span></span>
<span id="cb95-483"><a href="#cb95-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-484"><a href="#cb95-484" aria-hidden="true" tabindex="-1"></a>Faecal calprotectin (FC), a marker of intestinal inflammation, has been</span>
<span id="cb95-485"><a href="#cb95-485" aria-hidden="true" tabindex="-1"></a>obtained from two datasets. The first dataset has been curated by</span>
<span id="cb95-486"><a href="#cb95-486" aria-hidden="true" tabindex="-1"></a>members of the Lees group whilst the second dataset is a direct extract</span>
<span id="cb95-487"><a href="#cb95-487" aria-hidden="true" tabindex="-1"></a>from TRAK, a patient monitoring system used by NHS Lothian.</span>
<span id="cb95-488"><a href="#cb95-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-489"><a href="#cb95-489" aria-hidden="true" tabindex="-1"></a><span class="fu">### Incorporating later extract</span></span>
<span id="cb95-490"><a href="#cb95-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-491"><a href="#cb95-491" aria-hidden="true" tabindex="-1"></a>Data from these datasets has been merged and duplicates of data (same</span>
<span id="cb95-492"><a href="#cb95-492" aria-hidden="true" tabindex="-1"></a>subject ID, measurement date, and recorded value) were removed. We also</span>
<span id="cb95-493"><a href="#cb95-493" aria-hidden="true" tabindex="-1"></a>reduced the FC dataset to only describe subjects for whom IBD type and</span>
<span id="cb95-494"><a href="#cb95-494" aria-hidden="true" tabindex="-1"></a>date of diagnosis are available for.</span>
<span id="cb95-495"><a href="#cb95-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-496"><a href="#cb95-496" aria-hidden="true" tabindex="-1"></a>For the TRAK extract, times for test results are given in datetime</span>
<span id="cb95-497"><a href="#cb95-497" aria-hidden="true" tabindex="-1"></a>format (where both date and time of the day are provided). The times</span>
<span id="cb95-498"><a href="#cb95-498" aria-hidden="true" tabindex="-1"></a>have been dropped as this degree of granularity is not required. </span>
<span id="cb95-499"><a href="#cb95-499" aria-hidden="true" tabindex="-1"></a>Duplicate tests (same id, date and test value) are removed here. </span>
<span id="cb95-500"><a href="#cb95-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-501"><a href="#cb95-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL merge}</span></span>
<span id="cb95-502"><a href="#cb95-502" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- fcal[, c(</span></span>
<span id="cb95-503"><a href="#cb95-503" aria-hidden="true" tabindex="-1"></a><span class="in">  "ids",</span></span>
<span id="cb95-504"><a href="#cb95-504" aria-hidden="true" tabindex="-1"></a><span class="in">  "COLLECTION_DATE",</span></span>
<span id="cb95-505"><a href="#cb95-505" aria-hidden="true" tabindex="-1"></a><span class="in">  "TEST_DATA",</span></span>
<span id="cb95-506"><a href="#cb95-506" aria-hidden="true" tabindex="-1"></a><span class="in">  "sex",</span></span>
<span id="cb95-507"><a href="#cb95-507" aria-hidden="true" tabindex="-1"></a><span class="in">  "diagnosis",</span></span>
<span id="cb95-508"><a href="#cb95-508" aria-hidden="true" tabindex="-1"></a><span class="in">  "diagnosis_date"</span></span>
<span id="cb95-509"><a href="#cb95-509" aria-hidden="true" tabindex="-1"></a><span class="in">)]</span></span>
<span id="cb95-510"><a href="#cb95-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-511"><a href="#cb95-511" aria-hidden="true" tabindex="-1"></a><span class="in"># Subset to only include those that passed the earlier inclusion/exclusion</span></span>
<span id="cb95-512"><a href="#cb95-512" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- subset(fcal, ids %in% dict$ids)</span></span>
<span id="cb95-513"><a href="#cb95-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-514"><a href="#cb95-514" aria-hidden="true" tabindex="-1"></a><span class="in"># Collection dates include collection times which are not required. Discarding.</span></span>
<span id="cb95-515"><a href="#cb95-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-516"><a href="#cb95-516" aria-hidden="true" tabindex="-1"></a><span class="in">fcal$COLLECTION_DATE &lt;- readr::parse_date(</span></span>
<span id="cb95-517"><a href="#cb95-517" aria-hidden="true" tabindex="-1"></a><span class="in">  stringr::str_split_fixed(fcal$COLLECTION_DATE, " ", n = 2)[, 1],</span></span>
<span id="cb95-518"><a href="#cb95-518" aria-hidden="true" tabindex="-1"></a><span class="in">  format = "%Y-%m-%d"</span></span>
<span id="cb95-519"><a href="#cb95-519" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-520"><a href="#cb95-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-521"><a href="#cb95-521" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(fcal)[1:3] &lt;- c("ids", "calpro_date", "calpro_result")</span></span>
<span id="cb95-522"><a href="#cb95-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-523"><a href="#cb95-523" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- subset(fcal, ids %in% dict$ids)</span></span>
<span id="cb95-524"><a href="#cb95-524" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- fcal %&gt;%</span></span>
<span id="cb95-525"><a href="#cb95-525" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-diagnosis)</span></span>
<span id="cb95-526"><a href="#cb95-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-527"><a href="#cb95-527" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- merge(fcal,</span></span>
<span id="cb95-528"><a href="#cb95-528" aria-hidden="true" tabindex="-1"></a><span class="in">  dict[, c("ids", "diagnosis", "date.of.diag")],</span></span>
<span id="cb95-529"><a href="#cb95-529" aria-hidden="true" tabindex="-1"></a><span class="in">  by = "ids",</span></span>
<span id="cb95-530"><a href="#cb95-530" aria-hidden="true" tabindex="-1"></a><span class="in">  all.x = TRUE</span></span>
<span id="cb95-531"><a href="#cb95-531" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-532"><a href="#cb95-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-533"><a href="#cb95-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-534"><a href="#cb95-534" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre-processing of test results</span></span>
<span id="cb95-535"><a href="#cb95-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-536"><a href="#cb95-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL censor mapping}</span></span>
<span id="cb95-537"><a href="#cb95-537" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb95-538"><a href="#cb95-538" aria-hidden="true" tabindex="-1"></a><span class="in">## Some values cannot be directly coerced as numeric</span></span>
<span id="cb95-539"><a href="#cb95-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-540"><a href="#cb95-540" aria-hidden="true" tabindex="-1"></a><span class="in">fcal$calpro_result &lt;- plyr::mapvalues(</span></span>
<span id="cb95-541"><a href="#cb95-541" aria-hidden="true" tabindex="-1"></a><span class="in">  fcal$calpro_result,</span></span>
<span id="cb95-542"><a href="#cb95-542" aria-hidden="true" tabindex="-1"></a><span class="in">  from = c(</span></span>
<span id="cb95-543"><a href="#cb95-543" aria-hidden="true" tabindex="-1"></a><span class="in">    "&lt;20",</span></span>
<span id="cb95-544"><a href="#cb95-544" aria-hidden="true" tabindex="-1"></a><span class="in">    "&lt;25",</span></span>
<span id="cb95-545"><a href="#cb95-545" aria-hidden="true" tabindex="-1"></a><span class="in">    "&lt;50",</span></span>
<span id="cb95-546"><a href="#cb95-546" aria-hidden="true" tabindex="-1"></a><span class="in">    "&gt;1250",</span></span>
<span id="cb95-547"><a href="#cb95-547" aria-hidden="true" tabindex="-1"></a><span class="in">    "&gt;2500",</span></span>
<span id="cb95-548"><a href="#cb95-548" aria-hidden="true" tabindex="-1"></a><span class="in">    "&gt;3000",</span></span>
<span id="cb95-549"><a href="#cb95-549" aria-hidden="true" tabindex="-1"></a><span class="in">    "&gt;6000"</span></span>
<span id="cb95-550"><a href="#cb95-550" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb95-551"><a href="#cb95-551" aria-hidden="true" tabindex="-1"></a><span class="in">  to = c(</span></span>
<span id="cb95-552"><a href="#cb95-552" aria-hidden="true" tabindex="-1"></a><span class="in">    "20",</span></span>
<span id="cb95-553"><a href="#cb95-553" aria-hidden="true" tabindex="-1"></a><span class="in">    "25",</span></span>
<span id="cb95-554"><a href="#cb95-554" aria-hidden="true" tabindex="-1"></a><span class="in">    "50",</span></span>
<span id="cb95-555"><a href="#cb95-555" aria-hidden="true" tabindex="-1"></a><span class="in">    "1250",</span></span>
<span id="cb95-556"><a href="#cb95-556" aria-hidden="true" tabindex="-1"></a><span class="in">    "2500",</span></span>
<span id="cb95-557"><a href="#cb95-557" aria-hidden="true" tabindex="-1"></a><span class="in">    "3000",</span></span>
<span id="cb95-558"><a href="#cb95-558" aria-hidden="true" tabindex="-1"></a><span class="in">    "6000"</span></span>
<span id="cb95-559"><a href="#cb95-559" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb95-560"><a href="#cb95-560" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-561"><a href="#cb95-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-562"><a href="#cb95-562" aria-hidden="true" tabindex="-1"></a><span class="in"># Here, values that cannot be converted into a numeric value will be excluded</span></span>
<span id="cb95-563"><a href="#cb95-563" aria-hidden="true" tabindex="-1"></a><span class="in"># (they are converted to NA)</span></span>
<span id="cb95-564"><a href="#cb95-564" aria-hidden="true" tabindex="-1"></a><span class="in">fcal$calpro_result &lt;- as.numeric(fcal$calpro_result) # Remove error codes</span></span>
<span id="cb95-565"><a href="#cb95-565" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- fcal[!is.na(fcal[, "calpro_result"]), ]</span></span>
<span id="cb95-566"><a href="#cb95-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-567"><a href="#cb95-567" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply limits of detection</span></span>
<span id="cb95-568"><a href="#cb95-568" aria-hidden="true" tabindex="-1"></a><span class="in">fcal[fcal[, "calpro_result"] &lt; 20, "calpro_result"] &lt;- 20</span></span>
<span id="cb95-569"><a href="#cb95-569" aria-hidden="true" tabindex="-1"></a><span class="in">fcal[fcal[, "calpro_result"] &gt; 1250, "calpro_result"] &lt;- 1250</span></span>
<span id="cb95-570"><a href="#cb95-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-571"><a href="#cb95-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-572"><a href="#cb95-572" aria-hidden="true" tabindex="-1"></a>FC data can be both left and right censored. FC recorded as "<span class="sc">\&lt;</span>20" were</span>
<span id="cb95-573"><a href="#cb95-573" aria-hidden="true" tabindex="-1"></a>mapped to "20". FC recorded as "<span class="sc">\&gt;</span>1250", "<span class="sc">\&gt;</span>2500", or "<span class="sc">\&gt;</span>6000" were all</span>
<span id="cb95-574"><a href="#cb95-574" aria-hidden="true" tabindex="-1"></a>mapped to "1250". Any FC tests given an error code (e.g. marked as an </span>
<span id="cb95-575"><a href="#cb95-575" aria-hidden="true" tabindex="-1"></a>insufficient sample by the laboratory) have been removed.</span>
<span id="cb95-576"><a href="#cb95-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-577"><a href="#cb95-577" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb95-578"><a href="#cb95-578" aria-hidden="true" tabindex="-1"></a><span class="fu">#### More information on FC censoring</span></span>
<span id="cb95-579"><a href="#cb95-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-580"><a href="#cb95-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-581"><a href="#cb95-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-582"><a href="#cb95-582" aria-hidden="true" tabindex="-1"></a>The lower limit of detection is $&lt;20 \mu g/g$ ($20 \mu g$ of</span>
<span id="cb95-583"><a href="#cb95-583" aria-hidden="true" tabindex="-1"></a>calprotectin per $g$ of stool). By reducing the upper limit, it is</span>
<span id="cb95-584"><a href="#cb95-584" aria-hidden="true" tabindex="-1"></a>possible to run more tests in parallel. As a higher throughput has been</span>
<span id="cb95-585"><a href="#cb95-585" aria-hidden="true" tabindex="-1"></a>required over time, the upper threshold for tests has become lower.</span>
<span id="cb95-586"><a href="#cb95-586" aria-hidden="true" tabindex="-1"></a>Initially test results over $6000 \mu g/g$ were censored, then</span>
<span id="cb95-587"><a href="#cb95-587" aria-hidden="true" tabindex="-1"></a>$2500 \mu g/g$ and now $1250 \mu g /g$ is the upper limit for FC tests.</span>
<span id="cb95-588"><a href="#cb95-588" aria-hidden="true" tabindex="-1"></a>This change has resulted in minimal impact in clinics as $1250 \mu g/g$</span>
<span id="cb95-589"><a href="#cb95-589" aria-hidden="true" tabindex="-1"></a>is still considered a high result. However, this change has potential</span>
<span id="cb95-590"><a href="#cb95-590" aria-hidden="true" tabindex="-1"></a>implications for research.</span>
<span id="cb95-591"><a href="#cb95-591" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb95-592"><a href="#cb95-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-593"><a href="#cb95-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-594"><a href="#cb95-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-fcal-meas}</span></span>
<span id="cb95-595"><a href="#cb95-595" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: "fig-fcal-meas"</span></span>
<span id="cb95-596"><a href="#cb95-596" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Density plot of FCAL measurements by observed value"</span></span>
<span id="cb95-597"><a href="#cb95-597" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb95-598"><a href="#cb95-598" aria-hidden="true" tabindex="-1"></a><span class="in">fcal %&gt;%</span></span>
<span id="cb95-599"><a href="#cb95-599" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = calpro_result)) +</span></span>
<span id="cb95-600"><a href="#cb95-600" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(</span></span>
<span id="cb95-601"><a href="#cb95-601" aria-hidden="true" tabindex="-1"></a><span class="in">    linewidth = 0.8,</span></span>
<span id="cb95-602"><a href="#cb95-602" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.5,</span></span>
<span id="cb95-603"><a href="#cb95-603" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#9FD8CB",</span></span>
<span id="cb95-604"><a href="#cb95-604" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "#517664"</span></span>
<span id="cb95-605"><a href="#cb95-605" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb95-606"><a href="#cb95-606" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-607"><a href="#cb95-607" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank()) +</span></span>
<span id="cb95-608"><a href="#cb95-608" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("FCAL (µg/g)") +</span></span>
<span id="cb95-609"><a href="#cb95-609" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Density") +</span></span>
<span id="cb95-610"><a href="#cb95-610" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 250, colour = "red")</span></span>
<span id="cb95-611"><a href="#cb95-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-612"><a href="#cb95-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-613"><a href="#cb95-613" aria-hidden="true" tabindex="-1"></a>FC test results on the original measurement scale are heavily</span>
<span id="cb95-614"><a href="#cb95-614" aria-hidden="true" tabindex="-1"></a>right-skewed towards $100 \mu g/g$. These data will be log transformed-</span>
<span id="cb95-615"><a href="#cb95-615" aria-hidden="true" tabindex="-1"></a>resulting in the multi-modal distribution seen in @fig-logfcal-meas.</span>
<span id="cb95-616"><a href="#cb95-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-619"><a href="#cb95-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-620"><a href="#cb95-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fig-logfcal-meas"</span></span>
<span id="cb95-621"><a href="#cb95-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Density plot of logged FCAL test results"</span></span>
<span id="cb95-622"><a href="#cb95-622" aria-hidden="true" tabindex="-1"></a>fcal <span class="sc">%&gt;%</span></span>
<span id="cb95-623"><a href="#cb95-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(calpro_result))) <span class="sc">+</span></span>
<span id="cb95-624"><a href="#cb95-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-625"><a href="#cb95-625" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-626"><a href="#cb95-626" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-627"><a href="#cb95-627" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#9FD8CB"</span>,</span>
<span id="cb95-628"><a href="#cb95-628" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#517664"</span></span>
<span id="cb95-629"><a href="#cb95-629" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-630"><a href="#cb95-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-631"><a href="#cb95-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-632"><a href="#cb95-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(FCAL (µg/g))"</span>) <span class="sc">+</span></span>
<span id="cb95-633"><a href="#cb95-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb95-634"><a href="#cb95-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">log</span>(<span class="dv">250</span>), <span class="at">colour =</span> <span class="st">"red"</span>)</span>
<span id="cb95-635"><a href="#cb95-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-636"><a href="#cb95-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-637"><a href="#cb95-637" aria-hidden="true" tabindex="-1"></a><span class="fu">### Removal of duplicate FCAL measurements</span></span>
<span id="cb95-638"><a href="#cb95-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-641"><a href="#cb95-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-642"><a href="#cb95-642" aria-hidden="true" tabindex="-1"></a>duplicated.ids <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb95-643"><a href="#cb95-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-644"><a href="#cb95-644" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> <span class="fu">unique</span>(fcal<span class="sc">$</span>ids)) {</span>
<span id="cb95-645"><a href="#cb95-645" aria-hidden="true" tabindex="-1"></a>  sub.fcal <span class="ot">&lt;-</span> <span class="fu">subset</span>(fcal, ids <span class="sc">==</span> id) <span class="co"># Get FC data for a subject</span></span>
<span id="cb95-646"><a href="#cb95-646" aria-hidden="true" tabindex="-1"></a>  sub.fcal <span class="ot">&lt;-</span> sub.fcal[<span class="fu">order</span>(sub.fcal<span class="sc">$</span>calpro_date), ] <span class="co"># Order by dates</span></span>
<span id="cb95-647"><a href="#cb95-647" aria-hidden="true" tabindex="-1"></a>  time.diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(sub.fcal<span class="sc">$</span>calpro_date) <span class="co"># Find time between ordered dates</span></span>
<span id="cb95-648"><a href="#cb95-648" aria-hidden="true" tabindex="-1"></a>  value.diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(sub.fcal<span class="sc">$</span>calpro_result) <span class="co"># Find difference in observed values</span></span>
<span id="cb95-649"><a href="#cb95-649" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If two measurements are within 10 days of each other and have the same value</span></span>
<span id="cb95-650"><a href="#cb95-650" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(time.diff <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> value.diff <span class="sc">==</span> <span class="dv">0</span>)) {</span>
<span id="cb95-651"><a href="#cb95-651" aria-hidden="true" tabindex="-1"></a>    duplicated.ids <span class="ot">&lt;-</span> <span class="fu">c</span>(duplicated.ids, id)</span>
<span id="cb95-652"><a href="#cb95-652" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove suspected duplicates (taking into account difference is lagged)</span></span>
<span id="cb95-653"><a href="#cb95-653" aria-hidden="true" tabindex="-1"></a>    sub.fcal <span class="ot">&lt;-</span> sub.fcal[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="sc">!</span>(time.diff <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> value.diff <span class="sc">==</span> <span class="dv">0</span>)), ]</span>
<span id="cb95-654"><a href="#cb95-654" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove data for subject with duplicates</span></span>
<span id="cb95-655"><a href="#cb95-655" aria-hidden="true" tabindex="-1"></a>    fcal <span class="ot">&lt;-</span> <span class="fu">subset</span>(fcal, ids <span class="sc">!=</span> id)</span>
<span id="cb95-656"><a href="#cb95-656" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add non duplicated data back</span></span>
<span id="cb95-657"><a href="#cb95-657" aria-hidden="true" tabindex="-1"></a>    fcal <span class="ot">&lt;-</span> <span class="fu">rbind</span>(fcal, sub.fcal)</span>
<span id="cb95-658"><a href="#cb95-658" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-659"><a href="#cb95-659" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-660"><a href="#cb95-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-661"><a href="#cb95-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-662"><a href="#cb95-662" aria-hidden="true" tabindex="-1"></a>Given FC was retrospectively collected from observational data, it is possible</span>
<span id="cb95-663"><a href="#cb95-663" aria-hidden="true" tabindex="-1"></a>duplicate tests have been recorded in the extract. As it is NHS Lothian policy</span>
<span id="cb95-664"><a href="#cb95-664" aria-hidden="true" tabindex="-1"></a>to not test FC days apart, we can assume that any tests with the same</span>
<span id="cb95-665"><a href="#cb95-665" aria-hidden="true" tabindex="-1"></a>observation within a small time frame are likely to be duplicates. This may</span>
<span id="cb95-666"><a href="#cb95-666" aria-hidden="true" tabindex="-1"></a>occur when collection dates and testing dates have been used interchangeably.</span>
<span id="cb95-667"><a href="#cb95-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-668"><a href="#cb95-668" aria-hidden="true" tabindex="-1"></a>If a subsequent FC test for a subject was dated within 10 days of a previous</span>
<span id="cb95-669"><a href="#cb95-669" aria-hidden="true" tabindex="-1"></a>test and has the same observed value, this observation was dropped. </span>
<span id="cb95-670"><a href="#cb95-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-673"><a href="#cb95-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-674"><a href="#cb95-674" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">p</span>(<span class="fu">paste</span>(</span>
<span id="cb95-675"><a href="#cb95-675" aria-hidden="true" tabindex="-1"></a>  <span class="st">"There are"</span>,</span>
<span id="cb95-676"><a href="#cb95-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(duplicated.ids),</span>
<span id="cb95-677"><a href="#cb95-677" aria-hidden="true" tabindex="-1"></a>  <span class="st">"subjects who appear to have duplicated FC measurements"</span></span>
<span id="cb95-678"><a href="#cb95-678" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb95-679"><a href="#cb95-679" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-680"><a href="#cb95-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-681"><a href="#cb95-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-682"><a href="#cb95-682" aria-hidden="true" tabindex="-1"></a><span class="fu">### Retiming - part 1</span></span>
<span id="cb95-683"><a href="#cb95-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-684"><a href="#cb95-684" aria-hidden="true" tabindex="-1"></a>Time of FC measurements were retimed and scaled to be the number of</span>
<span id="cb95-685"><a href="#cb95-685" aria-hidden="true" tabindex="-1"></a>years since IBD diagnosis.</span>
<span id="cb95-686"><a href="#cb95-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-687"><a href="#cb95-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL time mapping}</span></span>
<span id="cb95-688"><a href="#cb95-688" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-fcal-spag-pre</span></span>
<span id="cb95-689"><a href="#cb95-689" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Spaghetti plot of FC trajectories (preprocessed)"</span></span>
<span id="cb95-690"><a href="#cb95-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-691"><a href="#cb95-691" aria-hidden="true" tabindex="-1"></a><span class="in"># Dates have already been converted to Date class by fix_date_char() for dict</span></span>
<span id="cb95-692"><a href="#cb95-692" aria-hidden="true" tabindex="-1"></a><span class="in">fcal$calpro_time &lt;- as.numeric(fcal$calpro_date - fcal$date.of.diag) / 365.25</span></span>
<span id="cb95-693"><a href="#cb95-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-694"><a href="#cb95-694" aria-hidden="true" tabindex="-1"></a><span class="in">fcal %&gt;%</span></span>
<span id="cb95-695"><a href="#cb95-695" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = calpro_time, y = log(calpro_result), color = factor(ids))) +</span></span>
<span id="cb95-696"><a href="#cb95-696" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(alpha = 0.2) +</span></span>
<span id="cb95-697"><a href="#cb95-697" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.6) +</span></span>
<span id="cb95-698"><a href="#cb95-698" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-699"><a href="#cb95-699" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = viridis::viridis(length(unique(fcal$ids)))) +</span></span>
<span id="cb95-700"><a href="#cb95-700" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = "none") +</span></span>
<span id="cb95-701"><a href="#cb95-701" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Time (years)") +</span></span>
<span id="cb95-702"><a href="#cb95-702" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Log(FCAL (µg/g))") +</span></span>
<span id="cb95-703"><a href="#cb95-703" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("")</span></span>
<span id="cb95-704"><a href="#cb95-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-705"><a href="#cb95-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-706"><a href="#cb95-706" aria-hidden="true" tabindex="-1"></a>After retiming, it is clear some FC observations are earlier than diagnosis and</span>
<span id="cb95-707"><a href="#cb95-707" aria-hidden="true" tabindex="-1"></a>in some cases substantially earlier (@fig-fcal-spag-pre). Tests taken close to</span>
<span id="cb95-708"><a href="#cb95-708" aria-hidden="true" tabindex="-1"></a>the reported date of diagnosis are likely "early" as a result of diagnostic</span>
<span id="cb95-709"><a href="#cb95-709" aria-hidden="true" tabindex="-1"></a>delay whereas tests from much earlier were likely requested due to other</span>
<span id="cb95-710"><a href="#cb95-710" aria-hidden="true" tabindex="-1"></a>conditions.</span>
<span id="cb95-711"><a href="#cb95-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-712"><a href="#cb95-712" aria-hidden="true" tabindex="-1"></a>As such, FC results earlier than 90 days prior to diagnosis will be discarded.</span>
<span id="cb95-713"><a href="#cb95-713" aria-hidden="true" tabindex="-1"></a>If a subject has an FC within 90 days before diagnosis, then all of their FC</span>
<span id="cb95-714"><a href="#cb95-714" aria-hidden="true" tabindex="-1"></a>tests will be retimed such that their earliest FC within this period is equal to</span>
<span id="cb95-715"><a href="#cb95-715" aria-hidden="true" tabindex="-1"></a>0 and all later measurements are shifted accordingly to maintain the same</span>
<span id="cb95-716"><a href="#cb95-716" aria-hidden="true" tabindex="-1"></a> differences between measurement times.</span>
<span id="cb95-717"><a href="#cb95-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-718"><a href="#cb95-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove prediag fcal}</span></span>
<span id="cb95-719"><a href="#cb95-719" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- subset(fcal, calpro_time &gt;= -0.25)</span></span>
<span id="cb95-720"><a href="#cb95-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-721"><a href="#cb95-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-722"><a href="#cb95-722" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inclusion/exclusion: removal of subjects without a diagnostic FC test</span></span>
<span id="cb95-723"><a href="#cb95-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-724"><a href="#cb95-724" aria-hidden="true" tabindex="-1"></a>As indicated in our inclusion/exclusion criteria, we reduce the dataset to only </span>
<span id="cb95-725"><a href="#cb95-725" aria-hidden="true" tabindex="-1"></a>subjects with a diagnostic FC. This equates to subjects with at least one FCAL </span>
<span id="cb95-726"><a href="#cb95-726" aria-hidden="true" tabindex="-1"></a>measurement within 3 months of diagnosis $t \leq 0.25$.</span>
<span id="cb95-727"><a href="#cb95-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-728"><a href="#cb95-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL retiming}</span></span>
<span id="cb95-729"><a href="#cb95-729" aria-hidden="true" tabindex="-1"></a><span class="in">diagnostic &lt;- fcal %&gt;%</span></span>
<span id="cb95-730"><a href="#cb95-730" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ids) %&gt;%</span></span>
<span id="cb95-731"><a href="#cb95-731" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = sum(calpro_time &lt; 0.25)) %&gt;%</span></span>
<span id="cb95-732"><a href="#cb95-732" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n &gt; 0)</span></span>
<span id="cb95-733"><a href="#cb95-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-734"><a href="#cb95-734" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- subset(fcal, ids %in% diagnostic$ids)</span></span>
<span id="cb95-735"><a href="#cb95-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-736"><a href="#cb95-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-737"><a href="#cb95-737" aria-hidden="true" tabindex="-1"></a>After this exclusion, <span class="in">`r length(unique(fcal$ids))`</span> subjects remain in the data. </span>
<span id="cb95-738"><a href="#cb95-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-741"><a href="#cb95-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-742"><a href="#cb95-742" aria-hidden="true" tabindex="-1"></a><span class="do">##The following code is used to save the cleaned data generated so far. </span></span>
<span id="cb95-743"><a href="#cb95-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-744"><a href="#cb95-744" aria-hidden="true" tabindex="-1"></a>diag.time <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb95-745"><a href="#cb95-745" aria-hidden="true" tabindex="-1"></a>fc.ids <span class="ot">&lt;-</span>  <span class="fu">unique</span>(fcal<span class="sc">$</span>ids)</span>
<span id="cb95-746"><a href="#cb95-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-747"><a href="#cb95-747" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> fc.ids) {</span>
<span id="cb95-748"><a href="#cb95-748" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">subset</span>(fcal, ids <span class="sc">==</span> id)</span>
<span id="cb95-749"><a href="#cb95-749" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> temp[<span class="fu">order</span>(temp<span class="sc">$</span>calpro_time), ]</span>
<span id="cb95-750"><a href="#cb95-750" aria-hidden="true" tabindex="-1"></a>  diag.time <span class="ot">&lt;-</span> <span class="fu">c</span>(diag.time, temp[<span class="dv">1</span>, <span class="st">"calpro_time"</span>])</span>
<span id="cb95-751"><a href="#cb95-751" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-752"><a href="#cb95-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-753"><a href="#cb95-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-754"><a href="#cb95-754" aria-hidden="true" tabindex="-1"></a>fc.dist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ids =</span> fc.ids, <span class="at">diagnostic =</span> diag.time)</span>
<span id="cb95-755"><a href="#cb95-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-756"><a href="#cb95-756" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(prefix, <span class="st">"processed"</span>))) {</span>
<span id="cb95-757"><a href="#cb95-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(prefix, <span class="st">"processed"</span>))</span>
<span id="cb95-758"><a href="#cb95-758" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-759"><a href="#cb95-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-760"><a href="#cb95-760" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fc.dist, <span class="fu">paste0</span>(prefix, <span class="st">"processed/fc-diag-dist.RDS"</span>))</span>
<span id="cb95-761"><a href="#cb95-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-762"><a href="#cb95-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-763"><a href="#cb95-763" aria-hidden="true" tabindex="-1"></a><span class="fu">### Retiming - part 2</span></span>
<span id="cb95-764"><a href="#cb95-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-765"><a href="#cb95-765" aria-hidden="true" tabindex="-1"></a>Here, we show the distribution of the diagnostic FCAL measurements with</span>
<span id="cb95-766"><a href="#cb95-766" aria-hidden="true" tabindex="-1"></a>respect to diagnosis date (in days). </span>
<span id="cb95-767"><a href="#cb95-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-768"><a href="#cb95-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fcal days before diag}</span></span>
<span id="cb95-769"><a href="#cb95-769" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- fcal %&gt;%</span></span>
<span id="cb95-770"><a href="#cb95-770" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ids) %&gt;%</span></span>
<span id="cb95-771"><a href="#cb95-771" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(calpro_time == min(calpro_time)) %&gt;%</span></span>
<span id="cb95-772"><a href="#cb95-772" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = calpro_time * 365.25)) +</span></span>
<span id="cb95-773"><a href="#cb95-773" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(fill = "#20A39E", color = "#187370") +</span></span>
<span id="cb95-774"><a href="#cb95-774" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-775"><a href="#cb95-775" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb95-776"><a href="#cb95-776" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Density",</span></span>
<span id="cb95-777"><a href="#cb95-777" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Time from diagnosis to first faecal calprotectin (days)"</span></span>
<span id="cb95-778"><a href="#cb95-778" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb95-779"><a href="#cb95-779" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, linetype = "dashed", color = "red")</span></span>
<span id="cb95-780"><a href="#cb95-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-781"><a href="#cb95-781" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("plots/fc-diagnostic-dist.png",</span></span>
<span id="cb95-782"><a href="#cb95-782" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb95-783"><a href="#cb95-783" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 16 * 2 / 3,</span></span>
<span id="cb95-784"><a href="#cb95-784" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 6,</span></span>
<span id="cb95-785"><a href="#cb95-785" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb95-786"><a href="#cb95-786" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-787"><a href="#cb95-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-788"><a href="#cb95-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-789"><a href="#cb95-789" aria-hidden="true" tabindex="-1"></a>Although most diagnostic measurements were observed around the recorded </span>
<span id="cb95-790"><a href="#cb95-790" aria-hidden="true" tabindex="-1"></a>diagnosis time (near zero), this is not always the case. As such, we</span>
<span id="cb95-791"><a href="#cb95-791" aria-hidden="true" tabindex="-1"></a>decided to retime measurements/diagnosis time as described above (i.e. time = 0</span>
<span id="cb95-792"><a href="#cb95-792" aria-hidden="true" tabindex="-1"></a>matches the time of first available FCAL measurement). This is only applied to</span>
<span id="cb95-793"><a href="#cb95-793" aria-hidden="true" tabindex="-1"></a>individuals for which the first available CRP is prior to the recorded diagnosis</span>
<span id="cb95-794"><a href="#cb95-794" aria-hidden="true" tabindex="-1"></a>time.</span>
<span id="cb95-795"><a href="#cb95-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-798"><a href="#cb95-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-799"><a href="#cb95-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-fcal-spag-post</span></span>
<span id="cb95-800"><a href="#cb95-800" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Spaghetti plot of FC trajectories (processed)"</span></span>
<span id="cb95-801"><a href="#cb95-801" aria-hidden="true" tabindex="-1"></a><span class="co"># Retime so that t_0 = 0.</span></span>
<span id="cb95-802"><a href="#cb95-802" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> <span class="fu">unique</span>(fcal<span class="sc">$</span>ids)) {</span>
<span id="cb95-803"><a href="#cb95-803" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">subset</span>(fcal, ids <span class="sc">==</span> id)</span>
<span id="cb95-804"><a href="#cb95-804" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(temp<span class="sc">$</span>calpro_time <span class="sc">&lt;</span> <span class="dv">0</span>)) {</span>
<span id="cb95-805"><a href="#cb95-805" aria-hidden="true" tabindex="-1"></a>    add <span class="ot">&lt;-</span> <span class="fu">sort</span>(temp<span class="sc">$</span>calpro_time)[<span class="dv">1</span>]</span>
<span id="cb95-806"><a href="#cb95-806" aria-hidden="true" tabindex="-1"></a>    fcal[fcal[, <span class="st">"ids"</span>] <span class="sc">==</span> id, <span class="st">"calpro_time"</span>] <span class="ot">&lt;-</span></span>
<span id="cb95-807"><a href="#cb95-807" aria-hidden="true" tabindex="-1"></a>      fcal[fcal[, <span class="st">"ids"</span>] <span class="sc">==</span> id, <span class="st">"calpro_time"</span>] <span class="sc">+</span> <span class="fu">abs</span>(add)</span>
<span id="cb95-808"><a href="#cb95-808" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-809"><a href="#cb95-809" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-810"><a href="#cb95-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-811"><a href="#cb95-811" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(fcal<span class="sc">$</span>ids))</span>
<span id="cb95-812"><a href="#cb95-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-813"><a href="#cb95-813" aria-hidden="true" tabindex="-1"></a>fcal <span class="sc">%&gt;%</span></span>
<span id="cb95-814"><a href="#cb95-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> calpro_time, <span class="at">y =</span> <span class="fu">log</span>(calpro_result), <span class="at">color =</span> <span class="fu">factor</span>(ids))) <span class="sc">+</span></span>
<span id="cb95-815"><a href="#cb95-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb95-816"><a href="#cb95-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb95-817"><a href="#cb95-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-818"><a href="#cb95-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="fu">length</span>(<span class="fu">unique</span>(fcal<span class="sc">$</span>ids)))) <span class="sc">+</span></span>
<span id="cb95-819"><a href="#cb95-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb95-820"><a href="#cb95-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (years)"</span>) <span class="sc">+</span></span>
<span id="cb95-821"><a href="#cb95-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Log(FCAL (µg/g))"</span>) <span class="sc">+</span></span>
<span id="cb95-822"><a href="#cb95-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span>
<span id="cb95-823"><a href="#cb95-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-824"><a href="#cb95-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-825"><a href="#cb95-825" aria-hidden="true" tabindex="-1"></a>At this stage, we also exclude FCAL measurements recorded beyond 7 years post</span>
<span id="cb95-826"><a href="#cb95-826" aria-hidden="true" tabindex="-1"></a>diagnosis. </span>
<span id="cb95-827"><a href="#cb95-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-828"><a href="#cb95-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove fcal after 7 years}</span></span>
<span id="cb95-829"><a href="#cb95-829" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- subset(fcal, calpro_time &lt;= 7)</span></span>
<span id="cb95-830"><a href="#cb95-830" aria-hidden="true" tabindex="-1"></a><span class="in">length(unique(fcal$ids))</span></span>
<span id="cb95-831"><a href="#cb95-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-832"><a href="#cb95-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-833"><a href="#cb95-833" aria-hidden="true" tabindex="-1"></a>At this point, the data contains <span class="in">`r nrow(fcal)`</span> FCAL measurements across all</span>
<span id="cb95-834"><a href="#cb95-834" aria-hidden="true" tabindex="-1"></a><span class="in">`r length(unique(fcal$ids))`</span> individuals. </span>
<span id="cb95-835"><a href="#cb95-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-836"><a href="#cb95-836" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inclusion/exclusion: a minimum number of FCAL measurements</span></span>
<span id="cb95-837"><a href="#cb95-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-838"><a href="#cb95-838" aria-hidden="true" tabindex="-1"></a>Here, we summarise the number of observations per individual (with and without</span>
<span id="cb95-839"><a href="#cb95-839" aria-hidden="true" tabindex="-1"></a>considering censored values) as well as length of follow-up. The latter is </span>
<span id="cb95-840"><a href="#cb95-840" aria-hidden="true" tabindex="-1"></a>defined as the difference (in years) between diagnosis time and the time of the </span>
<span id="cb95-841"><a href="#cb95-841" aria-hidden="true" tabindex="-1"></a>latest FCAL measurement. </span>
<span id="cb95-842"><a href="#cb95-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-845"><a href="#cb95-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb95-846"><a href="#cb95-846" aria-hidden="true" tabindex="-1"></a>countsDF <span class="ot">&lt;-</span> fcal <span class="sc">%&gt;%</span></span>
<span id="cb95-847"><a href="#cb95-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-848"><a href="#cb95-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb95-849"><a href="#cb95-849" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.total =</span> <span class="fu">n</span>(),</span>
<span id="cb95-850"><a href="#cb95-850" aria-hidden="true" tabindex="-1"></a>    <span class="at">censored.left =</span> <span class="fu">sum</span>(calpro_result <span class="sc">==</span> <span class="dv">20</span>),</span>
<span id="cb95-851"><a href="#cb95-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">censored.right =</span> <span class="fu">sum</span>(calpro_result <span class="sc">==</span> <span class="dv">1250</span>),</span>
<span id="cb95-852"><a href="#cb95-852" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.noncensored =</span> n.total <span class="sc">-</span> censored.left <span class="sc">-</span> censored.right,</span>
<span id="cb95-853"><a href="#cb95-853" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.negtime.nondiag =</span> <span class="fu">sum</span>(calpro_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> calpro_date <span class="sc">-</span> date.of.diag <span class="sc">&lt;</span> <span class="dv">0</span>),</span>
<span id="cb95-854"><a href="#cb95-854" aria-hidden="true" tabindex="-1"></a>    <span class="at">followup =</span> <span class="fu">max</span>(calpro_time)</span>
<span id="cb95-855"><a href="#cb95-855" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb95-856"><a href="#cb95-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-857"><a href="#cb95-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-858"><a href="#cb95-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-859"><a href="#cb95-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{R fcal followup pre exclusions}</span></span>
<span id="cb95-860"><a href="#cb95-860" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-fcal-follow-up</span></span>
<span id="cb95-861"><a href="#cb95-861" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "(A) Histogram of the number of FCAL measurements per subject. (B) Histogram of FCAL follow-up per subject (before exclusions). (C) Scatterplot with number of FCAL measurements vs follow-up."</span></span>
<span id="cb95-862"><a href="#cb95-862" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 12</span></span>
<span id="cb95-863"><a href="#cb95-863" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: body-outset</span></span>
<span id="cb95-864"><a href="#cb95-864" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-865"><a href="#cb95-865" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = n.total)) +</span></span>
<span id="cb95-866"><a href="#cb95-866" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-867"><a href="#cb95-867" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-868"><a href="#cb95-868" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-869"><a href="#cb95-869" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Measurements per subject")</span></span>
<span id="cb95-870"><a href="#cb95-870" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-871"><a href="#cb95-871" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = followup)) +</span></span>
<span id="cb95-872"><a href="#cb95-872" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-873"><a href="#cb95-873" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-874"><a href="#cb95-874" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-875"><a href="#cb95-875" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years)")</span></span>
<span id="cb95-876"><a href="#cb95-876" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-877"><a href="#cb95-877" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(y = n.total, x = followup)) +</span></span>
<span id="cb95-878"><a href="#cb95-878" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hex() +</span></span>
<span id="cb95-879"><a href="#cb95-879" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years since diagnosis)") +</span></span>
<span id="cb95-880"><a href="#cb95-880" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Number of FC measurements") +</span></span>
<span id="cb95-881"><a href="#cb95-881" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-882"><a href="#cb95-882" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Count")</span></span>
<span id="cb95-883"><a href="#cb95-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-884"><a href="#cb95-884" aria-hidden="true" tabindex="-1"></a><span class="in">p1 + p2 + p3 + plot_annotation(tag_levels = "A")</span></span>
<span id="cb95-885"><a href="#cb95-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-886"><a href="#cb95-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-887"><a href="#cb95-887" aria-hidden="true" tabindex="-1"></a>Summary observations:</span>
<span id="cb95-888"><a href="#cb95-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-889"><a href="#cb95-889" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The number of FC measurements per subject is skewed towards low values. </span>
<span id="cb95-890"><a href="#cb95-890" aria-hidden="true" tabindex="-1"></a>However, there are also subjects with many FC observations. These subjects were </span>
<span id="cb95-891"><a href="#cb95-891" aria-hidden="true" tabindex="-1"></a>investigated and found to often have a complex disease course, such as acute </span>
<span id="cb95-892"><a href="#cb95-892" aria-hidden="true" tabindex="-1"></a>severe ulcerative colitis, and required close monitoring as a result.</span>
<span id="cb95-893"><a href="#cb95-893" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We do not directly require a minimum follow-up for a subject as this may bias </span>
<span id="cb95-894"><a href="#cb95-894" aria-hidden="true" tabindex="-1"></a>our findings. For example, UC patients who undergo a proctocolectomy</span>
<span id="cb95-895"><a href="#cb95-895" aria-hidden="true" tabindex="-1"></a>(surgical removal of the colon and rectum) are less likely to have FC</span>
<span id="cb95-896"><a href="#cb95-896" aria-hidden="true" tabindex="-1"></a>measurements after their surgery than patients who did not require</span>
<span id="cb95-897"><a href="#cb95-897" aria-hidden="true" tabindex="-1"></a>surgery. By applying criteria based on follow-up, we could indirectly</span>
<span id="cb95-898"><a href="#cb95-898" aria-hidden="true" tabindex="-1"></a>exclude subjects based on disease outcomes.</span>
<span id="cb95-899"><a href="#cb95-899" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>However, the requirement of at least 3 FCAL measurements (within 7 years</span>
<span id="cb95-900"><a href="#cb95-900" aria-hidden="true" tabindex="-1"></a>from diagnosis) will indirectly remove individuals with a very short follow-up time. </span>
<span id="cb95-901"><a href="#cb95-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-902"><a href="#cb95-902" aria-hidden="true" tabindex="-1"></a>Note that our inclusion criteria requires at least 3 non-censored FCAL </span>
<span id="cb95-903"><a href="#cb95-903" aria-hidden="true" tabindex="-1"></a>measurements per individual. As such, censoring needs to be taken into account</span>
<span id="cb95-904"><a href="#cb95-904" aria-hidden="true" tabindex="-1"></a>before applying filtering out individuals.</span>
<span id="cb95-905"><a href="#cb95-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-906"><a href="#cb95-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-909"><a href="#cb95-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb95-910"><a href="#cb95-910" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> countsDF <span class="sc">%&gt;%</span></span>
<span id="cb95-911"><a href="#cb95-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n.noncensored)) <span class="sc">+</span></span>
<span id="cb95-912"><a href="#cb95-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#5BBA6F"</span>, <span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb95-913"><a href="#cb95-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-914"><a href="#cb95-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb95-915"><a href="#cb95-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of non-censored measurements per subject"</span>)</span>
<span id="cb95-916"><a href="#cb95-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-917"><a href="#cb95-917" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> countsDF <span class="sc">%&gt;%</span></span>
<span id="cb95-918"><a href="#cb95-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> n.noncensored, <span class="at">x =</span> followup)) <span class="sc">+</span></span>
<span id="cb95-919"><a href="#cb95-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#FF4F79"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb95-920"><a href="#cb95-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Follow-up (years since diagnosis)"</span>) <span class="sc">+</span></span>
<span id="cb95-921"><a href="#cb95-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Number of non-censored FCAL measurements"</span>) <span class="sc">+</span></span>
<span id="cb95-922"><a href="#cb95-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-923"><a href="#cb95-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">3</span>)</span>
<span id="cb95-924"><a href="#cb95-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-925"><a href="#cb95-925" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>)</span>
<span id="cb95-926"><a href="#cb95-926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-927"><a href="#cb95-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-928"><a href="#cb95-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{R calculate number of non censored FCAL}</span></span>
<span id="cb95-929"><a href="#cb95-929" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of individuals with at least 3 FCAL measurements</span></span>
<span id="cb95-930"><a href="#cb95-930" aria-hidden="true" tabindex="-1"></a><span class="in">sum(countsDF$n.total &gt;= 3)</span></span>
<span id="cb95-931"><a href="#cb95-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-932"><a href="#cb95-932" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of individuals with at least 3 non-censored FCAL measurements</span></span>
<span id="cb95-933"><a href="#cb95-933" aria-hidden="true" tabindex="-1"></a><span class="in">sum(countsDF$n.noncensored &gt;= 3)</span></span>
<span id="cb95-934"><a href="#cb95-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-935"><a href="#cb95-935" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of individuals with at least 3 non-censored FCAL measurements after</span></span>
<span id="cb95-936"><a href="#cb95-936" aria-hidden="true" tabindex="-1"></a><span class="in"># discarding non-diagnostic values with negative calpro_time</span></span>
<span id="cb95-937"><a href="#cb95-937" aria-hidden="true" tabindex="-1"></a><span class="in">sum(countsDF$n.noncensored - countsDF$n.negtime.nondiag &gt;= 3)</span></span>
<span id="cb95-938"><a href="#cb95-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-939"><a href="#cb95-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-940"><a href="#cb95-940" aria-hidden="true" tabindex="-1"></a>The following is used to select individuals with at least 3 non-censored FCAL </span>
<span id="cb95-941"><a href="#cb95-941" aria-hidden="true" tabindex="-1"></a>measurements. </span>
<span id="cb95-942"><a href="#cb95-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-943"><a href="#cb95-943" aria-hidden="true" tabindex="-1"></a><span class="in">```{R FCAL frequency}</span></span>
<span id="cb95-944"><a href="#cb95-944" aria-hidden="true" tabindex="-1"></a><span class="in">fcal &lt;- fcal %&gt;%</span></span>
<span id="cb95-945"><a href="#cb95-945" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(ids %in% countsDF$ids[countsDF$n.noncensored &gt;= 3])</span></span>
<span id="cb95-946"><a href="#cb95-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-947"><a href="#cb95-947" aria-hidden="true" tabindex="-1"></a><span class="in">length(unique(fcal$ids))</span></span>
<span id="cb95-948"><a href="#cb95-948" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-949"><a href="#cb95-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-950"><a href="#cb95-950" aria-hidden="true" tabindex="-1"></a>This leaves a cohort with <span class="in">`r length(unique(fcal$ids))`</span> individuals.</span>
<span id="cb95-951"><a href="#cb95-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-952"><a href="#cb95-952" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fcal followup post exclusions}</span></span>
<span id="cb95-953"><a href="#cb95-953" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-fcal-follow-up-post</span></span>
<span id="cb95-954"><a href="#cb95-954" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "(A) Histogram of the number of FCAL measurements per subject. (B) Histogram of FCAL follow-up per subject (before exclusions). (C) Scatterplot with number of FCAL measurements vs follow-up. In all cases, only individuals with at least 3 non-censored measurements are included."</span></span>
<span id="cb95-955"><a href="#cb95-955" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 12</span></span>
<span id="cb95-956"><a href="#cb95-956" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: body-outset</span></span>
<span id="cb95-957"><a href="#cb95-957" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-958"><a href="#cb95-958" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n.noncensored &gt;= 3) %&gt;%</span></span>
<span id="cb95-959"><a href="#cb95-959" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = n.total)) +</span></span>
<span id="cb95-960"><a href="#cb95-960" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-961"><a href="#cb95-961" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-962"><a href="#cb95-962" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-963"><a href="#cb95-963" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Measurements per subject")</span></span>
<span id="cb95-964"><a href="#cb95-964" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-965"><a href="#cb95-965" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n.noncensored &gt;= 3) %&gt;%</span></span>
<span id="cb95-966"><a href="#cb95-966" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = followup)) +</span></span>
<span id="cb95-967"><a href="#cb95-967" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-968"><a href="#cb95-968" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-969"><a href="#cb95-969" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-970"><a href="#cb95-970" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years)")</span></span>
<span id="cb95-971"><a href="#cb95-971" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-972"><a href="#cb95-972" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n.noncensored &gt;= 3) %&gt;%</span></span>
<span id="cb95-973"><a href="#cb95-973" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(y = n.total, x = followup)) +</span></span>
<span id="cb95-974"><a href="#cb95-974" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hex() +</span></span>
<span id="cb95-975"><a href="#cb95-975" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years since diagnosis)") +</span></span>
<span id="cb95-976"><a href="#cb95-976" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Number of FC measurements") +</span></span>
<span id="cb95-977"><a href="#cb95-977" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-978"><a href="#cb95-978" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Count")</span></span>
<span id="cb95-979"><a href="#cb95-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-980"><a href="#cb95-980" aria-hidden="true" tabindex="-1"></a><span class="in">p1 + p2 + p3 + plot_annotation(tag_levels = "A")</span></span>
<span id="cb95-981"><a href="#cb95-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-982"><a href="#cb95-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-983"><a href="#cb95-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-984"><a href="#cb95-984" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--- CAV: do we need this here? may remove and keep in an EDA file ---&gt;</span></span>
<span id="cb95-985"><a href="#cb95-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-988"><a href="#cb95-988" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-989"><a href="#cb95-989" aria-hidden="true" tabindex="-1"></a>fcal <span class="sc">%&gt;%</span></span>
<span id="cb95-990"><a href="#cb95-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-991"><a href="#cb95-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-992"><a href="#cb95-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb95-993"><a href="#cb95-993" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-994"><a href="#cb95-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-995"><a href="#cb95-995" aria-hidden="true" tabindex="-1"></a><span class="fu">### Revisiting month of diagnosis</span></span>
<span id="cb95-996"><a href="#cb95-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-997"><a href="#cb95-997" aria-hidden="true" tabindex="-1"></a>After filtering by subjects who have a diagnostic FC available, January</span>
<span id="cb95-998"><a href="#cb95-998" aria-hidden="true" tabindex="-1"></a>is no longer over-represented for month of diagnosis as we hypothesised</span>
<span id="cb95-999"><a href="#cb95-999" aria-hidden="true" tabindex="-1"></a>(@fig-diag-month-redux)</span>
<span id="cb95-1000"><a href="#cb95-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1001"><a href="#cb95-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Month of diagnosis (postprocessed)}</span></span>
<span id="cb95-1002"><a href="#cb95-1002" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-diag-month-redux</span></span>
<span id="cb95-1003"><a href="#cb95-1003" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Bar plot of month of diagnosis"</span></span>
<span id="cb95-1004"><a href="#cb95-1004" aria-hidden="true" tabindex="-1"></a><span class="in">dict.temp &lt;- subset(dict, ids %in% unique(fcal$ids))</span></span>
<span id="cb95-1005"><a href="#cb95-1005" aria-hidden="true" tabindex="-1"></a><span class="in">dict.temp %&gt;%</span></span>
<span id="cb95-1006"><a href="#cb95-1006" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as.factor(month(date.of.diag, label = TRUE)))) +</span></span>
<span id="cb95-1007"><a href="#cb95-1007" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(color = "black", fill = "#FEC601", linewidth = 0.3) +</span></span>
<span id="cb95-1008"><a href="#cb95-1008" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1009"><a href="#cb95-1009" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency") +</span></span>
<span id="cb95-1010"><a href="#cb95-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Month of IBD Diagnosis")</span></span>
<span id="cb95-1011"><a href="#cb95-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1012"><a href="#cb95-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1013"><a href="#cb95-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">## C-reactive protein</span></span>
<span id="cb95-1014"><a href="#cb95-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1015"><a href="#cb95-1015" aria-hidden="true" tabindex="-1"></a><span class="in">```{R crp preprocess}</span></span>
<span id="cb95-1016"><a href="#cb95-1016" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- crp[, c("ids", "COLLECTION_DATE", "TEST_DATA")] %&gt;%</span></span>
<span id="cb95-1017"><a href="#cb95-1017" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(ids %in% dict$ids)</span></span>
<span id="cb95-1018"><a href="#cb95-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1019"><a href="#cb95-1019" aria-hidden="true" tabindex="-1"></a><span class="in"># Collection dates include collection times which are not required. Discarding.</span></span>
<span id="cb95-1020"><a href="#cb95-1020" aria-hidden="true" tabindex="-1"></a><span class="in">crp$COLLECTION_DATE &lt;- readr::parse_date(</span></span>
<span id="cb95-1021"><a href="#cb95-1021" aria-hidden="true" tabindex="-1"></a><span class="in">  stringr::str_split_fixed(crp$COLLECTION_DATE, " ", n = 2)[, 1],</span></span>
<span id="cb95-1022"><a href="#cb95-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  format = "%Y-%m-%d"</span></span>
<span id="cb95-1023"><a href="#cb95-1023" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-1024"><a href="#cb95-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1025"><a href="#cb95-1025" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(crp) &lt;- c("ids", "crp_date", "crp_result")</span></span>
<span id="cb95-1026"><a href="#cb95-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1027"><a href="#cb95-1027" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- merge(crp,</span></span>
<span id="cb95-1028"><a href="#cb95-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  dict[, c("ids", "diagnosis")],</span></span>
<span id="cb95-1029"><a href="#cb95-1029" aria-hidden="true" tabindex="-1"></a><span class="in">  by = "ids",</span></span>
<span id="cb95-1030"><a href="#cb95-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  all.x = TRUE</span></span>
<span id="cb95-1031"><a href="#cb95-1031" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-1032"><a href="#cb95-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1033"><a href="#cb95-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1034"><a href="#cb95-1034" aria-hidden="true" tabindex="-1"></a>C-reactive protein (CRP) is a blood-based marker of inflammation. Unlike</span>
<span id="cb95-1035"><a href="#cb95-1035" aria-hidden="true" tabindex="-1"></a>FCAL, which is highly specific to gastrointestinal inflammation, CRP</span>
<span id="cb95-1036"><a href="#cb95-1036" aria-hidden="true" tabindex="-1"></a>levels are indicative of overall inflammation and are more likely to be</span>
<span id="cb95-1037"><a href="#cb95-1037" aria-hidden="true" tabindex="-1"></a>affected by extra-intestinal factors such as infections. However,</span>
<span id="cb95-1038"><a href="#cb95-1038" aria-hidden="true" tabindex="-1"></a>patient adherence to CRP testing is very strong, and CRP has seen</span>
<span id="cb95-1039"><a href="#cb95-1039" aria-hidden="true" tabindex="-1"></a>historic usage in the field of IBD. Although CRP has been used for many</span>
<span id="cb95-1040"><a href="#cb95-1040" aria-hidden="true" tabindex="-1"></a>years, we unfortunately only have test results from as early as 2008 due</span>
<span id="cb95-1041"><a href="#cb95-1041" aria-hidden="true" tabindex="-1"></a>to the transition towards using TRAK for storing CRP results instead of</span>
<span id="cb95-1042"><a href="#cb95-1042" aria-hidden="true" tabindex="-1"></a>the previous system.</span>
<span id="cb95-1043"><a href="#cb95-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1044"><a href="#cb95-1044" aria-hidden="true" tabindex="-1"></a>As there is only one extract for CRP data (obtained from TRAK), merging</span>
<span id="cb95-1045"><a href="#cb95-1045" aria-hidden="true" tabindex="-1"></a>multiple datasets is not required. As with the FCAL data, the recorded</span>
<span id="cb95-1046"><a href="#cb95-1046" aria-hidden="true" tabindex="-1"></a>time of day for each test has been discarded in favour of the date. Any</span>
<span id="cb95-1047"><a href="#cb95-1047" aria-hidden="true" tabindex="-1"></a>potential duplicate results have been removed.</span>
<span id="cb95-1048"><a href="#cb95-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1049"><a href="#cb95-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1050"><a href="#cb95-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre-processing of test results</span></span>
<span id="cb95-1051"><a href="#cb95-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1052"><a href="#cb95-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```{R crp censor mapping}</span></span>
<span id="cb95-1053"><a href="#cb95-1053" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb95-1054"><a href="#cb95-1054" aria-hidden="true" tabindex="-1"></a><span class="in">crp$crp_result &lt;- as.numeric(</span></span>
<span id="cb95-1055"><a href="#cb95-1055" aria-hidden="true" tabindex="-1"></a><span class="in">  plyr::mapvalues(</span></span>
<span id="cb95-1056"><a href="#cb95-1056" aria-hidden="true" tabindex="-1"></a><span class="in">    crp$crp_result,</span></span>
<span id="cb95-1057"><a href="#cb95-1057" aria-hidden="true" tabindex="-1"></a><span class="in">    from = c(</span></span>
<span id="cb95-1058"><a href="#cb95-1058" aria-hidden="true" tabindex="-1"></a><span class="in">      "&lt;0.2", "&lt;1", "&lt;1.", "&lt;1.0", "&lt;2", "&lt;3", "&lt;3.0", "&lt;5",</span></span>
<span id="cb95-1059"><a href="#cb95-1059" aria-hidden="true" tabindex="-1"></a><span class="in">      "&gt;90", "&gt;320"</span></span>
<span id="cb95-1060"><a href="#cb95-1060" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb95-1061"><a href="#cb95-1061" aria-hidden="true" tabindex="-1"></a><span class="in">    to = c(1, 1, 1, 1, 2, 3, 3, 5, 90, 320)</span></span>
<span id="cb95-1062"><a href="#cb95-1062" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb95-1063"><a href="#cb95-1063" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-1064"><a href="#cb95-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1065"><a href="#cb95-1065" aria-hidden="true" tabindex="-1"></a><span class="in"># Lower-bound censoring</span></span>
<span id="cb95-1066"><a href="#cb95-1066" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- crp %&gt;%</span></span>
<span id="cb95-1067"><a href="#cb95-1067" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(crp_result = if_else(crp_result &lt; 1, 1, crp_result))</span></span>
<span id="cb95-1068"><a href="#cb95-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1069"><a href="#cb95-1069" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove error test results</span></span>
<span id="cb95-1070"><a href="#cb95-1070" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- crp[!is.na(crp[, "crp_result"]), ]</span></span>
<span id="cb95-1071"><a href="#cb95-1071" aria-hidden="true" tabindex="-1"></a><span class="in"># Map numerical &lt;1 test results (e.g 0.2) to 1.</span></span>
<span id="cb95-1072"><a href="#cb95-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1073"><a href="#cb95-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1074"><a href="#cb95-1074" aria-hidden="true" tabindex="-1"></a>CRP is left-censored, but does not appear to be right-censored. Multiple</span>
<span id="cb95-1075"><a href="#cb95-1075" aria-hidden="true" tabindex="-1"></a>cut-offs are reported</span>
<span id="cb95-1076"><a href="#cb95-1076" aria-hidden="true" tabindex="-1"></a>(<span class="in">`r unique(as.numeric(gsub("&lt;", "", names(table(crp$crp_result))[2:8])))`</span>)</span>
<span id="cb95-1077"><a href="#cb95-1077" aria-hidden="true" tabindex="-1"></a>with there also being variations for how $&lt; 1mg/L$ is reported</span>
<span id="cb95-1078"><a href="#cb95-1078" aria-hidden="true" tabindex="-1"></a>(<span class="in">`r names(table(crp$crp_result))[3:5]`</span>). We map every observation $&lt; 1$</span>
<span id="cb95-1079"><a href="#cb95-1079" aria-hidden="true" tabindex="-1"></a>to 1 and map <span class="sc">\&lt;</span>2, <span class="sc">\&lt;</span>3, and <span class="sc">\&lt;</span> 5 to 2, 3, and 5 respectively. Any failed</span>
<span id="cb95-1080"><a href="#cb95-1080" aria-hidden="true" tabindex="-1"></a>tests (e.g due to contamination or an insufficient sample being</span>
<span id="cb95-1081"><a href="#cb95-1081" aria-hidden="true" tabindex="-1"></a>provided) are discarded. As such, $1mg/L$ is used as a left censoring value </span>
<span id="cb95-1082"><a href="#cb95-1082" aria-hidden="true" tabindex="-1"></a>for CRP.</span>
<span id="cb95-1083"><a href="#cb95-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1084"><a href="#cb95-1084" aria-hidden="true" tabindex="-1"></a>As can be seen in @fig-crp-meas, extremely elevated CRP has been</span>
<span id="cb95-1085"><a href="#cb95-1085" aria-hidden="true" tabindex="-1"></a>observed in some cases. These observations are physiologically valid.</span>
<span id="cb95-1086"><a href="#cb95-1086" aria-hidden="true" tabindex="-1"></a>However, these data may skew our models and may be candidates for</span>
<span id="cb95-1087"><a href="#cb95-1087" aria-hidden="true" tabindex="-1"></a>removal.</span>
<span id="cb95-1088"><a href="#cb95-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1089"><a href="#cb95-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1092"><a href="#cb95-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1093"><a href="#cb95-1093" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fig-crp-meas"</span></span>
<span id="cb95-1094"><a href="#cb95-1094" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Density plot of FC measurements by observed value"</span></span>
<span id="cb95-1095"><a href="#cb95-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1096"><a href="#cb95-1096" aria-hidden="true" tabindex="-1"></a>crp <span class="sc">%&gt;%</span></span>
<span id="cb95-1097"><a href="#cb95-1097" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> crp_result)) <span class="sc">+</span></span>
<span id="cb95-1098"><a href="#cb95-1098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-1099"><a href="#cb95-1099" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-1100"><a href="#cb95-1100" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-1101"><a href="#cb95-1101" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#FFC800"</span>,</span>
<span id="cb95-1102"><a href="#cb95-1102" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#FF8427"</span></span>
<span id="cb95-1103"><a href="#cb95-1103" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-1104"><a href="#cb95-1104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1105"><a href="#cb95-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-1106"><a href="#cb95-1106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"CRP (mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb95-1107"><a href="#cb95-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb95-1108"><a href="#cb95-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1109"><a href="#cb95-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1110"><a href="#cb95-1110" aria-hidden="true" tabindex="-1"></a>As with the FC data, the CRP data is also log transformed</span>
<span id="cb95-1111"><a href="#cb95-1111" aria-hidden="true" tabindex="-1"></a>(@fig-logcrp-meas).</span>
<span id="cb95-1112"><a href="#cb95-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1115"><a href="#cb95-1115" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1116"><a href="#cb95-1116" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fig-logcrp-meas"</span></span>
<span id="cb95-1117"><a href="#cb95-1117" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Density plot of logged CRP test results"</span></span>
<span id="cb95-1118"><a href="#cb95-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1119"><a href="#cb95-1119" aria-hidden="true" tabindex="-1"></a>crp <span class="sc">%&gt;%</span></span>
<span id="cb95-1120"><a href="#cb95-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(crp_result))) <span class="sc">+</span></span>
<span id="cb95-1121"><a href="#cb95-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-1122"><a href="#cb95-1122" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-1123"><a href="#cb95-1123" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-1124"><a href="#cb95-1124" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#FFC800"</span>,</span>
<span id="cb95-1125"><a href="#cb95-1125" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#FF8427"</span></span>
<span id="cb95-1126"><a href="#cb95-1126" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-1127"><a href="#cb95-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1128"><a href="#cb95-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-1129"><a href="#cb95-1129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(CRP (mg/L))"</span>) <span class="sc">+</span></span>
<span id="cb95-1130"><a href="#cb95-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb95-1131"><a href="#cb95-1131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1132"><a href="#cb95-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1133"><a href="#cb95-1133" aria-hidden="true" tabindex="-1"></a>Observing @fig-logcrp-meas, it would appear the influence of extremely</span>
<span id="cb95-1134"><a href="#cb95-1134" aria-hidden="true" tabindex="-1"></a>elevated CRP results will be minimal.</span>
<span id="cb95-1135"><a href="#cb95-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1136"><a href="#cb95-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">### Removal of duplicates</span></span>
<span id="cb95-1137"><a href="#cb95-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1140"><a href="#cb95-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1141"><a href="#cb95-1141" aria-hidden="true" tabindex="-1"></a>crp <span class="ot">&lt;-</span> crp <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ids,</span>
<span id="cb95-1142"><a href="#cb95-1142" aria-hidden="true" tabindex="-1"></a>  crp_date,</span>
<span id="cb95-1143"><a href="#cb95-1143" aria-hidden="true" tabindex="-1"></a>  crp_result,</span>
<span id="cb95-1144"><a href="#cb95-1144" aria-hidden="true" tabindex="-1"></a>  <span class="at">.keep_all =</span> <span class="cn">TRUE</span></span>
<span id="cb95-1145"><a href="#cb95-1145" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-1146"><a href="#cb95-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1147"><a href="#cb95-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1148"><a href="#cb95-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1149"><a href="#cb95-1149" aria-hidden="true" tabindex="-1"></a>As multiple CRP measurements are possible within a short time-frame, we only </span>
<span id="cb95-1150"><a href="#cb95-1150" aria-hidden="true" tabindex="-1"></a>consider as duplicates those with an exact match by <span class="in">`ids`</span>, <span class="in">`crp_date`</span> and</span>
<span id="cb95-1151"><a href="#cb95-1151" aria-hidden="true" tabindex="-1"></a><span class="in">`crp_result`</span>. </span>
<span id="cb95-1152"><a href="#cb95-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1153"><a href="#cb95-1153" aria-hidden="true" tabindex="-1"></a><span class="fu">### Retiming - part 1</span></span>
<span id="cb95-1154"><a href="#cb95-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1155"><a href="#cb95-1155" aria-hidden="true" tabindex="-1"></a>As with the FCAL data, the times of CRP measurements are retimed and</span>
<span id="cb95-1156"><a href="#cb95-1156" aria-hidden="true" tabindex="-1"></a>scaled to be the number of years since IBD diagnosis.</span>
<span id="cb95-1157"><a href="#cb95-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1158"><a href="#cb95-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```{R CRP time mapping}</span></span>
<span id="cb95-1159"><a href="#cb95-1159" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-crp-spag-pre</span></span>
<span id="cb95-1160"><a href="#cb95-1160" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Spaghetti plot of CRP trajectories (preprocessed)"</span></span>
<span id="cb95-1161"><a href="#cb95-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1162"><a href="#cb95-1162" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- merge(crp, dict[, c("ids", "date.of.diag")],</span></span>
<span id="cb95-1163"><a href="#cb95-1163" aria-hidden="true" tabindex="-1"></a><span class="in">  by = "ids", all.x = TRUE, all.y = FALSE</span></span>
<span id="cb95-1164"><a href="#cb95-1164" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-1165"><a href="#cb95-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1166"><a href="#cb95-1166" aria-hidden="true" tabindex="-1"></a><span class="in"># Dates have already been converted to Date class by fix_date_char() for dict</span></span>
<span id="cb95-1167"><a href="#cb95-1167" aria-hidden="true" tabindex="-1"></a><span class="in">crp$crp_time &lt;- as.numeric(crp$crp_date - crp$date.of.diag) / 365.25</span></span>
<span id="cb95-1168"><a href="#cb95-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1169"><a href="#cb95-1169" aria-hidden="true" tabindex="-1"></a><span class="in">crp %&gt;%</span></span>
<span id="cb95-1170"><a href="#cb95-1170" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = crp_time, y = log(crp_result), color = factor(ids))) +</span></span>
<span id="cb95-1171"><a href="#cb95-1171" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(alpha = 0.2) +</span></span>
<span id="cb95-1172"><a href="#cb95-1172" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.3) +</span></span>
<span id="cb95-1173"><a href="#cb95-1173" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1174"><a href="#cb95-1174" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = viridis::viridis(length(unique(crp$ids)))) +</span></span>
<span id="cb95-1175"><a href="#cb95-1175" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = "none") +</span></span>
<span id="cb95-1176"><a href="#cb95-1176" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Time (years)") +</span></span>
<span id="cb95-1177"><a href="#cb95-1177" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Log(CRP (mg/L))") +</span></span>
<span id="cb95-1178"><a href="#cb95-1178" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("")</span></span>
<span id="cb95-1179"><a href="#cb95-1179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1180"><a href="#cb95-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1181"><a href="#cb95-1181" aria-hidden="true" tabindex="-1"></a>As should be expected given the ubiquitous nature of CRP testing, many</span>
<span id="cb95-1182"><a href="#cb95-1182" aria-hidden="true" tabindex="-1"></a>CRP observations are earlier than diagnosis (@fig-crp-spag-pre). Tests</span>
<span id="cb95-1183"><a href="#cb95-1183" aria-hidden="true" tabindex="-1"></a>taken close to reported date of diagnosis are likely "early" as a result</span>
<span id="cb95-1184"><a href="#cb95-1184" aria-hidden="true" tabindex="-1"></a>of diagnostic delay whereas tests from much earlier were likely</span>
<span id="cb95-1185"><a href="#cb95-1185" aria-hidden="true" tabindex="-1"></a>requested due to other conditions.</span>
<span id="cb95-1186"><a href="#cb95-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1187"><a href="#cb95-1187" aria-hidden="true" tabindex="-1"></a>As with FCAL, CRP results earlier than 90 days prior to diagnosis will</span>
<span id="cb95-1188"><a href="#cb95-1188" aria-hidden="true" tabindex="-1"></a>be discarded. If a subject has a CRP within 90 days before diagnosis,</span>
<span id="cb95-1189"><a href="#cb95-1189" aria-hidden="true" tabindex="-1"></a>then all of their CRP tests will be retimed such that their earliest CRP</span>
<span id="cb95-1190"><a href="#cb95-1190" aria-hidden="true" tabindex="-1"></a>within this period is equal to 0 and all later measurements are shifted</span>
<span id="cb95-1191"><a href="#cb95-1191" aria-hidden="true" tabindex="-1"></a>accordingly to maintain the same differences between measurement times.</span>
<span id="cb95-1192"><a href="#cb95-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1193"><a href="#cb95-1193" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb95-1194"><a href="#cb95-1194" aria-hidden="true" tabindex="-1"></a>This may mean $t_0$ corresponds to slightly different dates across FCAL</span>
<span id="cb95-1195"><a href="#cb95-1195" aria-hidden="true" tabindex="-1"></a>and CRP for the same subject.</span>
<span id="cb95-1196"><a href="#cb95-1196" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb95-1197"><a href="#cb95-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1198"><a href="#cb95-1198" aria-hidden="true" tabindex="-1"></a>We also reduce the dataset to only subjects with a diagnostic CRP which</span>
<span id="cb95-1199"><a href="#cb95-1199" aria-hidden="true" tabindex="-1"></a>equates to subjects with a CRP measurement within 3 months of diagnosis</span>
<span id="cb95-1200"><a href="#cb95-1200" aria-hidden="true" tabindex="-1"></a>$t \leq 0.25$</span>
<span id="cb95-1201"><a href="#cb95-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1204"><a href="#cb95-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb95-1205"><a href="#cb95-1205" aria-hidden="true" tabindex="-1"></a>crp <span class="ot">&lt;-</span> <span class="fu">subset</span>(crp, crp_time <span class="sc">&gt;=</span> <span class="sc">-</span><span class="fl">0.25</span>)</span>
<span id="cb95-1206"><a href="#cb95-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1207"><a href="#cb95-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1208"><a href="#cb95-1208" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inclusion/exclusion: removal of subjects without a diagnostic CRP test</span></span>
<span id="cb95-1209"><a href="#cb95-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1210"><a href="#cb95-1210" aria-hidden="true" tabindex="-1"></a>As indicated in our inclusion/exclusion criteria, we reduce the dataset to only </span>
<span id="cb95-1211"><a href="#cb95-1211" aria-hidden="true" tabindex="-1"></a>subjects with a diagnostic FC. This equates to subjects with at least one FCAL </span>
<span id="cb95-1212"><a href="#cb95-1212" aria-hidden="true" tabindex="-1"></a>measurement within 3 months of diagnosis $t \leq 0.25$.</span>
<span id="cb95-1213"><a href="#cb95-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1214"><a href="#cb95-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```{R CRP retiming}</span></span>
<span id="cb95-1215"><a href="#cb95-1215" aria-hidden="true" tabindex="-1"></a><span class="in">diagnostic &lt;- crp %&gt;%</span></span>
<span id="cb95-1216"><a href="#cb95-1216" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ids) %&gt;%</span></span>
<span id="cb95-1217"><a href="#cb95-1217" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = sum(crp_time &lt; 0.25)) %&gt;%</span></span>
<span id="cb95-1218"><a href="#cb95-1218" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n &gt; 0)</span></span>
<span id="cb95-1219"><a href="#cb95-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1220"><a href="#cb95-1220" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- subset(crp, ids %in% diagnostic$ids)</span></span>
<span id="cb95-1221"><a href="#cb95-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1222"><a href="#cb95-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1223"><a href="#cb95-1223" aria-hidden="true" tabindex="-1"></a>After this exclusion, <span class="in">`r length(unique(crp$ids))`</span> remain in the data. </span>
<span id="cb95-1224"><a href="#cb95-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1227"><a href="#cb95-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1228"><a href="#cb95-1228" aria-hidden="true" tabindex="-1"></a>diag.time <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb95-1229"><a href="#cb95-1229" aria-hidden="true" tabindex="-1"></a>crp.ids <span class="ot">&lt;-</span>  <span class="fu">unique</span>(crp<span class="sc">$</span>ids)</span>
<span id="cb95-1230"><a href="#cb95-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1231"><a href="#cb95-1231" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> crp.ids) {</span>
<span id="cb95-1232"><a href="#cb95-1232" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">subset</span>(crp, ids <span class="sc">==</span> id)</span>
<span id="cb95-1233"><a href="#cb95-1233" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> temp[<span class="fu">order</span>(temp<span class="sc">$</span>crp_time), ]</span>
<span id="cb95-1234"><a href="#cb95-1234" aria-hidden="true" tabindex="-1"></a>  diag.time <span class="ot">&lt;-</span> <span class="fu">c</span>(diag.time, temp[<span class="dv">1</span>, <span class="st">"crp_time"</span>])</span>
<span id="cb95-1235"><a href="#cb95-1235" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-1236"><a href="#cb95-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1237"><a href="#cb95-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1238"><a href="#cb95-1238" aria-hidden="true" tabindex="-1"></a>crp.dist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ids =</span> crp.ids, <span class="at">diagnostic =</span> diag.time)</span>
<span id="cb95-1239"><a href="#cb95-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1240"><a href="#cb95-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(crp.dist, <span class="fu">paste0</span>(prefix, <span class="st">"processed/crp-diag-dist.RDS"</span>))</span>
<span id="cb95-1241"><a href="#cb95-1241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1242"><a href="#cb95-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1243"><a href="#cb95-1243" aria-hidden="true" tabindex="-1"></a><span class="fu">### Retiming - part 2</span></span>
<span id="cb95-1244"><a href="#cb95-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1245"><a href="#cb95-1245" aria-hidden="true" tabindex="-1"></a>Here, we show the distribution of the diagnostic CRP measurements with</span>
<span id="cb95-1246"><a href="#cb95-1246" aria-hidden="true" tabindex="-1"></a>respect to diagnosis date (in days). </span>
<span id="cb95-1247"><a href="#cb95-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1248"><a href="#cb95-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r crp days before diag}</span></span>
<span id="cb95-1249"><a href="#cb95-1249" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- crp %&gt;%</span></span>
<span id="cb95-1250"><a href="#cb95-1250" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ids) %&gt;%</span></span>
<span id="cb95-1251"><a href="#cb95-1251" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(crp_time == min(crp_time)) %&gt;%</span></span>
<span id="cb95-1252"><a href="#cb95-1252" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = crp_time * 365.25)) +</span></span>
<span id="cb95-1253"><a href="#cb95-1253" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(fill = "#415A77", color = "#1B263B") +</span></span>
<span id="cb95-1254"><a href="#cb95-1254" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1255"><a href="#cb95-1255" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb95-1256"><a href="#cb95-1256" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Density",</span></span>
<span id="cb95-1257"><a href="#cb95-1257" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Time from diagnosis to first CRP (days)"</span></span>
<span id="cb95-1258"><a href="#cb95-1258" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb95-1259"><a href="#cb95-1259" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, linetype = "dashed", color = "red")</span></span>
<span id="cb95-1260"><a href="#cb95-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1261"><a href="#cb95-1261" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("plots/crp-diagnostic-dist.png",</span></span>
<span id="cb95-1262"><a href="#cb95-1262" aria-hidden="true" tabindex="-1"></a><span class="in">  p,</span></span>
<span id="cb95-1263"><a href="#cb95-1263" aria-hidden="true" tabindex="-1"></a><span class="in">  width = 16 * 2 / 3,</span></span>
<span id="cb95-1264"><a href="#cb95-1264" aria-hidden="true" tabindex="-1"></a><span class="in">  height = 6,</span></span>
<span id="cb95-1265"><a href="#cb95-1265" aria-hidden="true" tabindex="-1"></a><span class="in">  units = "in"</span></span>
<span id="cb95-1266"><a href="#cb95-1266" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-1267"><a href="#cb95-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1268"><a href="#cb95-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1269"><a href="#cb95-1269" aria-hidden="true" tabindex="-1"></a>Similar to what was observed for FC, most diagnostic measurements were around </span>
<span id="cb95-1270"><a href="#cb95-1270" aria-hidden="true" tabindex="-1"></a>the recorded diagnosis time (near zero). Here, we also retime </span>
<span id="cb95-1271"><a href="#cb95-1271" aria-hidden="true" tabindex="-1"></a>measurements/diagnosis time as described above (i.e. time = 0</span>
<span id="cb95-1272"><a href="#cb95-1272" aria-hidden="true" tabindex="-1"></a>matches the time of first available CRP measurement). This is only applied to</span>
<span id="cb95-1273"><a href="#cb95-1273" aria-hidden="true" tabindex="-1"></a>individuals for which the first available CRP is prior to the recorded diagnosis</span>
<span id="cb95-1274"><a href="#cb95-1274" aria-hidden="true" tabindex="-1"></a>time.</span>
<span id="cb95-1275"><a href="#cb95-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1278"><a href="#cb95-1278" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1279"><a href="#cb95-1279" aria-hidden="true" tabindex="-1"></a><span class="co"># Retime so that t_0 = 0.</span></span>
<span id="cb95-1280"><a href="#cb95-1280" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> <span class="fu">unique</span>(crp<span class="sc">$</span>ids)) {</span>
<span id="cb95-1281"><a href="#cb95-1281" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">subset</span>(crp, ids <span class="sc">==</span> id)</span>
<span id="cb95-1282"><a href="#cb95-1282" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(temp<span class="sc">$</span>crp_time <span class="sc">&lt;</span> <span class="dv">0</span>)) {</span>
<span id="cb95-1283"><a href="#cb95-1283" aria-hidden="true" tabindex="-1"></a>    add <span class="ot">&lt;-</span> <span class="fu">sort</span>(temp<span class="sc">$</span>crp_time)[<span class="dv">1</span>]</span>
<span id="cb95-1284"><a href="#cb95-1284" aria-hidden="true" tabindex="-1"></a>    crp[crp[, <span class="st">"ids"</span>] <span class="sc">==</span> id, <span class="st">"crp_time"</span>] <span class="ot">&lt;-</span></span>
<span id="cb95-1285"><a href="#cb95-1285" aria-hidden="true" tabindex="-1"></a>      crp[crp[, <span class="st">"ids"</span>] <span class="sc">==</span> id, <span class="st">"crp_time"</span>] <span class="sc">+</span> <span class="fu">abs</span>(add)</span>
<span id="cb95-1286"><a href="#cb95-1286" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-1287"><a href="#cb95-1287" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-1288"><a href="#cb95-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1289"><a href="#cb95-1289" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(crp<span class="sc">$</span>ids))</span>
<span id="cb95-1290"><a href="#cb95-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1291"><a href="#cb95-1291" aria-hidden="true" tabindex="-1"></a>crp <span class="sc">%&gt;%</span></span>
<span id="cb95-1292"><a href="#cb95-1292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> crp_time, <span class="at">y =</span> <span class="fu">log</span>(crp_result), <span class="at">color =</span> <span class="fu">factor</span>(ids))) <span class="sc">+</span></span>
<span id="cb95-1293"><a href="#cb95-1293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb95-1294"><a href="#cb95-1294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb95-1295"><a href="#cb95-1295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1296"><a href="#cb95-1296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="fu">length</span>(<span class="fu">unique</span>(crp<span class="sc">$</span>ids)))) <span class="sc">+</span></span>
<span id="cb95-1297"><a href="#cb95-1297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb95-1298"><a href="#cb95-1298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (years)"</span>) <span class="sc">+</span></span>
<span id="cb95-1299"><a href="#cb95-1299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Log(CRP (mg/L))"</span>) <span class="sc">+</span></span>
<span id="cb95-1300"><a href="#cb95-1300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span>
<span id="cb95-1301"><a href="#cb95-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1302"><a href="#cb95-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1303"><a href="#cb95-1303" aria-hidden="true" tabindex="-1"></a>At this stage, we also exclude CRP measurements recorded beyond 7-years post</span>
<span id="cb95-1304"><a href="#cb95-1304" aria-hidden="true" tabindex="-1"></a>diagnosis. </span>
<span id="cb95-1305"><a href="#cb95-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1306"><a href="#cb95-1306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove crp after 7 years}</span></span>
<span id="cb95-1307"><a href="#cb95-1307" aria-hidden="true" tabindex="-1"></a><span class="in">crp &lt;- subset(crp, crp_time &lt;= 7)</span></span>
<span id="cb95-1308"><a href="#cb95-1308" aria-hidden="true" tabindex="-1"></a><span class="in">length(unique(crp$ids))</span></span>
<span id="cb95-1309"><a href="#cb95-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1310"><a href="#cb95-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1311"><a href="#cb95-1311" aria-hidden="true" tabindex="-1"></a>At this point, the data contains <span class="in">`r nrow(fcal)`</span> FCAL measurements across all</span>
<span id="cb95-1312"><a href="#cb95-1312" aria-hidden="true" tabindex="-1"></a><span class="in">`r length(unique(fcal$ids))`</span> individuals. </span>
<span id="cb95-1313"><a href="#cb95-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1314"><a href="#cb95-1314" aria-hidden="true" tabindex="-1"></a><span class="fu">### Additional pre-processing</span></span>
<span id="cb95-1315"><a href="#cb95-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1316"><a href="#cb95-1316" aria-hidden="true" tabindex="-1"></a>Here, we summarise the number of observations per individual (with and without</span>
<span id="cb95-1317"><a href="#cb95-1317" aria-hidden="true" tabindex="-1"></a>considering censored values) as well as length of follow-up. The latter is </span>
<span id="cb95-1318"><a href="#cb95-1318" aria-hidden="true" tabindex="-1"></a>defined as the difference (in years) between diagnosis time and the time of the </span>
<span id="cb95-1319"><a href="#cb95-1319" aria-hidden="true" tabindex="-1"></a>latest CRP measurement. </span>
<span id="cb95-1320"><a href="#cb95-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1321"><a href="#cb95-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```{R crp followup pre exclusions}</span></span>
<span id="cb95-1322"><a href="#cb95-1322" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-crp-follow-up</span></span>
<span id="cb95-1323"><a href="#cb95-1323" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "(A) Histogram of the number of CRP measurements per subject. (B) Histogram of CRP follow-up per subject (before exclusions). (C) Scatterplot with number of CRP measurements vs follow-up."</span></span>
<span id="cb95-1324"><a href="#cb95-1324" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 12</span></span>
<span id="cb95-1325"><a href="#cb95-1325" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: body-outset</span></span>
<span id="cb95-1326"><a href="#cb95-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1327"><a href="#cb95-1327" aria-hidden="true" tabindex="-1"></a><span class="in">countsDF &lt;- crp %&gt;%</span></span>
<span id="cb95-1328"><a href="#cb95-1328" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ids) %&gt;%</span></span>
<span id="cb95-1329"><a href="#cb95-1329" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb95-1330"><a href="#cb95-1330" aria-hidden="true" tabindex="-1"></a><span class="in">    n.total = n(),</span></span>
<span id="cb95-1331"><a href="#cb95-1331" aria-hidden="true" tabindex="-1"></a><span class="in">    censored.left = sum(crp_result == 1),</span></span>
<span id="cb95-1332"><a href="#cb95-1332" aria-hidden="true" tabindex="-1"></a><span class="in">    n.noncensored = n.total - censored.left,</span></span>
<span id="cb95-1333"><a href="#cb95-1333" aria-hidden="true" tabindex="-1"></a><span class="in">    n.negtime.nondiag = sum(crp_time != 0 &amp; crp_date - date.of.diag &lt; 0),</span></span>
<span id="cb95-1334"><a href="#cb95-1334" aria-hidden="true" tabindex="-1"></a><span class="in">    followup = max(crp_time)</span></span>
<span id="cb95-1335"><a href="#cb95-1335" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb95-1336"><a href="#cb95-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1337"><a href="#cb95-1337" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1338"><a href="#cb95-1338" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = n.total)) +</span></span>
<span id="cb95-1339"><a href="#cb95-1339" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-1340"><a href="#cb95-1340" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1341"><a href="#cb95-1341" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-1342"><a href="#cb95-1342" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Measurements per subject")</span></span>
<span id="cb95-1343"><a href="#cb95-1343" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1344"><a href="#cb95-1344" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = followup)) +</span></span>
<span id="cb95-1345"><a href="#cb95-1345" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-1346"><a href="#cb95-1346" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1347"><a href="#cb95-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-1348"><a href="#cb95-1348" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years)")</span></span>
<span id="cb95-1349"><a href="#cb95-1349" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1350"><a href="#cb95-1350" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(y = n.total, x = followup)) +</span></span>
<span id="cb95-1351"><a href="#cb95-1351" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hex() +</span></span>
<span id="cb95-1352"><a href="#cb95-1352" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years since diagnosis)") +</span></span>
<span id="cb95-1353"><a href="#cb95-1353" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Number of CRP measurements") +</span></span>
<span id="cb95-1354"><a href="#cb95-1354" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1355"><a href="#cb95-1355" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Count")</span></span>
<span id="cb95-1356"><a href="#cb95-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1357"><a href="#cb95-1357" aria-hidden="true" tabindex="-1"></a><span class="in">p1 + p2 + p3 + plot_annotation(tag_levels = "A")</span></span>
<span id="cb95-1358"><a href="#cb95-1358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1359"><a href="#cb95-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1360"><a href="#cb95-1360" aria-hidden="true" tabindex="-1"></a>Our observations are very similar to what we had for FCAL. However, as CRP</span>
<span id="cb95-1361"><a href="#cb95-1361" aria-hidden="true" tabindex="-1"></a>measurement frequency is higher, we find a lower proportion of individuals with</span>
<span id="cb95-1362"><a href="#cb95-1362" aria-hidden="true" tabindex="-1"></a>a low follow-up time. </span>
<span id="cb95-1363"><a href="#cb95-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1364"><a href="#cb95-1364" aria-hidden="true" tabindex="-1"></a>As CRP is not specific to gastrointestinal inflammation, a variety of factors </span>
<span id="cb95-1365"><a href="#cb95-1365" aria-hidden="true" tabindex="-1"></a>(e.g. infection) can affect the measurements. To focus on long-term trends, </span>
<span id="cb95-1366"><a href="#cb95-1366" aria-hidden="true" tabindex="-1"></a>further processing was applied to smooth out short-term fluctuations. </span>
<span id="cb95-1367"><a href="#cb95-1367" aria-hidden="true" tabindex="-1"></a>Measurements were grouped into intervals of t: [0, 0.5), [0.5, 1.5), [1.5, 2.5), </span>
<span id="cb95-1368"><a href="#cb95-1368" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">2.5, 3.5), [3.5, 4.5), [4.5, 5.5), [5.5, 7</span><span class="co">]</span>, where t = 0 (years) is the time </span>
<span id="cb95-1369"><a href="#cb95-1369" aria-hidden="true" tabindex="-1"></a>of diagnosis. The median CRP for each interval was calculated for each subject</span>
<span id="cb95-1370"><a href="#cb95-1370" aria-hidden="true" tabindex="-1"></a>and used as input for subsequent analyses. The centre of each interval was used </span>
<span id="cb95-1371"><a href="#cb95-1371" aria-hidden="true" tabindex="-1"></a>as the corresponding observation time. </span>
<span id="cb95-1372"><a href="#cb95-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1373"><a href="#cb95-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r crp additional preproc}</span></span>
<span id="cb95-1374"><a href="#cb95-1374" aria-hidden="true" tabindex="-1"></a><span class="in">id.list &lt;- unique(crp$ids)</span></span>
<span id="cb95-1375"><a href="#cb95-1375" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma &lt;- matrix(NA, nrow = length(id.list), ncol = 7)</span></span>
<span id="cb95-1376"><a href="#cb95-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1377"><a href="#cb95-1377" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in seq_along(id.list)) {</span></span>
<span id="cb95-1378"><a href="#cb95-1378" aria-hidden="true" tabindex="-1"></a><span class="in">  subject_data &lt;- subset(crp, ids == id.list[i])</span></span>
<span id="cb95-1379"><a href="#cb95-1379" aria-hidden="true" tabindex="-1"></a><span class="in">  for (j in seq(0, 6)) {</span></span>
<span id="cb95-1380"><a href="#cb95-1380" aria-hidden="true" tabindex="-1"></a><span class="in">    if (j == 6) {</span></span>
<span id="cb95-1381"><a href="#cb95-1381" aria-hidden="true" tabindex="-1"></a><span class="in">      sub.obs &lt;- subset(</span></span>
<span id="cb95-1382"><a href="#cb95-1382" aria-hidden="true" tabindex="-1"></a><span class="in">        subject_data,</span></span>
<span id="cb95-1383"><a href="#cb95-1383" aria-hidden="true" tabindex="-1"></a><span class="in">        crp_time &gt;= j - 0.5 &amp; crp_time &lt;= j + 1</span></span>
<span id="cb95-1384"><a href="#cb95-1384" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb95-1385"><a href="#cb95-1385" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb95-1386"><a href="#cb95-1386" aria-hidden="true" tabindex="-1"></a><span class="in">      sub.obs &lt;- subset(</span></span>
<span id="cb95-1387"><a href="#cb95-1387" aria-hidden="true" tabindex="-1"></a><span class="in">        subject_data,</span></span>
<span id="cb95-1388"><a href="#cb95-1388" aria-hidden="true" tabindex="-1"></a><span class="in">        crp_time &gt;= j - 0.5 &amp; crp_time &lt; j + 0.5</span></span>
<span id="cb95-1389"><a href="#cb95-1389" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb95-1390"><a href="#cb95-1390" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb95-1391"><a href="#cb95-1391" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(sub.obs) &gt; 0) {</span></span>
<span id="cb95-1392"><a href="#cb95-1392" aria-hidden="true" tabindex="-1"></a><span class="in">      crp.ma[i, j + 1] &lt;- median(sub.obs$crp_result)</span></span>
<span id="cb95-1393"><a href="#cb95-1393" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb95-1394"><a href="#cb95-1394" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb95-1395"><a href="#cb95-1395" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb95-1396"><a href="#cb95-1396" aria-hidden="true" tabindex="-1"></a><span class="in">rownames(crp.ma) &lt;- id.list</span></span>
<span id="cb95-1397"><a href="#cb95-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1398"><a href="#cb95-1398" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert back to a long-format dataset and rename columns</span></span>
<span id="cb95-1399"><a href="#cb95-1399" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma &lt;- reshape2::melt(t(crp.ma), id.vars = row.names(crp.ma), na.rm = TRUE)</span></span>
<span id="cb95-1400"><a href="#cb95-1400" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(crp.ma) &lt;- c("crp_time", "ids", "crp_result")</span></span>
<span id="cb95-1401"><a href="#cb95-1401" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma &lt;- crp.ma[, c(2, 3, 1)]</span></span>
<span id="cb95-1402"><a href="#cb95-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1403"><a href="#cb95-1403" aria-hidden="true" tabindex="-1"></a><span class="in"># Reset the time to start at zero</span></span>
<span id="cb95-1404"><a href="#cb95-1404" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma$crp_time &lt;- crp.ma$crp_time - 1</span></span>
<span id="cb95-1405"><a href="#cb95-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1406"><a href="#cb95-1406" aria-hidden="true" tabindex="-1"></a><span class="in"># Take into account uneven spacing at start and end</span></span>
<span id="cb95-1407"><a href="#cb95-1407" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma$crp_time &lt;- plyr::mapvalues(crp.ma$crp_time,</span></span>
<span id="cb95-1408"><a href="#cb95-1408" aria-hidden="true" tabindex="-1"></a><span class="in">  from = c(0, 6),</span></span>
<span id="cb95-1409"><a href="#cb95-1409" aria-hidden="true" tabindex="-1"></a><span class="in">  to = c(0.25, 6.25)</span></span>
<span id="cb95-1410"><a href="#cb95-1410" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb95-1411"><a href="#cb95-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1412"><a href="#cb95-1412" aria-hidden="true" tabindex="-1"></a><span class="in"># Add diagnosis type back</span></span>
<span id="cb95-1413"><a href="#cb95-1413" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma &lt;- merge(crp.ma, dict[, -3], by = "ids", all.x = TRUE, all.y = FALSE)</span></span>
<span id="cb95-1414"><a href="#cb95-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1415"><a href="#cb95-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1416"><a href="#cb95-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inclusion/exclusion: a minimum number of CRP measurements</span></span>
<span id="cb95-1417"><a href="#cb95-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1418"><a href="#cb95-1418" aria-hidden="true" tabindex="-1"></a>Note that our inclusion criteria requires at least 3 CRP measurements per </span>
<span id="cb95-1419"><a href="#cb95-1419" aria-hidden="true" tabindex="-1"></a>individual. This is applied after the additional pre-processing applied in the</span>
<span id="cb95-1420"><a href="#cb95-1420" aria-hidden="true" tabindex="-1"></a>previous section. Here, we re-calculate relevant summary statistics. </span>
<span id="cb95-1421"><a href="#cb95-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1422"><a href="#cb95-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1423"><a href="#cb95-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```{R crp followup pre exclusions post processed}</span></span>
<span id="cb95-1424"><a href="#cb95-1424" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-crp-follow-up-postproc</span></span>
<span id="cb95-1425"><a href="#cb95-1425" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "(A) Histogram of the number of CRP measurements per subject. (B) Histogram of CRP follow-up per subject (before exclusions). (C) Scatterplot with number of CRP measurements vs follow-up."</span></span>
<span id="cb95-1426"><a href="#cb95-1426" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 12</span></span>
<span id="cb95-1427"><a href="#cb95-1427" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: body-outset</span></span>
<span id="cb95-1428"><a href="#cb95-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1429"><a href="#cb95-1429" aria-hidden="true" tabindex="-1"></a><span class="in">countsDF &lt;- crp.ma %&gt;%</span></span>
<span id="cb95-1430"><a href="#cb95-1430" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(ids) %&gt;%</span></span>
<span id="cb95-1431"><a href="#cb95-1431" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb95-1432"><a href="#cb95-1432" aria-hidden="true" tabindex="-1"></a><span class="in">    n.total = n(),</span></span>
<span id="cb95-1433"><a href="#cb95-1433" aria-hidden="true" tabindex="-1"></a><span class="in">    censored.left = sum(crp_result == 0), # 0 because it was log transformed</span></span>
<span id="cb95-1434"><a href="#cb95-1434" aria-hidden="true" tabindex="-1"></a><span class="in">    n.noncensored = n.total - censored.left,</span></span>
<span id="cb95-1435"><a href="#cb95-1435" aria-hidden="true" tabindex="-1"></a><span class="in">    followup = max(crp_time),</span></span>
<span id="cb95-1436"><a href="#cb95-1436" aria-hidden="true" tabindex="-1"></a><span class="in">    crp.var = var(crp_result, na.rm = TRUE)</span></span>
<span id="cb95-1437"><a href="#cb95-1437" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb95-1438"><a href="#cb95-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1439"><a href="#cb95-1439" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1440"><a href="#cb95-1440" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = n.total)) +</span></span>
<span id="cb95-1441"><a href="#cb95-1441" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-1442"><a href="#cb95-1442" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1443"><a href="#cb95-1443" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-1444"><a href="#cb95-1444" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Measurements per subject")</span></span>
<span id="cb95-1445"><a href="#cb95-1445" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1446"><a href="#cb95-1446" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = followup)) +</span></span>
<span id="cb95-1447"><a href="#cb95-1447" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-1448"><a href="#cb95-1448" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1449"><a href="#cb95-1449" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-1450"><a href="#cb95-1450" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years)")</span></span>
<span id="cb95-1451"><a href="#cb95-1451" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1452"><a href="#cb95-1452" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(y = n.total, x = followup)) +</span></span>
<span id="cb95-1453"><a href="#cb95-1453" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hex() +</span></span>
<span id="cb95-1454"><a href="#cb95-1454" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years since diagnosis)") +</span></span>
<span id="cb95-1455"><a href="#cb95-1455" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Number of CRP measurements") +</span></span>
<span id="cb95-1456"><a href="#cb95-1456" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1457"><a href="#cb95-1457" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Count")</span></span>
<span id="cb95-1458"><a href="#cb95-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1459"><a href="#cb95-1459" aria-hidden="true" tabindex="-1"></a><span class="in">p1 + p2 + p3 + plot_annotation(tag_levels = "A")</span></span>
<span id="cb95-1460"><a href="#cb95-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1461"><a href="#cb95-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1462"><a href="#cb95-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```{R calculate number of non censored CRP}</span></span>
<span id="cb95-1463"><a href="#cb95-1463" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of individuals with at least 3 CRP measurements</span></span>
<span id="cb95-1464"><a href="#cb95-1464" aria-hidden="true" tabindex="-1"></a><span class="in">sum(countsDF$n.total &gt;= 3)</span></span>
<span id="cb95-1465"><a href="#cb95-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1466"><a href="#cb95-1466" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of individuals with at least 3 CRP measurements and non zero variance</span></span>
<span id="cb95-1467"><a href="#cb95-1467" aria-hidden="true" tabindex="-1"></a><span class="in">sum(countsDF$n.total &gt;= 3 &amp; countsDF$crp.var != 0)</span></span>
<span id="cb95-1468"><a href="#cb95-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1469"><a href="#cb95-1469" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of individuals with at least 3 non-censored FCAL measurements</span></span>
<span id="cb95-1470"><a href="#cb95-1470" aria-hidden="true" tabindex="-1"></a><span class="in">sum(countsDF$n.noncensored &gt;= 3)</span></span>
<span id="cb95-1471"><a href="#cb95-1471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1472"><a href="#cb95-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1473"><a href="#cb95-1473" aria-hidden="true" tabindex="-1"></a>The following is used to select individuals with at least 3 CRP measurements</span>
<span id="cb95-1474"><a href="#cb95-1474" aria-hidden="true" tabindex="-1"></a>and non-zero variance.</span>
<span id="cb95-1475"><a href="#cb95-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1476"><a href="#cb95-1476" aria-hidden="true" tabindex="-1"></a><span class="in">```{R CRP frequency}</span></span>
<span id="cb95-1477"><a href="#cb95-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1478"><a href="#cb95-1478" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma.0 &lt;- crp.ma %&gt;%</span></span>
<span id="cb95-1479"><a href="#cb95-1479" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(ids %in% countsDF$ids[countsDF$n.total &gt;= 3 &amp; countsDF$crp.var == 0])</span></span>
<span id="cb95-1480"><a href="#cb95-1480" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(crp.ma.0, paste0(prefix, "processed/crp-ma-0.RDS"))</span></span>
<span id="cb95-1481"><a href="#cb95-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1482"><a href="#cb95-1482" aria-hidden="true" tabindex="-1"></a><span class="in">crp.ma &lt;- crp.ma %&gt;%</span></span>
<span id="cb95-1483"><a href="#cb95-1483" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(ids %in% countsDF$ids[countsDF$n.total &gt;= 3 &amp; countsDF$crp.var != 0])</span></span>
<span id="cb95-1484"><a href="#cb95-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1485"><a href="#cb95-1485" aria-hidden="true" tabindex="-1"></a><span class="in">length(unique(crp.ma$ids))</span></span>
<span id="cb95-1486"><a href="#cb95-1486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1487"><a href="#cb95-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1488"><a href="#cb95-1488" aria-hidden="true" tabindex="-1"></a>This leaves a cohort with <span class="in">`r length(unique(crp$ids))`</span> individuals.</span>
<span id="cb95-1489"><a href="#cb95-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1490"><a href="#cb95-1490" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--- CAV: I think we could include the nonzero variance subjects here ---&gt;</span></span>
<span id="cb95-1491"><a href="#cb95-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1492"><a href="#cb95-1492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r crp followup post exclusions}</span></span>
<span id="cb95-1493"><a href="#cb95-1493" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-crp-follow-up-post-exclusions</span></span>
<span id="cb95-1494"><a href="#cb95-1494" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "(A) Histogram of the number of CRP measurements per subject. (B) Histogram of FCAL follow-up per subject (before exclusions). (C) Scatterplot with number of CRP measurements vs follow-up. In all cases, only individuals with at least 3 measurements  and non-zero variance are included."</span></span>
<span id="cb95-1495"><a href="#cb95-1495" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1496"><a href="#cb95-1496" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n.total &gt;= 3 &amp; crp.var != 0) %&gt;%</span></span>
<span id="cb95-1497"><a href="#cb95-1497" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = n.total)) +</span></span>
<span id="cb95-1498"><a href="#cb95-1498" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-1499"><a href="#cb95-1499" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1500"><a href="#cb95-1500" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-1501"><a href="#cb95-1501" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Measurements per subject")</span></span>
<span id="cb95-1502"><a href="#cb95-1502" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1503"><a href="#cb95-1503" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n.total &gt;= 3 &amp; crp.var != 0) %&gt;%</span></span>
<span id="cb95-1504"><a href="#cb95-1504" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = followup)) +</span></span>
<span id="cb95-1505"><a href="#cb95-1505" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(color = "black", fill = "#5BBA6F", binwidth = 1) +</span></span>
<span id="cb95-1506"><a href="#cb95-1506" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1507"><a href="#cb95-1507" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Count") +</span></span>
<span id="cb95-1508"><a href="#cb95-1508" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years)")</span></span>
<span id="cb95-1509"><a href="#cb95-1509" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- countsDF %&gt;%</span></span>
<span id="cb95-1510"><a href="#cb95-1510" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(n.total &gt;= 3 &amp; crp.var != 0) %&gt;%</span></span>
<span id="cb95-1511"><a href="#cb95-1511" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(y = n.total, x = followup)) +</span></span>
<span id="cb95-1512"><a href="#cb95-1512" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(color = "#FF4F79", size = 2) +</span></span>
<span id="cb95-1513"><a href="#cb95-1513" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Follow-up (years since diagnosis)") +</span></span>
<span id="cb95-1514"><a href="#cb95-1514" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Number of FCAL measurements") +</span></span>
<span id="cb95-1515"><a href="#cb95-1515" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1516"><a href="#cb95-1516" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = 3)</span></span>
<span id="cb95-1517"><a href="#cb95-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1518"><a href="#cb95-1518" aria-hidden="true" tabindex="-1"></a><span class="in">p1 + p2 + p3 + plot_annotation(tag_levels = "A")</span></span>
<span id="cb95-1519"><a href="#cb95-1519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1520"><a href="#cb95-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1521"><a href="#cb95-1521" aria-hidden="true" tabindex="-1"></a><span class="fu">### Additional pre-processing</span></span>
<span id="cb95-1522"><a href="#cb95-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1523"><a href="#cb95-1523" aria-hidden="true" tabindex="-1"></a>Some subjects have the same</span>
<span id="cb95-1524"><a href="#cb95-1524" aria-hidden="true" tabindex="-1"></a>median log-transformed CRP across all of their observations, effectively</span>
<span id="cb95-1525"><a href="#cb95-1525" aria-hidden="true" tabindex="-1"></a>having a variance of 0. These subjects will be extracted and considered</span>
<span id="cb95-1526"><a href="#cb95-1526" aria-hidden="true" tabindex="-1"></a>as their own cluster, as they may cause numerical issues when model</span>
<span id="cb95-1527"><a href="#cb95-1527" aria-hidden="true" tabindex="-1"></a>fitting but remain of note.</span>
<span id="cb95-1528"><a href="#cb95-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1531"><a href="#cb95-1531" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1532"><a href="#cb95-1532" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> crp.ma <span class="sc">%&gt;%</span></span>
<span id="cb95-1533"><a href="#cb95-1533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> crp_result)) <span class="sc">+</span></span>
<span id="cb95-1534"><a href="#cb95-1534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-1535"><a href="#cb95-1535" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-1536"><a href="#cb95-1536" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-1537"><a href="#cb95-1537" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#EE92C2"</span>,</span>
<span id="cb95-1538"><a href="#cb95-1538" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#7B5D6F"</span></span>
<span id="cb95-1539"><a href="#cb95-1539" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-1540"><a href="#cb95-1540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1541"><a href="#cb95-1541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-1542"><a href="#cb95-1542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"CRP (mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb95-1543"><a href="#cb95-1543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb95-1544"><a href="#cb95-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1545"><a href="#cb95-1545" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> crp.ma <span class="sc">%&gt;%</span></span>
<span id="cb95-1546"><a href="#cb95-1546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(crp_result))) <span class="sc">+</span></span>
<span id="cb95-1547"><a href="#cb95-1547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-1548"><a href="#cb95-1548" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-1549"><a href="#cb95-1549" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-1550"><a href="#cb95-1550" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#ADF1D2"</span>,</span>
<span id="cb95-1551"><a href="#cb95-1551" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#50635A"</span></span>
<span id="cb95-1552"><a href="#cb95-1552" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-1553"><a href="#cb95-1553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1554"><a href="#cb95-1554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-1555"><a href="#cb95-1555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(CRP (mg/L))"</span>) <span class="sc">+</span></span>
<span id="cb95-1556"><a href="#cb95-1556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb95-1557"><a href="#cb95-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1558"><a href="#cb95-1558" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1 <span class="sc">+</span> p2)</span>
<span id="cb95-1559"><a href="#cb95-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1560"><a href="#cb95-1560" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots/crp-dist-ma.pdf"</span>, p1 <span class="sc">+</span> p2, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="fl">4.5</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb95-1561"><a href="#cb95-1561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1562"><a href="#cb95-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1563"><a href="#cb95-1563" aria-hidden="true" tabindex="-1"></a>There are <span class="in">`r nrow(crp.ma)`</span> total data points after the additional</span>
<span id="cb95-1564"><a href="#cb95-1564" aria-hidden="true" tabindex="-1"></a>preprocessing describing <span class="in">`r length(unique(crp.ma$ids))`</span> subjects.</span>
<span id="cb95-1565"><a href="#cb95-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1568"><a href="#cb95-1568" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1569"><a href="#cb95-1569" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-crp-ma-freq</span></span>
<span id="cb95-1570"><a href="#cb95-1570" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Quantiles for number of CRP observations per subject after additional preprocessing."</span></span>
<span id="cb95-1571"><a href="#cb95-1571" aria-hidden="true" tabindex="-1"></a>crp.ma <span class="sc">%&gt;%</span></span>
<span id="cb95-1572"><a href="#cb95-1572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1573"><a href="#cb95-1573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-1574"><a href="#cb95-1574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb95-1575"><a href="#cb95-1575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1576"><a href="#cb95-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1577"><a href="#cb95-1577" aria-hidden="true" tabindex="-1"></a><span class="fu">### Revisiting month of diagnosis</span></span>
<span id="cb95-1578"><a href="#cb95-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1579"><a href="#cb95-1579" aria-hidden="true" tabindex="-1"></a>After filtering by subjects who have a diagnostic CRP available, January</span>
<span id="cb95-1580"><a href="#cb95-1580" aria-hidden="true" tabindex="-1"></a>is no longer over-represented for month of diagnosis. This is a</span>
<span id="cb95-1581"><a href="#cb95-1581" aria-hidden="true" tabindex="-1"></a>comparable finding to FC (@fig-diag-month-redux).</span>
<span id="cb95-1582"><a href="#cb95-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1583"><a href="#cb95-1583" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Month of diagnosis (postprocessed)}</span></span>
<span id="cb95-1584"><a href="#cb95-1584" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-diag-month-redux-crp</span></span>
<span id="cb95-1585"><a href="#cb95-1585" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Bar plot of month of diagnosis"</span></span>
<span id="cb95-1586"><a href="#cb95-1586" aria-hidden="true" tabindex="-1"></a><span class="in">dict.temp &lt;- subset(dict, ids %in% unique(fcal$ids))</span></span>
<span id="cb95-1587"><a href="#cb95-1587" aria-hidden="true" tabindex="-1"></a><span class="in">dict.temp %&gt;%</span></span>
<span id="cb95-1588"><a href="#cb95-1588" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as.factor(month(date.of.diag, label = TRUE)))) +</span></span>
<span id="cb95-1589"><a href="#cb95-1589" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(color = "black", fill = "#FEC601", linewidth = 0.3) +</span></span>
<span id="cb95-1590"><a href="#cb95-1590" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1591"><a href="#cb95-1591" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency") +</span></span>
<span id="cb95-1592"><a href="#cb95-1592" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Month of IBD Diagnosis")</span></span>
<span id="cb95-1593"><a href="#cb95-1593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1594"><a href="#cb95-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1595"><a href="#cb95-1595" aria-hidden="true" tabindex="-1"></a><span class="fu">## Updated density plots</span></span>
<span id="cb95-1596"><a href="#cb95-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1597"><a href="#cb95-1597" aria-hidden="true" tabindex="-1"></a>The following plots are updated versions of previous density plots</span>
<span id="cb95-1598"><a href="#cb95-1598" aria-hidden="true" tabindex="-1"></a>(@fig-fcal-meas, @fig-logfcal-meas, @fig-crp-meas and @fig-logcrp-meas).</span>
<span id="cb95-1599"><a href="#cb95-1599" aria-hidden="true" tabindex="-1"></a>These plots only include subjects who have met the inclusion criteria.</span>
<span id="cb95-1600"><a href="#cb95-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1601"><a href="#cb95-1601" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Updated FCAL distribution}</span></span>
<span id="cb95-1602"><a href="#cb95-1602" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: "fig-fcal-meas-update"</span></span>
<span id="cb95-1603"><a href="#cb95-1603" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Updated density plot of FC measurements by observed value"</span></span>
<span id="cb95-1604"><a href="#cb95-1604" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb95-1605"><a href="#cb95-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1606"><a href="#cb95-1606" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- fcal %&gt;%</span></span>
<span id="cb95-1607"><a href="#cb95-1607" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = calpro_result)) +</span></span>
<span id="cb95-1608"><a href="#cb95-1608" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(</span></span>
<span id="cb95-1609"><a href="#cb95-1609" aria-hidden="true" tabindex="-1"></a><span class="in">    linewidth = 0.8,</span></span>
<span id="cb95-1610"><a href="#cb95-1610" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.5,</span></span>
<span id="cb95-1611"><a href="#cb95-1611" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#2E86AB",</span></span>
<span id="cb95-1612"><a href="#cb95-1612" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "#07004D"</span></span>
<span id="cb95-1613"><a href="#cb95-1613" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb95-1614"><a href="#cb95-1614" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1615"><a href="#cb95-1615" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank()) +</span></span>
<span id="cb95-1616"><a href="#cb95-1616" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("FC (µg/g)") +</span></span>
<span id="cb95-1617"><a href="#cb95-1617" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Density")</span></span>
<span id="cb95-1618"><a href="#cb95-1618" aria-hidden="true" tabindex="-1"></a><span class="in">print(p1)</span></span>
<span id="cb95-1619"><a href="#cb95-1619" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1620"><a href="#cb95-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1623"><a href="#cb95-1623" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1624"><a href="#cb95-1624" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fig-logfcal-meas-update"</span></span>
<span id="cb95-1625"><a href="#cb95-1625" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Updated density plot of logged FC test results"</span></span>
<span id="cb95-1626"><a href="#cb95-1626" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> fcal <span class="sc">%&gt;%</span></span>
<span id="cb95-1627"><a href="#cb95-1627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(calpro_result))) <span class="sc">+</span></span>
<span id="cb95-1628"><a href="#cb95-1628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-1629"><a href="#cb95-1629" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-1630"><a href="#cb95-1630" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-1631"><a href="#cb95-1631" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#F7A072"</span>,</span>
<span id="cb95-1632"><a href="#cb95-1632" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#936136"</span></span>
<span id="cb95-1633"><a href="#cb95-1633" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-1634"><a href="#cb95-1634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1635"><a href="#cb95-1635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-1636"><a href="#cb95-1636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(FC (µg/g))"</span>) <span class="sc">+</span></span>
<span id="cb95-1637"><a href="#cb95-1637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb95-1638"><a href="#cb95-1638" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span>
<span id="cb95-1639"><a href="#cb95-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1640"><a href="#cb95-1640" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots/fcal-dist.pdf"</span>, p1 <span class="sc">+</span> p2, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="fl">4.5</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb95-1641"><a href="#cb95-1641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1642"><a href="#cb95-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1643"><a href="#cb95-1643" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Updated CRP distribution}</span></span>
<span id="cb95-1644"><a href="#cb95-1644" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: "fig-crp-meas-update"</span></span>
<span id="cb95-1645"><a href="#cb95-1645" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Updated density plot of CRP measurements by observed value"</span></span>
<span id="cb95-1646"><a href="#cb95-1646" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb95-1647"><a href="#cb95-1647" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- crp %&gt;%</span></span>
<span id="cb95-1648"><a href="#cb95-1648" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = crp_result)) +</span></span>
<span id="cb95-1649"><a href="#cb95-1649" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(</span></span>
<span id="cb95-1650"><a href="#cb95-1650" aria-hidden="true" tabindex="-1"></a><span class="in">    linewidth = 0.8,</span></span>
<span id="cb95-1651"><a href="#cb95-1651" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.5,</span></span>
<span id="cb95-1652"><a href="#cb95-1652" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#EE92C2",</span></span>
<span id="cb95-1653"><a href="#cb95-1653" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "#7B5D6F"</span></span>
<span id="cb95-1654"><a href="#cb95-1654" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb95-1655"><a href="#cb95-1655" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1656"><a href="#cb95-1656" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank()) +</span></span>
<span id="cb95-1657"><a href="#cb95-1657" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("CRP (mg/L)") +</span></span>
<span id="cb95-1658"><a href="#cb95-1658" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Density")</span></span>
<span id="cb95-1659"><a href="#cb95-1659" aria-hidden="true" tabindex="-1"></a><span class="in">print(p3)</span></span>
<span id="cb95-1660"><a href="#cb95-1660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1661"><a href="#cb95-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1664"><a href="#cb95-1664" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1665"><a href="#cb95-1665" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fig-logcrp-meas-update"</span></span>
<span id="cb95-1666"><a href="#cb95-1666" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Updated density plot of logged CRP test results"</span></span>
<span id="cb95-1667"><a href="#cb95-1667" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> crp <span class="sc">%&gt;%</span></span>
<span id="cb95-1668"><a href="#cb95-1668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(crp_result))) <span class="sc">+</span></span>
<span id="cb95-1669"><a href="#cb95-1669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-1670"><a href="#cb95-1670" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-1671"><a href="#cb95-1671" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-1672"><a href="#cb95-1672" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#ADF1D2"</span>,</span>
<span id="cb95-1673"><a href="#cb95-1673" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#50635A"</span></span>
<span id="cb95-1674"><a href="#cb95-1674" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-1675"><a href="#cb95-1675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1676"><a href="#cb95-1676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-1677"><a href="#cb95-1677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(CRP (mg/L))"</span>) <span class="sc">+</span></span>
<span id="cb95-1678"><a href="#cb95-1678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb95-1679"><a href="#cb95-1679" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p4)</span>
<span id="cb95-1680"><a href="#cb95-1680" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots/crp-dist.pdf"</span>, p3 <span class="sc">+</span> p4, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="fl">4.5</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb95-1681"><a href="#cb95-1681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1682"><a href="#cb95-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1683"><a href="#cb95-1683" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Updated CRP distribution}</span></span>
<span id="cb95-1684"><a href="#cb95-1684" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: "fig-crp-meas-processed"</span></span>
<span id="cb95-1685"><a href="#cb95-1685" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Updated density plot of CRP after additional preprocessing"</span></span>
<span id="cb95-1686"><a href="#cb95-1686" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb95-1687"><a href="#cb95-1687" aria-hidden="true" tabindex="-1"></a><span class="in">p5 &lt;- crp.ma %&gt;%</span></span>
<span id="cb95-1688"><a href="#cb95-1688" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = crp_result)) +</span></span>
<span id="cb95-1689"><a href="#cb95-1689" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(</span></span>
<span id="cb95-1690"><a href="#cb95-1690" aria-hidden="true" tabindex="-1"></a><span class="in">    linewidth = 0.8,</span></span>
<span id="cb95-1691"><a href="#cb95-1691" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.5,</span></span>
<span id="cb95-1692"><a href="#cb95-1692" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = "#EE92C2",</span></span>
<span id="cb95-1693"><a href="#cb95-1693" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "#7B5D6F"</span></span>
<span id="cb95-1694"><a href="#cb95-1694" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb95-1695"><a href="#cb95-1695" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb95-1696"><a href="#cb95-1696" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank()) +</span></span>
<span id="cb95-1697"><a href="#cb95-1697" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Processed CRP (mg/L)") +</span></span>
<span id="cb95-1698"><a href="#cb95-1698" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Density")</span></span>
<span id="cb95-1699"><a href="#cb95-1699" aria-hidden="true" tabindex="-1"></a><span class="in">print(p5)</span></span>
<span id="cb95-1700"><a href="#cb95-1700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1701"><a href="#cb95-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1704"><a href="#cb95-1704" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1705"><a href="#cb95-1705" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "fig-logcrp-meas-processed"</span></span>
<span id="cb95-1706"><a href="#cb95-1706" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Updated density plot of logged CRP after additional preprocessing"</span></span>
<span id="cb95-1707"><a href="#cb95-1707" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> crp.ma <span class="sc">%&gt;%</span></span>
<span id="cb95-1708"><a href="#cb95-1708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(crp_result))) <span class="sc">+</span></span>
<span id="cb95-1709"><a href="#cb95-1709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(</span>
<span id="cb95-1710"><a href="#cb95-1710" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb95-1711"><a href="#cb95-1711" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-1712"><a href="#cb95-1712" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#ADF1D2"</span>,</span>
<span id="cb95-1713"><a href="#cb95-1713" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#50635A"</span></span>
<span id="cb95-1714"><a href="#cb95-1714" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-1715"><a href="#cb95-1715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-1716"><a href="#cb95-1716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-1717"><a href="#cb95-1717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(processed CRP (mg/L))"</span>) <span class="sc">+</span></span>
<span id="cb95-1718"><a href="#cb95-1718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb95-1719"><a href="#cb95-1719" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p6)</span>
<span id="cb95-1720"><a href="#cb95-1720" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots/crp-processed-dist.pdf"</span>,</span>
<span id="cb95-1721"><a href="#cb95-1721" aria-hidden="true" tabindex="-1"></a>  p5 <span class="sc">+</span> p6,</span>
<span id="cb95-1722"><a href="#cb95-1722" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb95-1723"><a href="#cb95-1723" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb95-1724"><a href="#cb95-1724" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb95-1725"><a href="#cb95-1725" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-1726"><a href="#cb95-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1727"><a href="#cb95-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1728"><a href="#cb95-1728" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> (p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p5 <span class="sc">+</span> p6) <span class="sc">+</span></span>
<span id="cb95-1729"><a href="#cb95-1729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">&amp;</span></span>
<span id="cb95-1730"><a href="#cb95-1730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb95-1731"><a href="#cb95-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1732"><a href="#cb95-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1733"><a href="#cb95-1733" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots/Sup-Figure-1.pdf"</span>,</span>
<span id="cb95-1734"><a href="#cb95-1734" aria-hidden="true" tabindex="-1"></a>  p,</span>
<span id="cb95-1735"><a href="#cb95-1735" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb95-1736"><a href="#cb95-1736" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">8</span>,</span>
<span id="cb95-1737"><a href="#cb95-1737" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb95-1738"><a href="#cb95-1738" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-1739"><a href="#cb95-1739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1740"><a href="#cb95-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1743"><a href="#cb95-1743" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1744"><a href="#cb95-1744" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of CRP observations (unprocessed) per subject</span></span>
<span id="cb95-1745"><a href="#cb95-1745" aria-hidden="true" tabindex="-1"></a>crp <span class="sc">%&gt;%</span></span>
<span id="cb95-1746"><a href="#cb95-1746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ids <span class="sc">%in%</span> <span class="fu">unique</span>(crp.ma<span class="sc">$</span>ids)) <span class="sc">%&gt;%</span></span>
<span id="cb95-1747"><a href="#cb95-1747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1748"><a href="#cb95-1748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-1749"><a href="#cb95-1749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb95-1750"><a href="#cb95-1750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1751"><a href="#cb95-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1754"><a href="#cb95-1754" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1755"><a href="#cb95-1755" aria-hidden="true" tabindex="-1"></a>crp <span class="sc">%&gt;%</span></span>
<span id="cb95-1756"><a href="#cb95-1756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ids <span class="sc">%in%</span> <span class="fu">unique</span>(crp.ma<span class="sc">$</span>ids)) <span class="sc">%&gt;%</span></span>
<span id="cb95-1757"><a href="#cb95-1757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1758"><a href="#cb95-1758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb95-1759"><a href="#cb95-1759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1760"><a href="#cb95-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1763"><a href="#cb95-1763" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1764"><a href="#cb95-1764" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of CRP observations (unprocessed) per subject for the overlap cohort</span></span>
<span id="cb95-1765"><a href="#cb95-1765" aria-hidden="true" tabindex="-1"></a>crp <span class="sc">%&gt;%</span></span>
<span id="cb95-1766"><a href="#cb95-1766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ids <span class="sc">%in%</span> <span class="fu">unique</span>(crp.ma<span class="sc">$</span>ids) <span class="sc">&amp;</span> ids <span class="sc">%in%</span> <span class="fu">unique</span>(fcal<span class="sc">$</span>ids)  ) <span class="sc">%&gt;%</span></span>
<span id="cb95-1767"><a href="#cb95-1767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1768"><a href="#cb95-1768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-1769"><a href="#cb95-1769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb95-1770"><a href="#cb95-1770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1771"><a href="#cb95-1771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1772"><a href="#cb95-1772" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data saving</span></span>
<span id="cb95-1773"><a href="#cb95-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1774"><a href="#cb95-1774" aria-hidden="true" tabindex="-1"></a>The processed subject dictionary and FC and CRP datasets have been saved</span>
<span id="cb95-1775"><a href="#cb95-1775" aria-hidden="true" tabindex="-1"></a>to files, so they can be used for the primary analysis.</span>
<span id="cb95-1776"><a href="#cb95-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1779"><a href="#cb95-1779" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1780"><a href="#cb95-1780" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(prefix, <span class="st">"processed"</span>))) {</span>
<span id="cb95-1781"><a href="#cb95-1781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(prefix, <span class="st">"processed"</span>))</span>
<span id="cb95-1782"><a href="#cb95-1782" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-1783"><a href="#cb95-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1784"><a href="#cb95-1784" aria-hidden="true" tabindex="-1"></a>fcal<span class="sc">$</span>calpro_result <span class="ot">&lt;-</span> <span class="fu">log</span>(fcal<span class="sc">$</span>calpro_result)</span>
<span id="cb95-1785"><a href="#cb95-1785" aria-hidden="true" tabindex="-1"></a>crp.ma<span class="sc">$</span>crp_result <span class="ot">&lt;-</span> <span class="fu">log</span>(crp.ma<span class="sc">$</span>crp_result)</span>
<span id="cb95-1786"><a href="#cb95-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1787"><a href="#cb95-1787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1788"><a href="#cb95-1788" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dict, <span class="fu">paste0</span>(prefix, <span class="st">"processed/dict-initial.RDS"</span>))</span>
<span id="cb95-1789"><a href="#cb95-1789" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fcal, <span class="fu">paste0</span>(prefix, <span class="st">"processed/fcal.RDS"</span>))</span>
<span id="cb95-1790"><a href="#cb95-1790" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(crp, <span class="fu">paste0</span>(prefix, <span class="st">"processed/crp.RDS"</span>))</span>
<span id="cb95-1791"><a href="#cb95-1791" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(crp.ma, <span class="fu">paste0</span>(prefix, <span class="st">"processed/median-crp.RDS"</span>))</span>
<span id="cb95-1792"><a href="#cb95-1792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1793"><a href="#cb95-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1794"><a href="#cb95-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1797"><a href="#cb95-1797" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1798"><a href="#cb95-1798" aria-hidden="true" tabindex="-1"></a>fcal <span class="sc">%&gt;%</span></span>
<span id="cb95-1799"><a href="#cb95-1799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ids <span class="sc">%in%</span> crp.ma<span class="sc">$</span>ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1800"><a href="#cb95-1800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1801"><a href="#cb95-1801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-1802"><a href="#cb95-1802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb95-1803"><a href="#cb95-1803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1804"><a href="#cb95-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1805"><a href="#cb95-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1808"><a href="#cb95-1808" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb95-1809"><a href="#cb95-1809" aria-hidden="true" tabindex="-1"></a>crp.ma <span class="sc">%&gt;%</span></span>
<span id="cb95-1810"><a href="#cb95-1810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ids <span class="sc">%in%</span> fcal<span class="sc">$</span>ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1811"><a href="#cb95-1811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ids) <span class="sc">%&gt;%</span></span>
<span id="cb95-1812"><a href="#cb95-1812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-1813"><a href="#cb95-1813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb95-1814"><a href="#cb95-1814" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb95-1815"><a href="#cb95-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1816"><a href="#cb95-1816" aria-hidden="true" tabindex="-1"></a><span class="fu">## Acknowledgments {.appendix}</span></span>
<span id="cb95-1817"><a href="#cb95-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1818"><a href="#cb95-1818" aria-hidden="true" tabindex="-1"></a>This work is funded by the Medical Research Council &amp; University of</span>
<span id="cb95-1819"><a href="#cb95-1819" aria-hidden="true" tabindex="-1"></a>Edinburgh via a Precision Medicine PhD studentship (MR/N013166/1, to</span>
<span id="cb95-1820"><a href="#cb95-1820" aria-hidden="true" tabindex="-1"></a>**NC-C**).</span>
<span id="cb95-1821"><a href="#cb95-1821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1822"><a href="#cb95-1822" aria-hidden="true" tabindex="-1"></a><span class="fu">## Author contributions {.appendix}</span></span>
<span id="cb95-1823"><a href="#cb95-1823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1824"><a href="#cb95-1824" aria-hidden="true" tabindex="-1"></a>**NC-C** performed the processing and wrote the text. **NP**, **ML**,</span>
<span id="cb95-1825"><a href="#cb95-1825" aria-hidden="true" tabindex="-1"></a>curated and provided datasets. **KM-G**, **CWL**, and **CAV** provided</span>
<span id="cb95-1826"><a href="#cb95-1826" aria-hidden="true" tabindex="-1"></a>supervisory support and assisted with revisions.</span>
<span id="cb95-1827"><a href="#cb95-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1828"><a href="#cb95-1828" aria-hidden="true" tabindex="-1"></a><span class="fu">## References {.appendix}</span></span>
<span id="cb95-1829"><a href="#cb95-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1830"><a href="#cb95-1830" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb95-1831"><a href="#cb95-1831" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb95-1832"><a href="#cb95-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1833"><a href="#cb95-1833" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reuse {.appendix}</span></span>
<span id="cb95-1834"><a href="#cb95-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1835"><a href="#cb95-1835" aria-hidden="true" tabindex="-1"></a>Licensed by &lt;a href="https://creativecommons.org/licenses/by/4.0/"&gt;CC</span>
<span id="cb95-1836"><a href="#cb95-1836" aria-hidden="true" tabindex="-1"></a>BY&lt;/a&gt; unless otherwise stated.</span>
<span id="cb95-1837"><a href="#cb95-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1838"><a href="#cb95-1838" aria-hidden="true" tabindex="-1"></a><span class="fu">##  {.appendix}</span></span>
<span id="cb95-1839"><a href="#cb95-1839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1840"><a href="#cb95-1840" aria-hidden="true" tabindex="-1"></a>::: center</span>
<span id="cb95-1841"><a href="#cb95-1841" aria-hidden="true" tabindex="-1"></a>&lt;img src="../../images/MRC_HGU_Edinburgh RGB.png" alt="MRC Human Genetics Unit logo" class="center" height="50px"/&gt;</span>
<span id="cb95-1842"><a href="#cb95-1842" aria-hidden="true" tabindex="-1"></a>&lt;img src="../../images/cgem-logo.png" alt="Centre for Genomic <span class="dv">&amp;amp;</span> Experimental Medicine logo" height="50px"/&gt;</span>
<span id="cb95-1843"><a href="#cb95-1843" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb95-1844"><a href="#cb95-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1845"><a href="#cb95-1845" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb95-1846"><a href="#cb95-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1847"><a href="#cb95-1847" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session info {.appendix}</span></span>
<span id="cb95-1848"><a href="#cb95-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-1849"><a href="#cb95-1849" aria-hidden="true" tabindex="-1"></a><span class="in">```{R Session info}</span></span>
<span id="cb95-1850"><a href="#cb95-1850" aria-hidden="true" tabindex="-1"></a><span class="in">pander(sessionInfo())</span></span>
<span id="cb95-1851"><a href="#cb95-1851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/VallejosGroup/Lothian-IBDR/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://x.com/IBDNathan">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>